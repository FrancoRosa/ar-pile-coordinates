var Kb=Object.defineProperty;var Yb=(t,e,n)=>e in t?Kb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var T=(t,e,n)=>Yb(t,typeof e!="symbol"?e+"":e,n);function Qb(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var v9=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ew={exports:{}},Tf={},tw={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cc=Symbol.for("react.element"),Jb=Symbol.for("react.portal"),Gb=Symbol.for("react.fragment"),eI=Symbol.for("react.strict_mode"),tI=Symbol.for("react.profiler"),nI=Symbol.for("react.provider"),rI=Symbol.for("react.context"),iI=Symbol.for("react.forward_ref"),sI=Symbol.for("react.suspense"),oI=Symbol.for("react.memo"),aI=Symbol.for("react.lazy"),$y=Symbol.iterator;function lI(t){return t===null||typeof t!="object"?null:(t=$y&&t[$y]||t["@@iterator"],typeof t=="function"?t:null)}var nw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rw=Object.assign,iw={};function ua(t,e,n){this.props=t,this.context=e,this.refs=iw,this.updater=n||nw}ua.prototype.isReactComponent={};ua.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ua.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function sw(){}sw.prototype=ua.prototype;function I_(t,e,n){this.props=t,this.context=e,this.refs=iw,this.updater=n||nw}var C_=I_.prototype=new sw;C_.constructor=I_;rw(C_,ua.prototype);C_.isPureReactComponent=!0;var Hy=Array.isArray,ow=Object.prototype.hasOwnProperty,P_={current:null},aw={key:!0,ref:!0,__self:!0,__source:!0};function lw(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)ow.call(e,r)&&!aw.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:cc,type:t,key:s,ref:o,props:i,_owner:P_.current}}function cI(t,e){return{$$typeof:cc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function x_(t){return typeof t=="object"&&t!==null&&t.$$typeof===cc}function uI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Xy=/\/+/g;function yd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?uI(""+t.key):e.toString(36)}function Pu(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case cc:case Jb:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+yd(o,0):r,Hy(i)?(n="",t!=null&&(n=t.replace(Xy,"$&/")+"/"),Pu(i,e,n,"",function(u){return u})):i!=null&&(x_(i)&&(i=cI(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Xy,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Hy(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+yd(s,a);o+=Pu(s,e,n,l,i)}else if(l=lI(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+yd(s,a++),o+=Pu(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Xc(t,e,n){if(t==null)return t;var r=[],i=0;return Pu(t,r,"","",function(s){return e.call(n,s,i++)}),r}function hI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wt={current:null},xu={transition:null},fI={ReactCurrentDispatcher:Wt,ReactCurrentBatchConfig:xu,ReactCurrentOwner:P_};function cw(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:Xc,forEach:function(t,e,n){Xc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Xc(t,function(){e++}),e},toArray:function(t){return Xc(t,function(e){return e})||[]},only:function(t){if(!x_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};he.Component=ua;he.Fragment=Gb;he.Profiler=tI;he.PureComponent=I_;he.StrictMode=eI;he.Suspense=sI;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fI;he.act=cw;he.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=rw({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=P_.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)ow.call(e,l)&&!aw.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:cc,type:t.type,key:i,ref:s,props:r,_owner:o}};he.createContext=function(t){return t={$$typeof:rI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:nI,_context:t},t.Consumer=t};he.createElement=lw;he.createFactory=function(t){var e=lw.bind(null,t);return e.type=t,e};he.createRef=function(){return{current:null}};he.forwardRef=function(t){return{$$typeof:iI,render:t}};he.isValidElement=x_;he.lazy=function(t){return{$$typeof:aI,_payload:{_status:-1,_result:t},_init:hI}};he.memo=function(t,e){return{$$typeof:oI,type:t,compare:e===void 0?null:e}};he.startTransition=function(t){var e=xu.transition;xu.transition={};try{t()}finally{xu.transition=e}};he.unstable_act=cw;he.useCallback=function(t,e){return Wt.current.useCallback(t,e)};he.useContext=function(t){return Wt.current.useContext(t)};he.useDebugValue=function(){};he.useDeferredValue=function(t){return Wt.current.useDeferredValue(t)};he.useEffect=function(t,e){return Wt.current.useEffect(t,e)};he.useId=function(){return Wt.current.useId()};he.useImperativeHandle=function(t,e,n){return Wt.current.useImperativeHandle(t,e,n)};he.useInsertionEffect=function(t,e){return Wt.current.useInsertionEffect(t,e)};he.useLayoutEffect=function(t,e){return Wt.current.useLayoutEffect(t,e)};he.useMemo=function(t,e){return Wt.current.useMemo(t,e)};he.useReducer=function(t,e,n){return Wt.current.useReducer(t,e,n)};he.useRef=function(t){return Wt.current.useRef(t)};he.useState=function(t){return Wt.current.useState(t)};he.useSyncExternalStore=function(t,e,n){return Wt.current.useSyncExternalStore(t,e,n)};he.useTransition=function(){return Wt.current.useTransition()};he.version="18.3.1";tw.exports=he;var Q=tw.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dI=Q,pI=Symbol.for("react.element"),gI=Symbol.for("react.fragment"),_I=Object.prototype.hasOwnProperty,mI=dI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yI={key:!0,ref:!0,__self:!0,__source:!0};function uw(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)_I.call(e,r)&&!yI.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:pI,type:t,key:s,ref:o,props:i,_owner:mI.current}}Tf.Fragment=gI;Tf.jsx=uw;Tf.jsxs=uw;ew.exports=Tf;var dt=ew.exports,hw={exports:{}},ln={},fw={exports:{}},dw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,ie){var ce=J.length;J.push(ie);e:for(;0<ce;){var xe=ce-1>>>1,_e=J[xe];if(0<i(_e,ie))J[xe]=ie,J[ce]=_e,ce=xe;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var ie=J[0],ce=J.pop();if(ce!==ie){J[0]=ce;e:for(var xe=0,_e=J.length,Ue=_e>>>1;xe<Ue;){var Jt=2*(xe+1)-1,Rn=J[Jt],bn=Jt+1,Ne=J[bn];if(0>i(Rn,ce))bn<_e&&0>i(Ne,Rn)?(J[xe]=Ne,J[bn]=ce,xe=bn):(J[xe]=Rn,J[Jt]=ce,xe=Jt);else if(bn<_e&&0>i(Ne,ce))J[xe]=Ne,J[bn]=ce,xe=bn;else break e}}return ie}function i(J,ie){var ce=J.sortIndex-ie.sortIndex;return ce!==0?ce:J.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],h=1,d=null,p=3,_=!1,A=!1,S=!1,k=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(J){for(var ie=n(u);ie!==null;){if(ie.callback===null)r(u);else if(ie.startTime<=J)r(u),ie.sortIndex=ie.expirationTime,e(l,ie);else break;ie=n(u)}}function D(J){if(S=!1,b(J),!A)if(n(l)!==null)A=!0,Vi(V);else{var ie=n(u);ie!==null&&un(D,ie.startTime-J)}}function V(J,ie){A=!1,S&&(S=!1,v(E),E=-1),_=!0;var ce=p;try{for(b(ie),d=n(l);d!==null&&(!(d.expirationTime>ie)||J&&!O());){var xe=d.callback;if(typeof xe=="function"){d.callback=null,p=d.priorityLevel;var _e=xe(d.expirationTime<=ie);ie=t.unstable_now(),typeof _e=="function"?d.callback=_e:d===n(l)&&r(l),b(ie)}else r(l);d=n(l)}if(d!==null)var Ue=!0;else{var Jt=n(u);Jt!==null&&un(D,Jt.startTime-ie),Ue=!1}return Ue}finally{d=null,p=ce,_=!1}}var j=!1,P=null,E=-1,C=5,x=-1;function O(){return!(t.unstable_now()-x<C)}function F(){if(P!==null){var J=t.unstable_now();x=J;var ie=!0;try{ie=P(!0,J)}finally{ie?N():(j=!1,P=null)}}else j=!1}var N;if(typeof m=="function")N=function(){m(F)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,ct=oe.port2;oe.port1.onmessage=F,N=function(){ct.postMessage(null)}}else N=function(){k(F,0)};function Vi(J){P=J,j||(j=!0,N())}function un(J,ie){E=k(function(){J(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){A||_||(A=!0,Vi(V))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(J){switch(p){case 1:case 2:case 3:var ie=3;break;default:ie=p}var ce=p;p=ie;try{return J()}finally{p=ce}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,ie){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var ce=p;p=J;try{return ie()}finally{p=ce}},t.unstable_scheduleCallback=function(J,ie,ce){var xe=t.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?xe+ce:xe):ce=xe,J){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=ce+_e,J={id:h++,callback:ie,priorityLevel:J,startTime:ce,expirationTime:_e,sortIndex:-1},ce>xe?(J.sortIndex=ce,e(u,J),n(l)===null&&J===n(u)&&(S?(v(E),E=-1):S=!0,un(D,ce-xe))):(J.sortIndex=_e,e(l,J),A||_||(A=!0,Vi(V))),J},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(J){var ie=p;return function(){var ce=p;p=ie;try{return J.apply(this,arguments)}finally{p=ce}}}})(dw);fw.exports=dw;var TI=fw.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vI=Q,an=TI;function K(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pw=new Set,Pl={};function Cs(t,e){Lo(t,e),Lo(t+"Capture",e)}function Lo(t,e){for(Pl[t]=e,t=0;t<e.length;t++)pw.add(e[t])}var Nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pp=Object.prototype.hasOwnProperty,EI=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qy={},Ky={};function wI(t){return Pp.call(Ky,t)?!0:Pp.call(qy,t)?!1:EI.test(t)?Ky[t]=!0:(qy[t]=!0,!1)}function AI(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function SI(t,e,n,r){if(e===null||typeof e>"u"||AI(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function $t(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var St={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){St[t]=new $t(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];St[e]=new $t(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){St[t]=new $t(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){St[t]=new $t(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){St[t]=new $t(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){St[t]=new $t(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){St[t]=new $t(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){St[t]=new $t(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){St[t]=new $t(t,5,!1,t.toLowerCase(),null,!1,!1)});var N_=/[\-:]([a-z])/g;function k_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(N_,k_);St[e]=new $t(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(N_,k_);St[e]=new $t(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(N_,k_);St[e]=new $t(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){St[t]=new $t(t,1,!1,t.toLowerCase(),null,!1,!1)});St.xlinkHref=new $t("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){St[t]=new $t(t,1,!1,t.toLowerCase(),null,!0,!0)});function M_(t,e,n,r){var i=St.hasOwnProperty(e)?St[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(SI(e,n,i,r)&&(n=null),r||i===null?wI(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Vr=vI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qc=Symbol.for("react.element"),lo=Symbol.for("react.portal"),co=Symbol.for("react.fragment"),O_=Symbol.for("react.strict_mode"),xp=Symbol.for("react.profiler"),gw=Symbol.for("react.provider"),_w=Symbol.for("react.context"),D_=Symbol.for("react.forward_ref"),Np=Symbol.for("react.suspense"),kp=Symbol.for("react.suspense_list"),F_=Symbol.for("react.memo"),ti=Symbol.for("react.lazy"),mw=Symbol.for("react.offscreen"),Yy=Symbol.iterator;function Fa(t){return t===null||typeof t!="object"?null:(t=Yy&&t[Yy]||t["@@iterator"],typeof t=="function"?t:null)}var Le=Object.assign,Td;function Za(t){if(Td===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Td=e&&e[1]||""}return`
`+Td+t}var vd=!1;function Ed(t,e){if(!t||vd)return"";vd=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{vd=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Za(t):""}function RI(t){switch(t.tag){case 5:return Za(t.type);case 16:return Za("Lazy");case 13:return Za("Suspense");case 19:return Za("SuspenseList");case 0:case 2:case 15:return t=Ed(t.type,!1),t;case 11:return t=Ed(t.type.render,!1),t;case 1:return t=Ed(t.type,!0),t;default:return""}}function Mp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case co:return"Fragment";case lo:return"Portal";case xp:return"Profiler";case O_:return"StrictMode";case Np:return"Suspense";case kp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case _w:return(t.displayName||"Context")+".Consumer";case gw:return(t._context.displayName||"Context")+".Provider";case D_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case F_:return e=t.displayName||null,e!==null?e:Mp(t.type)||"Memo";case ti:e=t._payload,t=t._init;try{return Mp(t(e))}catch{}}return null}function bI(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Mp(e);case 8:return e===O_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function bi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function yw(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function II(t){var e=yw(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Kc(t){t._valueTracker||(t._valueTracker=II(t))}function Tw(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=yw(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Qu(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Op(t,e){var n=e.checked;return Le({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Qy(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=bi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vw(t,e){e=e.checked,e!=null&&M_(t,"checked",e,!1)}function Dp(t,e){vw(t,e);var n=bi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Fp(t,e.type,n):e.hasOwnProperty("defaultValue")&&Fp(t,e.type,bi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Zy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Fp(t,e,n){(e!=="number"||Qu(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ja=Array.isArray;function Co(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+bi(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Up(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(K(91));return Le({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jy(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(K(92));if(Ja(n)){if(1<n.length)throw Error(K(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:bi(n)}}function Ew(t,e){var n=bi(e.value),r=bi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Gy(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function ww(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Bp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?ww(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Yc,Aw=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Yc=Yc||document.createElement("div"),Yc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function xl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ll={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},CI=["Webkit","ms","Moz","O"];Object.keys(ll).forEach(function(t){CI.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ll[e]=ll[t]})});function Sw(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ll.hasOwnProperty(t)&&ll[t]?(""+e).trim():e+"px"}function Rw(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Sw(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var PI=Le({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vp(t,e){if(e){if(PI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(K(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(K(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(K(61))}if(e.style!=null&&typeof e.style!="object")throw Error(K(62))}}function Lp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zp=null;function U_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var jp=null,Po=null,xo=null;function eT(t){if(t=fc(t)){if(typeof jp!="function")throw Error(K(280));var e=t.stateNode;e&&(e=Sf(e),jp(t.stateNode,t.type,e))}}function bw(t){Po?xo?xo.push(t):xo=[t]:Po=t}function Iw(){if(Po){var t=Po,e=xo;if(xo=Po=null,eT(t),e)for(t=0;t<e.length;t++)eT(e[t])}}function Cw(t,e){return t(e)}function Pw(){}var wd=!1;function xw(t,e,n){if(wd)return t(e,n);wd=!0;try{return Cw(t,e,n)}finally{wd=!1,(Po!==null||xo!==null)&&(Pw(),Iw())}}function Nl(t,e){var n=t.stateNode;if(n===null)return null;var r=Sf(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(K(231,e,typeof n));return n}var Wp=!1;if(Nr)try{var Ua={};Object.defineProperty(Ua,"passive",{get:function(){Wp=!0}}),window.addEventListener("test",Ua,Ua),window.removeEventListener("test",Ua,Ua)}catch{Wp=!1}function xI(t,e,n,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var cl=!1,Zu=null,Ju=!1,$p=null,NI={onError:function(t){cl=!0,Zu=t}};function kI(t,e,n,r,i,s,o,a,l){cl=!1,Zu=null,xI.apply(NI,arguments)}function MI(t,e,n,r,i,s,o,a,l){if(kI.apply(this,arguments),cl){if(cl){var u=Zu;cl=!1,Zu=null}else throw Error(K(198));Ju||(Ju=!0,$p=u)}}function Ps(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Nw(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function tT(t){if(Ps(t)!==t)throw Error(K(188))}function OI(t){var e=t.alternate;if(!e){if(e=Ps(t),e===null)throw Error(K(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return tT(i),t;if(s===r)return tT(i),e;s=s.sibling}throw Error(K(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(K(189))}}if(n.alternate!==r)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?t:e}function kw(t){return t=OI(t),t!==null?Mw(t):null}function Mw(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Mw(t);if(e!==null)return e;t=t.sibling}return null}var Ow=an.unstable_scheduleCallback,nT=an.unstable_cancelCallback,DI=an.unstable_shouldYield,FI=an.unstable_requestPaint,Ke=an.unstable_now,UI=an.unstable_getCurrentPriorityLevel,B_=an.unstable_ImmediatePriority,Dw=an.unstable_UserBlockingPriority,Gu=an.unstable_NormalPriority,BI=an.unstable_LowPriority,Fw=an.unstable_IdlePriority,vf=null,Gn=null;function VI(t){if(Gn&&typeof Gn.onCommitFiberRoot=="function")try{Gn.onCommitFiberRoot(vf,t,void 0,(t.current.flags&128)===128)}catch{}}var Dn=Math.clz32?Math.clz32:jI,LI=Math.log,zI=Math.LN2;function jI(t){return t>>>=0,t===0?32:31-(LI(t)/zI|0)|0}var Qc=64,Zc=4194304;function Ga(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function eh(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Ga(a):(s&=o,s!==0&&(r=Ga(s)))}else o=n&~i,o!==0?r=Ga(o):s!==0&&(r=Ga(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Dn(e),i=1<<n,r|=t[n],e&=~i;return r}function WI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $I(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Dn(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=WI(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Hp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Uw(){var t=Qc;return Qc<<=1,!(Qc&4194240)&&(Qc=64),t}function Ad(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function uc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Dn(e),t[e]=n}function HI(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Dn(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function V_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Dn(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Ee=0;function Bw(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Vw,L_,Lw,zw,jw,Xp=!1,Jc=[],di=null,pi=null,gi=null,kl=new Map,Ml=new Map,si=[],XI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rT(t,e){switch(t){case"focusin":case"focusout":di=null;break;case"dragenter":case"dragleave":pi=null;break;case"mouseover":case"mouseout":gi=null;break;case"pointerover":case"pointerout":kl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ml.delete(e.pointerId)}}function Ba(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=fc(e),e!==null&&L_(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function qI(t,e,n,r,i){switch(e){case"focusin":return di=Ba(di,t,e,n,r,i),!0;case"dragenter":return pi=Ba(pi,t,e,n,r,i),!0;case"mouseover":return gi=Ba(gi,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return kl.set(s,Ba(kl.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Ml.set(s,Ba(Ml.get(s)||null,t,e,n,r,i)),!0}return!1}function Ww(t){var e=os(t.target);if(e!==null){var n=Ps(e);if(n!==null){if(e=n.tag,e===13){if(e=Nw(n),e!==null){t.blockedOn=e,jw(t.priority,function(){Lw(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Nu(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);zp=r,n.target.dispatchEvent(r),zp=null}else return e=fc(n),e!==null&&L_(e),t.blockedOn=n,!1;e.shift()}return!0}function iT(t,e,n){Nu(t)&&n.delete(e)}function KI(){Xp=!1,di!==null&&Nu(di)&&(di=null),pi!==null&&Nu(pi)&&(pi=null),gi!==null&&Nu(gi)&&(gi=null),kl.forEach(iT),Ml.forEach(iT)}function Va(t,e){t.blockedOn===e&&(t.blockedOn=null,Xp||(Xp=!0,an.unstable_scheduleCallback(an.unstable_NormalPriority,KI)))}function Ol(t){function e(i){return Va(i,t)}if(0<Jc.length){Va(Jc[0],t);for(var n=1;n<Jc.length;n++){var r=Jc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(di!==null&&Va(di,t),pi!==null&&Va(pi,t),gi!==null&&Va(gi,t),kl.forEach(e),Ml.forEach(e),n=0;n<si.length;n++)r=si[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<si.length&&(n=si[0],n.blockedOn===null);)Ww(n),n.blockedOn===null&&si.shift()}var No=Vr.ReactCurrentBatchConfig,th=!0;function YI(t,e,n,r){var i=Ee,s=No.transition;No.transition=null;try{Ee=1,z_(t,e,n,r)}finally{Ee=i,No.transition=s}}function QI(t,e,n,r){var i=Ee,s=No.transition;No.transition=null;try{Ee=4,z_(t,e,n,r)}finally{Ee=i,No.transition=s}}function z_(t,e,n,r){if(th){var i=qp(t,e,n,r);if(i===null)Md(t,e,r,nh,n),rT(t,r);else if(qI(i,t,e,n,r))r.stopPropagation();else if(rT(t,r),e&4&&-1<XI.indexOf(t)){for(;i!==null;){var s=fc(i);if(s!==null&&Vw(s),s=qp(t,e,n,r),s===null&&Md(t,e,r,nh,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Md(t,e,r,null,n)}}var nh=null;function qp(t,e,n,r){if(nh=null,t=U_(r),t=os(t),t!==null)if(e=Ps(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Nw(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return nh=t,null}function $w(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(UI()){case B_:return 1;case Dw:return 4;case Gu:case BI:return 16;case Fw:return 536870912;default:return 16}default:return 16}}var ai=null,j_=null,ku=null;function Hw(){if(ku)return ku;var t,e=j_,n=e.length,r,i="value"in ai?ai.value:ai.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return ku=i.slice(t,1<r?1-r:void 0)}function Mu(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Gc(){return!0}function sT(){return!1}function cn(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Gc:sT,this.isPropagationStopped=sT,this}return Le(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Gc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Gc)},persist:function(){},isPersistent:Gc}),e}var ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},W_=cn(ha),hc=Le({},ha,{view:0,detail:0}),ZI=cn(hc),Sd,Rd,La,Ef=Le({},hc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==La&&(La&&t.type==="mousemove"?(Sd=t.screenX-La.screenX,Rd=t.screenY-La.screenY):Rd=Sd=0,La=t),Sd)},movementY:function(t){return"movementY"in t?t.movementY:Rd}}),oT=cn(Ef),JI=Le({},Ef,{dataTransfer:0}),GI=cn(JI),eC=Le({},hc,{relatedTarget:0}),bd=cn(eC),tC=Le({},ha,{animationName:0,elapsedTime:0,pseudoElement:0}),nC=cn(tC),rC=Le({},ha,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),iC=cn(rC),sC=Le({},ha,{data:0}),aT=cn(sC),oC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},lC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cC(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=lC[t])?!!e[t]:!1}function $_(){return cC}var uC=Le({},hc,{key:function(t){if(t.key){var e=oC[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Mu(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aC[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$_,charCode:function(t){return t.type==="keypress"?Mu(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Mu(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),hC=cn(uC),fC=Le({},Ef,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lT=cn(fC),dC=Le({},hc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$_}),pC=cn(dC),gC=Le({},ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),_C=cn(gC),mC=Le({},Ef,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),yC=cn(mC),TC=[9,13,27,32],H_=Nr&&"CompositionEvent"in window,ul=null;Nr&&"documentMode"in document&&(ul=document.documentMode);var vC=Nr&&"TextEvent"in window&&!ul,Xw=Nr&&(!H_||ul&&8<ul&&11>=ul),cT=" ",uT=!1;function qw(t,e){switch(t){case"keyup":return TC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Kw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var uo=!1;function EC(t,e){switch(t){case"compositionend":return Kw(e);case"keypress":return e.which!==32?null:(uT=!0,cT);case"textInput":return t=e.data,t===cT&&uT?null:t;default:return null}}function wC(t,e){if(uo)return t==="compositionend"||!H_&&qw(t,e)?(t=Hw(),ku=j_=ai=null,uo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Xw&&e.locale!=="ko"?null:e.data;default:return null}}var AC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!AC[t.type]:e==="textarea"}function Yw(t,e,n,r){bw(r),e=rh(e,"onChange"),0<e.length&&(n=new W_("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var hl=null,Dl=null;function SC(t){oA(t,0)}function wf(t){var e=po(t);if(Tw(e))return t}function RC(t,e){if(t==="change")return e}var Qw=!1;if(Nr){var Id;if(Nr){var Cd="oninput"in document;if(!Cd){var fT=document.createElement("div");fT.setAttribute("oninput","return;"),Cd=typeof fT.oninput=="function"}Id=Cd}else Id=!1;Qw=Id&&(!document.documentMode||9<document.documentMode)}function dT(){hl&&(hl.detachEvent("onpropertychange",Zw),Dl=hl=null)}function Zw(t){if(t.propertyName==="value"&&wf(Dl)){var e=[];Yw(e,Dl,t,U_(t)),xw(SC,e)}}function bC(t,e,n){t==="focusin"?(dT(),hl=e,Dl=n,hl.attachEvent("onpropertychange",Zw)):t==="focusout"&&dT()}function IC(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return wf(Dl)}function CC(t,e){if(t==="click")return wf(e)}function PC(t,e){if(t==="input"||t==="change")return wf(e)}function xC(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Bn=typeof Object.is=="function"?Object.is:xC;function Fl(t,e){if(Bn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Pp.call(e,i)||!Bn(t[i],e[i]))return!1}return!0}function pT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gT(t,e){var n=pT(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pT(n)}}function Jw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Jw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Gw(){for(var t=window,e=Qu();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qu(t.document)}return e}function X_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function NC(t){var e=Gw(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Jw(n.ownerDocument.documentElement,n)){if(r!==null&&X_(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=gT(n,s);var o=gT(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var kC=Nr&&"documentMode"in document&&11>=document.documentMode,ho=null,Kp=null,fl=null,Yp=!1;function _T(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Yp||ho==null||ho!==Qu(r)||(r=ho,"selectionStart"in r&&X_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),fl&&Fl(fl,r)||(fl=r,r=rh(Kp,"onSelect"),0<r.length&&(e=new W_("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ho)))}function eu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var fo={animationend:eu("Animation","AnimationEnd"),animationiteration:eu("Animation","AnimationIteration"),animationstart:eu("Animation","AnimationStart"),transitionend:eu("Transition","TransitionEnd")},Pd={},eA={};Nr&&(eA=document.createElement("div").style,"AnimationEvent"in window||(delete fo.animationend.animation,delete fo.animationiteration.animation,delete fo.animationstart.animation),"TransitionEvent"in window||delete fo.transitionend.transition);function Af(t){if(Pd[t])return Pd[t];if(!fo[t])return t;var e=fo[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in eA)return Pd[t]=e[n];return t}var tA=Af("animationend"),nA=Af("animationiteration"),rA=Af("animationstart"),iA=Af("transitionend"),sA=new Map,mT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Di(t,e){sA.set(t,e),Cs(e,[t])}for(var xd=0;xd<mT.length;xd++){var Nd=mT[xd],MC=Nd.toLowerCase(),OC=Nd[0].toUpperCase()+Nd.slice(1);Di(MC,"on"+OC)}Di(tA,"onAnimationEnd");Di(nA,"onAnimationIteration");Di(rA,"onAnimationStart");Di("dblclick","onDoubleClick");Di("focusin","onFocus");Di("focusout","onBlur");Di(iA,"onTransitionEnd");Lo("onMouseEnter",["mouseout","mouseover"]);Lo("onMouseLeave",["mouseout","mouseover"]);Lo("onPointerEnter",["pointerout","pointerover"]);Lo("onPointerLeave",["pointerout","pointerover"]);Cs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Cs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Cs("onBeforeInput",["compositionend","keypress","textInput","paste"]);Cs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Cs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Cs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var el="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),DC=new Set("cancel close invalid load scroll toggle".split(" ").concat(el));function yT(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,MI(r,e,void 0,t),t.currentTarget=null}function oA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;yT(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;yT(i,a,u),s=l}}}if(Ju)throw t=$p,Ju=!1,$p=null,t}function ke(t,e){var n=e[eg];n===void 0&&(n=e[eg]=new Set);var r=t+"__bubble";n.has(r)||(aA(e,t,2,!1),n.add(r))}function kd(t,e,n){var r=0;e&&(r|=4),aA(n,t,r,e)}var tu="_reactListening"+Math.random().toString(36).slice(2);function Ul(t){if(!t[tu]){t[tu]=!0,pw.forEach(function(n){n!=="selectionchange"&&(DC.has(n)||kd(n,!1,t),kd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[tu]||(e[tu]=!0,kd("selectionchange",!1,e))}}function aA(t,e,n,r){switch($w(e)){case 1:var i=YI;break;case 4:i=QI;break;default:i=z_}n=i.bind(null,e,n,t),i=void 0,!Wp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Md(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=os(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}xw(function(){var u=s,h=U_(n),d=[];e:{var p=sA.get(t);if(p!==void 0){var _=W_,A=t;switch(t){case"keypress":if(Mu(n)===0)break e;case"keydown":case"keyup":_=hC;break;case"focusin":A="focus",_=bd;break;case"focusout":A="blur",_=bd;break;case"beforeblur":case"afterblur":_=bd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=oT;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=GI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=pC;break;case tA:case nA:case rA:_=nC;break;case iA:_=_C;break;case"scroll":_=ZI;break;case"wheel":_=yC;break;case"copy":case"cut":case"paste":_=iC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=lT}var S=(e&4)!==0,k=!S&&t==="scroll",v=S?p!==null?p+"Capture":null:p;S=[];for(var m=u,b;m!==null;){b=m;var D=b.stateNode;if(b.tag===5&&D!==null&&(b=D,v!==null&&(D=Nl(m,v),D!=null&&S.push(Bl(m,D,b)))),k)break;m=m.return}0<S.length&&(p=new _(p,A,null,n,h),d.push({event:p,listeners:S}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",p&&n!==zp&&(A=n.relatedTarget||n.fromElement)&&(os(A)||A[kr]))break e;if((_||p)&&(p=h.window===h?h:(p=h.ownerDocument)?p.defaultView||p.parentWindow:window,_?(A=n.relatedTarget||n.toElement,_=u,A=A?os(A):null,A!==null&&(k=Ps(A),A!==k||A.tag!==5&&A.tag!==6)&&(A=null)):(_=null,A=u),_!==A)){if(S=oT,D="onMouseLeave",v="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(S=lT,D="onPointerLeave",v="onPointerEnter",m="pointer"),k=_==null?p:po(_),b=A==null?p:po(A),p=new S(D,m+"leave",_,n,h),p.target=k,p.relatedTarget=b,D=null,os(h)===u&&(S=new S(v,m+"enter",A,n,h),S.target=b,S.relatedTarget=k,D=S),k=D,_&&A)t:{for(S=_,v=A,m=0,b=S;b;b=Ys(b))m++;for(b=0,D=v;D;D=Ys(D))b++;for(;0<m-b;)S=Ys(S),m--;for(;0<b-m;)v=Ys(v),b--;for(;m--;){if(S===v||v!==null&&S===v.alternate)break t;S=Ys(S),v=Ys(v)}S=null}else S=null;_!==null&&TT(d,p,_,S,!1),A!==null&&k!==null&&TT(d,k,A,S,!0)}}e:{if(p=u?po(u):window,_=p.nodeName&&p.nodeName.toLowerCase(),_==="select"||_==="input"&&p.type==="file")var V=RC;else if(hT(p))if(Qw)V=PC;else{V=IC;var j=bC}else(_=p.nodeName)&&_.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(V=CC);if(V&&(V=V(t,u))){Yw(d,V,n,h);break e}j&&j(t,p,u),t==="focusout"&&(j=p._wrapperState)&&j.controlled&&p.type==="number"&&Fp(p,"number",p.value)}switch(j=u?po(u):window,t){case"focusin":(hT(j)||j.contentEditable==="true")&&(ho=j,Kp=u,fl=null);break;case"focusout":fl=Kp=ho=null;break;case"mousedown":Yp=!0;break;case"contextmenu":case"mouseup":case"dragend":Yp=!1,_T(d,n,h);break;case"selectionchange":if(kC)break;case"keydown":case"keyup":_T(d,n,h)}var P;if(H_)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else uo?qw(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(Xw&&n.locale!=="ko"&&(uo||E!=="onCompositionStart"?E==="onCompositionEnd"&&uo&&(P=Hw()):(ai=h,j_="value"in ai?ai.value:ai.textContent,uo=!0)),j=rh(u,E),0<j.length&&(E=new aT(E,t,null,n,h),d.push({event:E,listeners:j}),P?E.data=P:(P=Kw(n),P!==null&&(E.data=P)))),(P=vC?EC(t,n):wC(t,n))&&(u=rh(u,"onBeforeInput"),0<u.length&&(h=new aT("onBeforeInput","beforeinput",null,n,h),d.push({event:h,listeners:u}),h.data=P))}oA(d,e)})}function Bl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function rh(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Nl(t,n),s!=null&&r.unshift(Bl(t,s,i)),s=Nl(t,e),s!=null&&r.push(Bl(t,s,i))),t=t.return}return r}function Ys(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function TT(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=Nl(n,s),l!=null&&o.unshift(Bl(n,l,a))):i||(l=Nl(n,s),l!=null&&o.push(Bl(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var FC=/\r\n?/g,UC=/\u0000|\uFFFD/g;function vT(t){return(typeof t=="string"?t:""+t).replace(FC,`
`).replace(UC,"")}function nu(t,e,n){if(e=vT(e),vT(t)!==e&&n)throw Error(K(425))}function ih(){}var Qp=null,Zp=null;function Jp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Gp=typeof setTimeout=="function"?setTimeout:void 0,BC=typeof clearTimeout=="function"?clearTimeout:void 0,ET=typeof Promise=="function"?Promise:void 0,VC=typeof queueMicrotask=="function"?queueMicrotask:typeof ET<"u"?function(t){return ET.resolve(null).then(t).catch(LC)}:Gp;function LC(t){setTimeout(function(){throw t})}function Od(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ol(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ol(e)}function _i(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function wT(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var fa=Math.random().toString(36).slice(2),Yn="__reactFiber$"+fa,Vl="__reactProps$"+fa,kr="__reactContainer$"+fa,eg="__reactEvents$"+fa,zC="__reactListeners$"+fa,jC="__reactHandles$"+fa;function os(t){var e=t[Yn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[kr]||n[Yn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=wT(t);t!==null;){if(n=t[Yn])return n;t=wT(t)}return e}t=n,n=t.parentNode}return null}function fc(t){return t=t[Yn]||t[kr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function po(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(K(33))}function Sf(t){return t[Vl]||null}var tg=[],go=-1;function Fi(t){return{current:t}}function Me(t){0>go||(t.current=tg[go],tg[go]=null,go--)}function Ie(t,e){go++,tg[go]=t.current,t.current=e}var Ii={},Ft=Fi(Ii),Yt=Fi(!1),vs=Ii;function zo(t,e){var n=t.type.contextTypes;if(!n)return Ii;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Qt(t){return t=t.childContextTypes,t!=null}function sh(){Me(Yt),Me(Ft)}function AT(t,e,n){if(Ft.current!==Ii)throw Error(K(168));Ie(Ft,e),Ie(Yt,n)}function lA(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(K(108,bI(t)||"Unknown",i));return Le({},n,r)}function oh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ii,vs=Ft.current,Ie(Ft,t),Ie(Yt,Yt.current),!0}function ST(t,e,n){var r=t.stateNode;if(!r)throw Error(K(169));n?(t=lA(t,e,vs),r.__reactInternalMemoizedMergedChildContext=t,Me(Yt),Me(Ft),Ie(Ft,t)):Me(Yt),Ie(Yt,n)}var Rr=null,Rf=!1,Dd=!1;function cA(t){Rr===null?Rr=[t]:Rr.push(t)}function WC(t){Rf=!0,cA(t)}function Ui(){if(!Dd&&Rr!==null){Dd=!0;var t=0,e=Ee;try{var n=Rr;for(Ee=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Rr=null,Rf=!1}catch(i){throw Rr!==null&&(Rr=Rr.slice(t+1)),Ow(B_,Ui),i}finally{Ee=e,Dd=!1}}return null}var _o=[],mo=0,ah=null,lh=0,gn=[],_n=0,Es=null,Ir=1,Cr="";function Gi(t,e){_o[mo++]=lh,_o[mo++]=ah,ah=t,lh=e}function uA(t,e,n){gn[_n++]=Ir,gn[_n++]=Cr,gn[_n++]=Es,Es=t;var r=Ir;t=Cr;var i=32-Dn(r)-1;r&=~(1<<i),n+=1;var s=32-Dn(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Ir=1<<32-Dn(e)+i|n<<i|r,Cr=s+t}else Ir=1<<s|n<<i|r,Cr=t}function q_(t){t.return!==null&&(Gi(t,1),uA(t,1,0))}function K_(t){for(;t===ah;)ah=_o[--mo],_o[mo]=null,lh=_o[--mo],_o[mo]=null;for(;t===Es;)Es=gn[--_n],gn[_n]=null,Cr=gn[--_n],gn[_n]=null,Ir=gn[--_n],gn[_n]=null}var on=null,sn=null,Oe=!1,Nn=null;function hA(t,e){var n=yn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function RT(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,on=t,sn=_i(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,on=t,sn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Es!==null?{id:Ir,overflow:Cr}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=yn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,on=t,sn=null,!0):!1;default:return!1}}function ng(t){return(t.mode&1)!==0&&(t.flags&128)===0}function rg(t){if(Oe){var e=sn;if(e){var n=e;if(!RT(t,e)){if(ng(t))throw Error(K(418));e=_i(n.nextSibling);var r=on;e&&RT(t,e)?hA(r,n):(t.flags=t.flags&-4097|2,Oe=!1,on=t)}}else{if(ng(t))throw Error(K(418));t.flags=t.flags&-4097|2,Oe=!1,on=t}}}function bT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;on=t}function ru(t){if(t!==on)return!1;if(!Oe)return bT(t),Oe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Jp(t.type,t.memoizedProps)),e&&(e=sn)){if(ng(t))throw fA(),Error(K(418));for(;e;)hA(t,e),e=_i(e.nextSibling)}if(bT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){sn=_i(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}sn=null}}else sn=on?_i(t.stateNode.nextSibling):null;return!0}function fA(){for(var t=sn;t;)t=_i(t.nextSibling)}function jo(){sn=on=null,Oe=!1}function Y_(t){Nn===null?Nn=[t]:Nn.push(t)}var $C=Vr.ReactCurrentBatchConfig;function za(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(K(309));var r=n.stateNode}if(!r)throw Error(K(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(K(284));if(!n._owner)throw Error(K(290,t))}return t}function iu(t,e){throw t=Object.prototype.toString.call(e),Error(K(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function IT(t){var e=t._init;return e(t._payload)}function dA(t){function e(v,m){if(t){var b=v.deletions;b===null?(v.deletions=[m],v.flags|=16):b.push(m)}}function n(v,m){if(!t)return null;for(;m!==null;)e(v,m),m=m.sibling;return null}function r(v,m){for(v=new Map;m!==null;)m.key!==null?v.set(m.key,m):v.set(m.index,m),m=m.sibling;return v}function i(v,m){return v=vi(v,m),v.index=0,v.sibling=null,v}function s(v,m,b){return v.index=b,t?(b=v.alternate,b!==null?(b=b.index,b<m?(v.flags|=2,m):b):(v.flags|=2,m)):(v.flags|=1048576,m)}function o(v){return t&&v.alternate===null&&(v.flags|=2),v}function a(v,m,b,D){return m===null||m.tag!==6?(m=jd(b,v.mode,D),m.return=v,m):(m=i(m,b),m.return=v,m)}function l(v,m,b,D){var V=b.type;return V===co?h(v,m,b.props.children,D,b.key):m!==null&&(m.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===ti&&IT(V)===m.type)?(D=i(m,b.props),D.ref=za(v,m,b),D.return=v,D):(D=Lu(b.type,b.key,b.props,null,v.mode,D),D.ref=za(v,m,b),D.return=v,D)}function u(v,m,b,D){return m===null||m.tag!==4||m.stateNode.containerInfo!==b.containerInfo||m.stateNode.implementation!==b.implementation?(m=Wd(b,v.mode,D),m.return=v,m):(m=i(m,b.children||[]),m.return=v,m)}function h(v,m,b,D,V){return m===null||m.tag!==7?(m=ps(b,v.mode,D,V),m.return=v,m):(m=i(m,b),m.return=v,m)}function d(v,m,b){if(typeof m=="string"&&m!==""||typeof m=="number")return m=jd(""+m,v.mode,b),m.return=v,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case qc:return b=Lu(m.type,m.key,m.props,null,v.mode,b),b.ref=za(v,null,m),b.return=v,b;case lo:return m=Wd(m,v.mode,b),m.return=v,m;case ti:var D=m._init;return d(v,D(m._payload),b)}if(Ja(m)||Fa(m))return m=ps(m,v.mode,b,null),m.return=v,m;iu(v,m)}return null}function p(v,m,b,D){var V=m!==null?m.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return V!==null?null:a(v,m,""+b,D);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case qc:return b.key===V?l(v,m,b,D):null;case lo:return b.key===V?u(v,m,b,D):null;case ti:return V=b._init,p(v,m,V(b._payload),D)}if(Ja(b)||Fa(b))return V!==null?null:h(v,m,b,D,null);iu(v,b)}return null}function _(v,m,b,D,V){if(typeof D=="string"&&D!==""||typeof D=="number")return v=v.get(b)||null,a(m,v,""+D,V);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case qc:return v=v.get(D.key===null?b:D.key)||null,l(m,v,D,V);case lo:return v=v.get(D.key===null?b:D.key)||null,u(m,v,D,V);case ti:var j=D._init;return _(v,m,b,j(D._payload),V)}if(Ja(D)||Fa(D))return v=v.get(b)||null,h(m,v,D,V,null);iu(m,D)}return null}function A(v,m,b,D){for(var V=null,j=null,P=m,E=m=0,C=null;P!==null&&E<b.length;E++){P.index>E?(C=P,P=null):C=P.sibling;var x=p(v,P,b[E],D);if(x===null){P===null&&(P=C);break}t&&P&&x.alternate===null&&e(v,P),m=s(x,m,E),j===null?V=x:j.sibling=x,j=x,P=C}if(E===b.length)return n(v,P),Oe&&Gi(v,E),V;if(P===null){for(;E<b.length;E++)P=d(v,b[E],D),P!==null&&(m=s(P,m,E),j===null?V=P:j.sibling=P,j=P);return Oe&&Gi(v,E),V}for(P=r(v,P);E<b.length;E++)C=_(P,v,E,b[E],D),C!==null&&(t&&C.alternate!==null&&P.delete(C.key===null?E:C.key),m=s(C,m,E),j===null?V=C:j.sibling=C,j=C);return t&&P.forEach(function(O){return e(v,O)}),Oe&&Gi(v,E),V}function S(v,m,b,D){var V=Fa(b);if(typeof V!="function")throw Error(K(150));if(b=V.call(b),b==null)throw Error(K(151));for(var j=V=null,P=m,E=m=0,C=null,x=b.next();P!==null&&!x.done;E++,x=b.next()){P.index>E?(C=P,P=null):C=P.sibling;var O=p(v,P,x.value,D);if(O===null){P===null&&(P=C);break}t&&P&&O.alternate===null&&e(v,P),m=s(O,m,E),j===null?V=O:j.sibling=O,j=O,P=C}if(x.done)return n(v,P),Oe&&Gi(v,E),V;if(P===null){for(;!x.done;E++,x=b.next())x=d(v,x.value,D),x!==null&&(m=s(x,m,E),j===null?V=x:j.sibling=x,j=x);return Oe&&Gi(v,E),V}for(P=r(v,P);!x.done;E++,x=b.next())x=_(P,v,E,x.value,D),x!==null&&(t&&x.alternate!==null&&P.delete(x.key===null?E:x.key),m=s(x,m,E),j===null?V=x:j.sibling=x,j=x);return t&&P.forEach(function(F){return e(v,F)}),Oe&&Gi(v,E),V}function k(v,m,b,D){if(typeof b=="object"&&b!==null&&b.type===co&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case qc:e:{for(var V=b.key,j=m;j!==null;){if(j.key===V){if(V=b.type,V===co){if(j.tag===7){n(v,j.sibling),m=i(j,b.props.children),m.return=v,v=m;break e}}else if(j.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===ti&&IT(V)===j.type){n(v,j.sibling),m=i(j,b.props),m.ref=za(v,j,b),m.return=v,v=m;break e}n(v,j);break}else e(v,j);j=j.sibling}b.type===co?(m=ps(b.props.children,v.mode,D,b.key),m.return=v,v=m):(D=Lu(b.type,b.key,b.props,null,v.mode,D),D.ref=za(v,m,b),D.return=v,v=D)}return o(v);case lo:e:{for(j=b.key;m!==null;){if(m.key===j)if(m.tag===4&&m.stateNode.containerInfo===b.containerInfo&&m.stateNode.implementation===b.implementation){n(v,m.sibling),m=i(m,b.children||[]),m.return=v,v=m;break e}else{n(v,m);break}else e(v,m);m=m.sibling}m=Wd(b,v.mode,D),m.return=v,v=m}return o(v);case ti:return j=b._init,k(v,m,j(b._payload),D)}if(Ja(b))return A(v,m,b,D);if(Fa(b))return S(v,m,b,D);iu(v,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,m!==null&&m.tag===6?(n(v,m.sibling),m=i(m,b),m.return=v,v=m):(n(v,m),m=jd(b,v.mode,D),m.return=v,v=m),o(v)):n(v,m)}return k}var Wo=dA(!0),pA=dA(!1),ch=Fi(null),uh=null,yo=null,Q_=null;function Z_(){Q_=yo=uh=null}function J_(t){var e=ch.current;Me(ch),t._currentValue=e}function ig(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ko(t,e){uh=t,Q_=yo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Kt=!0),t.firstContext=null)}function An(t){var e=t._currentValue;if(Q_!==t)if(t={context:t,memoizedValue:e,next:null},yo===null){if(uh===null)throw Error(K(308));yo=t,uh.dependencies={lanes:0,firstContext:t}}else yo=yo.next=t;return e}var as=null;function G_(t){as===null?as=[t]:as.push(t)}function gA(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,G_(e)):(n.next=i.next,i.next=n),e.interleaved=n,Mr(t,r)}function Mr(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ni=!1;function em(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _A(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function xr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function mi(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,me&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Mr(t,n)}return i=r.interleaved,i===null?(e.next=e,G_(r)):(e.next=i.next,i.next=e),r.interleaved=e,Mr(t,n)}function Ou(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,V_(t,n)}}function CT(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hh(t,e,n,r){var i=t.updateQueue;ni=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var h=t.alternate;h!==null&&(h=h.updateQueue,a=h.lastBaseUpdate,a!==o&&(a===null?h.firstBaseUpdate=u:a.next=u,h.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,h=u=l=null,a=s;do{var p=a.lane,_=a.eventTime;if((r&p)===p){h!==null&&(h=h.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var A=t,S=a;switch(p=e,_=n,S.tag){case 1:if(A=S.payload,typeof A=="function"){d=A.call(_,d,p);break e}d=A;break e;case 3:A.flags=A.flags&-65537|128;case 0:if(A=S.payload,p=typeof A=="function"?A.call(_,d,p):A,p==null)break e;d=Le({},d,p);break e;case 2:ni=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=i.effects,p===null?i.effects=[a]:p.push(a))}else _={eventTime:_,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},h===null?(u=h=_,l=d):h=h.next=_,o|=p;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;p=a,a=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(h===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);As|=o,t.lanes=o,t.memoizedState=d}}function PT(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(K(191,i));i.call(r)}}}var dc={},er=Fi(dc),Ll=Fi(dc),zl=Fi(dc);function ls(t){if(t===dc)throw Error(K(174));return t}function tm(t,e){switch(Ie(zl,e),Ie(Ll,t),Ie(er,dc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Bp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Bp(e,t)}Me(er),Ie(er,e)}function $o(){Me(er),Me(Ll),Me(zl)}function mA(t){ls(zl.current);var e=ls(er.current),n=Bp(e,t.type);e!==n&&(Ie(Ll,t),Ie(er,n))}function nm(t){Ll.current===t&&(Me(er),Me(Ll))}var Be=Fi(0);function fh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Fd=[];function rm(){for(var t=0;t<Fd.length;t++)Fd[t]._workInProgressVersionPrimary=null;Fd.length=0}var Du=Vr.ReactCurrentDispatcher,Ud=Vr.ReactCurrentBatchConfig,ws=0,Ve=null,it=null,gt=null,dh=!1,dl=!1,jl=0,HC=0;function Ct(){throw Error(K(321))}function im(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Bn(t[n],e[n]))return!1;return!0}function sm(t,e,n,r,i,s){if(ws=s,Ve=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Du.current=t===null||t.memoizedState===null?YC:QC,t=n(r,i),dl){s=0;do{if(dl=!1,jl=0,25<=s)throw Error(K(301));s+=1,gt=it=null,e.updateQueue=null,Du.current=ZC,t=n(r,i)}while(dl)}if(Du.current=ph,e=it!==null&&it.next!==null,ws=0,gt=it=Ve=null,dh=!1,e)throw Error(K(300));return t}function om(){var t=jl!==0;return jl=0,t}function Kn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Ve.memoizedState=gt=t:gt=gt.next=t,gt}function Sn(){if(it===null){var t=Ve.alternate;t=t!==null?t.memoizedState:null}else t=it.next;var e=gt===null?Ve.memoizedState:gt.next;if(e!==null)gt=e,it=t;else{if(t===null)throw Error(K(310));it=t,t={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},gt===null?Ve.memoizedState=gt=t:gt=gt.next=t}return gt}function Wl(t,e){return typeof e=="function"?e(t):e}function Bd(t){var e=Sn(),n=e.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=t;var r=it,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var h=u.lane;if((ws&h)===h)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Ve.lanes|=h,As|=h}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,Bn(r,e.memoizedState)||(Kt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,Ve.lanes|=s,As|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Vd(t){var e=Sn(),n=e.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Bn(s,e.memoizedState)||(Kt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function yA(){}function TA(t,e){var n=Ve,r=Sn(),i=e(),s=!Bn(r.memoizedState,i);if(s&&(r.memoizedState=i,Kt=!0),r=r.queue,am(wA.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||gt!==null&&gt.memoizedState.tag&1){if(n.flags|=2048,$l(9,EA.bind(null,n,r,i,e),void 0,null),_t===null)throw Error(K(349));ws&30||vA(n,e,i)}return i}function vA(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ve.updateQueue,e===null?(e={lastEffect:null,stores:null},Ve.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function EA(t,e,n,r){e.value=n,e.getSnapshot=r,AA(e)&&SA(t)}function wA(t,e,n){return n(function(){AA(e)&&SA(t)})}function AA(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Bn(t,n)}catch{return!0}}function SA(t){var e=Mr(t,1);e!==null&&Fn(e,t,1,-1)}function xT(t){var e=Kn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wl,lastRenderedState:t},e.queue=t,t=t.dispatch=KC.bind(null,Ve,t),[e.memoizedState,t]}function $l(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Ve.updateQueue,e===null?(e={lastEffect:null,stores:null},Ve.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function RA(){return Sn().memoizedState}function Fu(t,e,n,r){var i=Kn();Ve.flags|=t,i.memoizedState=$l(1|e,n,void 0,r===void 0?null:r)}function bf(t,e,n,r){var i=Sn();r=r===void 0?null:r;var s=void 0;if(it!==null){var o=it.memoizedState;if(s=o.destroy,r!==null&&im(r,o.deps)){i.memoizedState=$l(e,n,s,r);return}}Ve.flags|=t,i.memoizedState=$l(1|e,n,s,r)}function NT(t,e){return Fu(8390656,8,t,e)}function am(t,e){return bf(2048,8,t,e)}function bA(t,e){return bf(4,2,t,e)}function IA(t,e){return bf(4,4,t,e)}function CA(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function PA(t,e,n){return n=n!=null?n.concat([t]):null,bf(4,4,CA.bind(null,e,t),n)}function lm(){}function xA(t,e){var n=Sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&im(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function NA(t,e){var n=Sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&im(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function kA(t,e,n){return ws&21?(Bn(n,e)||(n=Uw(),Ve.lanes|=n,As|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Kt=!0),t.memoizedState=n)}function XC(t,e){var n=Ee;Ee=n!==0&&4>n?n:4,t(!0);var r=Ud.transition;Ud.transition={};try{t(!1),e()}finally{Ee=n,Ud.transition=r}}function MA(){return Sn().memoizedState}function qC(t,e,n){var r=Ti(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},OA(t))DA(e,n);else if(n=gA(t,e,n,r),n!==null){var i=jt();Fn(n,t,r,i),FA(n,e,r)}}function KC(t,e,n){var r=Ti(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(OA(t))DA(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Bn(a,o)){var l=e.interleaved;l===null?(i.next=i,G_(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=gA(t,e,i,r),n!==null&&(i=jt(),Fn(n,t,r,i),FA(n,e,r))}}function OA(t){var e=t.alternate;return t===Ve||e!==null&&e===Ve}function DA(t,e){dl=dh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function FA(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,V_(t,n)}}var ph={readContext:An,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useInsertionEffect:Ct,useLayoutEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useMutableSource:Ct,useSyncExternalStore:Ct,useId:Ct,unstable_isNewReconciler:!1},YC={readContext:An,useCallback:function(t,e){return Kn().memoizedState=[t,e===void 0?null:e],t},useContext:An,useEffect:NT,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Fu(4194308,4,CA.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Fu(4194308,4,t,e)},useInsertionEffect:function(t,e){return Fu(4,2,t,e)},useMemo:function(t,e){var n=Kn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Kn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=qC.bind(null,Ve,t),[r.memoizedState,t]},useRef:function(t){var e=Kn();return t={current:t},e.memoizedState=t},useState:xT,useDebugValue:lm,useDeferredValue:function(t){return Kn().memoizedState=t},useTransition:function(){var t=xT(!1),e=t[0];return t=XC.bind(null,t[1]),Kn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Ve,i=Kn();if(Oe){if(n===void 0)throw Error(K(407));n=n()}else{if(n=e(),_t===null)throw Error(K(349));ws&30||vA(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,NT(wA.bind(null,r,s,t),[t]),r.flags|=2048,$l(9,EA.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Kn(),e=_t.identifierPrefix;if(Oe){var n=Cr,r=Ir;n=(r&~(1<<32-Dn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=jl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=HC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},QC={readContext:An,useCallback:xA,useContext:An,useEffect:am,useImperativeHandle:PA,useInsertionEffect:bA,useLayoutEffect:IA,useMemo:NA,useReducer:Bd,useRef:RA,useState:function(){return Bd(Wl)},useDebugValue:lm,useDeferredValue:function(t){var e=Sn();return kA(e,it.memoizedState,t)},useTransition:function(){var t=Bd(Wl)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:yA,useSyncExternalStore:TA,useId:MA,unstable_isNewReconciler:!1},ZC={readContext:An,useCallback:xA,useContext:An,useEffect:am,useImperativeHandle:PA,useInsertionEffect:bA,useLayoutEffect:IA,useMemo:NA,useReducer:Vd,useRef:RA,useState:function(){return Vd(Wl)},useDebugValue:lm,useDeferredValue:function(t){var e=Sn();return it===null?e.memoizedState=t:kA(e,it.memoizedState,t)},useTransition:function(){var t=Vd(Wl)[0],e=Sn().memoizedState;return[t,e]},useMutableSource:yA,useSyncExternalStore:TA,useId:MA,unstable_isNewReconciler:!1};function Pn(t,e){if(t&&t.defaultProps){e=Le({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function sg(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Le({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var If={isMounted:function(t){return(t=t._reactInternals)?Ps(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=jt(),i=Ti(t),s=xr(r,i);s.payload=e,n!=null&&(s.callback=n),e=mi(t,s,i),e!==null&&(Fn(e,t,i,r),Ou(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=jt(),i=Ti(t),s=xr(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=mi(t,s,i),e!==null&&(Fn(e,t,i,r),Ou(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=jt(),r=Ti(t),i=xr(n,r);i.tag=2,e!=null&&(i.callback=e),e=mi(t,i,r),e!==null&&(Fn(e,t,r,n),Ou(e,t,r))}};function kT(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Fl(n,r)||!Fl(i,s):!0}function UA(t,e,n){var r=!1,i=Ii,s=e.contextType;return typeof s=="object"&&s!==null?s=An(s):(i=Qt(e)?vs:Ft.current,r=e.contextTypes,s=(r=r!=null)?zo(t,i):Ii),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=If,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function MT(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&If.enqueueReplaceState(e,e.state,null)}function og(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},em(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=An(s):(s=Qt(e)?vs:Ft.current,i.context=zo(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(sg(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&If.enqueueReplaceState(i,i.state,null),hh(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ho(t,e){try{var n="",r=e;do n+=RI(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Ld(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ag(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var JC=typeof WeakMap=="function"?WeakMap:Map;function BA(t,e,n){n=xr(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){_h||(_h=!0,mg=r),ag(t,e)},n}function VA(t,e,n){n=xr(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){ag(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){ag(t,e),typeof r!="function"&&(yi===null?yi=new Set([this]):yi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function OT(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new JC;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=fP.bind(null,t,e,n),e.then(t,t))}function DT(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function FT(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=xr(-1,1),e.tag=2,mi(n,e,1))),n.lanes|=1),t)}var GC=Vr.ReactCurrentOwner,Kt=!1;function Lt(t,e,n,r){e.child=t===null?pA(e,null,n,r):Wo(e,t.child,n,r)}function UT(t,e,n,r,i){n=n.render;var s=e.ref;return ko(e,i),r=sm(t,e,n,r,s,i),n=om(),t!==null&&!Kt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Or(t,e,i)):(Oe&&n&&q_(e),e.flags|=1,Lt(t,e,r,i),e.child)}function BT(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!_m(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,LA(t,e,s,r,i)):(t=Lu(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Fl,n(o,r)&&t.ref===e.ref)return Or(t,e,i)}return e.flags|=1,t=vi(s,r),t.ref=e.ref,t.return=e,e.child=t}function LA(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Fl(s,r)&&t.ref===e.ref)if(Kt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(Kt=!0);else return e.lanes=t.lanes,Or(t,e,i)}return lg(t,e,n,r,i)}function zA(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ie(vo,nn),nn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ie(vo,nn),nn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Ie(vo,nn),nn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Ie(vo,nn),nn|=r;return Lt(t,e,i,n),e.child}function jA(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function lg(t,e,n,r,i){var s=Qt(n)?vs:Ft.current;return s=zo(e,s),ko(e,i),n=sm(t,e,n,r,s,i),r=om(),t!==null&&!Kt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Or(t,e,i)):(Oe&&r&&q_(e),e.flags|=1,Lt(t,e,n,i),e.child)}function VT(t,e,n,r,i){if(Qt(n)){var s=!0;oh(e)}else s=!1;if(ko(e,i),e.stateNode===null)Uu(t,e),UA(e,n,r),og(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=An(u):(u=Qt(n)?vs:Ft.current,u=zo(e,u));var h=n.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&MT(e,o,r,u),ni=!1;var p=e.memoizedState;o.state=p,hh(e,r,o,i),l=e.memoizedState,a!==r||p!==l||Yt.current||ni?(typeof h=="function"&&(sg(e,n,h,r),l=e.memoizedState),(a=ni||kT(e,n,a,r,p,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,_A(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Pn(e.type,a),o.props=u,d=e.pendingProps,p=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=An(l):(l=Qt(n)?vs:Ft.current,l=zo(e,l));var _=n.getDerivedStateFromProps;(h=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||p!==l)&&MT(e,o,r,l),ni=!1,p=e.memoizedState,o.state=p,hh(e,r,o,i);var A=e.memoizedState;a!==d||p!==A||Yt.current||ni?(typeof _=="function"&&(sg(e,n,_,r),A=e.memoizedState),(u=ni||kT(e,n,u,r,p,A,l)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,A,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,A,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=A),o.props=r,o.state=A,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return cg(t,e,n,r,s,i)}function cg(t,e,n,r,i,s){jA(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&ST(e,n,!1),Or(t,e,s);r=e.stateNode,GC.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Wo(e,t.child,null,s),e.child=Wo(e,null,a,s)):Lt(t,e,a,s),e.memoizedState=r.state,i&&ST(e,n,!0),e.child}function WA(t){var e=t.stateNode;e.pendingContext?AT(t,e.pendingContext,e.pendingContext!==e.context):e.context&&AT(t,e.context,!1),tm(t,e.containerInfo)}function LT(t,e,n,r,i){return jo(),Y_(i),e.flags|=256,Lt(t,e,n,r),e.child}var ug={dehydrated:null,treeContext:null,retryLane:0};function hg(t){return{baseLanes:t,cachePool:null,transitions:null}}function $A(t,e,n){var r=e.pendingProps,i=Be.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ie(Be,i&1),t===null)return rg(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=xf(o,r,0,null),t=ps(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=hg(n),e.memoizedState=ug,t):cm(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return eP(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=vi(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=vi(a,s):(s=ps(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?hg(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=ug,r}return s=t.child,t=s.sibling,r=vi(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function cm(t,e){return e=xf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function su(t,e,n,r){return r!==null&&Y_(r),Wo(e,t.child,null,n),t=cm(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function eP(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Ld(Error(K(422))),su(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=xf({mode:"visible",children:r.children},i,0,null),s=ps(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Wo(e,t.child,null,o),e.child.memoizedState=hg(o),e.memoizedState=ug,s);if(!(e.mode&1))return su(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(K(419)),r=Ld(s,r,void 0),su(t,e,o,r)}if(a=(o&t.childLanes)!==0,Kt||a){if(r=_t,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Mr(t,i),Fn(r,t,i,-1))}return gm(),r=Ld(Error(K(421))),su(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=dP.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,sn=_i(i.nextSibling),on=e,Oe=!0,Nn=null,t!==null&&(gn[_n++]=Ir,gn[_n++]=Cr,gn[_n++]=Es,Ir=t.id,Cr=t.overflow,Es=e),e=cm(e,r.children),e.flags|=4096,e)}function zT(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),ig(t.return,e,n)}function zd(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function HA(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Lt(t,e,r.children,n),r=Be.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&zT(t,n,e);else if(t.tag===19)zT(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ie(Be,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&fh(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),zd(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&fh(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}zd(e,!0,n,null,s);break;case"together":zd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Uu(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Or(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),As|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(K(153));if(e.child!==null){for(t=e.child,n=vi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=vi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function tP(t,e,n){switch(e.tag){case 3:WA(e),jo();break;case 5:mA(e);break;case 1:Qt(e.type)&&oh(e);break;case 4:tm(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ie(ch,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ie(Be,Be.current&1),e.flags|=128,null):n&e.child.childLanes?$A(t,e,n):(Ie(Be,Be.current&1),t=Or(t,e,n),t!==null?t.sibling:null);Ie(Be,Be.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return HA(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ie(Be,Be.current),r)break;return null;case 22:case 23:return e.lanes=0,zA(t,e,n)}return Or(t,e,n)}var XA,fg,qA,KA;XA=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};fg=function(){};qA=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ls(er.current);var s=null;switch(n){case"input":i=Op(t,i),r=Op(t,r),s=[];break;case"select":i=Le({},i,{value:void 0}),r=Le({},r,{value:void 0}),s=[];break;case"textarea":i=Up(t,i),r=Up(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=ih)}Vp(n,r);var o;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Pl.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Pl.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ke("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};KA=function(t,e,n,r){n!==r&&(e.flags|=4)};function ja(t,e){if(!Oe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Pt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function nP(t,e,n){var r=e.pendingProps;switch(K_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(e),null;case 1:return Qt(e.type)&&sh(),Pt(e),null;case 3:return r=e.stateNode,$o(),Me(Yt),Me(Ft),rm(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ru(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nn!==null&&(vg(Nn),Nn=null))),fg(t,e),Pt(e),null;case 5:nm(e);var i=ls(zl.current);if(n=e.type,t!==null&&e.stateNode!=null)qA(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(K(166));return Pt(e),null}if(t=ls(er.current),ru(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Yn]=e,r[Vl]=s,t=(e.mode&1)!==0,n){case"dialog":ke("cancel",r),ke("close",r);break;case"iframe":case"object":case"embed":ke("load",r);break;case"video":case"audio":for(i=0;i<el.length;i++)ke(el[i],r);break;case"source":ke("error",r);break;case"img":case"image":case"link":ke("error",r),ke("load",r);break;case"details":ke("toggle",r);break;case"input":Qy(r,s),ke("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ke("invalid",r);break;case"textarea":Jy(r,s),ke("invalid",r)}Vp(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&nu(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&nu(r.textContent,a,t),i=["children",""+a]):Pl.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ke("scroll",r)}switch(n){case"input":Kc(r),Zy(r,s,!0);break;case"textarea":Kc(r),Gy(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ih)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=ww(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Yn]=e,t[Vl]=r,XA(t,e,!1,!1),e.stateNode=t;e:{switch(o=Lp(n,r),n){case"dialog":ke("cancel",t),ke("close",t),i=r;break;case"iframe":case"object":case"embed":ke("load",t),i=r;break;case"video":case"audio":for(i=0;i<el.length;i++)ke(el[i],t);i=r;break;case"source":ke("error",t),i=r;break;case"img":case"image":case"link":ke("error",t),ke("load",t),i=r;break;case"details":ke("toggle",t),i=r;break;case"input":Qy(t,r),i=Op(t,r),ke("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Le({},r,{value:void 0}),ke("invalid",t);break;case"textarea":Jy(t,r),i=Up(t,r),ke("invalid",t);break;default:i=r}Vp(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Rw(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Aw(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&xl(t,l):typeof l=="number"&&xl(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Pl.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ke("scroll",t):l!=null&&M_(t,s,l,o))}switch(n){case"input":Kc(t),Zy(t,r,!1);break;case"textarea":Kc(t),Gy(t);break;case"option":r.value!=null&&t.setAttribute("value",""+bi(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Co(t,!!r.multiple,s,!1):r.defaultValue!=null&&Co(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=ih)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Pt(e),null;case 6:if(t&&e.stateNode!=null)KA(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(K(166));if(n=ls(zl.current),ls(er.current),ru(e)){if(r=e.stateNode,n=e.memoizedProps,r[Yn]=e,(s=r.nodeValue!==n)&&(t=on,t!==null))switch(t.tag){case 3:nu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&nu(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Yn]=e,e.stateNode=r}return Pt(e),null;case 13:if(Me(Be),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Oe&&sn!==null&&e.mode&1&&!(e.flags&128))fA(),jo(),e.flags|=98560,s=!1;else if(s=ru(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(K(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(K(317));s[Yn]=e}else jo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Pt(e),s=!1}else Nn!==null&&(vg(Nn),Nn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Be.current&1?ot===0&&(ot=3):gm())),e.updateQueue!==null&&(e.flags|=4),Pt(e),null);case 4:return $o(),fg(t,e),t===null&&Ul(e.stateNode.containerInfo),Pt(e),null;case 10:return J_(e.type._context),Pt(e),null;case 17:return Qt(e.type)&&sh(),Pt(e),null;case 19:if(Me(Be),s=e.memoizedState,s===null)return Pt(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)ja(s,!1);else{if(ot!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=fh(t),o!==null){for(e.flags|=128,ja(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ie(Be,Be.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ke()>Xo&&(e.flags|=128,r=!0,ja(s,!1),e.lanes=4194304)}else{if(!r)if(t=fh(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ja(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Oe)return Pt(e),null}else 2*Ke()-s.renderingStartTime>Xo&&n!==1073741824&&(e.flags|=128,r=!0,ja(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ke(),e.sibling=null,n=Be.current,Ie(Be,r?n&1|2:n&1),e):(Pt(e),null);case 22:case 23:return pm(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?nn&1073741824&&(Pt(e),e.subtreeFlags&6&&(e.flags|=8192)):Pt(e),null;case 24:return null;case 25:return null}throw Error(K(156,e.tag))}function rP(t,e){switch(K_(e),e.tag){case 1:return Qt(e.type)&&sh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return $o(),Me(Yt),Me(Ft),rm(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return nm(e),null;case 13:if(Me(Be),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(K(340));jo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Me(Be),null;case 4:return $o(),null;case 10:return J_(e.type._context),null;case 22:case 23:return pm(),null;case 24:return null;default:return null}}var ou=!1,Mt=!1,iP=typeof WeakSet=="function"?WeakSet:Set,te=null;function To(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){He(t,e,r)}else n.current=null}function dg(t,e,n){try{n()}catch(r){He(t,e,r)}}var jT=!1;function sP(t,e){if(Qp=th,t=Gw(),X_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,h=0,d=t,p=null;t:for(;;){for(var _;d!==n||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(_=d.firstChild)!==null;)p=d,d=_;for(;;){if(d===t)break t;if(p===n&&++u===i&&(a=o),p===s&&++h===r&&(l=o),(_=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=_}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Zp={focusedElem:t,selectionRange:n},th=!1,te=e;te!==null;)if(e=te,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,te=t;else for(;te!==null;){e=te;try{var A=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(A!==null){var S=A.memoizedProps,k=A.memoizedState,v=e.stateNode,m=v.getSnapshotBeforeUpdate(e.elementType===e.type?S:Pn(e.type,S),k);v.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(D){He(e,e.return,D)}if(t=e.sibling,t!==null){t.return=e.return,te=t;break}te=e.return}return A=jT,jT=!1,A}function pl(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&dg(e,n,s)}i=i.next}while(i!==r)}}function Cf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function pg(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function YA(t){var e=t.alternate;e!==null&&(t.alternate=null,YA(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Yn],delete e[Vl],delete e[eg],delete e[zC],delete e[jC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function QA(t){return t.tag===5||t.tag===3||t.tag===4}function WT(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||QA(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function gg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ih));else if(r!==4&&(t=t.child,t!==null))for(gg(t,e,n),t=t.sibling;t!==null;)gg(t,e,n),t=t.sibling}function _g(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(_g(t,e,n),t=t.sibling;t!==null;)_g(t,e,n),t=t.sibling}var vt=null,xn=!1;function Qr(t,e,n){for(n=n.child;n!==null;)ZA(t,e,n),n=n.sibling}function ZA(t,e,n){if(Gn&&typeof Gn.onCommitFiberUnmount=="function")try{Gn.onCommitFiberUnmount(vf,n)}catch{}switch(n.tag){case 5:Mt||To(n,e);case 6:var r=vt,i=xn;vt=null,Qr(t,e,n),vt=r,xn=i,vt!==null&&(xn?(t=vt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):vt.removeChild(n.stateNode));break;case 18:vt!==null&&(xn?(t=vt,n=n.stateNode,t.nodeType===8?Od(t.parentNode,n):t.nodeType===1&&Od(t,n),Ol(t)):Od(vt,n.stateNode));break;case 4:r=vt,i=xn,vt=n.stateNode.containerInfo,xn=!0,Qr(t,e,n),vt=r,xn=i;break;case 0:case 11:case 14:case 15:if(!Mt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&dg(n,e,o),i=i.next}while(i!==r)}Qr(t,e,n);break;case 1:if(!Mt&&(To(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){He(n,e,a)}Qr(t,e,n);break;case 21:Qr(t,e,n);break;case 22:n.mode&1?(Mt=(r=Mt)||n.memoizedState!==null,Qr(t,e,n),Mt=r):Qr(t,e,n);break;default:Qr(t,e,n)}}function $T(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new iP),e.forEach(function(r){var i=pP.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Cn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:vt=a.stateNode,xn=!1;break e;case 3:vt=a.stateNode.containerInfo,xn=!0;break e;case 4:vt=a.stateNode.containerInfo,xn=!0;break e}a=a.return}if(vt===null)throw Error(K(160));ZA(s,o,i),vt=null,xn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){He(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JA(e,t),e=e.sibling}function JA(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Cn(e,t),jn(t),r&4){try{pl(3,t,t.return),Cf(3,t)}catch(S){He(t,t.return,S)}try{pl(5,t,t.return)}catch(S){He(t,t.return,S)}}break;case 1:Cn(e,t),jn(t),r&512&&n!==null&&To(n,n.return);break;case 5:if(Cn(e,t),jn(t),r&512&&n!==null&&To(n,n.return),t.flags&32){var i=t.stateNode;try{xl(i,"")}catch(S){He(t,t.return,S)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&vw(i,s),Lp(a,o);var u=Lp(a,s);for(o=0;o<l.length;o+=2){var h=l[o],d=l[o+1];h==="style"?Rw(i,d):h==="dangerouslySetInnerHTML"?Aw(i,d):h==="children"?xl(i,d):M_(i,h,d,u)}switch(a){case"input":Dp(i,s);break;case"textarea":Ew(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var _=s.value;_!=null?Co(i,!!s.multiple,_,!1):p!==!!s.multiple&&(s.defaultValue!=null?Co(i,!!s.multiple,s.defaultValue,!0):Co(i,!!s.multiple,s.multiple?[]:"",!1))}i[Vl]=s}catch(S){He(t,t.return,S)}}break;case 6:if(Cn(e,t),jn(t),r&4){if(t.stateNode===null)throw Error(K(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(S){He(t,t.return,S)}}break;case 3:if(Cn(e,t),jn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ol(e.containerInfo)}catch(S){He(t,t.return,S)}break;case 4:Cn(e,t),jn(t);break;case 13:Cn(e,t),jn(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(fm=Ke())),r&4&&$T(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Mt=(u=Mt)||h,Cn(e,t),Mt=u):Cn(e,t),jn(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(te=t,h=t.child;h!==null;){for(d=te=h;te!==null;){switch(p=te,_=p.child,p.tag){case 0:case 11:case 14:case 15:pl(4,p,p.return);break;case 1:To(p,p.return);var A=p.stateNode;if(typeof A.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,A.props=e.memoizedProps,A.state=e.memoizedState,A.componentWillUnmount()}catch(S){He(r,n,S)}}break;case 5:To(p,p.return);break;case 22:if(p.memoizedState!==null){XT(d);continue}}_!==null?(_.return=p,te=_):XT(d)}h=h.sibling}e:for(h=null,d=t;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Sw("display",o))}catch(S){He(t,t.return,S)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(S){He(t,t.return,S)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Cn(e,t),jn(t),r&4&&$T(t);break;case 21:break;default:Cn(e,t),jn(t)}}function jn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(QA(n)){var r=n;break e}n=n.return}throw Error(K(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(xl(i,""),r.flags&=-33);var s=WT(t);_g(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=WT(t);gg(t,a,o);break;default:throw Error(K(161))}}catch(l){He(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function oP(t,e,n){te=t,GA(t)}function GA(t,e,n){for(var r=(t.mode&1)!==0;te!==null;){var i=te,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||ou;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Mt;a=ou;var u=Mt;if(ou=o,(Mt=l)&&!u)for(te=i;te!==null;)o=te,l=o.child,o.tag===22&&o.memoizedState!==null?qT(i):l!==null?(l.return=o,te=l):qT(i);for(;s!==null;)te=s,GA(s),s=s.sibling;te=i,ou=a,Mt=u}HT(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,te=s):HT(t)}}function HT(t){for(;te!==null;){var e=te;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Mt||Cf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Mt)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Pn(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&PT(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}PT(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&Ol(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}Mt||e.flags&512&&pg(e)}catch(p){He(e,e.return,p)}}if(e===t){te=null;break}if(n=e.sibling,n!==null){n.return=e.return,te=n;break}te=e.return}}function XT(t){for(;te!==null;){var e=te;if(e===t){te=null;break}var n=e.sibling;if(n!==null){n.return=e.return,te=n;break}te=e.return}}function qT(t){for(;te!==null;){var e=te;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Cf(4,e)}catch(l){He(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){He(e,i,l)}}var s=e.return;try{pg(e)}catch(l){He(e,s,l)}break;case 5:var o=e.return;try{pg(e)}catch(l){He(e,o,l)}}}catch(l){He(e,e.return,l)}if(e===t){te=null;break}var a=e.sibling;if(a!==null){a.return=e.return,te=a;break}te=e.return}}var aP=Math.ceil,gh=Vr.ReactCurrentDispatcher,um=Vr.ReactCurrentOwner,vn=Vr.ReactCurrentBatchConfig,me=0,_t=null,et=null,At=0,nn=0,vo=Fi(0),ot=0,Hl=null,As=0,Pf=0,hm=0,gl=null,qt=null,fm=0,Xo=1/0,Ar=null,_h=!1,mg=null,yi=null,au=!1,li=null,mh=0,_l=0,yg=null,Bu=-1,Vu=0;function jt(){return me&6?Ke():Bu!==-1?Bu:Bu=Ke()}function Ti(t){return t.mode&1?me&2&&At!==0?At&-At:$C.transition!==null?(Vu===0&&(Vu=Uw()),Vu):(t=Ee,t!==0||(t=window.event,t=t===void 0?16:$w(t.type)),t):1}function Fn(t,e,n,r){if(50<_l)throw _l=0,yg=null,Error(K(185));uc(t,n,r),(!(me&2)||t!==_t)&&(t===_t&&(!(me&2)&&(Pf|=n),ot===4&&oi(t,At)),Zt(t,r),n===1&&me===0&&!(e.mode&1)&&(Xo=Ke()+500,Rf&&Ui()))}function Zt(t,e){var n=t.callbackNode;$I(t,e);var r=eh(t,t===_t?At:0);if(r===0)n!==null&&nT(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&nT(n),e===1)t.tag===0?WC(KT.bind(null,t)):cA(KT.bind(null,t)),VC(function(){!(me&6)&&Ui()}),n=null;else{switch(Bw(r)){case 1:n=B_;break;case 4:n=Dw;break;case 16:n=Gu;break;case 536870912:n=Fw;break;default:n=Gu}n=aS(n,eS.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function eS(t,e){if(Bu=-1,Vu=0,me&6)throw Error(K(327));var n=t.callbackNode;if(Mo()&&t.callbackNode!==n)return null;var r=eh(t,t===_t?At:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=yh(t,r);else{e=r;var i=me;me|=2;var s=nS();(_t!==t||At!==e)&&(Ar=null,Xo=Ke()+500,ds(t,e));do try{uP();break}catch(a){tS(t,a)}while(!0);Z_(),gh.current=s,me=i,et!==null?e=0:(_t=null,At=0,e=ot)}if(e!==0){if(e===2&&(i=Hp(t),i!==0&&(r=i,e=Tg(t,i))),e===1)throw n=Hl,ds(t,0),oi(t,r),Zt(t,Ke()),n;if(e===6)oi(t,r);else{if(i=t.current.alternate,!(r&30)&&!lP(i)&&(e=yh(t,r),e===2&&(s=Hp(t),s!==0&&(r=s,e=Tg(t,s))),e===1))throw n=Hl,ds(t,0),oi(t,r),Zt(t,Ke()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(K(345));case 2:es(t,qt,Ar);break;case 3:if(oi(t,r),(r&130023424)===r&&(e=fm+500-Ke(),10<e)){if(eh(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){jt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Gp(es.bind(null,t,qt,Ar),e);break}es(t,qt,Ar);break;case 4:if(oi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Dn(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Ke()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*aP(r/1960))-r,10<r){t.timeoutHandle=Gp(es.bind(null,t,qt,Ar),r);break}es(t,qt,Ar);break;case 5:es(t,qt,Ar);break;default:throw Error(K(329))}}}return Zt(t,Ke()),t.callbackNode===n?eS.bind(null,t):null}function Tg(t,e){var n=gl;return t.current.memoizedState.isDehydrated&&(ds(t,e).flags|=256),t=yh(t,e),t!==2&&(e=qt,qt=n,e!==null&&vg(e)),t}function vg(t){qt===null?qt=t:qt.push.apply(qt,t)}function lP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Bn(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function oi(t,e){for(e&=~hm,e&=~Pf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Dn(e),r=1<<n;t[n]=-1,e&=~r}}function KT(t){if(me&6)throw Error(K(327));Mo();var e=eh(t,0);if(!(e&1))return Zt(t,Ke()),null;var n=yh(t,e);if(t.tag!==0&&n===2){var r=Hp(t);r!==0&&(e=r,n=Tg(t,r))}if(n===1)throw n=Hl,ds(t,0),oi(t,e),Zt(t,Ke()),n;if(n===6)throw Error(K(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,es(t,qt,Ar),Zt(t,Ke()),null}function dm(t,e){var n=me;me|=1;try{return t(e)}finally{me=n,me===0&&(Xo=Ke()+500,Rf&&Ui())}}function Ss(t){li!==null&&li.tag===0&&!(me&6)&&Mo();var e=me;me|=1;var n=vn.transition,r=Ee;try{if(vn.transition=null,Ee=1,t)return t()}finally{Ee=r,vn.transition=n,me=e,!(me&6)&&Ui()}}function pm(){nn=vo.current,Me(vo)}function ds(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,BC(n)),et!==null)for(n=et.return;n!==null;){var r=n;switch(K_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&sh();break;case 3:$o(),Me(Yt),Me(Ft),rm();break;case 5:nm(r);break;case 4:$o();break;case 13:Me(Be);break;case 19:Me(Be);break;case 10:J_(r.type._context);break;case 22:case 23:pm()}n=n.return}if(_t=t,et=t=vi(t.current,null),At=nn=e,ot=0,Hl=null,hm=Pf=As=0,qt=gl=null,as!==null){for(e=0;e<as.length;e++)if(n=as[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}as=null}return t}function tS(t,e){do{var n=et;try{if(Z_(),Du.current=ph,dh){for(var r=Ve.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}dh=!1}if(ws=0,gt=it=Ve=null,dl=!1,jl=0,um.current=null,n===null||n.return===null){ot=1,Hl=e,et=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=At,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,h=a,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var p=h.alternate;p?(h.updateQueue=p.updateQueue,h.memoizedState=p.memoizedState,h.lanes=p.lanes):(h.updateQueue=null,h.memoizedState=null)}var _=DT(o);if(_!==null){_.flags&=-257,FT(_,o,a,s,e),_.mode&1&&OT(s,u,e),e=_,l=u;var A=e.updateQueue;if(A===null){var S=new Set;S.add(l),e.updateQueue=S}else A.add(l);break e}else{if(!(e&1)){OT(s,u,e),gm();break e}l=Error(K(426))}}else if(Oe&&a.mode&1){var k=DT(o);if(k!==null){!(k.flags&65536)&&(k.flags|=256),FT(k,o,a,s,e),Y_(Ho(l,a));break e}}s=l=Ho(l,a),ot!==4&&(ot=2),gl===null?gl=[s]:gl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=BA(s,l,e);CT(s,v);break e;case 1:a=l;var m=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(yi===null||!yi.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var D=VA(s,a,e);CT(s,D);break e}}s=s.return}while(s!==null)}iS(n)}catch(V){e=V,et===n&&n!==null&&(et=n=n.return);continue}break}while(!0)}function nS(){var t=gh.current;return gh.current=ph,t===null?ph:t}function gm(){(ot===0||ot===3||ot===2)&&(ot=4),_t===null||!(As&268435455)&&!(Pf&268435455)||oi(_t,At)}function yh(t,e){var n=me;me|=2;var r=nS();(_t!==t||At!==e)&&(Ar=null,ds(t,e));do try{cP();break}catch(i){tS(t,i)}while(!0);if(Z_(),me=n,gh.current=r,et!==null)throw Error(K(261));return _t=null,At=0,ot}function cP(){for(;et!==null;)rS(et)}function uP(){for(;et!==null&&!DI();)rS(et)}function rS(t){var e=oS(t.alternate,t,nn);t.memoizedProps=t.pendingProps,e===null?iS(t):et=e,um.current=null}function iS(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=rP(n,e),n!==null){n.flags&=32767,et=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ot=6,et=null;return}}else if(n=nP(n,e,nn),n!==null){et=n;return}if(e=e.sibling,e!==null){et=e;return}et=e=t}while(e!==null);ot===0&&(ot=5)}function es(t,e,n){var r=Ee,i=vn.transition;try{vn.transition=null,Ee=1,hP(t,e,n,r)}finally{vn.transition=i,Ee=r}return null}function hP(t,e,n,r){do Mo();while(li!==null);if(me&6)throw Error(K(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(K(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(HI(t,s),t===_t&&(et=_t=null,At=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||au||(au=!0,aS(Gu,function(){return Mo(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=vn.transition,vn.transition=null;var o=Ee;Ee=1;var a=me;me|=4,um.current=null,sP(t,n),JA(n,t),NC(Zp),th=!!Qp,Zp=Qp=null,t.current=n,oP(n),FI(),me=a,Ee=o,vn.transition=s}else t.current=n;if(au&&(au=!1,li=t,mh=i),s=t.pendingLanes,s===0&&(yi=null),VI(n.stateNode),Zt(t,Ke()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(_h)throw _h=!1,t=mg,mg=null,t;return mh&1&&t.tag!==0&&Mo(),s=t.pendingLanes,s&1?t===yg?_l++:(_l=0,yg=t):_l=0,Ui(),null}function Mo(){if(li!==null){var t=Bw(mh),e=vn.transition,n=Ee;try{if(vn.transition=null,Ee=16>t?16:t,li===null)var r=!1;else{if(t=li,li=null,mh=0,me&6)throw Error(K(331));var i=me;for(me|=4,te=t.current;te!==null;){var s=te,o=s.child;if(te.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(te=u;te!==null;){var h=te;switch(h.tag){case 0:case 11:case 15:pl(8,h,s)}var d=h.child;if(d!==null)d.return=h,te=d;else for(;te!==null;){h=te;var p=h.sibling,_=h.return;if(YA(h),h===u){te=null;break}if(p!==null){p.return=_,te=p;break}te=_}}}var A=s.alternate;if(A!==null){var S=A.child;if(S!==null){A.child=null;do{var k=S.sibling;S.sibling=null,S=k}while(S!==null)}}te=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,te=o;else e:for(;te!==null;){if(s=te,s.flags&2048)switch(s.tag){case 0:case 11:case 15:pl(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,te=v;break e}te=s.return}}var m=t.current;for(te=m;te!==null;){o=te;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,te=b;else e:for(o=m;te!==null;){if(a=te,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Cf(9,a)}}catch(V){He(a,a.return,V)}if(a===o){te=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,te=D;break e}te=a.return}}if(me=i,Ui(),Gn&&typeof Gn.onPostCommitFiberRoot=="function")try{Gn.onPostCommitFiberRoot(vf,t)}catch{}r=!0}return r}finally{Ee=n,vn.transition=e}}return!1}function YT(t,e,n){e=Ho(n,e),e=BA(t,e,1),t=mi(t,e,1),e=jt(),t!==null&&(uc(t,1,e),Zt(t,e))}function He(t,e,n){if(t.tag===3)YT(t,t,n);else for(;e!==null;){if(e.tag===3){YT(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(yi===null||!yi.has(r))){t=Ho(n,t),t=VA(e,t,1),e=mi(e,t,1),t=jt(),e!==null&&(uc(e,1,t),Zt(e,t));break}}e=e.return}}function fP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=jt(),t.pingedLanes|=t.suspendedLanes&n,_t===t&&(At&n)===n&&(ot===4||ot===3&&(At&130023424)===At&&500>Ke()-fm?ds(t,0):hm|=n),Zt(t,e)}function sS(t,e){e===0&&(t.mode&1?(e=Zc,Zc<<=1,!(Zc&130023424)&&(Zc=4194304)):e=1);var n=jt();t=Mr(t,e),t!==null&&(uc(t,e,n),Zt(t,n))}function dP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),sS(t,n)}function pP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(K(314))}r!==null&&r.delete(e),sS(t,n)}var oS;oS=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Yt.current)Kt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Kt=!1,tP(t,e,n);Kt=!!(t.flags&131072)}else Kt=!1,Oe&&e.flags&1048576&&uA(e,lh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Uu(t,e),t=e.pendingProps;var i=zo(e,Ft.current);ko(e,n),i=sm(null,e,r,t,i,n);var s=om();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qt(r)?(s=!0,oh(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,em(e),i.updater=If,e.stateNode=i,i._reactInternals=e,og(e,r,t,n),e=cg(null,e,r,!0,s,n)):(e.tag=0,Oe&&s&&q_(e),Lt(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Uu(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=_P(r),t=Pn(r,t),i){case 0:e=lg(null,e,r,t,n);break e;case 1:e=VT(null,e,r,t,n);break e;case 11:e=UT(null,e,r,t,n);break e;case 14:e=BT(null,e,r,Pn(r.type,t),n);break e}throw Error(K(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),lg(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),VT(t,e,r,i,n);case 3:e:{if(WA(e),t===null)throw Error(K(387));r=e.pendingProps,s=e.memoizedState,i=s.element,_A(t,e),hh(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ho(Error(K(423)),e),e=LT(t,e,r,n,i);break e}else if(r!==i){i=Ho(Error(K(424)),e),e=LT(t,e,r,n,i);break e}else for(sn=_i(e.stateNode.containerInfo.firstChild),on=e,Oe=!0,Nn=null,n=pA(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(jo(),r===i){e=Or(t,e,n);break e}Lt(t,e,r,n)}e=e.child}return e;case 5:return mA(e),t===null&&rg(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Jp(r,i)?o=null:s!==null&&Jp(r,s)&&(e.flags|=32),jA(t,e),Lt(t,e,o,n),e.child;case 6:return t===null&&rg(e),null;case 13:return $A(t,e,n);case 4:return tm(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Wo(e,null,r,n):Lt(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),UT(t,e,r,i,n);case 7:return Lt(t,e,e.pendingProps,n),e.child;case 8:return Lt(t,e,e.pendingProps.children,n),e.child;case 12:return Lt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Ie(ch,r._currentValue),r._currentValue=o,s!==null)if(Bn(s.value,o)){if(s.children===i.children&&!Yt.current){e=Or(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=xr(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?l.next=l:(l.next=h.next,h.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ig(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(K(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ig(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Lt(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ko(e,n),i=An(i),r=r(i),e.flags|=1,Lt(t,e,r,n),e.child;case 14:return r=e.type,i=Pn(r,e.pendingProps),i=Pn(r.type,i),BT(t,e,r,i,n);case 15:return LA(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pn(r,i),Uu(t,e),e.tag=1,Qt(r)?(t=!0,oh(e)):t=!1,ko(e,n),UA(e,r,i),og(e,r,i,n),cg(null,e,r,!0,t,n);case 19:return HA(t,e,n);case 22:return zA(t,e,n)}throw Error(K(156,e.tag))};function aS(t,e){return Ow(t,e)}function gP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yn(t,e,n,r){return new gP(t,e,n,r)}function _m(t){return t=t.prototype,!(!t||!t.isReactComponent)}function _P(t){if(typeof t=="function")return _m(t)?1:0;if(t!=null){if(t=t.$$typeof,t===D_)return 11;if(t===F_)return 14}return 2}function vi(t,e){var n=t.alternate;return n===null?(n=yn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Lu(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")_m(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case co:return ps(n.children,i,s,e);case O_:o=8,i|=8;break;case xp:return t=yn(12,n,e,i|2),t.elementType=xp,t.lanes=s,t;case Np:return t=yn(13,n,e,i),t.elementType=Np,t.lanes=s,t;case kp:return t=yn(19,n,e,i),t.elementType=kp,t.lanes=s,t;case mw:return xf(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case gw:o=10;break e;case _w:o=9;break e;case D_:o=11;break e;case F_:o=14;break e;case ti:o=16,r=null;break e}throw Error(K(130,t==null?t:typeof t,""))}return e=yn(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function ps(t,e,n,r){return t=yn(7,t,r,e),t.lanes=n,t}function xf(t,e,n,r){return t=yn(22,t,r,e),t.elementType=mw,t.lanes=n,t.stateNode={isHidden:!1},t}function jd(t,e,n){return t=yn(6,t,null,e),t.lanes=n,t}function Wd(t,e,n){return e=yn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function mP(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ad(0),this.expirationTimes=Ad(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ad(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function mm(t,e,n,r,i,s,o,a,l){return t=new mP(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=yn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},em(s),t}function yP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function lS(t){if(!t)return Ii;t=t._reactInternals;e:{if(Ps(t)!==t||t.tag!==1)throw Error(K(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(K(171))}if(t.tag===1){var n=t.type;if(Qt(n))return lA(t,n,e)}return e}function cS(t,e,n,r,i,s,o,a,l){return t=mm(n,r,!0,t,i,s,o,a,l),t.context=lS(null),n=t.current,r=jt(),i=Ti(n),s=xr(r,i),s.callback=e??null,mi(n,s,i),t.current.lanes=i,uc(t,i,r),Zt(t,r),t}function Nf(t,e,n,r){var i=e.current,s=jt(),o=Ti(i);return n=lS(n),e.context===null?e.context=n:e.pendingContext=n,e=xr(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=mi(i,e,o),t!==null&&(Fn(t,i,o,s),Ou(t,i,o)),o}function Th(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function QT(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ym(t,e){QT(t,e),(t=t.alternate)&&QT(t,e)}function TP(){return null}var uS=typeof reportError=="function"?reportError:function(t){console.error(t)};function Tm(t){this._internalRoot=t}kf.prototype.render=Tm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(K(409));Nf(t,e,null,null)};kf.prototype.unmount=Tm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ss(function(){Nf(null,t,null,null)}),e[kr]=null}};function kf(t){this._internalRoot=t}kf.prototype.unstable_scheduleHydration=function(t){if(t){var e=zw();t={blockedOn:null,target:t,priority:e};for(var n=0;n<si.length&&e!==0&&e<si[n].priority;n++);si.splice(n,0,t),n===0&&Ww(t)}};function vm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Mf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ZT(){}function vP(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=Th(o);s.call(u)}}var o=cS(e,r,t,0,null,!1,!1,"",ZT);return t._reactRootContainer=o,t[kr]=o.current,Ul(t.nodeType===8?t.parentNode:t),Ss(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=Th(l);a.call(u)}}var l=mm(t,0,!1,null,null,!1,!1,"",ZT);return t._reactRootContainer=l,t[kr]=l.current,Ul(t.nodeType===8?t.parentNode:t),Ss(function(){Nf(e,l,n,r)}),l}function Of(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Th(o);a.call(l)}}Nf(e,o,t,i)}else o=vP(n,e,t,i,r);return Th(o)}Vw=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ga(e.pendingLanes);n!==0&&(V_(e,n|1),Zt(e,Ke()),!(me&6)&&(Xo=Ke()+500,Ui()))}break;case 13:Ss(function(){var r=Mr(t,1);if(r!==null){var i=jt();Fn(r,t,1,i)}}),ym(t,1)}};L_=function(t){if(t.tag===13){var e=Mr(t,134217728);if(e!==null){var n=jt();Fn(e,t,134217728,n)}ym(t,134217728)}};Lw=function(t){if(t.tag===13){var e=Ti(t),n=Mr(t,e);if(n!==null){var r=jt();Fn(n,t,e,r)}ym(t,e)}};zw=function(){return Ee};jw=function(t,e){var n=Ee;try{return Ee=t,e()}finally{Ee=n}};jp=function(t,e,n){switch(e){case"input":if(Dp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Sf(r);if(!i)throw Error(K(90));Tw(r),Dp(r,i)}}}break;case"textarea":Ew(t,n);break;case"select":e=n.value,e!=null&&Co(t,!!n.multiple,e,!1)}};Cw=dm;Pw=Ss;var EP={usingClientEntryPoint:!1,Events:[fc,po,Sf,bw,Iw,dm]},Wa={findFiberByHostInstance:os,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wP={bundleType:Wa.bundleType,version:Wa.version,rendererPackageName:Wa.rendererPackageName,rendererConfig:Wa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Vr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=kw(t),t===null?null:t.stateNode},findFiberByHostInstance:Wa.findFiberByHostInstance||TP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lu.isDisabled&&lu.supportsFiber)try{vf=lu.inject(wP),Gn=lu}catch{}}ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EP;ln.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!vm(e))throw Error(K(200));return yP(t,e,null,n)};ln.createRoot=function(t,e){if(!vm(t))throw Error(K(299));var n=!1,r="",i=uS;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=mm(t,1,!1,null,null,n,!1,r,i),t[kr]=e.current,Ul(t.nodeType===8?t.parentNode:t),new Tm(e)};ln.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(K(188)):(t=Object.keys(t).join(","),Error(K(268,t)));return t=kw(e),t=t===null?null:t.stateNode,t};ln.flushSync=function(t){return Ss(t)};ln.hydrate=function(t,e,n){if(!Mf(e))throw Error(K(200));return Of(null,t,e,!0,n)};ln.hydrateRoot=function(t,e,n){if(!vm(t))throw Error(K(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=uS;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=cS(e,null,t,1,n??null,i,!1,s,o),t[kr]=e.current,Ul(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new kf(e)};ln.render=function(t,e,n){if(!Mf(e))throw Error(K(200));return Of(null,t,e,!1,n)};ln.unmountComponentAtNode=function(t){if(!Mf(t))throw Error(K(40));return t._reactRootContainer?(Ss(function(){Of(null,null,t,!1,function(){t._reactRootContainer=null,t[kr]=null})}),!0):!1};ln.unstable_batchedUpdates=dm;ln.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Mf(n))throw Error(K(200));if(t==null||t._reactInternals===void 0)throw Error(K(38));return Of(t,e,n,!1,r)};ln.version="18.3.1-next-f1338f8080-20240426";function hS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hS)}catch(t){console.error(t)}}hS(),hw.exports=ln;var Em=hw.exports,fS,JT=Em;fS=JT.createRoot,JT.hydrateRoot;function vh(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const wm=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),GT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);GT&&parseFloat(GT[1]);const cu=globalThis,Qs=globalThis.process||{},AP=globalThis.navigator||{};function dS(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Bi(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||dS()}function SP(t){return Bi()?dS()?"Electron":(AP.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const pS="4.0.7";function RP(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class bP{constructor(e,n,r="sessionStorage"){this.storage=RP(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function IP(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function CP(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Eh;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Eh||(Eh={}));const PP=10;function ev(t){return typeof t!="string"?t:(t=t.toUpperCase(),Eh[t]||Eh.WHITE)}function xP(t,e,n){return!Bi&&typeof t=="string"&&(e&&(t=`\x1B[${ev(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${ev(n)+PP}m${t}\x1B[49m`)),t}function NP(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Am(t,e){if(!t)throw new Error("Assertion failed")}function Zs(){var e,n,r;let t;if(Bi()&&cu.performance)t=(n=(e=cu==null?void 0:cu.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Qs){const i=(r=Qs==null?void 0:Qs.hrtime)==null?void 0:r.call(Qs);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Js={debug:Bi()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},kP={enabled:!0,level:0};function Gs(){}const tv={},nv={once:!0};class pc{constructor({id:e}={id:""}){this.VERSION=pS,this._startTs=Zs(),this._deltaTs=Zs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new bP(`__probe-${this.id}__`,kP),this.timeStamp(`${this.id} started`),NP(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Zs()-this._startTs).toPrecision(10))}getDelta(){return Number((Zs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Js.warn,arguments,nv)}error(e){return this._getLogFunction(0,e,Js.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Js.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Js.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Js.debug||Js.info,arguments,nv)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Gs,r&&[r],{tag:OP(n)}):Gs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Gs)}group(e,n,r={collapsed:!1}){const i=rv({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gs)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=gS(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=rv({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Am(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Zs();const o=s.tag||s.message;if(s.once&&o)if(!tv[o])tv[o]=Zs();else return Gs;return n=MP(this.id,s.message,s),r.bind(console,n,...s.args)}return Gs}}pc.VERSION=pS;function gS(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Am(Number.isFinite(e)&&e>=0),e}function rv(t){const{logLevel:e,message:n}=t;t.logLevel=gS(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Am(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function MP(t,e,n){if(typeof e=="string"){const r=n.time?CP(IP(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=xP(e,n.color,n.background)}return e}function OP(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const $d="4.3.1",DP=$d[0]>="0"&&$d[0]<="9"?`v${$d}`:"";function FP(){const t=new pc({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=DP,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const UP=FP();function BP(t,e){return _S(t||{},e)}function _S(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=_S(r[i]||{},e[i],n+1):r[i]=e[i];return r}const VP="latest";function LP(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const zP=LP();function Ci(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const gs=typeof process!="object"||String(process)!=="[object process]"||process.browser,jP=typeof window<"u"&&typeof window.orientation<"u",iv=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);iv&&parseFloat(iv[1]);class WP{constructor(e,n){T(this,"name");T(this,"workerThread");T(this,"isRunning",!0);T(this,"result");T(this,"_resolve",()=>{});T(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Ci(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Ci(this.isRunning),this.isRunning=!1,this._reject(e)}}class Hd{terminate(){}}const Xd=new Map;function $P(t){Ci(t.source&&!t.url||!t.source&&t.url);let e=Xd.get(t.source||t.url);return e||(t.url&&(e=HP(t.url),Xd.set(t.url,e)),t.source&&(e=mS(t.source),Xd.set(t.source,e))),Ci(e),e}function HP(t){if(!t.startsWith("http"))return t;const e=XP(t);return mS(e)}function mS(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function XP(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function yS(t,e=!0,n){const r=n||new Set;if(t){if(sv(t))r.add(t);else if(sv(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)yS(t[i],e,r)}}return n===void 0?Array.from(r):[]}function sv(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const qd=()=>{};class Eg{constructor(e){T(this,"name");T(this,"source");T(this,"url");T(this,"terminated",!1);T(this,"worker");T(this,"onMessage");T(this,"onError");T(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Ci(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=qd,this.onError=s=>console.log(s),this.worker=gs?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&gs||typeof Hd<"u"&&!gs}destroy(){this.onMessage=qd,this.onError=qd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||yS(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=$P({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Hd(r,{eval:!1})}else if(this.source)e=new Hd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class qP{constructor(e){T(this,"name","unnamed");T(this,"source");T(this,"url");T(this,"maxConcurrency",1);T(this,"maxMobileConcurrency",1);T(this,"onDebug",()=>{});T(this,"reuseWorkers",!0);T(this,"props",{});T(this,"jobQueue",[]);T(this,"idleQueue",[]);T(this,"count",0);T(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Eg.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new WP(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!gs||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Eg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return jP?this.maxMobileConcurrency:this.maxConcurrency}}const KP={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ii=class ii{constructor(e){T(this,"props");T(this,"workerPools",new Map);this.props={...KP},this.setProps(e),this.workerPools=new Map}static isSupported(){return Eg.isSupported()}static getWorkerFarm(e={}){return ii._workerFarm=ii._workerFarm||new ii({}),ii._workerFarm.setProps(e),ii._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new qP({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};T(ii,"_workerFarm");let wh=ii;function YP(t,e={}){const n=e[t.id]||{},r=gs?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(gs?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=VP);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Ci(i),i}function QP(t,e=zP){Ci(t,"no worker provided");const n=t.version;return!(!e||!n)}function ZP(t,e){return!wh.isSupported()||!gs&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function JP(t,e,n,r,i){const s=t.id,o=YP(t,n),l=wh.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const u=await l.startJob("process-on-worker",GP.bind(null,i));return u.postMessage("process",{input:e,options:n,context:r}),await(await u.result).result}async function GP(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function e2(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function t2(...t){return n2(t)}function n2(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function r2(t){const e=[];for await(const n of t)e.push(n);return t2(...e)}function ov(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let av=class{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ov(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ov()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};class Df{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof av?i=e:i=new av(n,r),this.stats[n]=i),i}}let i2="";const lv={};function s2(t){for(const e in lv)if(t.startsWith(e)){const n=lv[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${i2}${t}`),t}function o2(t){return t&&typeof t=="object"&&t.isBuffer}function TS(t){if(o2(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function vS(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function a2(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const l2=t=>typeof t=="boolean",ml=t=>typeof t=="function",gc=t=>t!==null&&typeof t=="object",cv=t=>gc(t)&&t.constructor==={}.constructor,c2=t=>!!t&&typeof t[Symbol.iterator]=="function",u2=t=>t&&typeof t[Symbol.asyncIterator]=="function",xs=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Ns=t=>typeof Blob<"u"&&t instanceof Blob,h2=t=>t&&typeof t=="object"&&t.isBuffer,f2=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||gc(t)&&ml(t.tee)&&ml(t.cancel)&&ml(t.getReader),d2=t=>gc(t)&&ml(t.read)&&ml(t.pipe)&&l2(t.readable),ES=t=>f2(t)||d2(t);class p2 extends Error{constructor(n,r){super(n);T(this,"reason");T(this,"url");T(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const g2=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,_2=/^([-\w.]+\/[-\w.+]+)/;function uv(t,e){return t.toLowerCase()===e.toLowerCase()}function m2(t){const e=_2.exec(t);return e?e[1]:t}function hv(t){const e=g2.exec(t);return e?e[1]:""}const wS=/\?.*/;function y2(t){const e=t.match(wS);return e&&e[0]}function Sm(t){return t.replace(wS,"")}function T2(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Ff(t){return xs(t)?t.url:Ns(t)?t.name||"":typeof t=="string"?t:""}function Rm(t){if(xs(t)){const e=t,n=e.headers.get("content-type")||"",r=Sm(e.url);return m2(n)||hv(r)}return Ns(t)?t.type||"":typeof t=="string"?hv(t):""}function v2(t){return xs(t)?t.headers["content-length"]||-1:Ns(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function AS(t){if(xs(t))return t;const e={},n=v2(t);n>=0&&(e["content-length"]=String(n));const r=Ff(t),i=Rm(t);i&&(e["content-type"]=i);const s=await A2(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function E2(t){if(!t.ok)throw await w2(t)}async function w2(t){const e=T2(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new p2(n,r)}async function A2(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${S2(n)}`}return null}function S2(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function R2(t){return!b2(t)&&!I2(t)}function b2(t){return t.startsWith("http:")||t.startsWith("https:")}function I2(t){return t.startsWith("data:")}async function fv(t,e){var n,r;if(typeof t=="string"){const i=s2(t);return R2(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await AS(t)}const dv=new pc({id:"loaders.gl"});class C2{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class P2{constructor(){T(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const SS={fetch:null,mimeType:void 0,nothrow:!1,log:new P2,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:wm,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},x2={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function RS(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function bS(){const t=RS();return t.globalOptions=t.globalOptions||{...SS},t.globalOptions}function N2(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],k2(t,n),O2(e,t,r)}function k2(t,e){pv(t,null,SS,x2,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};pv(r,n.id,i,s,e)}}function pv(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&gc(t[a]),u=a==="baseUri"&&!e,h=a==="workerUrl"&&e;if(!(a in n)&&!u&&!h){if(a in r)dv.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const d=M2(a,i);dv.warn(`${s} loader option '${o}${a}' not recognized. ${d}`)()}}}}function M2(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function O2(t,e,n){const i={...t.options||{}};return D2(i,n),i.log===null&&(i.log=new C2),gv(i,bS()),gv(i,e),i}function gv(t,e){for(const n in e)if(n in e){const r=e[n];cv(r)&&cv(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function D2(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function bm(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function Im(t){vh(t,"null loader"),vh(bm(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const IS=()=>{const t=RS();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function F2(t){const e=IS();t=Array.isArray(t)?t:[t];for(const n of t){const r=Im(n);e.find(i=>r===i)||e.unshift(r)}}function U2(){return IS()}const B2=/\.([^.]+)$/;async function V2(t,e=[],n,r){if(!CS(t))return null;let i=_v(t,e,{...n,nothrow:!0},r);if(i)return i;if(Ns(t)&&(t=await t.slice(0,10).arrayBuffer(),i=_v(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(PS(t));return i}function _v(t,e=[],n,r){if(!CS(t))return null;if(e&&!Array.isArray(e))return Im(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...U2()),z2(i);const s=L2(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(PS(t));return s}function L2(t,e,n,r){const i=Ff(t),s=Rm(t),o=Sm(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=Kd(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||j2(e,o),l=l||(a?`matched url ${o}`:""),a=a||Kd(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||$2(e,t),l=l||(a?`matched initial data ${xS(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Kd(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&UP.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function CS(t){return!(t instanceof Response&&t.status===204)}function PS(t){const e=Ff(t),n=Rm(t);let r="No valid loader found (";r+=e?`${vS(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?xS(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function z2(t){for(const e of t)Im(e)}function j2(t,e){const n=e&&B2.exec(e),r=n&&n[1];return r?W2(t,r):null}function W2(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Kd(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>uv(e,i))||uv(e,`application/x.${r.id}`))return r;return null}function $2(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(H2(e,n))return n}else if(ArrayBuffer.isView(e)){if(mv(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&mv(e,0,n))return n;return null}function H2(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function mv(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>X2(t,e,n,i))}function X2(t,e,n,r){if(r instanceof ArrayBuffer)return e2(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=wg(t,e,r.length);return r===i;default:return!1}}function xS(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?wg(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?wg(t,0,e):""}function wg(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const q2=256*1024;function*K2(t,e){const n=(e==null?void 0:e.chunkSize)||q2;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const Y2=256*1024;function*Q2(t,e={}){const{chunkSize:n=Y2}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const Z2=1024*1024;async function*J2(t,e){const n=(e==null?void 0:e.chunkSize)||Z2;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function yv(t,e){return wm?G2(t,e):e3(t)}async function*G2(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield TS(o)}}catch{n.releaseLock()}}async function*e3(t,e){for await(const n of t)yield TS(n)}function t3(t,e){if(typeof t=="string")return K2(t,e);if(t instanceof ArrayBuffer)return Q2(t,e);if(Ns(t))return J2(t,e);if(ES(t))return yv(t,e);if(xs(t))return yv(t.body,e);throw new Error("makeIterator")}const NS="Cannot convert supplied data type";function n3(t,e,n){if(e.text&&typeof t=="string")return t;if(h2(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(NS)}async function r3(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return n3(t,e);if(Ns(t)&&(t=await AS(t)),xs(t)){const i=t;return await E2(i),e.binary?await i.arrayBuffer():await i.text()}if(ES(t)&&(t=t3(t,n)),c2(t)||u2(t))return r2(t);throw new Error(NS)}function kS(t,e){const n=bS(),r=t||n;return typeof r.fetch=="function"?r.fetch:gc(r.fetch)?i=>fv(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:fv}function i3(t,e,n){if(n)return n;const r={fetch:kS(e,t),...t};if(r.url){const i=Sm(r.url);r.baseUrl=i,r.queryString=y2(r.url),r.filename=vS(i),r.baseUrl=a2(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function s3(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Ah(t,e,n,r){e&&!Array.isArray(e)&&!bm(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Ff(t),o=s3(e,r),a=await V2(t,o,n);return a?(n=N2(n,a,o,i),r=i3({url:i,_parse:Ah,loaders:o},n,r||null),await o3(a,t,n,r)):null}async function o3(t,e,n,r){if(QP(t),n=BP(t.options,n),xs(e)){const s=e,{ok:o,redirected:a,status:l,statusText:u,type:h,url:d}=s,p=Object.fromEntries(s.headers.entries());r.response={headers:p,ok:o,redirected:a,status:l,statusText:u,type:h,url:d}}e=await r3(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(ZP(t,n))return await JP(t,e,n,r,Ah);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Ci(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Ag(t,e,n,r){let i,s;!Array.isArray(e)&&!bm(e)?(i=[],s=e):(i=e,s=n);const o=kS(s);let a=t;return typeof t=="string"&&(a=await o(t)),Ns(t)&&(a=await o(t)),Array.isArray(i)?await Ah(a,i,s):await Ah(a,i,s)}const a3="4.3.1";var GE;const l3=(GE=globalThis.loaders)==null?void 0:GE.parseImageNode,Sg=typeof Image<"u",Rg=typeof ImageBitmap<"u",c3=!!l3,bg=wm?!0:c3;function u3(t){switch(t){case"auto":return Rg||Sg||bg;case"imagebitmap":return Rg;case"image":return Sg;case"data":return bg;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function h3(){if(Rg)return"imagebitmap";if(Sg)return"image";if(bg)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function f3(t){const e=p3(t);if(!e)throw new Error("Not an image");return e}function d3(t){switch(f3(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function p3(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const g3=/^data:image\/svg\+xml/,_3=/\.svg((\?|#).*)?$/;function Cm(t){return t&&(g3.test(t)||_3.test(t))}function m3(t,e){if(Cm(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return MS(t,e)}function MS(t,e){if(Cm(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function OS(t,e,n){const r=m3(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await y3(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function y3(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const T3={};let Tv=!0;async function v3(t,e,n){let r;Cm(n)?r=await OS(t,e,n):r=MS(t,n);const i=e&&e.imagebitmap;return await E3(r,i)}async function E3(t,e=null){if((w3(e)||!Tv)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Tv=!1}return await createImageBitmap(t)}function w3(t){for(const e in t||T3)return!1;return!0}function A3(t){return!I3(t,"ftyp",4)||!(t[8]&96)?null:S3(t)}function S3(t){switch(R3(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function R3(t,e,n){return String.fromCharCode(...t.slice(e,n))}function b3(t){return[...t].map(e=>e.charCodeAt(0))}function I3(t,e,n=0){const r=b3(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Qn=!1,yl=!0;function DS(t){const e=_c(t);return P3(e)||k3(e)||x3(e)||N3(e)||C3(e)}function C3(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=A3(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function P3(t){const e=_c(t);return e.byteLength>=24&&e.getUint32(0,Qn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Qn),height:e.getUint32(20,Qn)}:null}function x3(t){const e=_c(t);return e.byteLength>=10&&e.getUint32(0,Qn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,yl),height:e.getUint16(8,yl)}:null}function N3(t){const e=_c(t);return e.byteLength>=14&&e.getUint16(0,Qn)===16973&&e.getUint32(2,yl)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,yl),height:e.getUint32(22,yl)}:null}function k3(t){const e=_c(t);if(!(e.byteLength>=3&&e.getUint16(0,Qn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=M3();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Qn);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Qn),width:e.getUint16(s+7,Qn)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Qn)}return null}function M3(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function _c(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function O3(t,e){var i;const{mimeType:n}=DS(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return vh(r),await r(t,n)}async function D3(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=F3(i);let a;switch(o){case"imagebitmap":a=await v3(t,e,s);break;case"image":a=await OS(t,e,s);break;case"data":a=await O3(t);break;default:vh(!1)}return i==="data"&&(a=d3(a)),a}function F3(t){switch(t){case"auto":case"data":return h3();default:return u3(t),t}}const U3=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],B3=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],V3={image:{type:"auto",decode:!0}},L3={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:a3,mimeTypes:B3,extensions:U3,parse:D3,tests:[t=>!!DS(new DataView(t))],options:V3},Ce=new pc({id:"deck"});let Ig={};function z3(t){Ig=t}function zt(t,e,n,r){Ce.level>0&&Ig[t]&&Ig[t].call(null,e,n,r)}function j3(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const W3={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:j3,parseTextSync:JSON.parse};function $3(){const t="9.0.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(Ce.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:Ce,_registerLoggers:z3},F2([W3,[L3,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const H3=$3();function cs(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Yd={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function X3(t){const e={};for(const[n,r]of Object.entries(t))e[n]=K3(r);return e}function q3(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&cs(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function K3(t){let e=vv(t);if(e!=="object")return{value:t,...Yd[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Yd[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=vv(t.value),{...t,...Yd[e],type:e}):{type:"object",value:null};throw new Error("props")}function vv(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const Y3=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,Q3=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,Z3={vertex:Y3,fragment:Q3},Ev=/void\s+main\s*\([^)]*\)\s*\{\n?/,wv=/}\n?[^{}]*$/,Qd=[],zu="__LUMA_INJECT_DECLARATIONS__";function J3(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=G3(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function G3(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Sh(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,u)=>l.order-u.order),Qd.length=o.length;for(let l=0,u=o.length;l<u;++l)Qd[l]=o[l].injection;const a=`${Qd.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(zu,a));break;case"vs:#main-start":i&&(t=t.replace(Ev,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(wv,l=>a+l));break;case"fs:#decl":i||(t=t.replace(zu,a));break;case"fs:#main-start":i||(t=t.replace(Ev,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(wv,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(zu,""),r&&(t=t.replace(/\}\s*$/,s=>s+Z3[e])),t}let ex=1;class us{constructor(e){T(this,"name");T(this,"vs");T(this,"fs");T(this,"getModuleUniforms");T(this,"dependencies");T(this,"deprecations");T(this,"defines");T(this,"injections");T(this,"uniforms",{});T(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformTypes:o={},uniformPropTypes:a={},getUniforms:l,deprecations:u=[],defines:h={},inject:d={}}=e;cs(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=l,this.dependencies=us.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(u),this.defines=h,this.injections=J3(d),this.uniformTypes=o,a&&(this.uniforms=X3(a))}static instantiateModules(e){return e.map(n=>{if(n instanceof us)return n;cs(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${ex++}`);const r=new us(n);return r.dependencies=us.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:cs(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):q3(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&cs(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function Av(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=Sv(t.platformInfo,t.vs);let n;return t.fs&&(n=Sv(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function Sv(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Uf(t){const e=us.instantiateModules(t);return tx(e)}function tx(t){const e={},n={};return FS({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function FS(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&FS({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function nx(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function rx(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=Rv(t,ix),t;case"fragment":return t=Rv(t,sx),t;default:throw new Error(e)}}const US=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ix=[...US,[Cg("attribute"),"in $1"],[Cg("varying"),"out $1"]],sx=[...US,[Cg("varying"),"in $1"]];function Rv(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Cg(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function BS(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function VS(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function ox(t,e){return{name:ax(t,e),language:"glsl",version:lx(t)}}function ax(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function lx(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const LS=`

${zu}
`,cx=`precision highp float;
`;function ux(t){const e=Uf(t.modules||[]);return{source:Pg(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Pm(e)}}function hx(t){const e=Uf(t.modules||[]);return{vs:Pg(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:Pg(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Pm(e)}}function fx(t){const{vs:e,fs:n}=t,r=Uf(t.modules||[]);return{vs:bv(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:bv(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Pm(r)}}function Pg(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;cs(typeof n=="string","shader source must be a string");const l=n;let u="";const h=VS(s),d={},p={},_={};for(const S in o){const k=typeof o[S]=="string"?{injection:o[S],order:0}:o[S],v=/^(v|f)s:(#)?([\w-]+)$/.exec(S);if(v){const m=v[2],b=v[3];m?b==="decl"?p[S]=[k]:_[S]=[k]:d[S]=[k]}else _[S]=[k]}const A=t.type!=="webgpu"?i:[];for(const S of A){a&&S.checkDeprecations(l,a);const k=S.getModuleSource(r,"wgsl");u+=k;const v=S.injections[r];for(const m in v){const b=/^(v|f)s:#([\w-]+)$/.exec(m);if(b){const V=b[2]==="decl"?p:_;V[m]=V[m]||[],V[m].push(v[m])}else d[m]=d[m]||[],d[m].push(v[m])}}return u+=LS,u=Sh(u,r,p),u+=BS(h[r],d),u+=l,u=Sh(u,r,_),u}function bv(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:u={},prologue:h=!0,log:d}=e;cs(typeof r=="string","shader source must be a string");const p=s==="glsl"?ox(r).version:-1,_=t.shaderLanguageVersion,A=p===100?"#version 100":"#version 300 es",k=r.split(`
`).slice(1).join(`
`),v={};o.forEach(P=>{Object.assign(v,P.getDefines())}),Object.assign(v,a);let m="";switch(s){case"wgsl":break;case"glsl":m=h?`${A}

// ----- PROLOGUE -------------------------
${dx({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${nx(t)}
${i==="fragment"?cx:""}

// ----- APPLICATION DEFINES -------------------------

${px(v)}

`:`${A}
`;break}const b=VS(l),D={},V={},j={};for(const P in u){const E=typeof u[P]=="string"?{injection:u[P],order:0}:u[P],C=/^(v|f)s:(#)?([\w-]+)$/.exec(P);if(C){const x=C[2],O=C[3];x?O==="decl"?V[P]=[E]:j[P]=[E]:D[P]=[E]}else j[P]=[E]}for(const P of o){d&&P.checkDeprecations(k,d);const E=P.getModuleSource(i);m+=E;const C=P.injections[i];for(const x in C){const O=/^(v|f)s:#([\w-]+)$/.exec(x);if(O){const N=O[2]==="decl"?V:j;N[x]=N[x]||[],N[x].push(C[x])}else D[x]=D[x]||[],D[x].push(C[x])}}return m+="// ----- MAIN SHADER SOURCE -------------------------",m+=LS,m=Sh(m,i,V),m+=BS(b[i],D),m+=k,m=Sh(m,i,j),s==="glsl"&&p!==_&&(m=rx(m,i)),m.trim()}function Pm(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function dx(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function px(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const is=class is{constructor(){T(this,"_hookFunctions",[]);T(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return is.defaultShaderAssembler=is.defaultShaderAssembler||new is,is.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=Av(e);return{...ux({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=Av(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?hx({platformInfo:s,...n,modules:r,hookFunctions:i}):fx({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,us.instantiateModules(n)}};T(is,"defaultShaderAssembler");let Rh=is;const gx=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,_x=`#version 300 es
${gx}`;function mx(t){const{input:e,inputChannels:n,output:r}={};if(!e)return _x;if(!n)throw new Error("inputChannels");const i=yx(n),s=Tx(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function yx(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function Tx(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const Y=new pc({id:"luma.gl"});class vx{constructor(){T(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Df({id:e})),this.stats.get(e)}}const xm=new vx;function Ex(){const t="9.0.27",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(Bi()&&Y.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:Y,stats:xm}),t}const wx=Ex();function Ax(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function Xl(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:Ax(t)}const Zd={};function ks(t="id"){Zd[t]=Zd[t]||1;const e=Zd[t]++;return`${t}-${e}`}function bh(t){let e=!0;for(const n in t){e=!1;break}return e}var Cp;let Se=(Cp=class{constructor(e,n,r){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"_device");T(this,"destroyed",!1);T(this,"allocatedBytes",0);T(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Sx(n,r);const i=this.props.id!=="undefined"?this.props.id:ks(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},T(Cp,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Cp);function Sx(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}var Ge;let Ye=(Ge=class extends Se{constructor(n,r){const i={...r};(r.usage||0)&Ge.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,Ge.defaultProps);T(this,"usage");T(this,"indexType");T(this,"updateTimestamp");T(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Ge.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}},T(Ge,"defaultProps",{...Se.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),T(Ge,"MAP_READ",1),T(Ge,"MAP_WRITE",2),T(Ge,"COPY_SRC",4),T(Ge,"COPY_DST",8),T(Ge,"INDEX",16),T(Ge,"VERTEX",32),T(Ge,"UNIFORM",64),T(Ge,"STORAGE",128),T(Ge,"INDIRECT",256),T(Ge,"QUERY_RESOLVE",512),T(Ge,"DEBUG_DATA_MAX_LENGTH",32),Ge);function zS(t){const e=Iv[t],n=Rx(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:Iv[t],byteLength:n,integer:i,signed:s,normalized:r}}function Rx(t){return bx[t]}const Iv={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},bx={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ix=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Cx=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function Px(t){return Ix.some(e=>t.startsWith(e))}function jS(t){const e=Cx.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=zS(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return Nx(t)}const xx={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function Nx(t){var n;const e=xx[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class kx{}class Mx{constructor(e=[],n){T(this,"features");T(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const Il=class Il{constructor(e){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"statsManager",xm);T(this,"_lumaData",{});T(this,"timestamp",0);this.props={...Il.defaultProps,...e},this.id=this.props.id||ks(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return Px(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Ye.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":Y.warn("indices buffer content must be of integer type")()),n}};T(Il,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!Y.get("debug"),spector:!!(Y.get("spector")||Y.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>Y.error(e.message)}),T(Il,"VERSION",wx);let qo=Il;function Pe(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const $a=new Map,Io=class Io{static registerDevices(e){for(const n of e)Pe(n.type&&n.isSupported&&n.create),$a.set(n.type,n)}static getAvailableDevices(){return Array.from($a).map(e=>e.type)}static getSupportedDevices(){return Array.from($a).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(qo.defaultProps,e)}static async attachDevice(e){const n=Cv(e.devices)||$a;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var s,o;e={...Io.defaultProps,...e},e.gl&&(e.type="webgl");const n=Cv(e.devices)||$a;let r,i;switch(e.type){case"webgpu":if(r=n.get("webgpu"),r)return await r.create(e);break;case"webgl":if(i=n.get("webgl"),i)return await i.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(r=n.get("webgpu"),(s=r==null?void 0:r.isSupported)!=null&&s.call(r))return await r.create(e);if(i=n.get("webgl"),(o=i==null?void 0:i.isSupported)!=null&&o.call(i))return await i.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const n=HTMLCanvasElement.prototype;if(!e&&n.originalGetContext){n.getContext=n.originalGetContext,n.originalGetContext=void 0;return}n.originalGetContext=n.getContext,n.getContext=function(r,i){return r==="webgl"||r==="experimental-webgl"?this.originalGetContext("webgl2",i):this.originalGetContext(r,i)}}};T(Io,"defaultProps",{...qo.defaultProps,type:"best-available",devices:void 0}),T(Io,"stats",xm),T(Io,"log",Y);let Oo=Io;function Cv(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const Ox=Bi()&&typeof document<"u",Bf=()=>Ox&&document.readyState==="complete",Dx={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Nm{constructor(e){T(this,"id");T(this,"props");T(this,"canvas");T(this,"htmlCanvas");T(this,"offscreenCanvas");T(this,"type");T(this,"width",1);T(this,"height",1);T(this,"resizeObserver");T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Dx,...e},e=this.props,!Bi()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=Bx(e.canvas):this.canvas=e.canvas;else{const n=Vx(e),r=Ux((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Bf()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Lx(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(Y.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[u,h]=this.getDrawingBufferSize();(u!==a||h!==l)&&(o=Math.min(u/r,h/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),Y.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}T(Nm,"pageLoaded",Fx());function Fx(){return Bf()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function Ux(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Bf())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function Bx(t){const e=document.getElementById(t);if(!e&&!Bf())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function Vx(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function Lx(t,e,n,r,i){const s=t,o=Pv(s[0],e,n);let a=xv(s[1],e,r,i),l=Pv(s[0]+1,e,n);const u=l===n-1?l:l-1;l=xv(s[1]+1,e,r,i);let h;return i?(l=l===0?l:l+1,h=a,a=l):h=l===r-1?l:l-1,{x:o,y:a,width:Math.max(u-o+1,1),height:Math.max(h-a+1,1)}}function Pv(t,e,n){return Math.min(Math.round(t*e),n-1)}function xv(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Sr=class Sr extends Se{constructor(n,r,i=Sr.defaultProps){super(n,r,i);T(this,"dimension");T(this,"format");T(this,"width");T(this,"height");T(this,"depth");T(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};T(Sr,"defaultProps",{...Se.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),T(Sr,"COPY_SRC",1),T(Sr,"COPY_DST",2),T(Sr,"TEXTURE_BINDING",4),T(Sr,"STORAGE_BINDING",8),T(Sr,"RENDER_ATTACHMENT",16);let Tn=Sr;const rf=class rf extends Se{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,rf.defaultProps)}};T(rf,"defaultProps",{...Se.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Ih=rf;function zx(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=WS(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=Nv(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=Nv(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function Nv(t,e,n,r){if(r!=null&&r.inlineSource){const i=jx(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function jx(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=WS(s,e,n))}return r}function WS(t,e,n){const r=n!=null&&n.html?$x(t):t;return`${Wx(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function Wx(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function $x(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function $S(t,e){return{name:Hx(t,e),language:"glsl",version:Xx(t)}}function Hx(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function Xx(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const sf=class sf extends Se{constructor(n,r){super(n,{id:qx(r),...r},sf.defaultProps);T(this,"stage");T(this,"source");T(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var u;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=$S(this.source).name,i=`${this.stage} ${r}`;let s=zx(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(u=l[0])!=null&&u.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};T(sf,"defaultProps",{...Se.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Ch=sf;function qx(t){return $S(t.source).name||t.id||ks(`unnamed ${t.stage}-shader`)}const of=class of extends Se{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,of.defaultProps)}};T(of,"defaultProps",{...Se.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Ph=of;const af=class af extends Se{constructor(n,r={}){super(n,r,af.defaultProps);T(this,"width");T(this,"height");T(this,"colorAttachments",[]);T(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(Y.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof Tn?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof Tn?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:Tn.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:Tn.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};T(af,"defaultProps",{...Se.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let xh=af;const lf=class lf extends Se{constructor(n,r){super(n,r,lf.defaultProps);T(this,"shaderLayout");T(this,"bufferLayout");T(this,"linkStatus","pending");T(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};T(lf,"defaultProps",{...Se.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Ko=lf;const cf=class cf extends Se{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,cf.defaultProps)}};T(cf,"defaultProps",{...Se.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let xg=cf;const uf=class uf extends Se{constructor(n,r){super(n,r,uf.defaultProps);T(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};T(uf,"defaultProps",{...Se.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Nh=uf;const hf=class hf extends Se{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,hf.defaultProps)}};T(hf,"defaultProps",{...Se.defaultProps,measureExecutionTime:void 0});let Ng=hf;const ff=class ff extends Se{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,ff.defaultProps)}};T(ff,"defaultProps",{...Se.defaultProps});let kg=ff;function Kx(t){const[e,n]=Qx[t],r=e==="i32"||e==="u32",i=e!=="u32",s=Zx[e]*n,o=Yx(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function Yx(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const Qx={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Zx={f32:4,f16:2,i32:4,u32:4};function HS(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=zS(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function XS(t,e){const n={};for(const r of t.attributes)n[r.name]=Gx(t,e,r.name);return n}function Jx(t,e,n=16){const r=XS(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function Gx(t,e,n){const r=eN(t,n),i=tN(e,n);if(!r)return null;const s=Kx(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=HS(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function eN(t,e){const n=t.attributes.find(r=>r.name===e);return n||Y.warn(`shader layout attribute "${e}" not present in shader`),n||null}function tN(t,e){nN(t);let n=rN(t,e);return n||(n=iN(t,e),n)?n:(Y.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function nN(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Y.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function rN(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function iN(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=HS(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function sN(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):Y.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const df=class df extends Se{constructor(n,r){super(n,r,df.defaultProps);T(this,"maxVertexAttributes");T(this,"attributeInfos");T(this,"indexBuffer",null);T(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=Jx(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};T(df,"defaultProps",{...Se.defaultProps,renderPipeline:null});let Mg=df;const pf=class pf extends Se{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,pf.defaultProps)}};T(pf,"defaultProps",{...Se.defaultProps,layout:void 0,buffers:{}});let Og=pf;const gf=class gf extends Se{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,gf.defaultProps)}};T(gf,"defaultProps",{...Se.defaultProps,type:void 0,count:void 0});let Dg=gf;const oN={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function aN(t){const e=oN[t];return Pe(t),e}function lN(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let uu;function qS(t){return(!uu||uu.byteLength<t)&&(uu=new ArrayBuffer(t)),uu}function cN(t,e){const n=qS(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function uN(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const kv=1024;class hN{constructor(e){T(this,"layout",{});T(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=aN(s),{type:a,components:l}=o;n=lN(n,l);const u=n;n+=l,this.layout[i]={type:a,size:l,offset:u}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,kv)}getData(e){const n=Math.max(this.byteLength,kv),r=qS(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){Y.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:u,offset:h}=a,d=i[l];if(u===1){if(typeof o!="number"&&typeof o!="boolean"){Y.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}d[h]=Number(o)}else{const p=Xl(o);if(!p){Y.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}d.set(p,h)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function fN(t,e,n=16){if(t!==e)return!1;const r=Xl(t);if(!r)return!1;const i=Xl(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function dN(t){const e=Xl(t);return e?e.slice():t}class pN{constructor(e){T(this,"name");T(this,"uniforms",{});T(this,"modifiedUniforms",{});T(this,"modified",!0);T(this,"bindingLayout",{});T(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){fN(this.uniforms[e],n)||(this.uniforms[e]=dN(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class gN{constructor(e){T(this,"uniformBlocks",new Map);T(this,"uniformBufferLayouts",new Map);T(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new hN(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new pN({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Ye.UNIFORM|Ye.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Ye.UNIFORM|Ye.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&Y.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();Y.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function KS(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function YS(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function _N(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=KS(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function mN(t){return Xl(t)!==null||typeof t=="number"||typeof t=="boolean"}function km(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];mN(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function yN(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const u=r[a]?`${t}.${r[a]}`:"N/A";Y.removed(`${t}.${a}`,u)()}for(const a in i)if(a in e){const l=i[a];Y.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(Y.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let TN="";async function vN(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:TN+t}catch(i){r(i)}})}async function QS(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function Fg(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Fg(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Fg(t[s],e[s],n-1))return!1;return!0}return!1}function EN(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function wN(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class AN{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Lr{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(kh.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Mh.instance)}}}class kh extends Lr{}kh.instance=new kh;class Mh extends Lr{}Mh.instance=new Mh;class Fe extends Lr{constructor(){super()}}let Ug=class extends Fe{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}};class SN extends Fe{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class RN extends Fe{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class bN extends Fe{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class IN extends Fe{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class rs extends Fe{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class ZS extends Fe{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class Bg extends Fe{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class Mv extends Fe{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Yo;(function(t){t.increment="++",t.decrement="--"})(Yo||(Yo={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Yo||(Yo={}));class CN extends Fe{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var ql;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ql||(ql={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(ql||(ql={}));class PN extends Fe{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class JS extends Fe{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class xN extends Fe{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class NN extends Fe{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class kN extends Fe{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class MN extends Fe{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class ON extends Fe{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class DN extends Fe{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class FN extends Fe{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class GS extends Fe{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class UN extends Fe{constructor(){super()}get astNodeType(){return"discard"}}class BN extends Fe{constructor(){super()}get astNodeType(){return"break"}}class VN extends Fe{constructor(){super()}get astNodeType(){return"continue"}}class Ms extends Fe{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ts extends Ms{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class e1 extends Ms{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class LN extends Ms{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class t1 extends Ms{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class tl extends Ms{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class lr extends Lr{constructor(){super()}}class zN extends lr{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Eo extends lr{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}evaluate(e){return this.args[0].evaluate(e)}}class n1 extends lr{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Vg extends lr{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class Ov extends lr{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof Eo){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class Dv extends lr{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class jN extends lr{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Fv extends lr{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class WN extends lr{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class r1 extends lr{constructor(){super()}}class $N extends r1{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Wn extends r1{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class i1 extends Lr{constructor(){super()}}class HN extends i1{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class XN extends i1{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class qN extends Lr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class KN extends Lr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class YN extends Lr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let QN=class extends Lr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var z,U;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(U||(U={}));class B{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class I{}z=I;I.none=new B("",U.reserved,"");I.eof=new B("EOF",U.token,"");I.reserved={asm:new B("asm",U.reserved,"asm"),bf16:new B("bf16",U.reserved,"bf16"),do:new B("do",U.reserved,"do"),enum:new B("enum",U.reserved,"enum"),f16:new B("f16",U.reserved,"f16"),f64:new B("f64",U.reserved,"f64"),handle:new B("handle",U.reserved,"handle"),i8:new B("i8",U.reserved,"i8"),i16:new B("i16",U.reserved,"i16"),i64:new B("i64",U.reserved,"i64"),mat:new B("mat",U.reserved,"mat"),premerge:new B("premerge",U.reserved,"premerge"),regardless:new B("regardless",U.reserved,"regardless"),typedef:new B("typedef",U.reserved,"typedef"),u8:new B("u8",U.reserved,"u8"),u16:new B("u16",U.reserved,"u16"),u64:new B("u64",U.reserved,"u64"),unless:new B("unless",U.reserved,"unless"),using:new B("using",U.reserved,"using"),vec:new B("vec",U.reserved,"vec"),void:new B("void",U.reserved,"void")};I.keywords={array:new B("array",U.keyword,"array"),atomic:new B("atomic",U.keyword,"atomic"),bool:new B("bool",U.keyword,"bool"),f32:new B("f32",U.keyword,"f32"),i32:new B("i32",U.keyword,"i32"),mat2x2:new B("mat2x2",U.keyword,"mat2x2"),mat2x3:new B("mat2x3",U.keyword,"mat2x3"),mat2x4:new B("mat2x4",U.keyword,"mat2x4"),mat3x2:new B("mat3x2",U.keyword,"mat3x2"),mat3x3:new B("mat3x3",U.keyword,"mat3x3"),mat3x4:new B("mat3x4",U.keyword,"mat3x4"),mat4x2:new B("mat4x2",U.keyword,"mat4x2"),mat4x3:new B("mat4x3",U.keyword,"mat4x3"),mat4x4:new B("mat4x4",U.keyword,"mat4x4"),ptr:new B("ptr",U.keyword,"ptr"),sampler:new B("sampler",U.keyword,"sampler"),sampler_comparison:new B("sampler_comparison",U.keyword,"sampler_comparison"),struct:new B("struct",U.keyword,"struct"),texture_1d:new B("texture_1d",U.keyword,"texture_1d"),texture_2d:new B("texture_2d",U.keyword,"texture_2d"),texture_2d_array:new B("texture_2d_array",U.keyword,"texture_2d_array"),texture_3d:new B("texture_3d",U.keyword,"texture_3d"),texture_cube:new B("texture_cube",U.keyword,"texture_cube"),texture_cube_array:new B("texture_cube_array",U.keyword,"texture_cube_array"),texture_multisampled_2d:new B("texture_multisampled_2d",U.keyword,"texture_multisampled_2d"),texture_storage_1d:new B("texture_storage_1d",U.keyword,"texture_storage_1d"),texture_storage_2d:new B("texture_storage_2d",U.keyword,"texture_storage_2d"),texture_storage_2d_array:new B("texture_storage_2d_array",U.keyword,"texture_storage_2d_array"),texture_storage_3d:new B("texture_storage_3d",U.keyword,"texture_storage_3d"),texture_depth_2d:new B("texture_depth_2d",U.keyword,"texture_depth_2d"),texture_depth_2d_array:new B("texture_depth_2d_array",U.keyword,"texture_depth_2d_array"),texture_depth_cube:new B("texture_depth_cube",U.keyword,"texture_depth_cube"),texture_depth_cube_array:new B("texture_depth_cube_array",U.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new B("texture_depth_multisampled_2d",U.keyword,"texture_depth_multisampled_2d"),texture_external:new B("texture_external",U.keyword,"texture_external"),u32:new B("u32",U.keyword,"u32"),vec2:new B("vec2",U.keyword,"vec2"),vec3:new B("vec3",U.keyword,"vec3"),vec4:new B("vec4",U.keyword,"vec4"),bitcast:new B("bitcast",U.keyword,"bitcast"),block:new B("block",U.keyword,"block"),break:new B("break",U.keyword,"break"),case:new B("case",U.keyword,"case"),continue:new B("continue",U.keyword,"continue"),continuing:new B("continuing",U.keyword,"continuing"),default:new B("default",U.keyword,"default"),diagnostic:new B("diagnostic",U.keyword,"diagnostic"),discard:new B("discard",U.keyword,"discard"),else:new B("else",U.keyword,"else"),enable:new B("enable",U.keyword,"enable"),fallthrough:new B("fallthrough",U.keyword,"fallthrough"),false:new B("false",U.keyword,"false"),fn:new B("fn",U.keyword,"fn"),for:new B("for",U.keyword,"for"),function:new B("function",U.keyword,"function"),if:new B("if",U.keyword,"if"),let:new B("let",U.keyword,"let"),const:new B("const",U.keyword,"const"),loop:new B("loop",U.keyword,"loop"),while:new B("while",U.keyword,"while"),private:new B("private",U.keyword,"private"),read:new B("read",U.keyword,"read"),read_write:new B("read_write",U.keyword,"read_write"),return:new B("return",U.keyword,"return"),requires:new B("requires",U.keyword,"requires"),storage:new B("storage",U.keyword,"storage"),switch:new B("switch",U.keyword,"switch"),true:new B("true",U.keyword,"true"),alias:new B("alias",U.keyword,"alias"),type:new B("type",U.keyword,"type"),uniform:new B("uniform",U.keyword,"uniform"),var:new B("var",U.keyword,"var"),override:new B("override",U.keyword,"override"),workgroup:new B("workgroup",U.keyword,"workgroup"),write:new B("write",U.keyword,"write"),r8unorm:new B("r8unorm",U.keyword,"r8unorm"),r8snorm:new B("r8snorm",U.keyword,"r8snorm"),r8uint:new B("r8uint",U.keyword,"r8uint"),r8sint:new B("r8sint",U.keyword,"r8sint"),r16uint:new B("r16uint",U.keyword,"r16uint"),r16sint:new B("r16sint",U.keyword,"r16sint"),r16float:new B("r16float",U.keyword,"r16float"),rg8unorm:new B("rg8unorm",U.keyword,"rg8unorm"),rg8snorm:new B("rg8snorm",U.keyword,"rg8snorm"),rg8uint:new B("rg8uint",U.keyword,"rg8uint"),rg8sint:new B("rg8sint",U.keyword,"rg8sint"),r32uint:new B("r32uint",U.keyword,"r32uint"),r32sint:new B("r32sint",U.keyword,"r32sint"),r32float:new B("r32float",U.keyword,"r32float"),rg16uint:new B("rg16uint",U.keyword,"rg16uint"),rg16sint:new B("rg16sint",U.keyword,"rg16sint"),rg16float:new B("rg16float",U.keyword,"rg16float"),rgba8unorm:new B("rgba8unorm",U.keyword,"rgba8unorm"),rgba8unorm_srgb:new B("rgba8unorm_srgb",U.keyword,"rgba8unorm_srgb"),rgba8snorm:new B("rgba8snorm",U.keyword,"rgba8snorm"),rgba8uint:new B("rgba8uint",U.keyword,"rgba8uint"),rgba8sint:new B("rgba8sint",U.keyword,"rgba8sint"),bgra8unorm:new B("bgra8unorm",U.keyword,"bgra8unorm"),bgra8unorm_srgb:new B("bgra8unorm_srgb",U.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new B("rgb10a2unorm",U.keyword,"rgb10a2unorm"),rg11b10float:new B("rg11b10float",U.keyword,"rg11b10float"),rg32uint:new B("rg32uint",U.keyword,"rg32uint"),rg32sint:new B("rg32sint",U.keyword,"rg32sint"),rg32float:new B("rg32float",U.keyword,"rg32float"),rgba16uint:new B("rgba16uint",U.keyword,"rgba16uint"),rgba16sint:new B("rgba16sint",U.keyword,"rgba16sint"),rgba16float:new B("rgba16float",U.keyword,"rgba16float"),rgba32uint:new B("rgba32uint",U.keyword,"rgba32uint"),rgba32sint:new B("rgba32sint",U.keyword,"rgba32sint"),rgba32float:new B("rgba32float",U.keyword,"rgba32float"),static_assert:new B("static_assert",U.keyword,"static_assert")};I.tokens={decimal_float_literal:new B("decimal_float_literal",U.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new B("hex_float_literal",U.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new B("int_literal",U.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new B("uint_literal",U.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new B("ident",U.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new B("and",U.token,"&"),and_and:new B("and_and",U.token,"&&"),arrow:new B("arrow ",U.token,"->"),attr:new B("attr",U.token,"@"),forward_slash:new B("forward_slash",U.token,"/"),bang:new B("bang",U.token,"!"),bracket_left:new B("bracket_left",U.token,"["),bracket_right:new B("bracket_right",U.token,"]"),brace_left:new B("brace_left",U.token,"{"),brace_right:new B("brace_right",U.token,"}"),colon:new B("colon",U.token,":"),comma:new B("comma",U.token,","),equal:new B("equal",U.token,"="),equal_equal:new B("equal_equal",U.token,"=="),not_equal:new B("not_equal",U.token,"!="),greater_than:new B("greater_than",U.token,">"),greater_than_equal:new B("greater_than_equal",U.token,">="),shift_right:new B("shift_right",U.token,">>"),less_than:new B("less_than",U.token,"<"),less_than_equal:new B("less_than_equal",U.token,"<="),shift_left:new B("shift_left",U.token,"<<"),modulo:new B("modulo",U.token,"%"),minus:new B("minus",U.token,"-"),minus_minus:new B("minus_minus",U.token,"--"),period:new B("period",U.token,"."),plus:new B("plus",U.token,"+"),plus_plus:new B("plus_plus",U.token,"++"),or:new B("or",U.token,"|"),or_or:new B("or_or",U.token,"||"),paren_left:new B("paren_left",U.token,"("),paren_right:new B("paren_right",U.token,")"),semicolon:new B("semicolon",U.token,";"),star:new B("star",U.token,"*"),tilde:new B("tilde",U.token,"~"),underscore:new B("underscore",U.token,"_"),xor:new B("xor",U.token,"^"),plus_equal:new B("plus_equal",U.token,"+="),minus_equal:new B("minus_equal",U.token,"-="),times_equal:new B("times_equal",U.token,"*="),division_equal:new B("division_equal",U.token,"/="),modulo_equal:new B("modulo_equal",U.token,"%="),and_equal:new B("and_equal",U.token,"&="),or_equal:new B("or_equal",U.token,"|="),xor_equal:new B("xor_equal",U.token,"^="),shift_right_equal:new B("shift_right_equal",U.token,">>="),shift_left_equal:new B("shift_left_equal",U.token,"<<=")};I.simpleTokens={"@":z.tokens.attr,"{":z.tokens.brace_left,"}":z.tokens.brace_right,":":z.tokens.colon,",":z.tokens.comma,"(":z.tokens.paren_left,")":z.tokens.paren_right,";":z.tokens.semicolon};I.literalTokens={"&":z.tokens.and,"&&":z.tokens.and_and,"->":z.tokens.arrow,"/":z.tokens.forward_slash,"!":z.tokens.bang,"[":z.tokens.bracket_left,"]":z.tokens.bracket_right,"=":z.tokens.equal,"==":z.tokens.equal_equal,"!=":z.tokens.not_equal,">":z.tokens.greater_than,">=":z.tokens.greater_than_equal,">>":z.tokens.shift_right,"<":z.tokens.less_than,"<=":z.tokens.less_than_equal,"<<":z.tokens.shift_left,"%":z.tokens.modulo,"-":z.tokens.minus,"--":z.tokens.minus_minus,".":z.tokens.period,"+":z.tokens.plus,"++":z.tokens.plus_plus,"|":z.tokens.or,"||":z.tokens.or_or,"*":z.tokens.star,"~":z.tokens.tilde,_:z.tokens.underscore,"^":z.tokens.xor,"+=":z.tokens.plus_equal,"-=":z.tokens.minus_equal,"*=":z.tokens.times_equal,"/=":z.tokens.division_equal,"%=":z.tokens.modulo_equal,"&=":z.tokens.and_equal,"|=":z.tokens.or_equal,"^=":z.tokens.xor_equal,">>=":z.tokens.shift_right_equal,"<<=":z.tokens.shift_left_equal};I.regexTokens={decimal_float_literal:z.tokens.decimal_float_literal,hex_float_literal:z.tokens.hex_float_literal,int_literal:z.tokens.int_literal,uint_literal:z.tokens.uint_literal,ident:z.tokens.ident};I.storage_class=[z.keywords.function,z.keywords.private,z.keywords.workgroup,z.keywords.uniform,z.keywords.storage];I.access_mode=[z.keywords.read,z.keywords.write,z.keywords.read_write];I.sampler_type=[z.keywords.sampler,z.keywords.sampler_comparison];I.sampled_texture_type=[z.keywords.texture_1d,z.keywords.texture_2d,z.keywords.texture_2d_array,z.keywords.texture_3d,z.keywords.texture_cube,z.keywords.texture_cube_array];I.multisampled_texture_type=[z.keywords.texture_multisampled_2d];I.storage_texture_type=[z.keywords.texture_storage_1d,z.keywords.texture_storage_2d,z.keywords.texture_storage_2d_array,z.keywords.texture_storage_3d];I.depth_texture_type=[z.keywords.texture_depth_2d,z.keywords.texture_depth_2d_array,z.keywords.texture_depth_cube,z.keywords.texture_depth_cube_array,z.keywords.texture_depth_multisampled_2d];I.texture_external_type=[z.keywords.texture_external];I.any_texture_type=[...z.sampled_texture_type,...z.multisampled_texture_type,...z.storage_texture_type,...z.depth_texture_type,...z.texture_external_type];I.texel_format=[z.keywords.r8unorm,z.keywords.r8snorm,z.keywords.r8uint,z.keywords.r8sint,z.keywords.r16uint,z.keywords.r16sint,z.keywords.r16float,z.keywords.rg8unorm,z.keywords.rg8snorm,z.keywords.rg8uint,z.keywords.rg8sint,z.keywords.r32uint,z.keywords.r32sint,z.keywords.r32float,z.keywords.rg16uint,z.keywords.rg16sint,z.keywords.rg16float,z.keywords.rgba8unorm,z.keywords.rgba8unorm_srgb,z.keywords.rgba8snorm,z.keywords.rgba8uint,z.keywords.rgba8sint,z.keywords.bgra8unorm,z.keywords.bgra8unorm_srgb,z.keywords.rgb10a2unorm,z.keywords.rg11b10float,z.keywords.rg32uint,z.keywords.rg32sint,z.keywords.rg32float,z.keywords.rgba16uint,z.keywords.rgba16sint,z.keywords.rgba16float,z.keywords.rgba32uint,z.keywords.rgba32sint,z.keywords.rgba32float];I.const_literal=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal,z.keywords.true,z.keywords.false];I.literal_or_ident=[z.tokens.ident,z.tokens.int_literal,z.tokens.uint_literal,z.tokens.decimal_float_literal,z.tokens.hex_float_literal];I.element_count_expression=[z.tokens.int_literal,z.tokens.uint_literal,z.tokens.ident];I.template_types=[z.keywords.vec2,z.keywords.vec3,z.keywords.vec4,z.keywords.mat2x2,z.keywords.mat2x3,z.keywords.mat2x4,z.keywords.mat3x2,z.keywords.mat3x3,z.keywords.mat3x4,z.keywords.mat4x2,z.keywords.mat4x3,z.keywords.mat4x4,z.keywords.atomic,z.keywords.bitcast,...z.any_texture_type];I.attribute_name=[z.tokens.ident,z.keywords.block,z.keywords.diagnostic];I.assignment_operators=[z.tokens.equal,z.tokens.plus_equal,z.tokens.minus_equal,z.tokens.times_equal,z.tokens.division_equal,z.tokens.modulo_equal,z.tokens.and_equal,z.tokens.or_equal,z.tokens.xor_equal,z.tokens.shift_right_equal,z.tokens.shift_left_equal];I.increment_operators=[z.tokens.plus_plus,z.tokens.minus_minus];class Uv{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return I.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==I.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class ZN{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Uv(I.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=I.simpleTokens[e];if(n)return this._addToken(n),!0;let r=I.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=I.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(I.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(I.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(I.tokens.minus_minus),!0;const l=this._tokens.length-1;if((I.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==I.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let l=!1,u=this._tokens.length-1;for(let h=0;h<5&&u>=0&&I.assignment_operators.indexOf(this._tokens[u].type)===-1;++h,--u)if(this._tokens[u].type===I.tokens.less_than){u>0&&this._tokens[u-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===I.none){let l=e,u=0;const h=2;for(let d=0;d<h;++d)if(l+=this._peekAhead(d),o=this._findType(l),o!==I.none){u=d;break}if(o===I.none)return r===I.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=u+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===I.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in I.regexTokens){const i=I.regexTokens[r];if(this._match(e,i.rule))return i}const n=I.literalTokens[e];return n||I.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Uv(e,n,this._line))}}class JN{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new AN,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Vg){const a=s.name,l=this._context.constants.get(a);if(l)try{const u=l.evaluate(this._context);i.count=u}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new ZN(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==I.eof}_match(e){if(e instanceof B)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._match(I.keywords.alias)){const n=this._type_alias();return this._consume(I.tokens.semicolon,"Expected ';'"),n}if(this._match(I.keywords.diagnostic)){const n=this._diagnostic();return this._consume(I.tokens.semicolon,"Expected ';'"),n}if(this._match(I.keywords.requires)){const n=this._requires_directive();return this._consume(I.tokens.semicolon,"Expected ';'"),n}if(this._match(I.keywords.enable)){const n=this._enable_directive();return this._consume(I.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(I.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(I.tokens.semicolon,"Expected ';'."),n}if(this._check(I.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(I.tokens.semicolon,"Expected ';'."),n}if(this._check(I.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(I.tokens.semicolon,"Expected ';'."),n}if(this._check(I.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(I.tokens.semicolon,"Expected ';'."),n}if(this._check(I.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(I.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(I.keywords.fn))return null;const e=this._currentLine,n=this._consume(I.tokens.ident,"Expected function name.").toString();this._consume(I.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(I.tokens.paren_right))do{if(this._check(I.tokens.paren_right))break;const a=this._attribute(),l=this._consume(I.tokens.ident,"Expected argument name.").toString();this._consume(I.tokens.colon,"Expected ':' for argument type.");const u=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=u,r.push(new qN(l,h,a)))}while(this._match(I.tokens.comma));this._consume(I.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(I.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new Ug(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(I.tokens.brace_left,"Expected '{' for block.");!this._check(I.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(I.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(I.tokens.semicolon)&&!this._isAtEnd(););if(this._check(I.tokens.attr)&&this._attribute(),this._check(I.keywords.if))return this._if_statement();if(this._check(I.keywords.switch))return this._switch_statement();if(this._check(I.keywords.loop))return this._loop_statement();if(this._check(I.keywords.for))return this._for_statement();if(this._check(I.keywords.while))return this._while_statement();if(this._check(I.keywords.continuing))return this._continuing_statement();if(this._check(I.keywords.static_assert))return this._static_assert_statement();if(this._check(I.tokens.brace_left))return this._compound_statement();let e=null;return this._check(I.keywords.return)?e=this._return_statement():this._check([I.keywords.var,I.keywords.let,I.keywords.const])?e=this._variable_statement():this._match(I.keywords.discard)?e=new UN:this._match(I.keywords.break)?e=new BN:this._match(I.keywords.continue)?e=new VN:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(I.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(I.keywords.static_assert))return null;const e=this._optional_paren_expression();return new SN(e)}_while_statement(){if(!this._match(I.keywords.while))return null;const e=this._optional_paren_expression();this._check(I.tokens.attr)&&this._attribute();const n=this._compound_statement();return new RN(e,n)}_continuing_statement(){if(!this._match(I.keywords.continuing))return null;const e=this._compound_statement();return new bN(e)}_for_statement(){if(!this._match(I.keywords.for))return null;this._consume(I.tokens.paren_left,"Expected '('.");const e=this._check(I.tokens.semicolon)?null:this._for_init();this._consume(I.tokens.semicolon,"Expected ';'.");const n=this._check(I.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(I.tokens.semicolon,"Expected ';'.");const r=this._check(I.tokens.paren_right)?null:this._for_increment();this._consume(I.tokens.paren_right,"Expected ')'."),this._check(I.tokens.attr)&&this._attribute();const i=this._compound_statement();return new IN(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(I.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(I.tokens.equal)&&(n=this._short_circuit_or_expression()),new rs(e.name,e.type,e.storage,e.access,n)}if(this._match(I.keywords.let)){const e=this._consume(I.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(I.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(I.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new Bg(e,n,null,null,r)}if(this._match(I.keywords.const)){const e=this._consume(I.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(I.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(I.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Mv(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(I.increment_operators))return this._current=e,null;const r=this._consume(I.increment_operators,"Expected increment operator");return new CN(r.type===I.tokens.plus_plus?Yo.increment:Yo.decrement,n)}_assignment_statement(){let e=null;if(this._check(I.tokens.brace_right))return null;let n=this._match(I.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(I.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new PN(ql.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(I.tokens.ident))return null;const e=this._current,n=this._consume(I.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new JS(n.lexeme,r)}_loop_statement(){if(!this._match(I.keywords.loop))return null;this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(I.keywords.continuing)&&(r=this._compound_statement()),this._consume(I.tokens.brace_right,"Expected '}' for loop."),new xN(e,r)}_switch_statement(){if(!this._match(I.keywords.switch))return null;const e=this._optional_paren_expression();this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(I.tokens.brace_right,"Expected '}' for switch."),new NN(e,n)}_switch_body(){const e=[];if(this._match(I.keywords.case)){const n=this._case_selectors();this._match(I.tokens.colon),this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch case."),e.push(new HN(n,r))}if(this._match(I.keywords.default)){this._match(I.tokens.colon),this._check(I.tokens.attr)&&this._attribute(),this._consume(I.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(I.tokens.brace_right,"Exected '}' for switch default."),e.push(new XN(n))}if(this._check([I.keywords.default,I.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(I.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(I.keywords.fallthrough))return this._consume(I.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(I.keywords.if))return null;const e=this._optional_paren_expression();this._check(I.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(I.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(I.keywords.else)&&(this._check(I.tokens.attr)&&this._attribute(),i=this._compound_statement()),new kN(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===I.keywords.else&&this._tokens[this._current+1].type===I.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new KN(n,r)),this._match_elseif()&&(this._check(I.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(I.keywords.return))return null;const e=this._short_circuit_or_expression();return new MN(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(I.tokens.or_or);)e=new Wn(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(I.tokens.and_and);)e=new Wn(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(I.tokens.or);)e=new Wn(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(I.tokens.xor);)e=new Wn(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(I.tokens.and);)e=new Wn(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([I.tokens.equal_equal,I.tokens.not_equal])?new Wn(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([I.tokens.less_than,I.tokens.greater_than,I.tokens.less_than_equal,I.tokens.greater_than_equal]);)e=new Wn(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([I.tokens.shift_left,I.tokens.shift_right]);)e=new Wn(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([I.tokens.plus,I.tokens.minus]);)e=new Wn(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([I.tokens.star,I.tokens.forward_slash,I.tokens.modulo]);)e=new Wn(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([I.tokens.minus,I.tokens.bang,I.tokens.tilde,I.tokens.star,I.tokens.and])?new $N(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(I.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(I.tokens.bracket_right,"Expected ']'.");const n=new WN(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(I.tokens.period)){const e=this._consume(I.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new zN(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(I.tokens.ident)){const r=this._previous().toString();if(this._check(I.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new Eo(s,i):new n1(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new Ov(r,i.value)}return new Vg(r)}if(this._match(I.const_literal))return new Dv(parseFloat(this._previous().toString()));if(this._check(I.tokens.paren_left))return this._paren_expression();if(this._match(I.keywords.bitcast)){this._consume(I.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(I.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new jN(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new Eo(e,n)}_argument_expression_list(){if(!this._match(I.tokens.paren_left))return null;const e=[];do{if(this._check(I.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(I.tokens.comma));return this._consume(I.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(I.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(I.tokens.paren_right),new Fv([e])}_paren_expression(){this._consume(I.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(I.tokens.paren_right,"Expected ')'."),new Fv([e])}_struct_decl(){if(!this._match(I.keywords.struct))return null;const e=this._currentLine,n=this._consume(I.tokens.ident,"Expected name for struct.").toString();this._consume(I.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(I.tokens.brace_right);){const o=this._attribute(),a=this._consume(I.tokens.ident,"Expected variable name.").toString();this._consume(I.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=l),this._check(I.tokens.brace_right)?this._match(I.tokens.comma):this._consume(I.tokens.comma,"Expected ',' for struct member."),r.push(new YN(a,u,o))}this._consume(I.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new ts(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(I.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(I.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(I.keywords.const))return null;const e=this._consume(I.tokens.ident,"Expected variable name");let n=null;if(this._match(I.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(I.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof Eo)r=s;else if(s instanceof Ov&&s.initializer instanceof Eo)r=s.initializer;else try{const o=s.evaluate(this._context);r=new Dv(o)}catch{r=s}}const i=new Mv(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(I.keywords.let))return null;const e=this._consume(I.tokens.ident,"Expected variable name");let n=null;if(this._match(I.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(I.tokens.equal)&&(r=this._const_expression()),new Bg(e.toString(),n,"","",r)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(I.keywords.var))return null;let e="",n="";this._match(I.tokens.less_than)&&(e=this._consume(I.storage_class,"Expected storage_class.").toString(),this._match(I.tokens.comma)&&(n=this._consume(I.access_mode,"Expected access_mode.").toString()),this._consume(I.tokens.greater_than,"Expected '>'."));const r=this._consume(I.tokens.ident,"Expected variable name");let i=null;if(this._match(I.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new rs(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(I.keywords.override))return null;const e=this._consume(I.tokens.ident,"Expected variable name");let n=null;if(this._match(I.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new ZS(e.toString(),n,null)}_diagnostic(){this._consume(I.tokens.paren_left,"Expected '('");const e=this._consume(I.tokens.ident,"Expected severity control name.");this._consume(I.tokens.comma,"Expected ','");const n=this._consume(I.tokens.ident,"Expected diagnostic rule name.");return this._consume(I.tokens.paren_right,"Expected ')'"),new FN(e.toString(),n.toString())}_enable_directive(){const e=this._consume(I.tokens.ident,"identity expected.");return new ON(e.toString())}_requires_directive(){const e=[this._consume(I.tokens.ident,"identity expected.").toString()];for(;this._match(I.tokens.comma);){const n=this._consume(I.tokens.ident,"identity expected.");e.push(n.toString())}return new DN(e)}_type_alias(){const e=this._consume(I.tokens.ident,"identity expected.");this._consume(I.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new GS(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([I.tokens.ident,...I.texel_format,I.keywords.bool,I.keywords.f32,I.keywords.i32,I.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Ms(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(I.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(I.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(I.tokens.comma)&&(s=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for type.")),new e1(r,i,s)}if(this._match(I.keywords.ptr)){let r=this._previous().toString();this._consume(I.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(I.storage_class,"Expected storage_class for pointer");this._consume(I.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(I.tokens.comma)&&(o=this._consume(I.access_mode,"Expected access_mode for pointer").toString()),this._consume(I.tokens.greater_than,"Expected '>' for pointer."),new LN(r,i.toString(),s,o)}const n=this._attribute();if(this._match(I.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(I.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(I.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(I.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new t1(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(I.sampler_type))return new tl(this._previous().toString(),null,null);if(this._match(I.depth_texture_type))return new tl(this._previous().toString(),null,null);if(this._match(I.sampled_texture_type)||this._match(I.multisampled_texture_type)){const e=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),new tl(e.toString(),n,null)}if(this._match(I.storage_texture_type)){const e=this._previous();this._consume(I.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(I.texel_format,"Invalid texel format.").toString();this._consume(I.tokens.comma,"Expected ',' after texel format.");const r=this._consume(I.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(I.tokens.greater_than,"Expected '>' for sampler type."),new tl(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(I.tokens.attr);){const n=this._consume(I.attribute_name,"Expected attribute name"),r=new QN(n.toString(),null);if(this._match(I.tokens.paren_left)){if(r.value=this._consume(I.literal_or_ident,"Expected attribute value").toString(),this._check(I.tokens.comma)){this._advance();do{const i=this._consume(I.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(I.tokens.comma))}this._consume(I.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Do{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Bv{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class hu extends Do{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Jd extends Do{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Vv extends Do{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var ri;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ri||(ri={}));class fu{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class GN{constructor(e,n){this.name=e,this.type=n}}class du{constructor(e,n){this.align=e,this.size=n}}class ek{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class Lv{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class tk{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class nk{constructor(e,n){this.name=e,this.type=n}}class rk{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class ik{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class sk{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Pr{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new ik,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new JN().parse(e);for(const i of r)i instanceof Ug&&this._functions.set(i.name,new sk(i));for(const i of r)if(i instanceof ts){const s=this._getTypeInfo(i,null);s instanceof hu&&this.structs.push(s)}for(const i of r){if(i instanceof GS){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof ZS){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new tk(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),u=new fu(s.name,l,o,a,s.attributes,ri.Uniform,s.access);this.uniforms.push(u);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(l),h=new fu(s.name,l,o,a,s.attributes,u?ri.StorageTexture:ri.Storage,s.access);this.storage.push(h);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),u=this._isStorageTexture(l),h=new fu(s.name,l,o,a,s.attributes,u?ri.StorageTexture:ri.Texture,s.access);u?this.storage.push(h):this.textures.push(h);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),u=new fu(s.name,l,o,a,s.attributes,ri.Sampler,s.access);this.samplers.push(u);continue}if(i instanceof Ug){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,u=new rk(i.name,l==null?void 0:l.name);u.startLine=i.startLine,u.endLine=i.endLine,this.functions.push(u),this._functions.get(i.name).info=u,l?(this._functions.get(i.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(i,!!l),u.inputs=this._getInputs(i.args),u.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(u)):(u.arguments=i.args.map(h=>new nk(h.name,this._getTypeInfo(h.type,h.attributes))),u.returnType=i.returnType?this._getTypeInfo(i.returnType,i.attributes):null);continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(s=>{var o;if(s.astNodeType==="varExpr"){const a=s;for(const l of this.overrides)a.name==l.name&&((o=i.info)===null||o===void 0||o.overrides.push(l))}});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof kh)s.push({});else if(o instanceof Mh)s.pop();else if(o instanceof rs){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Eo){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Bg){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Vg){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof n1){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof JS){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof ts)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof ts)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new Lv(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new Lv("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof ts)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof ts)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new ek(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new GN(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof t1){const i=e,s=i.format?this._getTypeInfo(i.format,i.attributes):null,o=new Jd(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ts){const i=e,s=new hu(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new Bv(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof tl){const i=e,s=i.format instanceof Ms,o=i.format?s?this._getTypeInfo(i.format,null):new Do(i.format,null):null,a=new Vv(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof e1){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new Vv(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Do(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof Jd&&e.format){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof hu&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const u=e.members[a],h=this._getTypeSize(u);if(!h)continue;(n=this._getAlias(u.type.name))!==null&&n!==void 0||u.type;const d=h.align,p=h.size;r=this._roundUp(d,r+i),i=p,s=r,o=Math.max(o,d),u.offset=r,u.size=p,this._updateTypeInfo(u.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Bv&&(e=e.type),e instanceof Do){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Pr._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new du(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=Pr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new du(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof Jd){let o=e,a=8,l=8;const u=this._getTypeSize(o.format);u!==null&&(l=u.size,a=u.align);const h=o.count,d=this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,l));return l=h*d,i&&(l=i),new du(Math.max(s,a),Math.max(i,l))}if(e instanceof hu){let o=0,a=0,l=0,u=0,h=0;for(const d of e.members){const p=this._getTypeSize(d.type);p!==null&&(o=Math.max(p.align,o),l=this._roundUp(p.align,l+u),u=p.size,h=l)}return a=this._roundUp(o,h+u),new du(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof rs&&e.storage=="uniform"}_isStorageVar(e){return e instanceof rs&&e.storage=="storage"}_isTextureVar(e){return e instanceof rs&&e.type!==null&&Pr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof rs&&e.type!==null&&Pr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Pr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Pr._textureTypes=I.any_texture_type.map(t=>t.name);Pr._samplerTypes=I.sampler_type.map(t=>t.name);function ok(t){var s;const e={attributes:[],bindings:[]};let n;try{n=ak(t)}catch(o){return Y.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:zv(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=zv(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function zv(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function ak(t){try{return new Pr(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const lk=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,ck={name:"fp32",vs:lk},uk=[0,1,1,1],hk=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
if (!bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = pickingColor;
}
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,fk=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,jv={name:"picking",vs:hk,fs:fk,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:uk},getUniforms:dk};function dk(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}function s1(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function pk(t){return t-Math.fround(t)}function gk(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;s1(t[r*4+n],e,i*2)}return e}const _k=`uniform float ONE;
vec2 split(float a) {
const float SPLIT = 4097.0;
float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float a_hi = t * ONE - (t - a);
float a_lo = a * ONE - a_hi;
#else
float a_hi = t - (t - a);
float a_lo = a - a_hi;
#endif
return vec2(a_hi, a_lo);
}
vec2 split2(vec2 a) {
vec2 b = split(a.x);
b.y += a.y;
return b;
}
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float sum = (a + b) * ONE;
float err = b - (sum - a) * ONE;
#else
float sum = a + b;
float err = b - (sum - a);
#endif
return vec2(sum, err);
}
vec2 twoSum(float a, float b) {
float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
float v = s - a;
float err = (a - (s - v)) + (b - v);
#endif
return vec2(s, err);
}
vec2 twoSub(float a, float b) {
float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float v = (s * ONE - a) * ONE;
float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
float v = s - a;
float err = (a - (s - v)) - (b + v);
#endif
return vec2(s, err);
}
vec2 twoSqr(float a) {
float prod = a * a;
vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
return vec2(prod, err);
}
vec2 twoProd(float a, float b) {
float prod = a * b;
vec2 a_fp64 = split(a);
vec2 b_fp64 = split(b);
float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
return vec2(prod, err);
}
vec2 sum_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSum(a.x, b.x);
t = twoSum(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 sub_fp64(vec2 a, vec2 b) {
vec2 s, t;
s = twoSub(a.x, b.x);
t = twoSub(a.y, b.y);
s.y += t.x;
s = quickTwoSum(s.x, s.y);
s.y += t.y;
s = quickTwoSum(s.x, s.y);
return s;
}
vec2 mul_fp64(vec2 a, vec2 b) {
vec2 prod = twoProd(a.x, b.x);
prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
prod = split2(prod);
#endif
prod = quickTwoSum(prod.x, prod.y);
return prod;
}
vec2 div_fp64(vec2 a, vec2 b) {
float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
vec2 yn = a * xn;
#endif
float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
vec2 prod = twoProd(xn, diff);
return sum_fp64(yn, prod);
}
vec2 sqrt_fp64(vec2 a) {
if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
float x = 1.0 / sqrt(a.x);
float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
vec2 yn_sqr = twoSqr(yn) * ONE;
#else
vec2 yn_sqr = twoSqr(yn);
#endif
float diff = sub_fp64(a, yn_sqr).x;
vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
return sum_fp64(split(yn), prod);
#else
return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,mk={ONE:1};function yk(){return mk}const Tk={name:"fp64-arithmetic",vs:_k,getUniforms:yk,fp64ify:s1,fp64LowPart:pk,fp64ifyMatrix4:gk},vk={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...vk}};const En=globalThis.mathgl.config;function Ek(t,{precision:e=En.precision}={}){return t=wk(t),`${parseFloat(t.toPrecision(e))}`}function Qo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ci(t,e,n){return Sk(t,r=>Math.max(e,Math.min(n,r)))}function Oh(t,e,n){return Qo(t)?t.map((r,i)=>Oh(r,e[i],n)):n*e+(1-n)*t}function Kl(t,e,n){const r=En.EPSILON;try{if(t===e)return!0;if(Qo(t)&&Qo(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Kl(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=En.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{En.EPSILON=r}}function wk(t){return Math.round(t/En.EPSILON)*En.EPSILON}function Ak(t){return t.clone?t.clone():new Array(t.length)}function Sk(t,e,n){if(Qo(t)){const r=t;n=n||Ak(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class o1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Qo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(En)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+Ek(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Kl(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(En.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function Rk(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function rn(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Gd(t,e,n=""){if(En.debug&&!Rk(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Wv(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class bk extends o1{get x(){return this[0]}set x(e){this[0]=rn(e)}get y(){return this[1]}set y(e){this[1]=rn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return rn(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return rn(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Wv(e>=0&&e<this.ELEMENTS,"index is out of range"),rn(this[e])}setComponent(e,n){return Wv(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const ju=1e-6;let Zo=typeof Float32Array<"u"?Float32Array:Array;function Ik(){const t=new Zo(2);return Zo!=Float32Array&&(t[0]=0,t[1]=0),t}function $v(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Ck(t,e){return t[0]=-e[0],t[1]=-e[1],t}function a1(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function Pk(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=Ik();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function xk(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function l1(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function Nk(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function kk(){const t=new Zo(3);return Zo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Mk(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Ok(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Dk(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Fk(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function c1(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function Uk(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function Bk(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],u=e[2];let h=i*u-s*l,d=s*a-r*u,p=r*l-i*a,_=i*p-s*d,A=s*h-r*p,S=r*d-i*h;const k=o*2;return h*=k,d*=k,p*=k,_*=2,A*=2,S*=2,t[0]=a+h+_,t[1]=l+d+A,t[2]=u+p+S,t}function Vk(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Lk(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function zk(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function jk(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),u=l&&Dk(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}const Wk=Mk;(function(){const t=kk();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const ep=[0,0,0];let pu;class ir extends bk{static get ZERO(){return pu||(pu=new ir(0,0,0),Object.freeze(pu)),pu}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Qo(e)?this.copy(e):(En.debug&&(rn(e),rn(n),rn(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return En.debug&&(rn(e.x),rn(e.y),rn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=rn(e)}angle(e){return jk(this,e)}cross(e){return Fk(this,this,e),this.check()}rotateX({radians:e,origin:n=ep}){return Vk(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ep}){return Lk(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ep}){return zk(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return c1(this,this,e),this.check()}transformAsVector(e){return l1(this,this,e),this.check()}transformByMatrix3(e){return Uk(this,this,e),this.check()}transformByMatrix2(e){return Nk(this,this,e),this.check()}transformByQuaternion(e){return Bk(this,this,e),this.check()}}class $k extends o1{toString(){let e="[";if(En.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=rn(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function Hk(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xk(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Lg(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],_=e[11],A=e[12],S=e[13],k=e[14],v=e[15],m=n*a-r*o,b=n*l-i*o,D=n*u-s*o,V=r*l-i*a,j=r*u-s*a,P=i*u-s*l,E=h*S-d*A,C=h*k-p*A,x=h*v-_*A,O=d*k-p*S,F=d*v-_*S,N=p*v-_*k;let oe=m*N-b*F+D*O+V*x-j*C+P*E;return oe?(oe=1/oe,t[0]=(a*N-l*F+u*O)*oe,t[1]=(i*F-r*N-s*O)*oe,t[2]=(S*P-k*j+v*V)*oe,t[3]=(p*j-d*P-_*V)*oe,t[4]=(l*x-o*N-u*C)*oe,t[5]=(n*N-i*x+s*C)*oe,t[6]=(k*D-A*P-v*b)*oe,t[7]=(h*P-p*D+_*b)*oe,t[8]=(o*F-a*x+u*E)*oe,t[9]=(r*x-n*F-s*E)*oe,t[10]=(A*j-S*D+v*m)*oe,t[11]=(d*D-h*j-_*m)*oe,t[12]=(a*C-o*O-l*E)*oe,t[13]=(n*O-r*C+i*E)*oe,t[14]=(S*b-A*V-k*m)*oe,t[15]=(h*V-d*b+p*m)*oe,t):null}function qk(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],h=t[9],d=t[10],p=t[11],_=t[12],A=t[13],S=t[14],k=t[15],v=e*o-n*s,m=e*a-r*s,b=n*a-r*o,D=u*A-h*_,V=u*S-d*_,j=h*S-d*A,P=e*j-n*V+r*D,E=s*j-o*V+a*D,C=u*b-h*m+d*v,x=_*b-A*m+S*v;return l*P-i*E+k*C-p*x}function _s(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=e[9],_=e[10],A=e[11],S=e[12],k=e[13],v=e[14],m=e[15];let b=n[0],D=n[1],V=n[2],j=n[3];return t[0]=b*r+D*a+V*d+j*S,t[1]=b*i+D*l+V*p+j*k,t[2]=b*s+D*u+V*_+j*v,t[3]=b*o+D*h+V*A+j*m,b=n[4],D=n[5],V=n[6],j=n[7],t[4]=b*r+D*a+V*d+j*S,t[5]=b*i+D*l+V*p+j*k,t[6]=b*s+D*u+V*_+j*v,t[7]=b*o+D*h+V*A+j*m,b=n[8],D=n[9],V=n[10],j=n[11],t[8]=b*r+D*a+V*d+j*S,t[9]=b*i+D*l+V*p+j*k,t[10]=b*s+D*u+V*_+j*v,t[11]=b*o+D*h+V*A+j*m,b=n[12],D=n[13],V=n[14],j=n[15],t[12]=b*r+D*a+V*d+j*S,t[13]=b*i+D*l+V*p+j*k,t[14]=b*s+D*u+V*_+j*v,t[15]=b*o+D*h+V*A+j*m,t}function Dh(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,u,h,d,p,_,A,S,k,v;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],u=e[3],h=e[4],d=e[5],p=e[6],_=e[7],A=e[8],S=e[9],k=e[10],v=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=u,t[4]=h,t[5]=d,t[6]=p,t[7]=_,t[8]=A,t[9]=S,t[10]=k,t[11]=v,t[12]=o*r+h*i+A*s+e[12],t[13]=a*r+d*i+S*s+e[13],t[14]=l*r+p*i+k*s+e[14],t[15]=u*r+_*i+v*s+e[15]),t}function Mm(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Kk(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,u,h,d,p,_,A,S,k,v,m,b,D,V,j,P,E,C,x,O,F,N,oe,ct;return a<ju?null:(a=1/a,i*=a,s*=a,o*=a,u=Math.sin(n),l=Math.cos(n),h=1-l,d=e[0],p=e[1],_=e[2],A=e[3],S=e[4],k=e[5],v=e[6],m=e[7],b=e[8],D=e[9],V=e[10],j=e[11],P=i*i*h+l,E=s*i*h+o*u,C=o*i*h-s*u,x=i*s*h-o*u,O=s*s*h+l,F=o*s*h+i*u,N=i*o*h+s*u,oe=s*o*h-i*u,ct=o*o*h+l,t[0]=d*P+S*E+b*C,t[1]=p*P+k*E+D*C,t[2]=_*P+v*E+V*C,t[3]=A*P+m*E+j*C,t[4]=d*x+S*O+b*F,t[5]=p*x+k*O+D*F,t[6]=_*x+v*O+V*F,t[7]=A*x+m*O+j*F,t[8]=d*N+S*oe+b*ct,t[9]=p*N+k*oe+D*ct,t[10]=_*N+v*oe+V*ct,t[11]=A*N+m*oe+j*ct,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function u1(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*r,t[5]=o*i+h*r,t[6]=a*i+d*r,t[7]=l*i+p*r,t[8]=u*i-s*r,t[9]=h*i-o*r,t[10]=d*i-a*r,t[11]=p*i-l*r,t}function Yk(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],u=e[8],h=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*r,t[1]=o*i-h*r,t[2]=a*i-d*r,t[3]=l*i-p*r,t[8]=s*r+u*i,t[9]=o*r+h*i,t[10]=a*r+d*i,t[11]=l*r+p*i,t}function h1(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*r,t[1]=o*i+h*r,t[2]=a*i+d*r,t[3]=l*i+p*r,t[4]=u*i-s*r,t[5]=h*i-o*r,t[6]=d*i-a*r,t[7]=p*i-l*r,t}function Qk(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,u=n*o,h=r*o,d=r*a,p=i*o,_=i*a,A=i*l,S=s*o,k=s*a,v=s*l;return t[0]=1-d-A,t[1]=h+v,t[2]=p-k,t[3]=0,t[4]=h-v,t[5]=1-u-A,t[6]=_+S,t[7]=0,t[8]=p+k,t[9]=_-S,t[10]=1-u-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zk(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),u=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*u,t[15]=0,t}function Jk(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const Gk=Jk;function eM(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),u=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*u,t[15]=1,t}const tM=eM;function nM(t,e,n,r){let i,s,o,a,l,u,h,d,p,_;const A=e[0],S=e[1],k=e[2],v=r[0],m=r[1],b=r[2],D=n[0],V=n[1],j=n[2];return Math.abs(A-D)<ju&&Math.abs(S-V)<ju&&Math.abs(k-j)<ju?Hk(t):(d=A-D,p=S-V,_=k-j,i=1/Math.sqrt(d*d+p*p+_*_),d*=i,p*=i,_*=i,s=m*_-b*p,o=b*d-v*_,a=v*p-m*d,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=p*a-_*o,u=_*s-d*a,h=d*o-p*s,i=Math.sqrt(l*l+u*u+h*h),i?(i=1/i,l*=i,u*=i,h*=i):(l=0,u=0,h=0),t[0]=s,t[1]=l,t[2]=d,t[3]=0,t[4]=o,t[5]=u,t[6]=p,t[7]=0,t[8]=a,t[9]=h,t[10]=_,t[11]=0,t[12]=-(s*A+o*S+a*k),t[13]=-(l*A+u*S+h*k),t[14]=-(d*A+p*S+_*k),t[15]=1,t)}function rM(){const t=new Zo(4);return Zo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function iM(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function mc(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=rM();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var zg;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(zg||(zg={}));const sM=45*Math.PI/180,oM=1,tp=.1,np=500,aM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class sr extends $k{static get IDENTITY(){return cM()}static get ZERO(){return lM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return zg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,u,h,d,p,_,A,S,k){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=u,this[9]=h,this[10]=d,this[11]=p,this[12]=_,this[13]=A,this[14]=S,this[15]=k,this.check()}setRowMajor(e,n,r,i,s,o,a,l,u,h,d,p,_,A,S,k){return this[0]=e,this[1]=s,this[2]=u,this[3]=_,this[4]=n,this[5]=o,this[6]=h,this[7]=A,this[8]=r,this[9]=a,this[10]=d,this[11]=S,this[12]=i,this[13]=l,this[14]=p,this[15]=k,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(aM)}fromObject(e){return this.check()}fromQuaternion(e){return Qk(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=tp,far:a=np}=e;return a===1/0?uM(this,n,r,i,s,o):Zk(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return nM(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=tp,far:a=np}=e;return tM(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=sM,aspect:r=oM,focalDistance:i=1,near:s=tp,far:o=np}=e;Hv(n);const a=n/2,l=i*Math.tan(a),u=l*r;return this.ortho({left:-u,right:u,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Hv(n),Gk(this,n,r,i,s),this.check()}determinant(){return qk(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return Xk(this,this),this.check()}invert(){return Lg(this,this),this.check()}multiplyLeft(e){return _s(this,e,this),this.check()}multiplyRight(e){return _s(this,this,e),this.check()}rotateX(e){return u1(this,this,e),this.check()}rotateY(e){return Yk(this,this,e),this.check()}rotateZ(e){return h1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Kk(this,this,e,n),this.check()}scale(e){return Mm(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Dh(this,this,e),this.check()}transform(e,n){return e.length===4?(n=mc(n||[-0,-0,-0,-0],e,this),Gd(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=Pk(n||[-0,-0],e,this);break;case 3:i=c1(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gd(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=xk(n||[-0,-0],e,this);break;case 3:r=l1(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gd(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let gu,_u;function lM(){return gu||(gu=new sr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(gu)),gu}function cM(){return _u||(_u=new sr,Object.freeze(_u)),_u}function Hv(t){if(t>Math.PI*2)throw Error("expected radians")}function uM(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),u=(i+r)/(i-r),h=-1,d=-1,p=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=u,t[10]=h,t[11]=d,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}const f1="#define SMOOTH_EDGE_RADIUS 0.5",hM=`
${f1}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fM=`
${f1}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,dM={name:"geometry",vs:hM,fs:fM},ve={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ve,"IDENTITY",{get:()=>(Ce.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Zn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Fh={common:0,meters:1,pixels:2},jg={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},pM=Object.keys(ve).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ve[t]};`).join(""),gM=Object.keys(Zn).map(t=>`const int PROJECTION_MODE_${t} = ${Zn[t]};`).join(""),_M=Object.keys(Fh).map(t=>`const int UNIT_${t.toUpperCase()} = ${Fh[t]};`).join(""),mM=`${pM}
${gM}
${_M}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function yM(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function yc(t){let e={},n;return r=>{for(const i in r)if(!yM(r[i],e[i])){n=t(r),e=r;break}return n}}const Xv=[0,0,0,0],TM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],d1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],vM=[0,0,0],p1=[0,0,0],EM=yc(SM);function g1(t,e,n=p1){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===ve.LNGLAT_OFFSETS||e===ve.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Zn.WEB_MERCATOR:(e===ve.LNGLAT||e===ve.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Zn.WEB_MERCATOR_AUTO_OFFSET:e===ve.LNGLAT?r=i:e===ve.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Zn.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Zn.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function wM(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Xv,l=Xv,u=t.cameraPosition;const{geospatialOrigin:h,shaderCoordinateOrigin:d,offsetMode:p}=g1(t,e,n);return p&&(l=t.projectPosition(h||d),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,a=mc([],l,o),s=r||s,o=_s([],i,s),o=_s([],o,TM)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:d,geospatialOrigin:h}}function AM({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=ve.DEFAULT,coordinateOrigin:i=p1,autoWrapLongitude:s=!1}){r===ve.DEFAULT&&(r=t.isGeospatial?ve.LNGLAT:ve.CARTESIAN);const o=EM({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||d1,o}function SM({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:u}=wM(t,n,r),h=t.getDistanceScales(),d=[t.width*e,t.height*e],p=mc([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,_={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:d,project_uDevicePixelRatio:e,project_uFocalDistance:p,project_uCommonUnitsPerMeter:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit:h.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:vM,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:d1,project_uCameraPosition:a};if(u){const A=t.getDistanceScales(u);switch(n){case ve.METER_OFFSETS:_.project_uCommonUnitsPerWorldUnit=A.unitsPerMeter,_.project_uCommonUnitsPerWorldUnit2=A.unitsPerMeter2;break;case ve.LNGLAT:case ve.LNGLAT_OFFSETS:t._pseudoMeters||(_.project_uCommonUnitsPerMeter=A.unitsPerMeter),_.project_uCommonUnitsPerWorldUnit=A.unitsPerDegree,_.project_uCommonUnitsPerWorldUnit2=A.unitsPerDegree2;break;case ve.CARTESIAN:_.project_uCommonUnitsPerWorldUnit=[1,1,A.unitsPerMeter[2]],_.project_uCommonUnitsPerWorldUnit2=[0,0,A.unitsPerMeter2[2]];break}}return _}const RM={};function bM(t=RM){return"viewport"in t?AM(t):{}}const Om={name:"project",dependencies:[ck,dM],vs:mM,getUniforms:bM},IM=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,CM={name:"project32",dependencies:[Om],vs:IM};function PM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Fo(t,e){const n=mc([],e,t);return iM(n,n,1/n[3]),n}function qv(t,e){const n=t%e;return n<0?e+n:n}function Wg(t,e,n){return t<e?e:t>n?n:t}function xM(t){return Math.log(t)*Math.LOG2E}const Dm=Math.log2||xM;function Dr(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const kn=Math.PI,_1=kn/4,wn=kn/180,$g=180/kn,Jo=512,Uh=4003e4,mu=85.051129,NM=1.5;function kM(t){return Dm(t)}function Bh(t){const[e,n]=t;Dr(Number.isFinite(e)),Dr(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*wn,i=n*wn,s=Jo*(r+kn)/(2*kn),o=Jo*(kn+Math.log(Math.tan(_1+i*.5)))/(2*kn);return[s,o]}function Go(t){const[e,n]=t,r=e/Jo*(2*kn)-kn,i=2*(Math.atan(Math.exp(n/Jo*(2*kn)-kn))-_1);return[r*$g,i*$g]}function MM(t){const{latitude:e}=t;Dr(Number.isFinite(e));const n=Math.cos(e*wn);return kM(Uh*n)-9}function rp(t){const e=Math.cos(t*wn);return Jo/Uh/e}function Hg(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;Dr(Number.isFinite(e)&&Number.isFinite(n));const i=Jo,s=Math.cos(e*wn),o=i/360,a=o/s,l=i/Uh/s,u={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const h=wn*Math.tan(e*wn)/s,d=o*h/2,p=i/Uh*h,_=p/a*l;u.unitsPerDegree2=[0,d,p],u.unitsPerMeter2=[_,0,_]}return u}function m1(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:u}=Hg({longitude:n,latitude:r,highPrecision:!0}),h=Bh(t);h[0]+=s*(l[0]+u[0]*o),h[1]+=o*(l[1]+u[1]*o);const d=Go(h),p=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[d[0],d[1],p]:d}function OM(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=PM();Dh(a,a,[0,0,-i]),u1(a,a,-n*wn),h1(a,a,r*wn);const l=s/e;return Mm(a,a,[l,l,l]),o&&Dh(a,a,Ok([],o)),a}function DM(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:u=1}=t;let{fovy:h=Vh(NM)}=t;r!==void 0&&(h=Vh(r));const d=h*wn,p=i*wn,_=y1(h);let A=_;o&&(A+=o[2]*a/Math.cos(p)/n);const S=d*(.5+(s?s[1]:0)/n),k=Math.sin(S)*A/Math.sin(Wg(Math.PI/2-p-S,.01,Math.PI-.01)),v=Math.sin(p)*k+A,m=A*10,b=Math.min(v*u,m);return{fov:d,aspect:e/n,focalDistance:_,near:l,far:b}}function Vh(t){return 2*Math.atan(.5/t)*$g}function y1(t){return .5/Math.tan(.5*t*wn)}function T1(t,e){const[n,r,i=0]=t;return Dr(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Fo(e,[n,r,i,1])}function Fm(t,e,n=0){const[r,i,s]=t;if(Dr(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Fo(e,[r,i,s,1]);const o=Fo(e,[r,i,0,1]),a=Fo(e,[r,i,1,1]),l=o[2],u=a[2],h=l===u?0:((n||0)-l)/(u-l);return a1([],o,a,h)}function FM(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[u,h]]=r,d=UM(t.padding),p=Bh([a,Wg(h,-mu,mu)]),_=Bh([u,Wg(l,-mu,mu)]),A=[Math.max(Math.abs(_[0]-p[0]),i),Math.max(Math.abs(_[1]-p[1]),i)],S=[e-d.left-d.right-Math.abs(o[0])*2,n-d.top-d.bottom-Math.abs(o[1])*2];Dr(S[0]>0&&S[1]>0);const k=S[0]/A[0],v=S[1]/A[1],m=(d.right-d.left)/2/k,b=(d.top-d.bottom)/2/v,D=[(_[0]+p[0])/2+m,(_[1]+p[1])/2+b],V=Go(D),j=Math.min(s,Dm(Math.abs(Math.min(k,v))));return Dr(Number.isFinite(j)),{longitude:V[0],latitude:V[1],zoom:j}}function UM(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Dr(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Kv=Math.PI/180;function BM(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,u;const h=t.fovy?.5*t.fovy*Kv:Math.atan(.5/t.altitude),d=(90-t.pitch)*Kv;return h>d-.01?(l=Yv(t,0,e),u=Yv(t,n,e)):(l=i([0,0],s),u=i([n,0],s)),[o,a,u,l]}function Yv(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Fo(r,[e,0,1,1]),s=Fo(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=a1([],i,s,a),u=Go(l);return u.push(n),u}const Qv=512;function VM(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=qv(i+180,360)-180),(a<-180||a>180)&&(a=qv(a+180,360)-180);const l=Dm(n/Qv);if(o<=l)o=l,s=0;else{const u=n/2/Math.pow(2,o),h=Go([0,u])[1];if(s<h)s=h;else{const d=Go([0,Qv-u])[1];s>d&&(s=d)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const LM=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,zM=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,jM=yc(qM),WM=yc(KM),$M=[0,0,0,1],HM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function XM(t,e){const[n,r,i]=t,s=Fm([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function qM({viewport:t,center:e}){return new sr(t.viewProjectionMatrix).invert().transform(e)}function KM({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>XM(o,r));for(const o of e){const a=o.clone().translate(new ir(t.center).negate()),l=s.map(h=>a.transform(h)),u=new sr().ortho({left:Math.min(...l.map(h=>h[0])),right:Math.max(...l.map(h=>h[0])),bottom:Math.min(...l.map(h=>h[1])),top:Math.max(...l.map(h=>h[1])),near:Math.min(...l.map(h=>-h[2])),far:Math.max(...l.map(h=>-h[2]))});n.push(u.multiplyRight(o))}return n}function YM(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||$M,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=jM({viewport:t.viewport,center:e.project_uCenter}),s=[],o=WM({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],u=l.clone().translate(new ir(t.viewport.center).negate());e.project_uCoordinateSystem===ve.LNGLAT&&e.project_uProjectionMode===Zn.WEB_MERCATOR?(o[a]=u,s[a]=i):(o[a]=l.clone().multiplyRight(HM),s[a]=u.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const Zv={name:"shadow",dependencies:[Om],vs:LM,fs:zM,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?YM(t,e):{}},QM={...jv,defaultUniforms:{...jv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},ZM=[Om],JM=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function GM(){const t=Rh.getDefaultShaderAssembler();for(const e of ZM)t.addDefaultModule(e);for(const e of JM)t.addShaderHook(e);return t}const eO=[255,255,255],tO=1;let nO=0;class rO{constructor(e={}){this.type="ambient";const{color:n=eO}=e,{intensity:r=tO}=e;this.id=e.id||`ambient-${nO++}`,this.color=n,this.intensity=r}}const iO=[255,255,255],sO=1,oO=[0,0,-1];let aO=0;class Jv{constructor(e={}){this.type="directional";const{color:n=iO}=e,{intensity:r=sO}=e,{direction:i=oO}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${aO++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new ir(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class lO{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Um extends lO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,u={viewport:[0,0,n,r]};e.colorMask&&(u.colorMask=l),e.scissorRect&&(u.scissorRect=e.scissorRect);const h=this.device.beginRenderPass({framebuffer:e.target,parameters:u,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(h,e)}finally{h.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const u=[];for(const h of s){const d=o&&o[h.id];a==null||a(h);const p=this._getDrawLayerParams(h,n),_=h.subViewports||[h];for(const A of _){const S=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:A,view:d,pass:n.pass,layers:n.layers},p);u.push(S)}}return u}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},u=!1){var A;const h=[],d=v1(this._lastRenderIndex+1),p={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},_={};for(let S=0;S<n.length;S++){const k=n[S],v=this._shouldDrawLayer(k,p,s,_),m={shouldDrawLayer:v};v&&!u&&(m.layerRenderIndex=d(k,v),m.moduleParameters=this._getModuleParameters(k,a,r,l),m.layerParameters={...(A=k.context.deck)==null?void 0:A.props.parameters,...this.getLayerParameters(k,S,e)}),h[S]=m}return h}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const u=cO(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const d=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:u},()=>this.device.clearWebGL(d))}const h={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:u});for(let d=0;d<n.length;d++){const p=n[d],{shouldDrawLayer:_,layerRenderIndex:A,moduleParameters:S,layerParameters:k}=l[d];if(_&&p.props.pickable&&h.pickableCount++,p.isComposite)h.compositeCount++;else if(_){h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,A),S.viewport=o,p.context.renderPass=e;try{p._drawLayer({renderPass:e,moduleParameters:S,uniforms:{layerIndex:A},parameters:k})}catch(v){p.raiseError(v,`drawing ${p} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const u of n)Object.assign(o,(l=u.getModuleParameters)==null?void 0:l.call(u,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function v1(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let u;if(l&&!(l in e)&&r(i.parent,!1),l in n){const h=n[l]=n[l]||v1(e[l],e);u=h(i,s),n[a]=h}else Number.isFinite(o)?(u=o+(e[l]||0),n[a]=null):u=t;return s&&u>=t&&(t=u+1),e[a]=u,u};return r}function cO(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class uO extends Um{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const hO={color:[255,255,255],intensity:1},Gv=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],fO=[0,0,0,200/255];class E1{constructor(e={}){this.id="lighting-effect",this.shadowColor=fO,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(Zv),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Zv))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new sr().lookAt({eye:new ir(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new uO(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new rO(hO),this.directionalLights.push(new Jv(Gv[0]),new Jv(Gv[1])))}}class dO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const u=i||e&&e.constructor||Float32Array,h=n*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new u(e.buffer,0,h)}let d=1/0;l&&(d=l*r+s);const p=this._allocate(u,h,a,d);return e&&o?p.set(e):a||p.fill(0,0,4),this._release(e),p}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(u=>u.byteLength>=a);if(l>=0){const u=new e(o.splice(l,1)[0],0,s);return r&&u.fill(0),u}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Yl=new dO;function nl(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pO(t){return[t[12],t[13],t[14]]}function gO(t){return{left:eo(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:eo(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:eo(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:eo(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:eo(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:eo(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const e0=new ir;function eo(t,e,n,r){e0.set(t,e,n);const i=e0.len();return{distance:r/i,normal:new ir(-t/i,-e/i,-n/i)}}function _O(t){return t-Math.fround(t)}let Ha;function ip(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Ha=Yl.allocate(Ha,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const u=t[o++];Ha[a+l]=u,Ha[a+l+n]=_O(u)}a+=n*2}return Ha.subarray(0,s*n*2)}function mO(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const yO=Math.PI/180,TO=nl(),t0=[0,0,0],vO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function EO({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,u=n?new sr().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new sr().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:h=0,right:d=0,top:p=0,bottom:_=0}=s,A=ci((h+t-d)/2,0,t)-t/2,S=ci((p+e-_)/2,0,e)-e/2;u[8]-=A*2/t,u[9]+=S*2/e}return u}class Tc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||vO,this.focalDistance=e.focalDistance||1,this.position=e.position||t0,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Zn.WEB_MERCATOR:Zn.WEB_MERCATOR_AUTO_OFFSET:Zn.IDENTITY}equals(e){return e instanceof Tc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Kl(e.projectionMatrix,this.projectionMatrix)&&Kl(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=T1(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],u=Fm([i,a,o],this.pixelUnprojectionMatrix,l),[h,d,p]=this.unprojectPosition(u);return Number.isFinite(o)?[h,d,p]:Number.isFinite(r)?[h,d,r]:[h,d]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Bh(e);return n[1]=ci(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Go(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?Hg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,gO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=MM({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Hg({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=t0;if(s&&(a=o?new sr(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new ir(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=TO,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:u=null,focalDistance:h=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new sr().multiplyRight(n).translate(new ir(this.center).negate()),this.projectionMatrix=r||EO({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*yO,focalDistance:h,padding:u,near:a,far:l});const d=nl();_s(d,d,this.projectionMatrix),_s(d,d,this.viewMatrix),this.viewProjectionMatrix=d,this.viewMatrixInverse=Lg([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=pO(this.viewMatrixInverse);const p=nl(),_=nl();Mm(p,p,[this.width/2,-this.height/2,1]),Dh(p,p,[1,-1,0]),_s(_,p,this.viewProjectionMatrix),this.pixelProjectionMatrix=_,this.pixelUnprojectionMatrix=Lg(nl(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ce.warn("Pixel project matrix not invertible")()}}Tc.displayName="Viewport";class ea extends Tc{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:u,farZ:h,orthographic:d=!1,projectionMatrix:p,repeat:_=!1,worldOffset:A=0,position:S,padding:k,legacyMeterSizes:v=!1}=e;let{width:m,height:b,altitude:D=1.5}=e;const V=Math.pow(2,i);m=m||1,b=b||1;let j,P=null;if(p)D=p[5]/2,j=Vh(D);else{e.fovy?(j=e.fovy,D=y1(j)):j=Vh(D);let C;if(k){const{top:x=0,bottom:O=0}=k;C=[0,ci((x+b-O)/2,0,b)-b/2]}P=DM({width:m,height:b,scale:V,center:S&&[0,0,S[2]*rp(n)],offset:C,pitch:s,fovy:j,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(u)&&(P.near=u),Number.isFinite(h)&&(P.far=h)}let E=OM({height:b,pitch:s,bearing:o,scale:V,altitude:D});A&&(E=new sr().translate([512*A,0,0]).multiplyLeft(E)),super({...e,width:m,height:b,viewMatrix:E,longitude:r,latitude:n,zoom:i,...P,fovy:j,focalDistance:D}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=D,this.fovy=j,this.orthographic=d,this._subViewports=_?[]:null,this._pseudoMeters=v,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new ea({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*rp(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/rp(r);return[n,r,i]}addMetersToLngLat(e,n){return m1(e,n)}panByPosition(e,n){const r=Fm(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=$v([],i,Ck([],r)),o=$v([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=BM(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=FM({width:r,height:i,bounds:e,...n});return new ea({width:r,height:i,longitude:s,latitude:o,zoom:a})}}ea.displayName="WebMercatorViewport";const n0=[0,0,0];function sp(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof ea){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function wO(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===ve.DEFAULT&&(i=e.isGeospatial?ve.LNGLAT:ve.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function w1(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=mc([],[o,a,l,1],n)),r){case ve.LNGLAT:return sp([o,a,l],e,s);case ve.LNGLAT_OFFSETS:return sp([o+i[0],a+i[1],l+(i[2]||0)],e,s);case ve.METER_OFFSETS:return sp(m1(i,[o,a,l]),e,s);case ve.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function AO(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=wO(e),{autoOffset:l=!0}=e,{geospatialOrigin:u=n0,shaderCoordinateOrigin:h=n0,offsetMode:d=!1}=l?g1(n,r,i):{},p=w1(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:d});if(d){const _=n.projectPosition(u||h);Wk(p,p,_)}return p}let SO=1,RO=1;class A1{constructor(){T(this,"time",0);T(this,"channels",new Map);T(this,"animations",new Map);T(this,"playing",!1);T(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=SO++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=RO++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let bO=0;const IO={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Oo.stats.get(`animation-loop-${bO++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class CO{constructor(e){T(this,"device",null);T(this,"canvas",null);T(this,"props");T(this,"animationProps",null);T(this,"timeline",null);T(this,"stats");T(this,"cpuTime");T(this,"gpuTime");T(this,"frameRate");T(this,"display");T(this,"needsRedraw","initialized");T(this,"_initialized",!1);T(this,"_running",!1);T(this,"_animationFrameId",null);T(this,"_nextFramePromise",null);T(this,"_resolveNextFrame",null);T(this,"_cpuStartTime",0);if(this.props={...IO,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Df({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=EN(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(wN(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class r0{constructor(e){T(this,"id");T(this,"userData",{});T(this,"topology");T(this,"bufferLayout",[]);T(this,"vertexCount");T(this,"indices");T(this,"attributes");this.id=e.id||ks("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&Pe(this.indices.usage===Ye.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function PO(t,e){if(e instanceof r0)return e;const n=xO(t,e),{attributes:r,bufferLayout:i}=NO(t,e);return new r0({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function xO(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Ye.INDEX,data:n})}function NO(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:u,normalized:h}=o;n.push({name:a,format:_N(l,u,h)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class kO{constructor(e){T(this,"modules");T(this,"moduleUniforms");T(this,"moduleBindings");T(this,"moduleUniformsChanged");const n=Uf(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;Y.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){Y.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],u=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:h,bindings:d}=km(u);this.moduleUniforms[i]={...a,...h},this.moduleBindings[i]={...l,...d}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const _f=class _f{constructor(e){T(this,"device");T(this,"_hashCounter",0);T(this,"_hashes",{});T(this,"_renderPipelineCache",{});T(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new _f(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Ko.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Nh.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Nh?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};T(_f,"defaultProps",{...Ko.defaultProps});let Xg=_f;const mf=class mf{constructor(e){T(this,"device");T(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new mf(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};T(mf,"defaultProps",{...Ch.defaultProps});let qg=mf;function MO(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let ft=null,op=null;function OO(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){ft||(ft=document.createElement("canvas"),ft.id=e,ft.title=e,ft.style.zIndex="100",ft.style.position="absolute",ft.style.top=i,ft.style.left=s,ft.style.border="blue 1px solid",ft.style.transform="scaleY(-1)",document.body.appendChild(ft),op=ft.getContext("2d")),(ft.width!==t.width||ft.height!==t.height)&&(ft.width=t.width/2,ft.height=t.height/2,ft.style.width="400px",ft.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=op.createImageData(t.width,t.height),u=0;for(let h=0;h<a.length;h+=4)l.data[u+h+0]=a[h+0]*o,l.data[u+h+1]=a[h+1]*o,l.data[u+h+2]=a[h+2]*o,l.data[u+h+3]=r?255:a[h+3]*o;op.putImageData(l,0,0)}const to=2,DO=1e4,yf=class yf{constructor(e,n){T(this,"device");T(this,"id");T(this,"source");T(this,"vs");T(this,"fs");T(this,"pipelineFactory");T(this,"shaderFactory");T(this,"userData",{});T(this,"parameters");T(this,"topology");T(this,"bufferLayout");T(this,"isInstanced");T(this,"instanceCount",0);T(this,"vertexCount");T(this,"indexBuffer",null);T(this,"bufferAttributes",{});T(this,"constantAttributes",{});T(this,"bindings",{});T(this,"uniforms",{});T(this,"vertexArray");T(this,"transformFeedback",null);T(this,"pipeline");T(this,"shaderInputs");T(this,"_uniformStore");T(this,"_attributeInfos",{});T(this,"_gpuGeometry",null);T(this,"_getModuleUniforms");T(this,"props");T(this,"_pipelineNeedsUpdate","newly created");T(this,"_needsRedraw","initializing");T(this,"_destroyed",!1);T(this,"_lastDrawTimestamp",-1);T(this,"_lastLogTime",0);T(this,"_logOpen",!1);T(this,"_drawCount",0);var a,l,u,h;this.props={...yf.defaultProps,...n},n=this.props,this.id=n.id||ks("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(d=>[d.name,d]))||[]);this.setShaderInputs(n.shaderInputs||new kO(r));const i=FO(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(u=this.shaderInputs)==null?void 0:u.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(h=this.props).shaderLayout||(h.shaderLayout=ok(this.props.source));const{source:d,getUniforms:p}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=d,this._getModuleUniforms=p}else{const{vs:d,fs:p,getUniforms:_}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=d,this.fs=p,this._getModuleUniforms=_}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Xg.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||qg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),bh(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&PO(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=i0(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?i0(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Fg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new gN(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindings()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&Y.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>s0(l).includes(r));if(!s){Y.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=s0(s);let a=!1;for(const l of o){const u=this._attributeInfos[l];u&&(this.vertexArray.setBuffer(u.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&Y.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||Y.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){bh(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=km(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Ih?e=Math.max(e,n.texture.updateTimestamp):n instanceof Ye||n instanceof Tn?e=Math.max(e,n.updateTimestamp):n instanceof Ph||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(Y.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=XS(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=Y.level>3?0:DO;Y.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Y.group(to,`>>> DRAWING MODEL ${this.id}`,{collapsed:Y.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=MO(this.pipeline.shaderLayout,this.id);Y.table(to,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};Y.table(to,n)();const r=this._getAttributeDebugTable();Y.table(to,this._attributeInfos)(),Y.table(to,r)(),Y.groupEnd(to)(),this._logOpen=!1}}_logFramebuffer(e){const n=Y.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&OO(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=YS(n);return(e instanceof Ye?new r(e.debugData):e).toString()}};T(yf,"defaultProps",{...Ko.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Rh.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ql=yf;function i0(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function FO(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function s0(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class Zl{constructor(e,n=Ql.defaultProps){T(this,"device");T(this,"model");T(this,"transformFeedback");Pe(Zl.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Ql(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||mx(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof Ye)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class UO{constructor(e){T(this,"id");T(this,"topology");T(this,"vertexCount");T(this,"indices");T(this,"attributes");T(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||ks("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;Pe(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(Pe(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return Pe(Number.isFinite(r)),r}}const BO={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class S1 extends Um{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:u,height:h},cullRect:d,effects:p,pass:_="picking",pickZ:A,moduleParameters:S}){this.pickZ=A;const k=this._resetColorEncoder(A),v=[a,l,u,h],m=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:d,effects:p==null?void 0:p.filter(D=>D.useInPicking),pass:_,isPicking:!0,moduleParameters:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:v});return this._colorEncoderState=null,{decodePickingColor:k&&LO.bind(null,k),stats:m}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,BO),i.blend=!0,i.blendColor=VO(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function VO(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(Ce.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function LO(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ro={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Lh=Symbol.for("component"),ms=Symbol.for("propTypes"),ap=Symbol.for("deprecatedProps"),Uo=Symbol.for("asyncPropDefaults"),Rs=Symbol.for("asyncPropOriginal"),ui=Symbol.for("asyncPropResolved");function R1(t,e=()=>!0){return Array.isArray(t)?b1(t,e,[]):e(t)?[t]:[]}function b1(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?b1(i,e,n):e(i)&&n.push(i)}return n}function zO({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class jO{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Ag(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class WO{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new jO(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const $O="layerManager.setLayers",HO="layerManager.activateViewport";class XO{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{zt(HO,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new WO({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:GM(),defaultShaderModules:[],renderPass:void 0,stats:i||new Df({id:"deck.gl"}),viewport:s||new Tc({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new A1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){zt($O,this,n,e),this._lastRenderedLayers=e;const r=R1(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?Ce.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&Ce.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ro.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ro.MATCHED,n!==e&&(e.lifecycle=ro.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ro.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ro.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Mn(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Mn(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Mn(t[s],e[s],n-1))return!1;return!0}return!1}class qO{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=R1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Mn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ce.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const u=!!s.controller;u&&!l&&(r=!0),(r||!u)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const KO=/([0-9]+\.?[0-9]*)(%|px)/;function Zr(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=KO.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Jr(t,e){return t.relative?Math.round(t.position*e):t.position}class ta{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Zr(r),this._y=Zr(i),this._width=Zr(s),this._height=Zr(o),this._padding=a&&{left:Zr(a.left||0),right:Zr(a.right||0),top:Zr(a.top||0),bottom:Zr(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&Mn(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Jr(this._x,e),y:Jr(this._y,n),width:Jr(this._width,e),height:Jr(this._height,n)};return this._padding&&(r.padding={left:Jr(this._padding.left,e),top:Jr(this._padding.top,n),right:Jr(this._padding.right,e),bottom:Jr(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Vf{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const o0=()=>{},Kg={BREAK:1,SNAP_TO_END:2,IGNORE:3},YO=t=>t,QO=Kg.BREAK;class ZO{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,u=l(r/a),h=i.interpolateProps(s,o,u);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Vf(e.timeline),this.onViewStateChange=e.onViewStateChange||o0,this.onStateChange=e.onStateChange||o0}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Kg.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Kg.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||YO,interpolator:s,interruption:n.transitionInterruption||QO,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Ot(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class JO{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Kl(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ot(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const GO=["longitude","latitude","zoom","bearing","pitch"],eD=["longitude","latitude","zoom"];class I1 extends JO{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:GO,required:eD},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Oh(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Oh(e.around,n.around,r)))}return i}}const Gr={transitionDuration:0},tD=300,yu=t=>1-(1-t)*(1-t),no={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Ji={};class nD{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new ZO({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?tD:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:u=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(no.WHEEL,h&&r),this.toggleEvents(no.PAN,h),this.toggleEvents(no.PINCH,h&&(a||l)),this.toggleEvents(no.TRIPLE_PAN,h&&l),this.toggleEvents(no.DOUBLE_TAP,h&&o),this.toggleEvents(no.KEYBOARD,h&&u),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=u}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Gr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Gr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:yu},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Gr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:yu},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Gr,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Gr,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:yu},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Ji._startPinchRotation=e.rotation,Ji._lastPinchEvent=e,this.updateViewport(r,Gr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Ji._startPinchRotation-r})}return this.updateViewport(n,Gr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Ji._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Ji;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:yu},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Ji._startPinchRotation=null,Ji._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const u={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),u.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),u.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),u.isRotating=!0):(l=a.moveLeft(i),u.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),u.isRotating=!0):(l=a.moveRight(i),u.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),u.isRotating=!0):(l=a.moveUp(i),u.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),u.isRotating=!0):(l=a.moveDown(i),u.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),u),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Gr:e?{...n,transitionInterpolator:new I1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class rD{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const a0=5,iD=1.2;class sD extends rD{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:u=1.5,position:h=[0,0,0],maxZoom:d=20,minZoom:p=0,maxPitch:_=60,minPitch:A=0,startPanLngLat:S,startZoomLngLat:k,startRotatePos:v,startBearing:m,startPitch:b,startZoom:D,normalize:V=!0}=e;Ot(Number.isFinite(s)),Ot(Number.isFinite(i)),Ot(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:u,maxZoom:d,minZoom:p,maxPitch:_,minPitch:A,normalize:V,position:h},{startPanLngLat:S,startZoomLngLat:k,startRotatePos:v,startBearing:m,startPitch:b,startZoom:D}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=ci(l,a,o);const u=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...u.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=ci(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=ci(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,VM(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:u,height:h}=this.getViewportProps(),d=s/u;let p=0;o>0?Math.abs(h-l)>a0&&(p=o/(l-h)*iD):o<0&&l>a0&&(p=1-a/l),p=ci(p,-1,1);const{minPitch:_,maxPitch:A}=this.getViewportProps(),S=i+180*d;let k=r;return p>0?k=r+p*(A-r):p<0&&(k=r-p*(_-r)),{pitch:k,bearing:S}}}class oD extends nD{constructor(){super(...arguments),this.ControllerState=sD,this.transition={transitionDuration:300,transitionInterpolator:new I1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class C1 extends ta{constructor(e={}){super(e)}get ViewportType(){return ea}get ControllerType(){return oD}}C1.displayName="MapView";const aD=new E1;function lD(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class cD{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>lD(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Mn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof E1)||this._resolvedEffects.push(aD),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class uD extends Um{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const hD="deckRenderer.renderLayers";class fD{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new uD(e),this.pickLayersPass=new S1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,zt(hD,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const dD={pickedColor:null,pickedObjectIndex:-1};function pD({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:u}=s;let h=i*i,d=-1,p=0;for(let _=0;_<u;_++){const A=_+a-r,S=A*A;if(S>h)p+=4*l;else for(let k=0;k<l;k++){if(t[p+3]-1>=0){const m=k+o-n,b=m*m+S;b<=h&&(h=b,d=p)}p+=4}}if(d>=0){const _=t.slice(d,d+4),A=e(_);if(A){const S=Math.floor(d/4/l),k=d/4-S*l;return{...A,pickedColor:_,pickedX:o+k,pickedY:a+S}}Ce.error("Picked non-existent layer. Is picking buffer corrupt?")()}return dD}function gD({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):Ce.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function P1({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=mD((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function _D(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const d=n.index,p=n.layerId,_=o?o.props.id:null;if(_!==p||a!==d){if(_!==p){const A=i.find(S=>S.props.id===p);A&&l.unshift(A)}n.layerId=_,n.index=a,n.info=null}}const u=P1(t),h=new Map;return h.set(null,u),l.forEach(d=>{let p={...u};d===o&&(p.color=s,p.index=a,p.picked=!0),p=x1({layer:d,info:p,mode:r});const _=p.layer;d===o&&r==="hover"&&(n.info=p),h.set(_.id,p),r==="hover"&&_.updateAutoHighlight(p)}),h}function x1({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function mD(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class yD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new S1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(p=>p.id===o):null,u=a&&i.find(p=>p.id===a)||i[0],h=u&&u.unproject([e-u.x,n-u.y]);return{...s,...{x:e,y:n,viewport:u,coordinate:h,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:u,onViewportActive:h,effects:d}){const p=this.device.canvasContext.cssToDeviceRatio(),_=this._getPickable(e);if(!_||r.length===0)return{result:[],emptyInfo:P1({viewports:r,x:i,y:s,pixelRatio:p})};this._resizeBuffer();const A=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=[A.x+Math.floor(A.width/2),A.y+Math.floor(A.height/2)],k=Math.round(o*p),{width:v,height:m}=this.pickingFBO,b=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:k,deviceWidth:v,deviceHeight:m}),D={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let V;const j=[],P=new Set;for(let E=0;E<a;E++){let C;if(b){const O=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:h,deviceRect:b,cullRect:D,effects:d,pass:`picking:${l}`});C=pD({...O,deviceX:S[0],deviceY:S[1],deviceRadius:k,deviceRect:b})}else C={pickedColor:null,pickedObjectIndex:-1};let x;if(C.pickedLayer&&u&&this.depthFBO){const{pickedColors:O}=this._drawAndSample({layers:[C.pickedLayer],views:n,viewports:r,onViewportActive:h,deviceRect:{x:C.pickedX,y:C.pickedY,width:1,height:1},cullRect:D,effects:d,pass:`picking:${l}:z`},!0);O[3]&&(x=O[0])}C.pickedLayer&&E+1<a&&(P.add(C.pickedLayer),C.pickedLayer.disablePickingIndex(C.pickedObjectIndex)),V=_D({pickInfo:C,lastPickedInfo:this.lastPickedInfo,mode:l,layers:_,viewports:r,x:i,y:s,z:x,pixelRatio:p});for(const O of V.values())O.layer&&j.push(O);if(!C.pickedColor)break}for(const E of P)E.restorePickingColors();return{result:j,emptyInfo:V.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:u=null,onViewportActive:h,effects:d}){const p=this._getPickable(e);if(!p||r.length===0)return[];this._resizeBuffer();const _=this.device.canvasContext.cssToDeviceRatio(),A=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=A.x,k=A.y+A.height,v=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),m=v.x+v.width,b=v.y,D={x:S,y:b,width:m-S,height:k-b},V=this._drawAndSample({layers:p,views:n,viewports:r,onViewportActive:h,deviceRect:D,cullRect:{x:i,y:s,width:o,height:a},effects:d,pass:`picking:${l}`}),j=gD(V),P=new Map,E=[],C=Number.isFinite(u);for(let x=0;x<j.length&&!(C&&E.length>=u);x++){const O=j[x];let F={color:O.pickedColor,layer:null,index:O.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:_};F=x1({layer:O.pickedLayer,info:F,mode:l});const N=F.layer.id;P.has(N)||P.set(N,new Set);const oe=P.get(N),ct=F.object??F.index;oe.has(ct)||(oe.add(ct),E.push(F))}return E}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},u=!1){const h=u?this.depthFBO:this.pickingFBO,d={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:u,preRenderStats:{}};for(const m of a)m.useInPicking&&(d.preRenderStats[m.id]=m.preRender(d));const{decodePickingColor:p}=this.pickLayersPass.render(d),{x:_,y:A,width:S,height:k}=s,v=new(u?Float32Array:Uint8Array)(S*k*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:_,sourceY:A,sourceWidth:S,sourceHeight:k,target:v}),{pickedColors:v,decodePickingColor:p}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,u=Math.min(s,n+r+1)-a;return l<=0||u<=0?null:{x:o,y:a,width:l,height:u}}}const TD={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},vD="top-left",l0="__root";class ED{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Mn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=vD}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||l0;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,TD[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===l0||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const u=r[l];u&&(a.onViewportChange&&!u.equals(i[l])&&a.onViewportChange(u),(s=a.onRedraw)==null||s.call(a,{viewports:[u],layers:n}))}else{if(a.onViewportChange)for(const u of e)u.equals(i[u.id])||a.onViewportChange(u);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=jg[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const wD={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class AD{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,wD),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var wo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(wo||(wo={}));const Bm={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ze=(t,e,n)=>e?t.enable(n):t.disable(n),c0=(t,e,n)=>t.hint(n,e),tn=(t,e,n)=>t.pixelStorei(n,e),u0=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},Xa=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function lp(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const SD={3042:Ze,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ze,2885:(t,e)=>t.cullFace(e),2929:Ze,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ze,35723:c0,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:u0,36010:u0,34964:Xa,36662:Xa,36663:Xa,35053:Xa,35055:Xa,2886:(t,e)=>t.frontFace(e),33170:c0,2849:(t,e)=>t.lineWidth(e),32823:Ze,32824:"polygonOffset",10752:"polygonOffset",35977:Ze,32926:Ze,32928:Ze,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ze,3088:(t,e)=>t.scissor(...e),2960:Ze,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ze,10754:Ze,12288:Ze,12289:Ze,12290:Ze,12291:Ze,12292:Ze,12293:Ze,12294:Ze,12295:Ze,3333:tn,3317:tn,37440:tn,37441:tn,37443:tn,3330:tn,3332:tn,3331:tn,3314:tn,32878:tn,3316:tn,3315:tn,32877:tn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=lp(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=lp(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=lp(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function $e(t,e,n){return e[t]!==void 0?e[t]:n[t]}const RD={blendEquation:(t,e,n)=>t.blendEquationSeparate($e(32777,e,n),$e(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate($e(32969,e,n),$e(32968,e,n),$e(32971,e,n),$e(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset($e(32824,e,n),$e(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage($e(32938,e,n),$e(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,$e(2962,e,n),$e(2967,e,n),$e(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,$e(34816,e,n),$e(36003,e,n),$e(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,$e(2964,e,n),$e(2965,e,n),$e(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,$e(34817,e,n),$e(34818,e,n),$e(34819,e,n))},h0={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},$n=(t,e)=>t.isEnabled(e),f0={3042:$n,2884:$n,2929:$n,3024:$n,32823:$n,32926:$n,32928:$n,3089:$n,2960:$n,35977:$n},bD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function da(t,e){if(CD(e))return;const n={};for(const i in e){const s=Number(i),o=SD[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=RD[i];s(t,e,r)}}function N1(t,e=Bm){if(typeof e=="number"){const i=e,s=f0[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=f0[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function ID(t){da(t,Bm)}function CD(t){for(const e in t)return!1;return!0}function PD(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class xD{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){T(this,"gl");T(this,"program",null);T(this,"stateStack",[]);T(this,"enable",!0);T(this,"cache");T(this,"log");this.gl=e,this.cache=n?N1(e):Object.assign({},Bm),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Pe(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];da(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){Pe(s!==void 0);const o=e[s],a=this.cache[s];PD(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function bs(t){return t.state}function k1(t,e){const{enable:n=!0,copyState:r}=e;if(Pe(r!==void 0),!t.state){t.state=new xD(t,{copyState:r}),kD(t);for(const s in h0){const o=h0[s];ND(t,s,o)}d0(t,"getParameter"),d0(t,"isEnabled")}const i=bs(t);return i.enable=n,t}function Lf(t){let e=bs(t);e||(k1(t,{copyState:!1}),e=bs(t)),e.push()}function Jl(t){const e=bs(t);Pe(e),e.pop()}function d0(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||bD.has(i))return n(i);const s=bs(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function ND(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=bs(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function kD(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=bs(t);i.program!==r&&(e(r),i.program=r)}}const MD={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function OD(t,e){e={...MD,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function Pi(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function DD(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Pi(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,u=t.getParameter(7938),h=M1(a,l),d=FD(a,l),p=UD(a,l);return{type:"webgl",gpu:h,gpuType:p,gpuBackend:d,vendor:a,renderer:l,version:u,shadingLanguage:"glsl",shadingLanguageVersion:300}}function M1(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function FD(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function UD(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(M1(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function O1(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const xt="texture-compression-bc",we="texture-compression-astc",Hn="texture-compression-etc2",BD="texture-compression-etc1-webgl",Tu="texture-compression-pvrtc-webgl",cp="texture-compression-atc-webgl",qa="float32-renderable-webgl",up="float16-renderable-webgl",VD="rgb9e5ufloat_renderable-webgl",hp="snorm8-renderable-webgl",Ka="norm16-renderable-webgl",fp="snorm16-renderable-webgl",vu="float32-filterable",p0="float16-filterable-webgl",rl="WEBGL_compressed_texture_s3tc",il="WEBGL_compressed_texture_s3tc_srgb",Ao="EXT_texture_compression_rgtc",So="EXT_texture_compression_bptc",LD="WEBGL_compressed_texture_etc",zD="WEBGL_compressed_texture_astc",jD="WEBGL_compressed_texture_etc1",WD="WEBGL_compressed_texture_pvrtc",$D="WEBGL_compressed_texture_atc",g0="EXT_texture_norm16",_0="EXT_render_snorm",HD="EXT_color_buffer_float",Vm={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[_0],"norm16-renderable-webgl":[g0],"snorm16-renderable-webgl":[g0,_0],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[rl,il,Ao,So],"texture-compression-bc5-webgl":[Ao],"texture-compression-bc7-webgl":[So],"texture-compression-etc2":[LD],"texture-compression-astc":[zD],"texture-compression-etc1-webgl":[jD],"texture-compression-pvrtc-webgl":[WD],"texture-compression-atc-webgl":[$D]};function XD(t){return t in Vm}function qD(t,e,n){return(Vm[e]||[]).every(i=>Pi(t,i,n))}const zf={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:hp},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:hp},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:up,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:Ka,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:fp},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:hp},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:up,filter:p0,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:Ka},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:fp},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:qa,filter:vu},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:VD},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:qa,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:Ka},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:Ka},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:qa,filter:vu,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:up,filter:p0},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:Ka,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:fp},"rgb32float-webgl":{gl:34837,render:qa,filter:vu,gl2ext:HD,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:qa,filter:vu,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:rl,f:xt},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:il,f:xt},"bc1-rgba-unorm":{gl:33777,x:rl,f:xt},"bc1-rgba-unorm-srgb":{gl:35916,x:il,f:xt},"bc2-rgba-unorm":{gl:33778,x:rl,f:xt},"bc2-rgba-unorm-srgb":{gl:35918,x:il,f:xt},"bc3-rgba-unorm":{gl:33779,x:rl,f:xt},"bc3-rgba-unorm-srgb":{gl:35919,x:il,f:xt},"bc4-r-unorm":{gl:36283,x:Ao,f:xt},"bc4-r-snorm":{gl:36284,x:Ao,f:xt},"bc5-rg-unorm":{gl:36285,x:Ao,f:xt},"bc5-rg-snorm":{gl:36286,x:Ao,f:xt},"bc6h-rgb-ufloat":{gl:36495,x:So,f:xt},"bc6h-rgb-float":{gl:36494,x:So,f:xt},"bc7-rgba-unorm":{gl:36492,x:So,f:xt},"bc7-rgba-unorm-srgb":{gl:36493,x:So,f:xt},"etc2-rgb8unorm":{gl:37492,f:Hn},"etc2-rgb8unorm-srgb":{gl:37494,f:Hn},"etc2-rgb8a1unorm":{gl:37496,f:Hn},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Hn},"etc2-rgba8unorm":{gl:37493,f:Hn},"etc2-rgba8unorm-srgb":{gl:37495,f:Hn},"eac-r11unorm":{gl:37488,f:Hn},"eac-r11snorm":{gl:37489,f:Hn},"eac-rg11unorm":{gl:37490,f:Hn},"eac-rg11snorm":{gl:37491,f:Hn},"astc-4x4-unorm":{gl:37808,f:we},"astc-4x4-unorm-srgb":{gl:37840,f:we},"astc-5x4-unorm":{gl:37809,f:we},"astc-5x4-unorm-srgb":{gl:37841,f:we},"astc-5x5-unorm":{gl:37810,f:we},"astc-5x5-unorm-srgb":{gl:37842,f:we},"astc-6x5-unorm":{gl:37811,f:we},"astc-6x5-unorm-srgb":{gl:37843,f:we},"astc-6x6-unorm":{gl:37812,f:we},"astc-6x6-unorm-srgb":{gl:37844,f:we},"astc-8x5-unorm":{gl:37813,f:we},"astc-8x5-unorm-srgb":{gl:37845,f:we},"astc-8x6-unorm":{gl:37814,f:we},"astc-8x6-unorm-srgb":{gl:37846,f:we},"astc-8x8-unorm":{gl:37815,f:we},"astc-8x8-unorm-srgb":{gl:37847,f:we},"astc-10x5-unorm":{gl:37819,f:we},"astc-10x5-unorm-srgb":{gl:37851,f:we},"astc-10x6-unorm":{gl:37817,f:we},"astc-10x6-unorm-srgb":{gl:37849,f:we},"astc-10x8-unorm":{gl:37818,f:we},"astc-10x8-unorm-srgb":{gl:37850,f:we},"astc-10x10-unorm":{gl:37819,f:we},"astc-10x10-unorm-srgb":{gl:37851,f:we},"astc-12x10-unorm":{gl:37820,f:we},"astc-12x10-unorm-srgb":{gl:37852,f:we},"astc-12x12-unorm":{gl:37821,f:we},"astc-12x12-unorm-srgb":{gl:37853,f:we},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Tu},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Tu},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Tu},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Tu},"etc1-rbg-unorm-webgl":{gl:36196,f:BD},"atc-rgb-unorm-webgl":{gl:35986,f:cp},"atc-rgba-unorm-webgl":{gl:35986,f:cp},"atc-rgbai-unorm-webgl":{gl:34798,f:cp}},KD={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},YD={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Lm(t,e,n){const r=zf[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!Pi(t,i,n):!0}function D1(t){const e=zf[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function QD(t,e,n){if(!Lm(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(jS(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!Pi(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!Pi(t,"OES_texture_half_float_linear, extensions",n):!0}function ZD(t,e,n){return!(!Lm(t,e,n)||typeof e=="number")}function zh(t){var i;const e=zf[t],n=D1(t),r=jS(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||GD(r.format,r.integer,r.normalized,n),type:r.dataType?O1(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function JD(t){const e=zf[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function m0(t){const e=zh(t),n=KD[e.dataFormat]||4,r=YD[e.type]||1;return n*r}function GD(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const y0={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class eF extends Mx{constructor(n,r,i){super([],i);T(this,"gl");T(this,"extensions");T(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Pi(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),XD(n)&&qD(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(y0),...Object.keys(Vm)]}getWebGLFeature(n){const r=y0[n];return typeof r=="string"?!!Pi(this.gl,r,this.extensions):!!r}}class tF extends kx{constructor(n){super();T(this,"gl");T(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function hi(t,e,n){if(nF(e))return n(t);const{nocatch:r=!0}=e;Lf(t),da(t,e);let i;if(r)i=n(t),Jl(t);else try{i=n(t)}finally{Jl(t)}return i}function nF(t){for(const e in t)return!1;return!0}function rF(t,e,n,r){if(bh(e))return r(t);const i=t;Lf(i.gl);try{return iF(t,e),da(i.gl,n),r(t)}finally{Jl(i.gl)}}function iF(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(ys("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=ys("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=ys("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(oF("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Yg("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Y.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Yg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=dp("stencilPassOperation",e.stencilPassOperation),s=dp("stencilFailOperation",e.stencilFailOperation),o=dp("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=T0("blendColorOperation",e.blendColorOperation||"add"),s=T0("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Eu("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Eu("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=Eu("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),u=Eu("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,u)}}function Yg(t,e){return ys(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function dp(t,e){return ys(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function T0(t,e){return ys(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Eu(t,e){return ys(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function sF(t,e){return`Illegal parameter ${e} for ${t}`}function ys(t,e,n){if(!(e in n))throw new Error(sF(t,e));return n[e]}function oF(t,e){return e}function F1(t){const e={};return t.addressModeU&&(e[10242]=pp(t.addressModeU)),t.addressModeV&&(e[10243]=pp(t.addressModeV)),t.addressModeW&&(e[32882]=pp(t.addressModeW)),t.magFilter&&(e[10240]=U1(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=aF(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Yg("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function pp(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function U1(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function aF(t,e){if(!e)return U1(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Ei extends Ye{constructor(n,r={}){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"glTarget");T(this,"glUsage");T(this,"glIndexType",5123);T(this,"byteLength");T(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=lF(this.props.usage),this.glUsage=cF(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){Pe(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function lF(t){return t&Ye.INDEX?34963:t&Ye.VERTEX?34962:t&Ye.UNIFORM?35345:34962}function cF(t){return t&Ye.INDEX||t&Ye.VERTEX?35044:t&Ye.UNIFORM?35048:35044}class Qg extends Ph{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"parameters");this.device=n,this.parameters=F1(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class Ro extends Ih{constructor(n,r){super(n,{...Tn.defaultProps,...r});T(this,"device");T(this,"gl");T(this,"handle");T(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const uF={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Cl=class Cl extends Tn{constructor(n,r){var i;super(n,{...uF,format:"rgba8unorm",...r});T(this,"MAX_ATTRIBUTES");T(this,"device");T(this,"gl");T(this,"handle");T(this,"sampler");T(this,"view");T(this,"glFormat");T(this,"type");T(this,"dataFormat");T(this,"mipmaps");T(this,"target");T(this,"textureUnit");T(this,"loaded",!1);T(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=hF(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:vN(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new Ro(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(v=>this.initialize(Object.assign({},n,{pixels:v,data:v}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:u=!0}=n;r||(r=o);let{width:h,height:d,dataFormat:p,type:_,compressed:A=!1}=n;const{depth:S=0}=n,k=D1(n.format);return{width:h,height:d,compressed:A,dataFormat:p,type:_}=this._deduceParameters({format:n.format,type:_,dataFormat:p,compressed:A,data:r,width:h,height:d}),this.width=h,this.height=d,this.glFormat=k,this.type=_,this.dataFormat=p,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=u,this.setImageData({data:r,width:h,height:d,depth:S,format:n.format,type:_,dataFormat:p,parameters:a,compressed:A}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),u&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof Qg?(this.sampler=n,r=n.props):(this.sampler=new Qg(this.device,n),r=n);const i=F1(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),hi(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:u=null,type:h=this.type,width:d=this.width,height:p=this.height,dataFormat:_=this.dataFormat,compressed:A=!1}=n;u||(u=i),{type:h,dataFormat:_,compressed:A,width:d,height:p}=this._deduceParameters({format:this.props.format,type:h,dataFormat:_,compressed:A,data:u,width:d,height:p});const{gl:S}=this;S.bindTexture(this.target,this.handle);let k=null;if({data:u,dataType:k}=this._getDataType({data:u,compressed:A}),hi(this.gl,l,()=>{switch(k){case"null":S.texImage2D(r,s,o,d,p,0,_,h,u);break;case"typed-array":S.texImage2D(r,s,o,d,p,0,_,h,u,a);break;case"buffer":this.device.gl.bindBuffer(35052,u.handle||u),this.device.gl.texImage2D(r,s,o,d,p,0,_,h,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":S.texImage2D(r,s,o,d,p,0,_,h,u);break;case"compressed":for(const[v,m]of u.entries())S.compressedTexImage2D(r,v,m.format,m.width,m.height,0,m.data);break;default:Pe(!1,"Unknown image data type")}}),u&&u.byteLength)this.trackAllocatedMemory(u.byteLength,"Texture");else{const v=m0(this.props.format);this.trackAllocatedMemory(this.width*this.height*v,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:u=0,glFormat:h=this.glFormat,type:d=this.type,dataFormat:p=this.dataFormat,compressed:_=!1,offset:A=0,parameters:S={}}){if({type:d,dataFormat:p,compressed:_,width:a,height:l}=this._deduceParameters({format:this.props.format,type:d,dataFormat:p,compressed:_,data:i,width:a,height:l}),Pe(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const k=i;i=k.data,a=k.shape[0],l=k.shape[1]}i instanceof Ei&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),hi(this.gl,S,()=>{_?this.gl.compressedTexSubImage2D(n,u,s,o,a,l,h,i):i===null?this.gl.texSubImage2D(n,u,s,o,a,l,p,d,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,u,s,o,a,l,p,d,i,A):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,u,s,o,a,l,p,d,A),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,u,s,o,a,l,p,d,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return Y.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Ei?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:u}=n;const h=zh(r);return a=a||h.dataFormat,l=l||h.type,u=u||h.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:u,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},Pe(s,"Could not deduced texture size"),Pe(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),Pe(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:u=5121}=n,h=o||a,d=await Promise.all(Cl.FACES.map(p=>{const _=h[p];return Promise.all(Array.isArray(_)?_:[_])}));this.bind(),Cl.FACES.forEach((p,_)=>{d[_].length>1&&this.props.mipmaps!==!1&&Y.warn(`${this.id} has mipmap and multiple LODs.`)(),d[_].forEach((A,S)=>{i&&s?r.texImage2D(p,S,l,i,s,0,l,u,A):r.texImage2D(p,S,l,l,u,A)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:u=5121}=n,{gl:h}=this,d=o||a;return this.bind(),d instanceof Promise?d.then(p=>this.setImageDataForFace(Object.assign({},n,{face:r,data:p,pixels:p}))):this.width||this.height?h.texImage2D(r,0,l,i,s,0,l,u,d):h.texImage2D(r,0,l,l,u,d),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:u=1,offset:h=0,data:d,parameters:p={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const _=zh(s);if(hi(this.gl,p,()=>{ArrayBuffer.isView(d)&&this.gl.texImage3D(this.target,r,_.format,a,l,u,0,_.dataFormat,_.type,d),d instanceof Ei&&(this.gl.bindBuffer(35052,d.handle),this.gl.texImage3D(this.target,r,i,a,l,u,0,s,o,h))}),d&&d.byteLength)this.trackAllocatedMemory(d.byteLength,"Texture");else{const A=m0(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*A,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!bh(n)){fF(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};T(Cl,"FACES",[34069,34070,34071,34072,34073,34074]);let Jn=Cl;function hF(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function fF(t){Y.log(1,"texture sampler parameters",t)()}class Tl extends xh{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(JD(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${pF(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new Jn(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof Jn)return this._attachTexture(n,r,0,0),r;if(r instanceof Ro){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=dF(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:Pe(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function dF(t){return t<34069?t+34069:t}function pF(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class gF extends Nm{constructor(n,r){super(r);T(this,"device");T(this,"presentationSize");T(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Tl(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const _F={spector:Y.get("spector")||Y.get("spectorjs")},mF="https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",yF=1;let Ae=null,v0=!1;async function TF(t){if(!globalThis.SPECTOR)try{await QS(mF)}catch(e){Y.warn(String(e))}}function vF(t){if(t={..._F,...t},!(t!=null&&t.spector)||(!Ae&&globalThis.SPECTOR&&(Y.probe(yF,"SPECTOR found and initialized")(),Ae=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Ae)),!Ae))return null;if(v0||(v0=!0,Ae.spyCanvases(),Ae==null||Ae.onCaptureStarted.add(e=>Y.info("Spector capture started:",e)()),Ae==null||Ae.onCapture.add(e=>{Y.info("Spector capture complete:",e)(),Ae==null||Ae.getResultUI(),Ae==null||Ae.resultView.display(),Ae==null||Ae.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return Ae;Ae==null||Ae.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{Y.info("Spector capture stopped after 2 seconds")(),Ae==null||Ae.stopCapture()})}return Ae}const EF="https://unpkg.com/webgl-debug@2.0.1/index.js";function B1(t){return t.luma=t.luma||{},t.luma}async function wF(){Bi()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await QS(EF))}function AF(t,e={}){return t?e.debug?RF(t,e):SF(t):null}function SF(t){const e=B1(t);return e.realContext?e.realContext:t}function RF(t,e){if(!globalThis.WebGLDebugUtils)return Y.warn("webgl-debug not loaded")(),t;const n=B1(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...wo,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,bF.bind(null,e),IF.bind(null,e));for(const o in wo)!(o in r)&&typeof wo[o]=="number"&&(r[o]=wo[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function gp(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function bF(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;Y.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function IF(t,e,n){let r="";if(Y.level>=1&&(r=gp(e,n),Y.log(1,r)()),t.break&&t.break.length>0&&(r=r||gp(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||gp(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);Y.error(`Undefined argument: ${r}`)();debugger}}function CF(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[d,p]=i;n.push({message:p.trim(),type:E0(d),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let u=parseInt(a,10);isNaN(u)&&(u=0);let h=parseInt(o,10);isNaN(h)&&(h=0),n.push({message:l.join(":").trim(),type:E0(s),lineNum:u,linePos:h})}return n}function E0(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class PF extends Ch{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return CF(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),Y.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Y.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Y.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const xF=256,NF=1024,kF=16384,_p=6144,MF=[1,2,4,8];class OF extends xg{constructor(n,r){super(n,r);T(this,"device");T(this,"glParameters");this.device=n,Lf(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Jl(this.device.gl)}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=MF.map(i=>!!(i&n.colorMask))),this.glParameters=r,da(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=kF,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=xF,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=NF,n.clearStencil=this.props.clearStencil),r!==0&&hi(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){hi(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(_p,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(_p,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(_p,n,r);break}})}}const DF="Failed to deduce GL constant from typed array";function FF(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(DF)}}function Zg(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const UF={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},BF={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class vl{constructor(...e){T(this,"offset");T(this,"stride");T(this,"type");T(this,"size");T(this,"divisor");T(this,"normalized");T(this,"integer");T(this,"buffer");T(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Zg(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Pe(e.size),Zg(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new vl(UF,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return vl.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return vl.getBytesPerVertex(this)}_assign(e={}){return e=yN("Accessor",e,BF),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function VF(t){return LF.includes(t)}const LF=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],V1={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function L1(t){const e=V1[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function zF(t){const e=V1[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function jF(t,e){const n={attributes:[],bindings:[]};n.attributes=WF(t,e);const r=XF(t,e);for(const a of r){const l=a.uniforms.map(u=>({name:u.name,format:u.format,byteOffset:u.byteOffset,byteStride:u.byteStride,arrayLength:u.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=HF(t,e);let s=0;for(const a of i)if(VF(a.type)){const{viewDimension:l,sampleType:u}=KF(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:u}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=$F(t,e);return o!=null&&o.length&&(n.varyings=o),n}function WF(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:u}=zF(a),h=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:h,type:u})}}return n.sort((i,s)=>i.location-s.location),n}function $F(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:u,components:h}=L1(a),d=new vl({type:u,size:l*h}),p={location:i,name:o,accessor:d};n.push(p)}return n.sort((i,s)=>i.location-s.location),n}function HF(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:u,isArray:h}=YF(o);let d=t.getUniformLocation(e,u);const p={location:d,name:u,size:a,type:l,isArray:h};if(n.push(p),p.size>1)for(let _=0;_<p.size;_++){const A=`${u}[${_}]`;d=t.getUniformLocation(e,A);const S={...p,name:A,location:d};n.push(S)}}return n}function XF(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),u=t.getActiveUniforms(e,a,35384),h=t.getActiveUniforms(e,a,35387),d=t.getActiveUniforms(e,a,35388);for(let p=0;p<o.uniformCount;++p){const _=t.getActiveUniform(e,a[p]);if(!_)throw new Error("activeInfo");o.uniforms.push({name:_.name,format:L1(l[p]).format,type:l[p],arrayLength:u[p],byteOffset:h[p],byteStride:d[p]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const qF={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function KF(t){const e=qF[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function YF(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function QF(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function ZF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function JF(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const w0=4;class GF extends Ko{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"vs");T(this,"fs");T(this,"introspectedLayout");T(this,"uniforms",{});T(this,"bindings",{});T(this,"varyings",null);T(this,"_uniformCount",0);T(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),Y.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=jF(this.device.gl,this.handle),Y.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=sN(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":Y.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||Y.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||Y.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Ei)&&!(s.buffer instanceof Ei))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ro||s instanceof Jn||s instanceof Tl))throw new Error("texture value");break;case"sampler":Y.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var k;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:u=!1,firstVertex:h=0,transformFeedback:d}=n,p=ZF(s),_=!!o.indexBuffer,A=(k=o.indexBuffer)==null?void 0:k.glIndexType;if(this.linkStatus!=="success")return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return Y.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),d&&d.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=r;return rF(this.device,i,S.glParameters,()=>{_&&u?this.device.gl.drawElementsInstanced(p,a||0,A,h,l||0):_?this.device.gl.drawElements(p,a||0,A,h):u?this.device.gl.drawArraysInstanced(p,h,a||0,l||0):this.device.gl.drawArrays(p,h,a||0),d&&d.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=km(n);Object.keys(r).forEach(i=>{Y.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),Y.time(w0,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),Y.timeEnd(w0,`linkProgram for ${this.id}`)(),Y.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Y.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Y.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Jn&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof Ei?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Ro||o instanceof Jn||o instanceof Tl))throw new Error("texture");let u;if(o instanceof Ro)u=o.texture;else if(o instanceof Jn)u=o;else if(o instanceof Tl&&o.colorAttachments[0]instanceof Ro)Y.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(u.target,u.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&QF(this.device.gl,i,s,a)}}}class e4 extends kg{constructor(n){super(n,{});T(this,"device");T(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":t4(this.device,r.options);break;case"copy-buffer-to-texture":n4(this.device,r.options);break;case"copy-texture-to-buffer":r4(this.device,r.options);break;case"copy-texture-to-texture":i4(this.device,r.options);break}}}function t4(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function n4(t,e){throw new Error("Not implemented")}function r4(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:u,byteOffset:h=0,bytesPerRow:d,rowsPerImage:p}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||d||p)throw new Error("not implemented");const{framebuffer:_,destroyFramebuffer:A}=z1(n);let S;try{const k=u,v=s||_.width,m=o||_.height,b=zh(_.texture.props.format),D=b.dataFormat,V=b.type;t.gl.bindBuffer(35051,k.handle),S=t.gl.bindFramebuffer(36160,_.handle),t.gl.readPixels(l[0],l[1],v,m,D,V,h)}finally{t.gl.bindBuffer(35051,null),S!==void 0&&t.gl.bindFramebuffer(36160,S),A&&_.destroy()}}function i4(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:u,destroyFramebuffer:h}=z1(n),[d,p]=i,[_,A,S]=s,k=t.gl.bindFramebuffer(36160,u.handle);let v=null,m;if(o instanceof Jn)v=o,a=Number.isFinite(a)?a:v.width,l=Number.isFinite(l)?l:v.height,v.bind(0),m=v.target;else throw new Error("invalid destination");switch(m){case 3553:case 34067:t.gl.copyTexSubImage2D(m,r,_,A,d,p,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(m,r,_,A,S,d,p,a,l);break}v&&v.unbind(),t.gl.bindFramebuffer(36160,k),h&&u.destroy()}function z1(t){if(t instanceof Tn){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class s4 extends Ng{constructor(n,r){super(n,r);T(this,"device");T(this,"commandBuffer");this.device=n,this.commandBuffer=new e4(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class zm extends Mg{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"buffer",null);T(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return SP()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:u,integer:h,divisor:d}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,u,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,d||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=O1(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=zm.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=o4(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!a4(i,this.bufferValue),a){const l=cN(r.constructor,o);uN({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function o4(t){return Array.isArray(t)?new Float32Array(t):t}function a4(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class l4 extends Og{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"layout");T(this,"buffers",{});T(this,"unusedBuffers",{});T(this,"bindOnUse",!0);T(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(JF(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,Y.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(A0(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Ei)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(A0(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function A0(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class c4 extends Dg{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"target",null);T(this,"_queryPending",!1);T(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function j1(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Pe(!1),0}}function u4(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Pe(!1),0}}function h4(t,e){var k,v;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:u}=e||{};const{framebuffer:h,deleteFramebuffer:d}=W1(t);Pe(h);const{gl:p,handle:_}=h;a=a||h.width,l=l||h.height;const A=s-36064;u=u||((v=(k=h.colorAttachments[A])==null?void 0:k.texture)==null?void 0:v.type)||5121,o=p4(o,u,i,a,l),u=u||FF(o);const S=p.bindFramebuffer(36160,_);return p.readPixels(n,r,a,l,i,u,o),p.bindFramebuffer(36160,S||null),d&&h.destroy(),o}function f4(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:u}=e||{};const{framebuffer:h,deleteFramebuffer:d}=W1(t);Pe(h),a=a||h.width,l=l||h.height;const p=h;u=u||5121;let _=n;if(!_){const S=j1(s),k=u4(u),v=o+a*l*S*k;_=p.device.createBuffer({byteLength:v})}const A=t.device.createCommandEncoder();return A.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:_,byteOffset:o}),A.destroy(),d&&h.destroy(),_}function W1(t){return t instanceof xh?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:d4(t),deleteFramebuffer:!0}}function d4(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function p4(t,e,n,r,i){if(t)return t;e=e||5121;const s=Zg(e,{clamped:!1}),o=j1(n);return new s(r*i*o)}const g4=256,_4=1024,m4=16384,y4="clear: bad arguments";function T4(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=m4,r!==!0&&(o.clearColor=r)),i&&(a|=g4,i!==!0&&(o.clearDepth=i)),s&&(a|=_4,i!==!0&&(o.clearStencil=i)),Pe(a!==0,y4);const l=t.gl;hi(l,o,()=>{l.clear(a)})}const Ya=1,ss=class ss extends qo{constructor(n){var l,u;super({...n,id:n.id||ks("webgl-device")});T(this,"type","webgl");T(this,"handle");T(this,"features");T(this,"limits");T(this,"info");T(this,"canvasContext");T(this,"lost");T(this,"_resolveContextLost");T(this,"renderPass",null);T(this,"gl");T(this,"debug",!1);T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});T(this,"_extensions",{});T(this,"_polyfilled",!1);T(this,"spectorJS");T(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((u=n.gl)==null?void 0:u.canvas)||n.canvas;this.canvasContext=new gF(this,{...n,canvas:i}),this.lost=new Promise(h=>{this._resolveContextLost=h});let s=n.gl||null;if(s||(s=OD(this.canvasContext.canvas,{...n,onContextLost:h=>{var d;return(d=this._resolveContextLost)==null?void 0:d.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,n.spector&&(this.spectorJS=vF({...this.props,canvas:this.handle.canvas})),this.info=DD(this.gl,this._extensions),this.limits=new tF(this.gl),this.features=new eF(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;k1(this.gl,{enable:o,copyState:a,log:(...h)=>Y.log(1,...h)()}),n.debug&&(this.gl=AF(this.gl,{...n,throwOnError:!0}),this.debug=!0,Y.level=Math.max(Y.level,1),Y.warn("WebGL debug mode activated. Performance reduced.")())}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof ss)return n;if((n==null?void 0:n.device)instanceof qo)return n.device;if(!v4(n))throw new Error("Invalid WebGL2RenderingContext");return new ss({gl:n})}static async create(n={}){var a;Y.groupCollapsed(Ya,"WebGLDevice created")();const r=[];n.debug&&r.push(wF()),n.spector&&r.push(TF()),typeof n.canvas=="string"&&r.push(Nm.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&Y.error(`Failed to initialize debug libraries ${l.reason}`)();if(Y.probe(Ya+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return Y.warn("reattaching existing device")(),ss.attach(n.gl);const s=new ss(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Y.probe(Ya,o)(),Y.table(Ya,s.info)(),Y.groupEnd(Ya)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Lm(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return QD(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return ZD(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new Ei(this,r)}_createTexture(n){return new Jn(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Qg(this,n)}createShader(n){return new PF(this,n)}createFramebuffer(n){return new Tl(this,n)}createVertexArray(n){return new zm(this,n)}createTransformFeedback(n){return new l4(this,n)}createQuerySet(n){return new c4(this,n)}createRenderPipeline(n){return new GF(this,n)}beginRenderPass(n){return new OF(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new s4(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return h4(n,r)}readPixelsToBufferWebGL(n,r){return f4(n,r)}setParametersWebGL(n){da(this.gl,n)}getParametersWebGL(n){return N1(this.gl,n)}withParametersWebGL(n,r){return hi(this.gl,n,r)}clearWebGL(n){T4(this,n)}resetWebGL(){Y.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),ID(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Lf(this.gl)}popState(){Jl(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&S4(s,r)&&Y.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:E4(this,n,r);break;case Int32Array:w4(this,n,r);break;case Uint32Array:A4(this,n,r);break;default:Pe(!1)}}getExtension(n){return Pi(this.gl,n,this._extensions),this._extensions}};T(ss,"type","webgl");let El=ss;function v4(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function E4(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:Pe(!1)}}function w4(t,e,n){t.gl.vertexAttribI4iv(e,n)}function A4(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function S4(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var $1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,u=Math.abs,h=Date.now;function d(y,R,M){return setTimeout(b(y,M),R)}function p(y,R,M){return Array.isArray(y)?(_(y,M[R],M),!0):!1}function _(y,R,M){var W;if(y)if(y.forEach)y.forEach(R,M);else if(y.length!==i)for(W=0;W<y.length;)R.call(M,y[W],W,y),W++;else for(W in y)y.hasOwnProperty(W)&&R.call(M,y[W],W,y)}function A(y,R,M){var W="DEPRECATED METHOD: "+R+`
`+M+` AT 
`;return function(){var X=new Error("get-stack-trace"),G=X&&X.stack?X.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ue=e.console&&(e.console.warn||e.console.log);return ue&&ue.call(e.console,W,G),y.apply(this,arguments)}}var S;typeof Object.assign!="function"?S=function(R){if(R===i||R===null)throw new TypeError("Cannot convert undefined or null to object");for(var M=Object(R),W=1;W<arguments.length;W++){var X=arguments[W];if(X!==i&&X!==null)for(var G in X)X.hasOwnProperty(G)&&(M[G]=X[G])}return M}:S=Object.assign;var k=A(function(R,M,W){for(var X=Object.keys(M),G=0;G<X.length;)(!W||W&&R[X[G]]===i)&&(R[X[G]]=M[X[G]]),G++;return R},"extend","Use `assign`."),v=A(function(R,M){return k(R,M,!0)},"merge","Use `assign`.");function m(y,R,M){var W=R.prototype,X;X=y.prototype=Object.create(W),X.constructor=y,X._super=W,M&&S(X,M)}function b(y,R){return function(){return y.apply(R,arguments)}}function D(y,R){return typeof y==a?y.apply(R&&R[0]||i,R):y}function V(y,R){return y===i?R:y}function j(y,R,M){_(x(R),function(W){y.addEventListener(W,M,!1)})}function P(y,R,M){_(x(R),function(W){y.removeEventListener(W,M,!1)})}function E(y,R){for(;y;){if(y==R)return!0;y=y.parentNode}return!1}function C(y,R){return y.indexOf(R)>-1}function x(y){return y.trim().split(/\s+/g)}function O(y,R,M){if(y.indexOf&&!M)return y.indexOf(R);for(var W=0;W<y.length;){if(M&&y[W][M]==R||!M&&y[W]===R)return W;W++}return-1}function F(y){return Array.prototype.slice.call(y,0)}function N(y,R,M){for(var W=[],X=[],G=0;G<y.length;){var ue=y[G][R];O(X,ue)<0&&W.push(y[G]),X[G]=ue,G++}return W=W.sort(function(nt,Xe){return nt[R]>Xe[R]}),W}function oe(y,R){for(var M,W,X=R[0].toUpperCase()+R.slice(1),G=0;G<s.length;){if(M=s[G],W=M?M+X:R,W in y)return W;G++}return i}var ct=1;function Vi(){return ct++}function un(y){var R=y.ownerDocument||y;return R.defaultView||R.parentWindow||e}var J=/mobile|tablet|ip(ad|hone|od)|android/i,ie="ontouchstart"in e,ce=oe(e,"PointerEvent")!==i,xe=ie&&J.test(navigator.userAgent),_e="touch",Ue="pen",Jt="mouse",Rn="kinect",bn=25,Ne=1,cr=2,je=4,tt=8,ur=1,hr=2,fr=4,dr=8,pr=16,Gt=hr|fr,gr=dr|pr,bc=Gt|gr,Ta=["x","y"],zr=["clientX","clientY"];function Ut(y,R){var M=this;this.manager=y,this.callback=R,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(W){D(y.options.enable,[y])&&M.handler(W)},this.init()}Ut.prototype={handler:function(){},init:function(){this.evEl&&j(this.element,this.evEl,this.domHandler),this.evTarget&&j(this.target,this.evTarget,this.domHandler),this.evWin&&j(un(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(un(this.element),this.evWin,this.domHandler)}};function ld(y){var R,M=y.options.inputClass;return M?R=M:ce?R=zi:xe?R=Wi:ie?R=ba:R=jr,new R(y,va)}function va(y,R,M){var W=M.pointers.length,X=M.changedPointers.length,G=R&Ne&&W-X===0,ue=R&(je|tt)&&W-X===0;M.isFirst=!!G,M.isFinal=!!ue,G&&(y.session={}),M.eventType=R,Ea(y,M),y.emit("hammer.input",M),y.recognize(M),y.session.prevInput=M}function Ea(y,R){var M=y.session,W=R.pointers,X=W.length;M.firstInput||(M.firstInput=ht(R)),X>1&&!M.firstMultiple?M.firstMultiple=ht(R):X===1&&(M.firstMultiple=!1);var G=M.firstInput,ue=M.firstMultiple,Qe=ue?ue.center:G.center,nt=R.center=Li(W);R.timeStamp=h(),R.deltaTime=R.timeStamp-G.timeStamp,R.angle=_r(Qe,nt),R.distance=Vs(Qe,nt),Ic(M,R),R.offsetDirection=Aa(R.deltaX,R.deltaY);var Xe=wa(R.deltaTime,R.deltaX,R.deltaY);R.overallVelocityX=Xe.x,R.overallVelocityY=Xe.y,R.overallVelocity=u(Xe.x)>u(Xe.y)?Xe.x:Xe.y,R.scale=ue?Pc(ue.pointers,W):1,R.rotation=ue?Cc(ue.pointers,W):0,R.maxPointers=M.prevInput?R.pointers.length>M.prevInput.maxPointers?R.pointers.length:M.prevInput.maxPointers:R.pointers.length,ut(M,R);var rt=y.element;E(R.srcEvent.target,rt)&&(rt=R.srcEvent.target),R.target=rt}function Ic(y,R){var M=R.center,W=y.offsetDelta||{},X=y.prevDelta||{},G=y.prevInput||{};(R.eventType===Ne||G.eventType===je)&&(X=y.prevDelta={x:G.deltaX||0,y:G.deltaY||0},W=y.offsetDelta={x:M.x,y:M.y}),R.deltaX=X.x+(M.x-W.x),R.deltaY=X.y+(M.y-W.y)}function ut(y,R){var M=y.lastInterval||R,W=R.timeStamp-M.timeStamp,X,G,ue,Qe;if(R.eventType!=tt&&(W>bn||M.velocity===i)){var nt=R.deltaX-M.deltaX,Xe=R.deltaY-M.deltaY,rt=wa(W,nt,Xe);G=rt.x,ue=rt.y,X=u(rt.x)>u(rt.y)?rt.x:rt.y,Qe=Aa(nt,Xe),y.lastInterval=R}else X=M.velocity,G=M.velocityX,ue=M.velocityY,Qe=M.direction;R.velocity=X,R.velocityX=G,R.velocityY=ue,R.direction=Qe}function ht(y){for(var R=[],M=0;M<y.pointers.length;)R[M]={clientX:l(y.pointers[M].clientX),clientY:l(y.pointers[M].clientY)},M++;return{timeStamp:h(),pointers:R,center:Li(R),deltaX:y.deltaX,deltaY:y.deltaY}}function Li(y){var R=y.length;if(R===1)return{x:l(y[0].clientX),y:l(y[0].clientY)};for(var M=0,W=0,X=0;X<R;)M+=y[X].clientX,W+=y[X].clientY,X++;return{x:l(M/R),y:l(W/R)}}function wa(y,R,M){return{x:R/y||0,y:M/y||0}}function Aa(y,R){return y===R?ur:u(y)>=u(R)?y<0?hr:fr:R<0?dr:pr}function Vs(y,R,M){M||(M=Ta);var W=R[M[0]]-y[M[0]],X=R[M[1]]-y[M[1]];return Math.sqrt(W*W+X*X)}function _r(y,R,M){M||(M=Ta);var W=R[M[0]]-y[M[0]],X=R[M[1]]-y[M[1]];return Math.atan2(X,W)*180/Math.PI}function Cc(y,R){return _r(R[1],R[0],zr)+_r(y[1],y[0],zr)}function Pc(y,R){return Vs(R[0],R[1],zr)/Vs(y[0],y[1],zr)}var Sa={mousedown:Ne,mousemove:cr,mouseup:je},cd="mousedown",ud="mousemove mouseup";function jr(){this.evEl=cd,this.evWin=ud,this.pressed=!1,Ut.apply(this,arguments)}m(jr,Ut,{handler:function(R){var M=Sa[R.type];M&Ne&&R.button===0&&(this.pressed=!0),M&cr&&R.which!==1&&(M=je),this.pressed&&(M&je&&(this.pressed=!1),this.callback(this.manager,M,{pointers:[R],changedPointers:[R],pointerType:Jt,srcEvent:R}))}});var xc={pointerdown:Ne,pointermove:cr,pointerup:je,pointercancel:tt,pointerout:tt},Nc={2:_e,3:Ue,4:Jt,5:Rn},Wr="pointerdown",Ls="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Wr="MSPointerDown",Ls="MSPointerMove MSPointerUp MSPointerCancel");function zi(){this.evEl=Wr,this.evWin=Ls,Ut.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(zi,Ut,{handler:function(R){var M=this.store,W=!1,X=R.type.toLowerCase().replace("ms",""),G=xc[X],ue=Nc[R.pointerType]||R.pointerType,Qe=ue==_e,nt=O(M,R.pointerId,"pointerId");G&Ne&&(R.button===0||Qe)?nt<0&&(M.push(R),nt=M.length-1):G&(je|tt)&&(W=!0),!(nt<0)&&(M[nt]=R,this.callback(this.manager,G,{pointers:M,changedPointers:[R],pointerType:ue,srcEvent:R}),W&&M.splice(nt,1))}});var mr={touchstart:Ne,touchmove:cr,touchend:je,touchcancel:tt},kc="touchstart",zs="touchstart touchmove touchend touchcancel";function Ra(){this.evTarget=kc,this.evWin=zs,this.started=!1,Ut.apply(this,arguments)}m(Ra,Ut,{handler:function(R){var M=mr[R.type];if(M===Ne&&(this.started=!0),!!this.started){var W=ji.call(this,R,M);M&(je|tt)&&W[0].length-W[1].length===0&&(this.started=!1),this.callback(this.manager,M,{pointers:W[0],changedPointers:W[1],pointerType:_e,srcEvent:R})}}});function ji(y,R){var M=F(y.touches),W=F(y.changedTouches);return R&(je|tt)&&(M=N(M.concat(W),"identifier")),[M,W]}var Mc={touchstart:Ne,touchmove:cr,touchend:je,touchcancel:tt},mt="touchstart touchmove touchend touchcancel";function Wi(){this.evTarget=mt,this.targetIds={},Ut.apply(this,arguments)}m(Wi,Ut,{handler:function(R){var M=Mc[R.type],W=$i.call(this,R,M);W&&this.callback(this.manager,M,{pointers:W[0],changedPointers:W[1],pointerType:_e,srcEvent:R})}});function $i(y,R){var M=F(y.touches),W=this.targetIds;if(R&(Ne|cr)&&M.length===1)return W[M[0].identifier]=!0,[M,M];var X,G,ue=F(y.changedTouches),Qe=[],nt=this.target;if(G=M.filter(function(Xe){return E(Xe.target,nt)}),R===Ne)for(X=0;X<G.length;)W[G[X].identifier]=!0,X++;for(X=0;X<ue.length;)W[ue[X].identifier]&&Qe.push(ue[X]),R&(je|tt)&&delete W[ue[X].identifier],X++;if(Qe.length)return[N(G.concat(Qe),"identifier"),Qe]}var Hi=2500,Oc=25;function ba(){Ut.apply(this,arguments);var y=b(this.handler,this);this.touch=new Wi(this.manager,y),this.mouse=new jr(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}m(ba,Ut,{handler:function(R,M,W){var X=W.pointerType==_e,G=W.pointerType==Jt;if(!(G&&W.sourceCapabilities&&W.sourceCapabilities.firesTouchEvents)){if(X)$r.call(this,M,W);else if(G&&hd.call(this,W))return;this.callback(R,M,W)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function $r(y,R){y&Ne?(this.primaryTouch=R.changedPointers[0].identifier,Dc.call(this,R)):y&(je|tt)&&Dc.call(this,R)}function Dc(y){var R=y.changedPointers[0];if(R.identifier===this.primaryTouch){var M={x:R.clientX,y:R.clientY};this.lastTouches.push(M);var W=this.lastTouches,X=function(){var G=W.indexOf(M);G>-1&&W.splice(G,1)};setTimeout(X,Hi)}}function hd(y){for(var R=y.srcEvent.clientX,M=y.srcEvent.clientY,W=0;W<this.lastTouches.length;W++){var X=this.lastTouches[W],G=Math.abs(R-X.x),ue=Math.abs(M-X.y);if(G<=Oc&&ue<=Oc)return!0}return!1}var Xi=oe(o.style,"touchAction"),Ia=Xi!==i,js="compute",qi="auto",hn="manipulation",Vn="none",Hr="pan-x",yr="pan-y",Xr=fd();function Ws(y,R){this.manager=y,this.set(R)}Ws.prototype={set:function(y){y==js&&(y=this.compute()),Ia&&this.manager.element.style&&Xr[y]&&(this.manager.element.style[Xi]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return _(this.manager.recognizers,function(R){D(R.options.enable,[R])&&(y=y.concat(R.getTouchAction()))}),Fc(y.join(" "))},preventDefaults:function(y){var R=y.srcEvent,M=y.offsetDirection;if(this.manager.session.prevented){R.preventDefault();return}var W=this.actions,X=C(W,Vn)&&!Xr[Vn],G=C(W,yr)&&!Xr[yr],ue=C(W,Hr)&&!Xr[Hr];if(X){var Qe=y.pointers.length===1,nt=y.distance<2,Xe=y.deltaTime<250;if(Qe&&nt&&Xe)return}if(!(ue&&G)&&(X||G&&M&Gt||ue&&M&gr))return this.preventSrc(R)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function Fc(y){if(C(y,Vn))return Vn;var R=C(y,Hr),M=C(y,yr);return R&&M?Vn:R||M?R?Hr:yr:C(y,hn)?hn:qi}function fd(){if(!Ia)return!1;var y={},R=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(M){y[M]=R?e.CSS.supports("touch-action",M):!0}),y}var Tr=1,Bt=2,Ln=4,Ht=8,yt=Ht,vr=16,fn=32;function dn(y){this.options=S({},this.defaults,y||{}),this.id=Vi(),this.manager=null,this.options.enable=V(this.options.enable,!0),this.state=Tr,this.simultaneous={},this.requireFail=[]}dn.prototype={defaults:{},set:function(y){return S(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(p(y,"recognizeWith",this))return this;var R=this.simultaneous;return y=qr(y,this),R[y.id]||(R[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return p(y,"dropRecognizeWith",this)?this:(y=qr(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(p(y,"requireFailure",this))return this;var R=this.requireFail;return y=qr(y,this),O(R,y)===-1&&(R.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(p(y,"dropRequireFailure",this))return this;y=qr(y,this);var R=O(this.requireFail,y);return R>-1&&this.requireFail.splice(R,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var R=this,M=this.state;function W(X){R.manager.emit(X,y)}M<Ht&&W(R.options.event+Ca(M)),W(R.options.event),y.additionalEvent&&W(y.additionalEvent),M>=Ht&&W(R.options.event+Ca(M))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=fn},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(fn|Tr)))return!1;y++}return!0},recognize:function(y){var R=S({},y);if(!D(this.options.enable,[this,R])){this.reset(),this.state=fn;return}this.state&(yt|vr|fn)&&(this.state=Tr),this.state=this.process(R),this.state&(Bt|Ln|Ht|vr)&&this.tryEmit(R)},process:function(y){},getTouchAction:function(){},reset:function(){}};function Ca(y){return y&vr?"cancel":y&Ht?"end":y&Ln?"move":y&Bt?"start":""}function Pa(y){return y==pr?"down":y==dr?"up":y==hr?"left":y==fr?"right":""}function qr(y,R){var M=R.manager;return M?M.get(y):y}function Vt(){dn.apply(this,arguments)}m(Vt,dn,{defaults:{pointers:1},attrTest:function(y){var R=this.options.pointers;return R===0||y.pointers.length===R},process:function(y){var R=this.state,M=y.eventType,W=R&(Bt|Ln),X=this.attrTest(y);return W&&(M&tt||!X)?R|vr:W||X?M&je?R|Ht:R&Bt?R|Ln:Bt:fn}});function Ki(){Vt.apply(this,arguments),this.pX=null,this.pY=null}m(Ki,Vt,{defaults:{event:"pan",threshold:10,pointers:1,direction:bc},getTouchAction:function(){var y=this.options.direction,R=[];return y&Gt&&R.push(yr),y&gr&&R.push(Hr),R},directionTest:function(y){var R=this.options,M=!0,W=y.distance,X=y.direction,G=y.deltaX,ue=y.deltaY;return X&R.direction||(R.direction&Gt?(X=G===0?ur:G<0?hr:fr,M=G!=this.pX,W=Math.abs(y.deltaX)):(X=ue===0?ur:ue<0?dr:pr,M=ue!=this.pY,W=Math.abs(y.deltaY))),y.direction=X,M&&W>R.threshold&&X&R.direction},attrTest:function(y){return Vt.prototype.attrTest.call(this,y)&&(this.state&Bt||!(this.state&Bt)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var R=Pa(y.direction);R&&(y.additionalEvent=this.options.event+R),this._super.emit.call(this,y)}});function $s(){Vt.apply(this,arguments)}m($s,Vt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Vn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&Bt)},emit:function(y){if(y.scale!==1){var R=y.scale<1?"in":"out";y.additionalEvent=this.options.event+R}this._super.emit.call(this,y)}});function xa(){dn.apply(this,arguments),this._timer=null,this._input=null}m(xa,dn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[qi]},process:function(y){var R=this.options,M=y.pointers.length===R.pointers,W=y.distance<R.threshold,X=y.deltaTime>R.time;if(this._input=y,!W||!M||y.eventType&(je|tt)&&!X)this.reset();else if(y.eventType&Ne)this.reset(),this._timer=d(function(){this.state=yt,this.tryEmit()},R.time,this);else if(y.eventType&je)return yt;return fn},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===yt&&(y&&y.eventType&je?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=h(),this.manager.emit(this.options.event,this._input)))}});function Na(){Vt.apply(this,arguments)}m(Na,Vt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Vn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&Bt)}});function Hs(){Vt.apply(this,arguments)}m(Hs,Vt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Gt|gr,pointers:1},getTouchAction:function(){return Ki.prototype.getTouchAction.call(this)},attrTest:function(y){var R=this.options.direction,M;return R&(Gt|gr)?M=y.overallVelocity:R&Gt?M=y.overallVelocityX:R&gr&&(M=y.overallVelocityY),this._super.attrTest.call(this,y)&&R&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&u(M)>this.options.velocity&&y.eventType&je},emit:function(y){var R=Pa(y.offsetDirection);R&&this.manager.emit(this.options.event+R,y),this.manager.emit(this.options.event,y)}});function Yi(){dn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Yi,dn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hn]},process:function(y){var R=this.options,M=y.pointers.length===R.pointers,W=y.distance<R.threshold,X=y.deltaTime<R.time;if(this.reset(),y.eventType&Ne&&this.count===0)return this.failTimeout();if(W&&X&&M){if(y.eventType!=je)return this.failTimeout();var G=this.pTime?y.timeStamp-this.pTime<R.interval:!0,ue=!this.pCenter||Vs(this.pCenter,y.center)<R.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!ue||!G?this.count=1:this.count+=1,this._input=y;var Qe=this.count%R.taps;if(Qe===0)return this.hasRequireFailures()?(this._timer=d(function(){this.state=yt,this.tryEmit()},R.interval,this),Bt):yt}return fn},failTimeout:function(){return this._timer=d(function(){this.state=fn},this.options.interval,this),fn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==yt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function zn(y,R){return R=R||{},R.recognizers=V(R.recognizers,zn.defaults.preset),new Kr(y,R)}zn.VERSION="2.0.7",zn.defaults={domEvents:!1,touchAction:js,enable:!0,inputTarget:null,inputClass:null,preset:[[Na,{enable:!1}],[$s,{enable:!1},["rotate"]],[Hs,{direction:Gt}],[Ki,{direction:Gt},["swipe"]],[Yi],[Yi,{event:"doubletap",taps:2},["tap"]],[xa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Er=1,pn=2;function Kr(y,R){this.options=S({},zn.defaults,R||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=ld(this),this.touchAction=new Ws(this,this.options.touchAction),Qi(this,!0),_(this.options.recognizers,function(M){var W=this.add(new M[0](M[1]));M[2]&&W.recognizeWith(M[2]),M[3]&&W.requireFailure(M[3])},this)}Kr.prototype={set:function(y){return S(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?pn:Er},recognize:function(y){var R=this.session;if(!R.stopped){this.touchAction.preventDefaults(y);var M,W=this.recognizers,X=R.curRecognizer;(!X||X&&X.state&yt)&&(X=R.curRecognizer=null);for(var G=0;G<W.length;)M=W[G],R.stopped!==pn&&(!X||M==X||M.canRecognizeWith(X))?M.recognize(y):M.reset(),!X&&M.state&(Bt|Ln|Ht)&&(X=R.curRecognizer=M),G++}},get:function(y){if(y instanceof dn)return y;for(var R=this.recognizers,M=0;M<R.length;M++)if(R[M].options.event==y)return R[M];return null},add:function(y){if(p(y,"add",this))return this;var R=this.get(y.options.event);return R&&this.remove(R),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(p(y,"remove",this))return this;if(y=this.get(y),y){var R=this.recognizers,M=O(R,y);M!==-1&&(R.splice(M,1),this.touchAction.update())}return this},on:function(y,R){if(y!==i&&R!==i){var M=this.handlers;return _(x(y),function(W){M[W]=M[W]||[],M[W].push(R)}),this}},off:function(y,R){if(y!==i){var M=this.handlers;return _(x(y),function(W){R?M[W]&&M[W].splice(O(M[W],R),1):delete M[W]}),this}},emit:function(y,R){this.options.domEvents&&Uc(y,R);var M=this.handlers[y]&&this.handlers[y].slice();if(!(!M||!M.length)){R.type=y,R.preventDefault=function(){R.srcEvent.preventDefault()};for(var W=0;W<M.length;)M[W](R),W++}},destroy:function(){this.element&&Qi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qi(y,R){var M=y.element;if(M.style){var W;_(y.options.cssProps,function(X,G){W=oe(M.style,G),R?(y.oldCssProps[W]=M.style[W],M.style[W]=X):M.style[W]=y.oldCssProps[W]||""}),R||(y.oldCssProps={})}}function Uc(y,R){var M=n.createEvent("Event");M.initEvent(y,!0,!0),M.gesture=R,R.target.dispatchEvent(M)}S(zn,{INPUT_START:Ne,INPUT_MOVE:cr,INPUT_END:je,INPUT_CANCEL:tt,STATE_POSSIBLE:Tr,STATE_BEGAN:Bt,STATE_CHANGED:Ln,STATE_ENDED:Ht,STATE_RECOGNIZED:yt,STATE_CANCELLED:vr,STATE_FAILED:fn,DIRECTION_NONE:ur,DIRECTION_LEFT:hr,DIRECTION_RIGHT:fr,DIRECTION_UP:dr,DIRECTION_DOWN:pr,DIRECTION_HORIZONTAL:Gt,DIRECTION_VERTICAL:gr,DIRECTION_ALL:bc,Manager:Kr,Input:Ut,TouchAction:Ws,TouchInput:Wi,MouseInput:jr,PointerEventInput:zi,TouchMouseInput:ba,SingleTouchInput:Ra,Recognizer:dn,AttrRecognizer:Vt,Tap:Yi,Pan:Ki,Swipe:Hs,Pinch:$s,Rotate:Na,Press:xa,on:j,off:P,each:_,merge:v,extend:k,assign:S,inherit:m,bindFn:b,prefixed:oe});var Re=typeof e<"u"?e:typeof self<"u"?self:{};Re.Hammer=zn,t.exports?t.exports=zn:e[r]=zn})(window,document,"Hammer")})($1);var vc=$1.exports;const R4=Zb(vc),Xn=Qb({__proto__:null,default:R4},[vc]),H1=1,X1=2,Jg=4,b4={mousedown:H1,mousemove:X1,mouseup:Jg};function I4(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function C4(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(I4(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function P4(t){t.prototype.handler=function(n){let r=b4[n.type];r&H1&&n.button>=0&&(this.pressed=!0),r&X1&&n.buttons===0&&(r=Jg),this.pressed&&(r&Jg&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}C4(vc.PointerEventInput);P4(vc.MouseInput);const x4=vc.Manager;class jf{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const N4=Xn?[[Xn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Xn.Rotate,{enable:!1}],[Xn.Pinch,{enable:!1}],[Xn.Swipe,{enable:!1}],[Xn.Pan,{threshold:0,enable:!1}],[Xn.Press,{enable:!1}],[Xn.Tap,{event:"doubletap",taps:2,enable:!1}],[Xn.Tap,{event:"anytap",enable:!1}],[Xn.Tap,{enable:!1}]]:null,S0={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},k4={doubletap:["tap"]},M4={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},jm={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},O4={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},R0={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},D4=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",bo=typeof window<"u"?window:global;let Gg=!1;try{const t={get passive(){return Gg=!0,!0}};bo.addEventListener("test",null,t),bo.removeEventListener("test",null)}catch{Gg=!1}const F4=D4.indexOf("firefox")!==-1,{WHEEL_EVENTS:U4}=jm,b0="wheel",I0=4.000244140625,B4=40,V4=.25;class L4 extends jf{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;bo.WheelEvent&&(F4&&i.deltaMode===bo.WheelEvent.DOM_DELTA_PIXEL&&(s/=bo.devicePixelRatio),i.deltaMode===bo.WheelEvent.DOM_DELTA_LINE&&(s*=B4)),s!==0&&s%I0===0&&(s=Math.floor(s/I0)),i.shiftKey&&s&&(s=s*V4),this.callback({type:b0,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(U4),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Gg?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===b0&&(this.options.enable=n)}}const{MOUSE_EVENTS:z4}=jm,C0="pointermove",P0="pointerover",x0="pointerout",N0="pointerenter",k0="pointerleave";class j4 extends jf{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(z4),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===C0&&(this.enableMoveEvent=n),e===P0&&(this.enableOverEvent=n),e===x0&&(this.enableOutEvent=n),e===N0&&(this.enableEnterEvent=n),e===k0&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(P0,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(x0,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(N0,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(k0,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(C0,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:W4}=jm,M0="keydown",O0="keyup";class $4 extends jf{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:M0,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:O0,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(W4),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===M0&&(this.enableDownEvent=n),e===O0&&(this.enableUpEvent=n)}}const D0="contextmenu";class H4 extends jf{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:D0,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===D0&&(this.options.enable=n)}}const F0=1,e_=2,U0=4,X4={pointerdown:F0,pointermove:e_,pointerup:U0,mousedown:F0,mousemove:e_,mouseup:U0},q4=0,K4=1,Y4=2,Q4=1,Z4=2,J4=4;function G4(t){const e=X4[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===e_?(i=!!(n&Q4),s=!!(n&J4),o=!!(n&Z4)):(i=r===q4,s=r===K4,o=r===Y4),{leftButton:i,middleButton:s,rightButton:o}}function eU(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const mp={srcElement:"root",priority:0};class tU{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=mp;typeof r=="string"||r&&r.addEventListener?l={...mp,srcElement:r}:r&&(l={...mp,...r});let u=a.get(l.srcElement);u||(u=[],a.set(l.srcElement,u));const h={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(h.once=!0),s&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let d=u.length-1;for(;d>=0&&!(u[d].priority>=h.priority);)d--;u.splice(d+1,0,h)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:u,handler:h,once:d}=r[l];if(h({...e,type:u,stopPropagation:s,stopImmediatePropagation:o}),d&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:u,handler:h}=a[l];this.remove(u,h)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...G4(e),...eU(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const nU={events:null,recognizers:null,recognizerOptions:{},Manager:x4,touchAction:"none",tabIndex:0};class rU{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=M4[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...nU,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||N4}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(S0).forEach(i=>{const s=this.manager.get(i);s&&S0[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new L4(e,this._onOtherEvent,{enable:!1}),this.moveInput=new j4(e,this._onOtherEvent,{enable:!1}),this.keyInput=new $4(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new H4(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=k4[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const h in e)this._addEventHandler(h,e[h],r,i,s);return}const{manager:o,events:a}=this,l=R0[e]||e;let u=a.get(l);u||(u=new tU(this),a.set(l,u),u.recognizerName=O4[l]||l,o&&o.on(l,u.handleEvent)),u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=R0[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ei(){}const iU=({isDragging:t})=>t?"grabbing":"grab",q1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ei,onWebGLInitialized:ei,onResize:ei,onViewStateChange:ei,onInteractionStateChange:ei,onBeforeRender:ei,onAfterRender:ei,onLoad:ei,onError:t=>Ce.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:iU,getTooltip:null,debug:!1,drawPickingColors:!1};class Wm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Df({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=jg[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,u=l&&(l[i.handler]||l.props[i.handler]),h=this.props[i.handler];let d=!1;u&&(d=u.call(l,a,r)),d||(h==null||h(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...q1,...e},e=this.props,e.viewState&&e.initialViewState&&Ce.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&Ce.error("WebGL1 context not supported.")(),this.device=El.attach(e.gl));let n=this.device;n||(Oo.registerDevices([El]),n=Oo.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Yl.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,u,h;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(u=this.widgetManager)==null||u.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((h=this.canvas.parentElement)==null||h.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ce.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ce.removed("onLayerClick","onClick")(),e.initialViewState&&!Mn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ot(this.viewManager),this.viewManager.views}getViewports(e){return Ot(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Ot(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ot(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new CO({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new C1({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const u of s)a=u,l=((n=u.layer)==null?void 0:n.onHover(u,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof El&&this.props.onWebGLInitialized(this.device.gl);const n=new A1;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new rU(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in jg)this.eventManager.on(o,this._onEvent);this.viewManager=new qO({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new XO(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new cD({deck:this,device:this.device}),this.deckRenderer=new fD(this.device),this.deckPicker=new yD(this.device),this.widgetManager=new ED({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new AD),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ce.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Oo.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}Wm.defaultProps=q1;Wm.VERSION=H3;function sU(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return YS(t)}}const oU=KS;function wu(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function hs(t){return t.stride||t.size*t.bytesPerElement}function aU(t,e){return t.type===e.type&&t.size===e.size&&hs(t)===hs(e)&&(t.offset||0)===(e.offset||0)}function t_(t,e){e.offset&&Ce.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=hs(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function lU(t,e){const n=t_(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class cU{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=sU(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*hs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Yl.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=t_(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:hs(r),attributes:i};if(this.doublePrecision){const o=lU(r,n||{});i.push(wu(e,{...r,...o.high}),wu(`${e}64Low`,{...r,...o.low}))}else if(n){const o=t_(r,n);i.push(wu(e,{...r,...o}))}else i.push(wu(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let u=0;u<i;u++){const h=n[l++];h<o[u]&&(o[u]=h),h>a[u]&&(a[u]=h)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Ye?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=oU(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=hs(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=hs(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=ip(s,i)),this.settings.isIndexed){const h=this.settings.defaultType;s.constructor!==h&&(s=new h(s))}const u=s.byteLength+l+a*2;(!o||o.byteLength<u)&&(o=this._createBuffer(u)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?ip(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Yl.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?ip(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Ce.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?Ye.INDEX:Ye.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const B0=[],V0=[];function uU(t,e=0,n=1/0){let r=B0;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(V0.length=t.length,r=V0):r=B0,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function K1(t){return t&&t[Symbol.asyncIterator]}function hU(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,u=i?i/a:0,h=Math.floor((t.length-u)/l);return(d,{index:p,target:_})=>{if(!s){const v=p*l+u;for(let m=0;m<n;m++)_[m]=t[v+m];return _}const A=s[p],S=s[p+1]||h;let k;if(o){k=new Array(S-A);for(let v=A;v<S;v++){const m=v*l+u;_=new Array(n);for(let b=0;b<n;b++)_[b]=t[m+b];k[v-A]=_}}else if(l===n)k=t.subarray(A*n+u,S*n+u);else{k=new t.constructor((S-A)*n);let v=0;for(let m=A;m<S;m++){const b=m*l+u;for(let D=0;D<n;D++)k[v++]=t[b+D]}}return k}}const fU=[],Wu=[[0,1/0]];function dU(t,e){if(t===Wu||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const pU={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Y1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...pU[n],...e,...t,type:n}}class Q1 extends cU{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Wu}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!aU(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return Y1(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=dU(this.state.updateRanges,[r,i])}else this.state.updateRanges=Wu}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=fU}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Wu),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[u,h]of s)o.call(i,this,{data:n,startRow:u,endRow:h,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[u,h]of s){const d=Number.isFinite(u)?this.getVertexOffset(u):0,p=Number.isFinite(h)?this.getVertexOffset(h):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:d,endOffset:p})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ot(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=hU(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:u,size:h,startIndices:d}=e,{accessor:p,transform:_}=a,A=l.binaryAccessor||(typeof p=="function"?p:s[p]);Ot(typeof A=="function",`accessor "${p}" is not a function`);let S=e.getVertexOffset(r);const{iterable:k,objectInfo:v}=uU(n,r,i);for(const m of k){v.index++;let b=A(m,v);if(_&&(b=_.call(this,b)),d){const D=(v.index<d.length-1?d[v.index+1]:o)-d[v.index];if(b&&Array.isArray(b[0])){let V=S;for(const j of b)e._normalizeValue(j,u,V),V+=h}else b&&b.length>h?u.set(b,S):(e._normalizeValue(b,v.target,0),zO({target:u,source:v.target,start:S,count:D}));S+=D*h}else e._normalizeValue(b,u,S),S+=h}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function yp(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let u=a;for(;u<l;){const h=s(u,e);for(let d=0;d<i;d++)n[r+u]=h[d]||0,u++}}function gU({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return yp({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((h,d)=>r(h+a,d)),u=Math.min(i.length,s.length);for(let h=1;h<u;h++){const d=i[h]*n,p=s[h]*n;yp({source:t.subarray(o,d),target:e,start:a,end:p,size:n,getData:l}),o=d,a=p}return a<e.length&&yp({source:[],target:e,start:a,size:n,getData:l}),e}function _U(t){const{device:e,settings:n,value:r}=t,i=new Q1(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function Z1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function J1(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function G1(t){t.push(t.shift())}function mU(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const u of Object.values(l))a=Math.max(a,u.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function eR({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function tR({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,u=n.byteOffset,h=n.settings.bytesPerElement<4?u/n.settings.bytesPerElement*4:u,d=n.startIndices,p=s&&d,_=n.isConstant;if(!p&&e&&r>=i)return e;const A=n.value instanceof Float64Array?Float32Array:n.value.constructor,S=_?n.value:new A(n.getBuffer().readSyncWebGL(u,i*A.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!_){const b=o;o=(D,V)=>n.normalizeConstant(b(D,V))}const k=_?(b,D)=>o(S,D):(b,D)=>o(S.subarray(b+u,b+u+l),D),v=e?new Float32Array(e.readSyncWebGL(h,r*4).buffer):new Float32Array(0),m=new Float32Array(i);return gU({source:v,target:m,sourceStartIndices:s,targetStartIndices:d,size:l,getData:k}),(!e||e.byteLength<m.byteLength+h)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:m.byteLength+h,usage:35050})),e.write(m,h),e}class nR{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Vf(r),this.attribute=n,this.attributeInTransition=_U(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=mU(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class yU extends nR{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=EU(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;G1(s),s[0]=tR({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=eR({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let u=Math.floor(this.currentLength/o.size);rR(o)&&(u/=2),l.setVertexCount(u),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const TU=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`,vU=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function rR(t){return t.doublePrecision&&t.value instanceof Float64Array}function EU(t,e){const n=e.size,r=Z1(n),i=J1(n),s=e.getBufferLayout();return rR(e)?new Zl(t,{vs:vU,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[Tk],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Zl(t,{vs:TU,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class wU extends nR{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=bU(e),this.framebuffer=IU(e,this.texture),this.transform=RU(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=tR({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=eR({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),G1(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const AU=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,SU=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function RU(t,e){const n=Z1(e.size),r=J1(e.size);return new Zl(t,{vs:AU,fs:SU,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function bU(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function IU(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const CU={interpolation:yU,spring:wU};class PU{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=CU[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(Ce.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const L0="attributeManager.invalidate",xU="attributeManager.updateStart",NU="attributeManager.updateEnd",kU="attribute.updateStart",MU="attribute.allocate",OU="attribute.updateEnd";class DU{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=yc(mO),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new PU(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);zt(L0,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);zt(L0,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;zt(xU,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const u in this.attributes){const h=this.attributes[u],d=h.settings.accessor;h.startIndices=r,h.numInstances=n,s[u]&&Ce.removed(`props.${u}`,`data.attributes.${u}`)(),h.setExternalBuffer(o[u])||h.setBinaryValue(typeof d=="string"?o[d]:void 0,e.startIndices)||typeof d=="string"&&!o[d]&&h.setConstantValue(s[d])||h.needsUpdate()&&(l=!0,this._updateAttribute({attribute:h,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}l&&zt(NU,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new Q1(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(zt(kU,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&zt(MU,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,zt(OU,n,r))}}class FU extends Vf{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Oh(n,r,o)}}const z0=1e-5;function j0(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function UU(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=j0(t[o],e[o],n[o],r,i);return s}return j0(t,e,n,r,i)}function W0(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class BU extends Vf{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=UU(s,o,n,r,i);const l=W0(a,n),u=W0(a,o);l<z0&&u<z0&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const VU={interpolation:FU,spring:BU};class LU{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:u=l.settings.fromValue}=l;n=u,this.remove(e)}if(i=Y1(i),!i)return;const o=VU[i.type];if(!o){Ce.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function zU(t){const e=t[ms];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function jU(t,e){const n=iR({newProps:t,oldProps:e,propTypes:t[ms],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=$U(t,e);let i=!1;return r||(i=HU(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:XU(t,e),transitionsChanged:WU(t,e)}}function WU(t,e){if(!t.transitions)return!1;const n={},r=t[ms];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&n_(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function iR({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=n_(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=n_(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function n_(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function $U(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function HU(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&$0(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&$0(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function XU(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function $0(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},iR({oldProps:i,newProps:r,triggerName:n})}const qU="count(): argument not an object",KU="count(): argument not a container";function YU(t){if(!ZU(t))throw new Error(qU);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(QU(t))return Object.keys(t).length;throw new Error(KU)}function QU(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function ZU(t){return t!==null&&typeof t=="object"}function H0(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const JU={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},r_={};function GU(t,e,n,r){if(n instanceof Tn)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...JU,...i,...r}});return r_[s.id]=t,s}function eB(t,e){!e||!(e instanceof Tn)||r_[e.id]===t&&(e.delete(),delete r_[e.id])}const tB={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||i_(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Mn(t,e,1)}},accessor:{validate(t,e){const n=jh(t);return n==="function"||n===jh(e.value)},equal(t,e,n){return typeof e=="function"?!0:Mn(t,e,1)}},array:{validate(t,e){return e.optional&&!t||i_(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mn(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?Mn(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:GU(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{eB(n.id,t)}}};function nB(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=rB(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function rB(t,e){switch(jh(e)){case"object":return Qa(t,e);case"array":return Qa(t,{type:"array",value:e,compare:!1});case"boolean":return Qa(t,{type:"boolean",value:e});case"number":return Qa(t,{type:"number",value:e});case"function":return Qa(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Qa(t,e){return"type"in e?{name:t,...tB[e.type],...e}:"value"in e?{name:t,type:jh(e.value),...e}:{name:t,type:"object",value:e}}function i_(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function jh(t){return i_(t)?"array":t===null?"null":typeof t}function iB(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=s_(t.constructor,n),i=Object.create(r);i[Lh]=t,i[Rs]={},i[ui]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const sB="_mergedDefaultProps";function s_(t,e){if(!(t instanceof Wf.constructor))return{};let n=sB;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=sR(t,n);return r||(t[n]=oB(t,e||[]))}function oB(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=s_(r),s=sR(t,"defaultProps")||{},o=nB(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[ms],o.propTypes),u=Object.assign(Object.create(null),i==null?void 0:i[ap],o.deprecatedProps);for(const h of e){const d=s_(h.constructor);d&&(Object.assign(a,d),Object.assign(l,d[ms]),Object.assign(u,d[ap]))}return aB(a,t),cB(a,l),lB(a,u),a[ms]=l,a[ap]=u,e.length===0&&!$m(t,"_propTypes")&&(t._propTypes=l),a}function aB(t,e){const n=hB(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function lB(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])$m(this,s)||(this[s]=r);Ce.deprecated(i,e[n].join("/"))()}})}function cB(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=uB(o))}t[Uo]=n,t[Rs]={},Object.defineProperties(t,r)}function uB(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||K1(e)?this[Rs][t]=e:this[ui][t]=e},get(){if(this[ui]){if(t in this[ui])return this[ui][t]||this[Uo][t];if(t in this[Rs]){const e=this[Lh]&&this[Lh].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Uo][t]}}return this[Uo][t]}}}function $m(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function sR(t,e){return $m(t,e)&&t[e]}function hB(t){const e=t.componentName;return e||Ce.warn(`${t.name}.componentName not specified`)(),e||t.name}let fB=0,Wf=class{constructor(...e){this.props=iB(this,e),this.id=this.props.id,this.count=fB++}clone(e){const{props:n}=this,r={};for(const i in n[Uo])i in n[ui]?r[i]=n[ui][i]:i in n[Rs]&&(r[i]=n[Rs][i]);return new this.constructor({...n,...r,...e})}};Wf.componentName="Component";Wf.defaultProps={};const dB=Object.freeze({});class pB{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||dB}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Lh]||this.component;const n=e[ui]||{},r=e[Rs]||e,i=e[Uo]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(K1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[ms];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class gB extends pB{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const _B="layer.changeFlag",mB="layer.initialize",yB="layer.update",TB="layer.finalize",vB="layer.matched",X0=2**24-1,EB=Object.freeze([]),wB=yc(({oldViewport:t,viewport:e})=>t.equals(e));let qn=new Uint8ClampedArray(0);const AB={data:{type:"data",value:EB,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Ag(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var u;return(u=n.internalState)==null?void 0:u.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Ag(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ve.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class $f extends Wf{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ro.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ot(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=w1(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=T1(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Ot(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ot(this.internalState);const r=this.internalState.viewport||this.context.viewport;return AO(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ve.DEFAULT||e===ve.LNGLAT||e===ve.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ot(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:YU(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=H0(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=H0(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,u=a||l;u&&(o&&u.constant&&(u.constant=!1,n.invalidate(u.id)),!u.value&&!o&&(u.constant=!0,u.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!wB({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(qn.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>X0&&Ce.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qn=Yl.allocate(qn,n,{size:4,copy:!0,maxCount:Math.max(n,X0)});const i=Math.floor(qn.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),qn[o*4+0]=s[0],qn[o*4+1]=s[1],qn[o*4+2]=s[2]}e.value=qn.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const u=n[l].getValue();for(const h in u){const d=u[h];d instanceof Ye?n[l].settings.isIndexed?e.setIndexBuffer(d):s[h]=d:d&&(o[h]=d)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let u=0;u<n.length;u++){const h=s.getVertexOffset(u);a[h]===l[0]&&a[h+1]===l[1]&&a[h+2]===l[2]&&this._disablePickingIndex(u)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==qn.buffer&&(r.value=qn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ot(!this.internalState),Ot(Number.isFinite(this.props.coordinateSystem)),zt(mB,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new gB({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ce.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new LU(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){zt(vB,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(zt(yB,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const h of this.props.extensions)h.updateState.call(this,a,h);const u=this.getModels()[0]!==l[0];this._postUpdate(a,u)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){zt(TB,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:h,isAttribute:d}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:h,isAttribute:d}})}const{getPolygonOffset:l}=this.props,u=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:u});for(const h of this.getModels())h.setParameters(i);o.device.withParametersWebGL(i,()=>{const h={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const d of this.props.extensions)d.draw.call(this,h,d);this.draw(h)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&zt(_B,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=jU(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){zU(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new DU(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const u={};Array.isArray(l)&&(u.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(u.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:u})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$f.defaultProps=AB;$f.layerName="Layer";const SB=typeof window<"u"?Q.useLayoutEffect:Q.useEffect;function Wh(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const RB={position:"absolute",zIndex:-1};function oR(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>oR(n,e));if(Hf(t)){if(bB(t))return e.style=RB,Q.cloneElement(t,e);if(IB(t))return Q.cloneElement(t,e)}return t}function Hf(t){return t&&typeof t=="object"&&"type"in t||!1}function bB(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function IB(t){const e=t.type;return e&&e.deckGLViewProps}function o_(t){if(typeof t=="function")return Q.createElement(ta,{},t);if(Array.isArray(t))return t.map(o_);if(Hf(t)){if(t.type===Q.Fragment)return o_(t.props.children);if(Wh(t.type,ta))return t}return t}function CB({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return Q.Children.forEach(o_(t),o=>{if(Hf(o)){const a=o.type;if(Wh(a,$f)){const l=PB(a,o.props);i.push(l)}else r.push(o);if(Wh(a,ta)&&a!==ta&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function PB(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function xB({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;Hf(o)&&Wh(o.type,ta)&&(a=o.props.id||s,l=o.props.children);const u=r.getViewport(a),h=r.getViewState(a);if(u){h.padding=u.padding;const{x:d,y:p,width:_,height:A}=u;l=oR(l,{x:d,y:p,width:_,height:A,viewport:u,viewState:h}),i[a]||(i[a]={viewport:u,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:u,y:h,width:d,height:p}=a,_={position:"absolute",left:u,top:h,width:d,height:p},A=`view-${o}`,S=Q.createElement("div",{key:A,id:A,style:_},...l);if(n){const k={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:v=>{v.viewId=o,e._onViewStateChange(v)}};return Q.createElement(n,{key:A,value:k},S)}return S})}const NB={mixBlendMode:null};function kB({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in NB?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function MB(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function aR(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function OB(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():aR(t)}});return r}function DB(t,e){const[n,r]=Q.useState(0),s=Q.useRef({control:null,version:n,forceUpdate:()=>r(V=>V+1)}).current,o=Q.useRef(null),a=Q.useRef(null),l=Q.useMemo(()=>CB(t),[t.layers,t.views,t.children]);let u=!0;const h=V=>{var j;return u&&t.viewState?(s.viewStateUpdateRequested=V,null):(s.viewStateUpdateRequested=null,(j=t.onViewStateChange)==null?void 0:j.call(t,V))},d=V=>{var j;u?s.interactionStateUpdateRequested=V:(s.interactionStateUpdateRequested=null,(j=t.onInteractionStateChange)==null||j.call(t,V))},p=Q.useMemo(()=>{const V={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:h,onInteractionStateChange:d};return delete V._customRender,s.deck&&s.deck.setProps(V),V},[t]);Q.useEffect(()=>{const V=t.Deck||Wm;return s.deck=OB(s,V,{...p,parent:o.current,canvas:a.current}),()=>{var j;return(j=s.deck)==null?void 0:j.finalize()}},[]),SB(()=>{aR(s);const{viewStateUpdateRequested:V,interactionStateUpdateRequested:j}=s;V&&h(V),j&&d(j)}),Q.useImperativeHandle(e,()=>MB(s),[]);const _=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:A,width:S="100%",height:k="100%",id:v,style:m}=t,{containerStyle:b,canvasStyle:D}=Q.useMemo(()=>kB({width:S,height:k,style:m}),[S,k,m]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===_||s.version!==n){s.lastRenderedViewports=_,s.version=n;const V=xB({children:l.children,deck:s.deck,ContextProvider:A}),j=Q.createElement("canvas",{key:"canvas",id:v||"deckgl-overlay",ref:a,style:D});s.control=Q.createElement("div",{id:`${v||"deckgl"}-wrapper`,ref:o,style:b},[j,V])}return u=!1,s.control}const FB=Q.forwardRef(DB),UB="modulepreload",BB=function(t){return"/ar-pile-coordinates/"+t},q0={},VB=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=BB(l),l in q0)return;q0[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":UB,u||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((p,_)=>{d.addEventListener("load",p),d.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},LB=Q.createContext(null);function zB(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function br(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!br(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!br(t[i],e[i]))return!1;return!0}return!1}function jB(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function K0(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();br(n,r)||e.setProjection(n)}function Y0(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Q0(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const WB=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Z0(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of WB)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}var J0={};const G0={version:8,sources:{},layers:[]},eE={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Tp={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},tE={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},$B=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],HB=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class na{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[tE[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[eE[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Tp[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=na.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=G0}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||XB()||null,container:e,style:Z0(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const h=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=h,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=h=>{this._inRender=!0,a.call(o,h),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=h=>{l.call(o._renderTaskQueue,h),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const u=o.fire;o.fire=this._fireEvent.bind(this,u),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),K0(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const h in eE)o.on(h,this._onPointerEvent);for(const h in Tp)o.on(h,this._onCameraEvent);for(const h in tE)o.on(h,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),na.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=jB(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const u=Q0(i,{...Y0(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),u&&n){const h=this._deferredEvents;h.move=!0,h.zoom||(h.zoom=s!==i.zoom),h.rotate||(h.rotate=a!==i.bearing),h.pitch||(h.pitch=o!==i.pitch)}return l||Q0(r.transform,e),u}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of $B)if(s in e&&!br(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=G0,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Z0(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!br(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!br(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!br(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of HB){const l=(r=e[a])!==null&&r!==void 0?r:!0,u=(i=n[a])!==null&&i!==void 0?i:!0;br(l,u)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Tp&&(typeof n=="object"&&(n.viewState=Y0(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{K0(this._renderTransform,n),e.transform=n}}}na.savedMaps=[];function XB(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||J0.MapboxAccessToken}catch{}try{t=t||J0.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const qB=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function KB(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of YB(e))!(r in n)&&!qB.includes(r)&&(n[r]=e[r].bind(e));return n}function YB(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const QB=typeof document<"u"?Q.useLayoutEffect:Q.useEffect,ZB=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function JB(t,e){for(const r of ZB)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const Xf=Q.createContext(null);function GB(t,e,n){const r=Q.useContext(LB),[i,s]=Q.useState(null),o=Q.useRef(),{current:a}=Q.useRef({mapLib:null,map:null});Q.useEffect(()=>{const h=t.mapLib;let d=!0,p;return Promise.resolve(h||n).then(_=>{if(!d)return;if(!_)throw new Error("Invalid mapLib");const A="Map"in _?_:_.default;if(!A.Map)throw new Error("Invalid mapLib");if(JB(A,t),!A.supported||A.supported(t))t.reuseMaps&&(p=na.reuse(t,o.current)),p||(p=new na(A.Map,t,o.current)),a.map=KB(p),a.mapLib=A,s(p),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(_=>{const{onError:A}=t;A?A({type:"error",target:null,originalEvent:null,error:_}):console.error(_)}),()=>{d=!1,p&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?p.recycle():p.destroy())}},[]),QB(()=>{i&&i.setProps(t)}),Q.useImperativeHandle(e,()=>a.map,[i]);const l=Q.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),u={height:"100%"};return Q.createElement("div",{id:t.id,ref:o,style:l},i&&Q.createElement(Xf.Provider,{value:a},Q.createElement("div",{"mapboxgl-children":"",style:u},t.children)))}const e6=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Os(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!e6.test(r)?n[r]=`${i}px`:n[r]=i}}function t6(t,e){const{map:n,mapLib:r}=Q.useContext(Xf),i=Q.useRef({props:t});i.current.props=t;const s=Q.useMemo(()=>{let S=!1;Q.Children.forEach(t.children,m=>{m&&(S=!0)});const k={...t,element:S?document.createElement("div"):null},v=new r.Marker(k);return v.setLngLat([t.longitude,t.latitude]),v.getElement().addEventListener("click",m=>{var b,D;(D=(b=i.current.props).onClick)===null||D===void 0||D.call(b,{type:"click",target:v,originalEvent:m})}),v.on("dragstart",m=>{var b,D;const V=m;V.lngLat=s.getLngLat(),(D=(b=i.current.props).onDragStart)===null||D===void 0||D.call(b,V)}),v.on("drag",m=>{var b,D;const V=m;V.lngLat=s.getLngLat(),(D=(b=i.current.props).onDrag)===null||D===void 0||D.call(b,V)}),v.on("dragend",m=>{var b,D;const V=m;V.lngLat=s.getLngLat(),(D=(b=i.current.props).onDragEnd)===null||D===void 0||D.call(b,V)}),v},[]);Q.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:u,draggable:h=!1,popup:d=null,rotation:p=0,rotationAlignment:_="auto",pitchAlignment:A="auto"}=t;return Q.useEffect(()=>{Os(s.getElement(),u)},[u]),Q.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!zB(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==h&&s.setDraggable(h),s.getRotation()!==p&&s.setRotation(p),s.getRotationAlignment()!==_&&s.setRotationAlignment(_),s.getPitchAlignment()!==A&&s.setPitchAlignment(A),s.getPopup()!==d&&s.setPopup(d),Em.createPortal(t.children,s.getElement())}Q.memo(Q.forwardRef(t6));function nE(t){return new Set(t?t.trim().split(/\s+/):[])}function n6(t,e){const{map:n,mapLib:r}=Q.useContext(Xf),i=Q.useMemo(()=>document.createElement("div"),[]),s=Q.useRef({props:t});s.current.props=t;const o=Q.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",u=>{var h,d;(d=(h=s.current.props).onOpen)===null||d===void 0||d.call(h,u)}),l},[]);if(Q.useEffect(()=>{const a=l=>{var u,h;(h=(u=s.current.props).onClose)===null||h===void 0||h.call(u,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),Q.useEffect(()=>{Os(o.getElement(),t.style)},[t.style]),Q.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!br(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=nE(o.options.className),l=nE(t.className);for(const u of a)l.has(u)||o.removeClassName(u);for(const u of l)a.has(u)||o.addClassName(u);o.options.className=t.className}return Em.createPortal(t.children,i)}Q.memo(Q.forwardRef(n6));function Ec(t,e,n,r){const i=Q.useContext(Xf),s=Q.useMemo(()=>t(i),[]);return Q.useEffect(()=>{const o=e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof e=="function"?e:null,{map:u}=i;return u.hasControl(s)||(u.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),u.hasControl(s)&&u.removeControl(s)}},[]),s}function r6(t){const e=Ec(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Q.useEffect(()=>{Os(e._container,t.style)},[t.style]),null}Q.memo(r6);function i6(t){const e=Ec(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Q.useEffect(()=>{Os(e._controlContainer,t.style)},[t.style]),null}Q.memo(i6);function s6(t,e){const n=Q.useRef({props:t}),r=Ec(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,u;(u=(l=n.current.props).onGeolocate)===null||u===void 0||u.call(l,a)}),s.on("error",a=>{var l,u;(u=(l=n.current.props).onError)===null||u===void 0||u.call(l,a)}),s.on("outofmaxbounds",a=>{var l,u;(u=(l=n.current.props).onOutOfMaxBounds)===null||u===void 0||u.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,u;(u=(l=n.current.props).onTrackUserLocationStart)===null||u===void 0||u.call(l,a)}),s.on("trackuserlocationend",a=>{var l,u;(u=(l=n.current.props).onTrackUserLocationEnd)===null||u===void 0||u.call(l,a)}),s},{position:t.position});return n.current.props=t,Q.useImperativeHandle(e,()=>r,[]),Q.useEffect(()=>{Os(r._container,t.style)},[t.style]),null}Q.memo(Q.forwardRef(s6));function o6(t){const e=Ec(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Q.useEffect(()=>{Os(e._container,t.style)},[t.style]),null}const a6=Q.memo(o6);function l6(t){const e=Ec(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=Q.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),Q.useEffect(()=>{Os(e._container,i)},[i]),null}Q.memo(l6);const c6=VB(()=>import("./mapbox-gl-DhfJO1Mi.js").then(t=>t.m),[]),u6=Q.forwardRef(function(e,n){return GB(e,n,c6)}),h6=a6;var rE={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lR=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},f6=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],l=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},cR={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,l=i+2<t.length,u=l?t[i+2]:0,h=s>>2,d=(s&3)<<4|a>>4;let p=(a&15)<<2|u>>6,_=u&63;l||(_=64,o||(p=64)),r.push(n[h],n[d],n[p],n[_])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(lR(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):f6(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const u=i<t.length?n[t.charAt(i)]:64;++i;const d=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||d==null)throw new d6;const p=s<<2|a>>4;if(r.push(p),u!==64){const _=a<<4&240|u>>2;if(r.push(_),d!==64){const A=u<<6&192|d;r.push(A)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class d6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const p6=function(t){const e=lR(t);return cR.encodeByteArray(e,!0)},$h=function(t){return p6(t).replace(/\./g,"")},g6=function(t){try{return cR.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _6(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m6=()=>_6().__FIREBASE_DEFAULTS__,y6=()=>{if(typeof process>"u"||typeof rE>"u")return;const t=rE.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},T6=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&g6(t[1]);return e&&JSON.parse(e)},Hm=()=>{try{return m6()||y6()||T6()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},v6=t=>{var e,n;return(n=(e=Hm())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},E6=t=>{const e=v6(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},uR=()=>{var t;return(t=Hm())===null||t===void 0?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w6{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A6(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[$h(JSON.stringify(n)),$h(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function R6(){var t;const e=(t=Hm())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function b6(){return!R6()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function I6(){try{return typeof indexedDB=="object"}catch{return!1}}function C6(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P6="FirebaseError";class pa extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=P6,Object.setPrototypeOf(this,pa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hR.prototype.create)}}class hR{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?x6(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new pa(i,a,r)}}function x6(t,e){return t.replace(N6,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const N6=/\{\$([^}]+)}/g;function a_(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(iE(s)&&iE(o)){if(!a_(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function iE(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gl(t){return t&&t._delegate?t._delegate:t}class ec{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k6{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new w6;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(O6(e))try{this.getOrInitializeService({instanceIdentifier:ns})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=ns){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ns){return this.instances.has(e)}getOptions(e=ns){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:M6(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ns){return this.component?this.component.multipleInstances?e:ns:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function M6(t){return t===ns?void 0:t}function O6(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new k6(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ge||(ge={}));const F6={debug:ge.DEBUG,verbose:ge.VERBOSE,info:ge.INFO,warn:ge.WARN,error:ge.ERROR,silent:ge.SILENT},U6=ge.INFO,B6={[ge.DEBUG]:"log",[ge.VERBOSE]:"log",[ge.INFO]:"info",[ge.WARN]:"warn",[ge.ERROR]:"error"},V6=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=B6[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class fR{constructor(e){this.name=e,this._logLevel=U6,this._logHandler=V6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?F6[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ge.DEBUG,...e),this._logHandler(this,ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ge.VERBOSE,...e),this._logHandler(this,ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ge.INFO,...e),this._logHandler(this,ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ge.WARN,...e),this._logHandler(this,ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ge.ERROR,...e),this._logHandler(this,ge.ERROR,...e)}}const L6=(t,e)=>e.some(n=>t instanceof n);let sE,oE;function z6(){return sE||(sE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function j6(){return oE||(oE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dR=new WeakMap,l_=new WeakMap,pR=new WeakMap,vp=new WeakMap,Xm=new WeakMap;function W6(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(wi(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&dR.set(n,t)}).catch(()=>{}),Xm.set(e,t),e}function $6(t){if(l_.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});l_.set(t,e)}let c_={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return l_.get(t);if(e==="objectStoreNames")return t.objectStoreNames||pR.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wi(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function H6(t){c_=t(c_)}function X6(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Ep(this),e,...n);return pR.set(r,e.sort?e.sort():[e]),wi(r)}:j6().includes(t)?function(...e){return t.apply(Ep(this),e),wi(dR.get(this))}:function(...e){return wi(t.apply(Ep(this),e))}}function q6(t){return typeof t=="function"?X6(t):(t instanceof IDBTransaction&&$6(t),L6(t,z6())?new Proxy(t,c_):t)}function wi(t){if(t instanceof IDBRequest)return W6(t);if(vp.has(t))return vp.get(t);const e=q6(t);return e!==t&&(vp.set(t,e),Xm.set(e,t)),e}const Ep=t=>Xm.get(t);function K6(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=wi(o);return r&&o.addEventListener("upgradeneeded",l=>{r(wi(o.result),l.oldVersion,l.newVersion,wi(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),i&&l.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Y6=["get","getKey","getAll","getAllKeys","count"],Q6=["put","add","delete","clear"],wp=new Map;function aE(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(wp.get(e))return wp.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Q6.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Y6.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,i?"readwrite":"readonly");let u=l.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),i&&l.done]))[0]};return wp.set(e,s),s}H6(t=>({...t,get:(e,n,r)=>aE(e,n)||t.get(e,n,r),has:(e,n)=>!!aE(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z6{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(J6(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function J6(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const u_="@firebase/app",lE="0.10.16";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fr=new fR("@firebase/app"),G6="@firebase/app-compat",eV="@firebase/analytics-compat",tV="@firebase/analytics",nV="@firebase/app-check-compat",rV="@firebase/app-check",iV="@firebase/auth",sV="@firebase/auth-compat",oV="@firebase/database",aV="@firebase/data-connect",lV="@firebase/database-compat",cV="@firebase/functions",uV="@firebase/functions-compat",hV="@firebase/installations",fV="@firebase/installations-compat",dV="@firebase/messaging",pV="@firebase/messaging-compat",gV="@firebase/performance",_V="@firebase/performance-compat",mV="@firebase/remote-config",yV="@firebase/remote-config-compat",TV="@firebase/storage",vV="@firebase/storage-compat",EV="@firebase/firestore",wV="@firebase/vertexai",AV="@firebase/firestore-compat",SV="firebase",RV="11.0.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h_="[DEFAULT]",bV={[u_]:"fire-core",[G6]:"fire-core-compat",[tV]:"fire-analytics",[eV]:"fire-analytics-compat",[rV]:"fire-app-check",[nV]:"fire-app-check-compat",[iV]:"fire-auth",[sV]:"fire-auth-compat",[oV]:"fire-rtdb",[aV]:"fire-data-connect",[lV]:"fire-rtdb-compat",[cV]:"fire-fn",[uV]:"fire-fn-compat",[hV]:"fire-iid",[fV]:"fire-iid-compat",[dV]:"fire-fcm",[pV]:"fire-fcm-compat",[gV]:"fire-perf",[_V]:"fire-perf-compat",[mV]:"fire-rc",[yV]:"fire-rc-compat",[TV]:"fire-gcs",[vV]:"fire-gcs-compat",[EV]:"fire-fst",[AV]:"fire-fst-compat",[wV]:"fire-vertex","fire-js":"fire-js",[SV]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh=new Map,IV=new Map,f_=new Map;function cE(t,e){try{t.container.addComponent(e)}catch(n){Fr.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Xh(t){const e=t.name;if(f_.has(e))return Fr.debug(`There were multiple attempts to register component ${e}.`),!1;f_.set(e,t);for(const n of Hh.values())cE(n,t);for(const n of IV.values())cE(n,t);return!0}function CV(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PV={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ai=new hR("app","Firebase",PV);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xV{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ec("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ai.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NV=RV;function gR(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:h_,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Ai.create("bad-app-name",{appName:String(i)});if(n||(n=uR()),!n)throw Ai.create("no-options");const s=Hh.get(i);if(s){if(a_(n,s.options)&&a_(r,s.config))return s;throw Ai.create("duplicate-app",{appName:i})}const o=new D6(i);for(const l of f_.values())o.addComponent(l);const a=new xV(n,r,o);return Hh.set(i,a),a}function kV(t=h_){const e=Hh.get(t);if(!e&&t===h_&&uR())return gR();if(!e)throw Ai.create("no-app",{appName:t});return e}function Bo(t,e,n){var r;let i=(r=bV[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Fr.warn(a.join(" "));return}Xh(new ec(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MV="firebase-heartbeat-database",OV=1,tc="firebase-heartbeat-store";let Ap=null;function _R(){return Ap||(Ap=K6(MV,OV,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(tc)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ai.create("idb-open",{originalErrorMessage:t.message})})),Ap}async function DV(t){try{const n=(await _R()).transaction(tc),r=await n.objectStore(tc).get(mR(t));return await n.done,r}catch(e){if(e instanceof pa)Fr.warn(e.message);else{const n=Ai.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Fr.warn(n.message)}}}async function uE(t,e){try{const r=(await _R()).transaction(tc,"readwrite");await r.objectStore(tc).put(e,mR(t)),await r.done}catch(n){if(n instanceof pa)Fr.warn(n.message);else{const r=Ai.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Fr.warn(r.message)}}}function mR(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FV=1024,UV=30*24*60*60*1e3;class BV{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new LV(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=hE();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=UV}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Fr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=hE(),{heartbeatsToSend:r,unsentEntries:i}=VV(this._heartbeatsCache.heartbeats),s=$h(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return Fr.warn(n),""}}}function hE(){return new Date().toISOString().substring(0,10)}function VV(t,e=FV){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),fE(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),fE(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class LV{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return I6()?C6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await DV(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return uE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return uE(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function fE(t){return $h(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zV(t){Xh(new ec("platform-logger",e=>new Z6(e),"PRIVATE")),Xh(new ec("heartbeat",e=>new BV(e),"PRIVATE")),Bo(u_,lE,t),Bo(u_,lE,"esm2017"),Bo("fire-js","")}zV("");var dE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ts,yR;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(P,E){function C(){}C.prototype=E.prototype,P.D=E.prototype,P.prototype=new C,P.prototype.constructor=P,P.C=function(x,O,F){for(var N=Array(arguments.length-2),oe=2;oe<arguments.length;oe++)N[oe-2]=arguments[oe];return E.prototype[O].apply(x,N)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(P,E,C){C||(C=0);var x=Array(16);if(typeof E=="string")for(var O=0;16>O;++O)x[O]=E.charCodeAt(C++)|E.charCodeAt(C++)<<8|E.charCodeAt(C++)<<16|E.charCodeAt(C++)<<24;else for(O=0;16>O;++O)x[O]=E[C++]|E[C++]<<8|E[C++]<<16|E[C++]<<24;E=P.g[0],C=P.g[1],O=P.g[2];var F=P.g[3],N=E+(F^C&(O^F))+x[0]+3614090360&4294967295;E=C+(N<<7&4294967295|N>>>25),N=F+(O^E&(C^O))+x[1]+3905402710&4294967295,F=E+(N<<12&4294967295|N>>>20),N=O+(C^F&(E^C))+x[2]+606105819&4294967295,O=F+(N<<17&4294967295|N>>>15),N=C+(E^O&(F^E))+x[3]+3250441966&4294967295,C=O+(N<<22&4294967295|N>>>10),N=E+(F^C&(O^F))+x[4]+4118548399&4294967295,E=C+(N<<7&4294967295|N>>>25),N=F+(O^E&(C^O))+x[5]+1200080426&4294967295,F=E+(N<<12&4294967295|N>>>20),N=O+(C^F&(E^C))+x[6]+2821735955&4294967295,O=F+(N<<17&4294967295|N>>>15),N=C+(E^O&(F^E))+x[7]+4249261313&4294967295,C=O+(N<<22&4294967295|N>>>10),N=E+(F^C&(O^F))+x[8]+1770035416&4294967295,E=C+(N<<7&4294967295|N>>>25),N=F+(O^E&(C^O))+x[9]+2336552879&4294967295,F=E+(N<<12&4294967295|N>>>20),N=O+(C^F&(E^C))+x[10]+4294925233&4294967295,O=F+(N<<17&4294967295|N>>>15),N=C+(E^O&(F^E))+x[11]+2304563134&4294967295,C=O+(N<<22&4294967295|N>>>10),N=E+(F^C&(O^F))+x[12]+1804603682&4294967295,E=C+(N<<7&4294967295|N>>>25),N=F+(O^E&(C^O))+x[13]+4254626195&4294967295,F=E+(N<<12&4294967295|N>>>20),N=O+(C^F&(E^C))+x[14]+2792965006&4294967295,O=F+(N<<17&4294967295|N>>>15),N=C+(E^O&(F^E))+x[15]+1236535329&4294967295,C=O+(N<<22&4294967295|N>>>10),N=E+(O^F&(C^O))+x[1]+4129170786&4294967295,E=C+(N<<5&4294967295|N>>>27),N=F+(C^O&(E^C))+x[6]+3225465664&4294967295,F=E+(N<<9&4294967295|N>>>23),N=O+(E^C&(F^E))+x[11]+643717713&4294967295,O=F+(N<<14&4294967295|N>>>18),N=C+(F^E&(O^F))+x[0]+3921069994&4294967295,C=O+(N<<20&4294967295|N>>>12),N=E+(O^F&(C^O))+x[5]+3593408605&4294967295,E=C+(N<<5&4294967295|N>>>27),N=F+(C^O&(E^C))+x[10]+38016083&4294967295,F=E+(N<<9&4294967295|N>>>23),N=O+(E^C&(F^E))+x[15]+3634488961&4294967295,O=F+(N<<14&4294967295|N>>>18),N=C+(F^E&(O^F))+x[4]+3889429448&4294967295,C=O+(N<<20&4294967295|N>>>12),N=E+(O^F&(C^O))+x[9]+568446438&4294967295,E=C+(N<<5&4294967295|N>>>27),N=F+(C^O&(E^C))+x[14]+3275163606&4294967295,F=E+(N<<9&4294967295|N>>>23),N=O+(E^C&(F^E))+x[3]+4107603335&4294967295,O=F+(N<<14&4294967295|N>>>18),N=C+(F^E&(O^F))+x[8]+1163531501&4294967295,C=O+(N<<20&4294967295|N>>>12),N=E+(O^F&(C^O))+x[13]+2850285829&4294967295,E=C+(N<<5&4294967295|N>>>27),N=F+(C^O&(E^C))+x[2]+4243563512&4294967295,F=E+(N<<9&4294967295|N>>>23),N=O+(E^C&(F^E))+x[7]+1735328473&4294967295,O=F+(N<<14&4294967295|N>>>18),N=C+(F^E&(O^F))+x[12]+2368359562&4294967295,C=O+(N<<20&4294967295|N>>>12),N=E+(C^O^F)+x[5]+4294588738&4294967295,E=C+(N<<4&4294967295|N>>>28),N=F+(E^C^O)+x[8]+2272392833&4294967295,F=E+(N<<11&4294967295|N>>>21),N=O+(F^E^C)+x[11]+1839030562&4294967295,O=F+(N<<16&4294967295|N>>>16),N=C+(O^F^E)+x[14]+4259657740&4294967295,C=O+(N<<23&4294967295|N>>>9),N=E+(C^O^F)+x[1]+2763975236&4294967295,E=C+(N<<4&4294967295|N>>>28),N=F+(E^C^O)+x[4]+1272893353&4294967295,F=E+(N<<11&4294967295|N>>>21),N=O+(F^E^C)+x[7]+4139469664&4294967295,O=F+(N<<16&4294967295|N>>>16),N=C+(O^F^E)+x[10]+3200236656&4294967295,C=O+(N<<23&4294967295|N>>>9),N=E+(C^O^F)+x[13]+681279174&4294967295,E=C+(N<<4&4294967295|N>>>28),N=F+(E^C^O)+x[0]+3936430074&4294967295,F=E+(N<<11&4294967295|N>>>21),N=O+(F^E^C)+x[3]+3572445317&4294967295,O=F+(N<<16&4294967295|N>>>16),N=C+(O^F^E)+x[6]+76029189&4294967295,C=O+(N<<23&4294967295|N>>>9),N=E+(C^O^F)+x[9]+3654602809&4294967295,E=C+(N<<4&4294967295|N>>>28),N=F+(E^C^O)+x[12]+3873151461&4294967295,F=E+(N<<11&4294967295|N>>>21),N=O+(F^E^C)+x[15]+530742520&4294967295,O=F+(N<<16&4294967295|N>>>16),N=C+(O^F^E)+x[2]+3299628645&4294967295,C=O+(N<<23&4294967295|N>>>9),N=E+(O^(C|~F))+x[0]+4096336452&4294967295,E=C+(N<<6&4294967295|N>>>26),N=F+(C^(E|~O))+x[7]+1126891415&4294967295,F=E+(N<<10&4294967295|N>>>22),N=O+(E^(F|~C))+x[14]+2878612391&4294967295,O=F+(N<<15&4294967295|N>>>17),N=C+(F^(O|~E))+x[5]+4237533241&4294967295,C=O+(N<<21&4294967295|N>>>11),N=E+(O^(C|~F))+x[12]+1700485571&4294967295,E=C+(N<<6&4294967295|N>>>26),N=F+(C^(E|~O))+x[3]+2399980690&4294967295,F=E+(N<<10&4294967295|N>>>22),N=O+(E^(F|~C))+x[10]+4293915773&4294967295,O=F+(N<<15&4294967295|N>>>17),N=C+(F^(O|~E))+x[1]+2240044497&4294967295,C=O+(N<<21&4294967295|N>>>11),N=E+(O^(C|~F))+x[8]+1873313359&4294967295,E=C+(N<<6&4294967295|N>>>26),N=F+(C^(E|~O))+x[15]+4264355552&4294967295,F=E+(N<<10&4294967295|N>>>22),N=O+(E^(F|~C))+x[6]+2734768916&4294967295,O=F+(N<<15&4294967295|N>>>17),N=C+(F^(O|~E))+x[13]+1309151649&4294967295,C=O+(N<<21&4294967295|N>>>11),N=E+(O^(C|~F))+x[4]+4149444226&4294967295,E=C+(N<<6&4294967295|N>>>26),N=F+(C^(E|~O))+x[11]+3174756917&4294967295,F=E+(N<<10&4294967295|N>>>22),N=O+(E^(F|~C))+x[2]+718787259&4294967295,O=F+(N<<15&4294967295|N>>>17),N=C+(F^(O|~E))+x[9]+3951481745&4294967295,P.g[0]=P.g[0]+E&4294967295,P.g[1]=P.g[1]+(O+(N<<21&4294967295|N>>>11))&4294967295,P.g[2]=P.g[2]+O&4294967295,P.g[3]=P.g[3]+F&4294967295}r.prototype.u=function(P,E){E===void 0&&(E=P.length);for(var C=E-this.blockSize,x=this.B,O=this.h,F=0;F<E;){if(O==0)for(;F<=C;)i(this,P,F),F+=this.blockSize;if(typeof P=="string"){for(;F<E;)if(x[O++]=P.charCodeAt(F++),O==this.blockSize){i(this,x),O=0;break}}else for(;F<E;)if(x[O++]=P[F++],O==this.blockSize){i(this,x),O=0;break}}this.h=O,this.o+=E},r.prototype.v=function(){var P=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);P[0]=128;for(var E=1;E<P.length-8;++E)P[E]=0;var C=8*this.o;for(E=P.length-8;E<P.length;++E)P[E]=C&255,C/=256;for(this.u(P),P=Array(16),E=C=0;4>E;++E)for(var x=0;32>x;x+=8)P[C++]=this.g[E]>>>x&255;return P};function s(P,E){var C=a;return Object.prototype.hasOwnProperty.call(C,P)?C[P]:C[P]=E(P)}function o(P,E){this.h=E;for(var C=[],x=!0,O=P.length-1;0<=O;O--){var F=P[O]|0;x&&F==E||(C[O]=F,x=!1)}this.g=C}var a={};function l(P){return-128<=P&&128>P?s(P,function(E){return new o([E|0],0>E?-1:0)}):new o([P|0],0>P?-1:0)}function u(P){if(isNaN(P)||!isFinite(P))return d;if(0>P)return k(u(-P));for(var E=[],C=1,x=0;P>=C;x++)E[x]=P/C|0,C*=4294967296;return new o(E,0)}function h(P,E){if(P.length==0)throw Error("number format error: empty string");if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(P.charAt(0)=="-")return k(h(P.substring(1),E));if(0<=P.indexOf("-"))throw Error('number format error: interior "-" character');for(var C=u(Math.pow(E,8)),x=d,O=0;O<P.length;O+=8){var F=Math.min(8,P.length-O),N=parseInt(P.substring(O,O+F),E);8>F?(F=u(Math.pow(E,F)),x=x.j(F).add(u(N))):(x=x.j(C),x=x.add(u(N)))}return x}var d=l(0),p=l(1),_=l(16777216);t=o.prototype,t.m=function(){if(S(this))return-k(this).m();for(var P=0,E=1,C=0;C<this.g.length;C++){var x=this.i(C);P+=(0<=x?x:4294967296+x)*E,E*=4294967296}return P},t.toString=function(P){if(P=P||10,2>P||36<P)throw Error("radix out of range: "+P);if(A(this))return"0";if(S(this))return"-"+k(this).toString(P);for(var E=u(Math.pow(P,6)),C=this,x="";;){var O=D(C,E).g;C=v(C,O.j(E));var F=((0<C.g.length?C.g[0]:C.h)>>>0).toString(P);if(C=O,A(C))return F+x;for(;6>F.length;)F="0"+F;x=F+x}},t.i=function(P){return 0>P?0:P<this.g.length?this.g[P]:this.h};function A(P){if(P.h!=0)return!1;for(var E=0;E<P.g.length;E++)if(P.g[E]!=0)return!1;return!0}function S(P){return P.h==-1}t.l=function(P){return P=v(this,P),S(P)?-1:A(P)?0:1};function k(P){for(var E=P.g.length,C=[],x=0;x<E;x++)C[x]=~P.g[x];return new o(C,~P.h).add(p)}t.abs=function(){return S(this)?k(this):this},t.add=function(P){for(var E=Math.max(this.g.length,P.g.length),C=[],x=0,O=0;O<=E;O++){var F=x+(this.i(O)&65535)+(P.i(O)&65535),N=(F>>>16)+(this.i(O)>>>16)+(P.i(O)>>>16);x=N>>>16,F&=65535,N&=65535,C[O]=N<<16|F}return new o(C,C[C.length-1]&-2147483648?-1:0)};function v(P,E){return P.add(k(E))}t.j=function(P){if(A(this)||A(P))return d;if(S(this))return S(P)?k(this).j(k(P)):k(k(this).j(P));if(S(P))return k(this.j(k(P)));if(0>this.l(_)&&0>P.l(_))return u(this.m()*P.m());for(var E=this.g.length+P.g.length,C=[],x=0;x<2*E;x++)C[x]=0;for(x=0;x<this.g.length;x++)for(var O=0;O<P.g.length;O++){var F=this.i(x)>>>16,N=this.i(x)&65535,oe=P.i(O)>>>16,ct=P.i(O)&65535;C[2*x+2*O]+=N*ct,m(C,2*x+2*O),C[2*x+2*O+1]+=F*ct,m(C,2*x+2*O+1),C[2*x+2*O+1]+=N*oe,m(C,2*x+2*O+1),C[2*x+2*O+2]+=F*oe,m(C,2*x+2*O+2)}for(x=0;x<E;x++)C[x]=C[2*x+1]<<16|C[2*x];for(x=E;x<2*E;x++)C[x]=0;return new o(C,0)};function m(P,E){for(;(P[E]&65535)!=P[E];)P[E+1]+=P[E]>>>16,P[E]&=65535,E++}function b(P,E){this.g=P,this.h=E}function D(P,E){if(A(E))throw Error("division by zero");if(A(P))return new b(d,d);if(S(P))return E=D(k(P),E),new b(k(E.g),k(E.h));if(S(E))return E=D(P,k(E)),new b(k(E.g),E.h);if(30<P.g.length){if(S(P)||S(E))throw Error("slowDivide_ only works with positive integers.");for(var C=p,x=E;0>=x.l(P);)C=V(C),x=V(x);var O=j(C,1),F=j(x,1);for(x=j(x,2),C=j(C,2);!A(x);){var N=F.add(x);0>=N.l(P)&&(O=O.add(C),F=N),x=j(x,1),C=j(C,1)}return E=v(P,O.j(E)),new b(O,E)}for(O=d;0<=P.l(E);){for(C=Math.max(1,Math.floor(P.m()/E.m())),x=Math.ceil(Math.log(C)/Math.LN2),x=48>=x?1:Math.pow(2,x-48),F=u(C),N=F.j(E);S(N)||0<N.l(P);)C-=x,F=u(C),N=F.j(E);A(F)&&(F=p),O=O.add(F),P=v(P,N)}return new b(O,P)}t.A=function(P){return D(this,P).h},t.and=function(P){for(var E=Math.max(this.g.length,P.g.length),C=[],x=0;x<E;x++)C[x]=this.i(x)&P.i(x);return new o(C,this.h&P.h)},t.or=function(P){for(var E=Math.max(this.g.length,P.g.length),C=[],x=0;x<E;x++)C[x]=this.i(x)|P.i(x);return new o(C,this.h|P.h)},t.xor=function(P){for(var E=Math.max(this.g.length,P.g.length),C=[],x=0;x<E;x++)C[x]=this.i(x)^P.i(x);return new o(C,this.h^P.h)};function V(P){for(var E=P.g.length+1,C=[],x=0;x<E;x++)C[x]=P.i(x)<<1|P.i(x-1)>>>31;return new o(C,P.h)}function j(P,E){var C=E>>5;E%=32;for(var x=P.g.length-C,O=[],F=0;F<x;F++)O[F]=0<E?P.i(F+C)>>>E|P.i(F+C+1)<<32-E:P.i(F+C);return new o(O,P.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,yR=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,Ts=o}).apply(typeof dE<"u"?dE:typeof self<"u"?self:typeof window<"u"?window:{});var Au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var TR,sl,vR,$u,d_,ER,wR,AR;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(c,f,g){return c==Array.prototype||c==Object.prototype||(c[f]=g.value),c};function n(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Au=="object"&&Au];for(var f=0;f<c.length;++f){var g=c[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var r=n(this);function i(c,f){if(f)e:{var g=r;c=c.split(".");for(var w=0;w<c.length-1;w++){var L=c[w];if(!(L in g))break e;g=g[L]}c=c[c.length-1],w=g[c],f=f(w),f!=w&&f!=null&&e(g,c,{configurable:!0,writable:!0,value:f})}}function s(c,f){c instanceof String&&(c+="");var g=0,w=!1,L={next:function(){if(!w&&g<c.length){var $=g++;return{value:f($,c[$]),done:!1}}return w=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}i("Array.prototype.values",function(c){return c||function(){return s(this,function(f,g){return g})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function l(c){var f=typeof c;return f=f!="object"?f:c?Array.isArray(c)?"array":f:"null",f=="array"||f=="object"&&typeof c.length=="number"}function u(c){var f=typeof c;return f=="object"&&c!=null||f=="function"}function h(c,f,g){return c.call.apply(c.bind,arguments)}function d(c,f,g){if(!c)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,w),c.apply(f,L)}}return function(){return c.apply(f,arguments)}}function p(c,f,g){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?h:d,p.apply(null,arguments)}function _(c,f){var g=Array.prototype.slice.call(arguments,1);return function(){var w=g.slice();return w.push.apply(w,arguments),c.apply(this,w)}}function A(c,f){function g(){}g.prototype=f.prototype,c.aa=f.prototype,c.prototype=new g,c.prototype.constructor=c,c.Qb=function(w,L,$){for(var Z=Array(arguments.length-2),be=2;be<arguments.length;be++)Z[be-2]=arguments[be];return f.prototype[L].apply(w,Z)}}function S(c){const f=c.length;if(0<f){const g=Array(f);for(let w=0;w<f;w++)g[w]=c[w];return g}return[]}function k(c,f){for(let g=1;g<arguments.length;g++){const w=arguments[g];if(l(w)){const L=c.length||0,$=w.length||0;c.length=L+$;for(let Z=0;Z<$;Z++)c[L+Z]=w[Z]}else c.push(w)}}class v{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return 0<this.h?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function m(c){return/^[\s\xa0]*$/.test(c)}function b(){var c=a.navigator;return c&&(c=c.userAgent)?c:""}function D(c){return D[" "](c),c}D[" "]=function(){};var V=b().indexOf("Gecko")!=-1&&!(b().toLowerCase().indexOf("webkit")!=-1&&b().indexOf("Edge")==-1)&&!(b().indexOf("Trident")!=-1||b().indexOf("MSIE")!=-1)&&b().indexOf("Edge")==-1;function j(c,f,g){for(const w in c)f.call(g,c[w],w,c)}function P(c,f){for(const g in c)f.call(void 0,c[g],g,c)}function E(c){const f={};for(const g in c)f[g]=c[g];return f}const C="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function x(c,f){let g,w;for(let L=1;L<arguments.length;L++){w=arguments[L];for(g in w)c[g]=w[g];for(let $=0;$<C.length;$++)g=C[$],Object.prototype.hasOwnProperty.call(w,g)&&(c[g]=w[g])}}function O(c){var f=1;c=c.split(":");const g=[];for(;0<f&&c.length;)g.push(c.shift()),f--;return c.length&&g.push(c.join(":")),g}function F(c){a.setTimeout(()=>{throw c},0)}function N(){var c=ie;let f=null;return c.g&&(f=c.g,c.g=c.g.next,c.g||(c.h=null),f.next=null),f}class oe{constructor(){this.h=this.g=null}add(f,g){const w=ct.get();w.set(f,g),this.h?this.h.next=w:this.g=w,this.h=w}}var ct=new v(()=>new Vi,c=>c.reset());class Vi{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let un,J=!1,ie=new oe,ce=()=>{const c=a.Promise.resolve(void 0);un=()=>{c.then(xe)}};var xe=()=>{for(var c;c=N();){try{c.h.call(c.g)}catch(g){F(g)}var f=ct;f.j(c),100>f.h&&(f.h++,c.next=f.g,f.g=c)}J=!1};function _e(){this.s=this.s,this.C=this.C}_e.prototype.s=!1,_e.prototype.ma=function(){this.s||(this.s=!0,this.N())},_e.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ue(c,f){this.type=c,this.g=this.target=f,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var Jt=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var c=!1,f=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};a.addEventListener("test",g,f),a.removeEventListener("test",g,f)}catch{}return c}();function Rn(c,f){if(Ue.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c){var g=this.type=c.type,w=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;if(this.target=c.target||c.srcElement,this.g=f,f=c.relatedTarget){if(V){e:{try{D(f.nodeName);var L=!0;break e}catch{}L=!1}L||(f=null)}}else g=="mouseover"?f=c.fromElement:g=="mouseout"&&(f=c.toElement);this.relatedTarget=f,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=typeof c.pointerType=="string"?c.pointerType:bn[c.pointerType]||"",this.state=c.state,this.i=c,c.defaultPrevented&&Rn.aa.h.call(this)}}A(Rn,Ue);var bn={2:"touch",3:"pen",4:"mouse"};Rn.prototype.h=function(){Rn.aa.h.call(this);var c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var Ne="closure_listenable_"+(1e6*Math.random()|0),cr=0;function je(c,f,g,w,L){this.listener=c,this.proxy=null,this.src=f,this.type=g,this.capture=!!w,this.ha=L,this.key=++cr,this.da=this.fa=!1}function tt(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function ur(c){this.src=c,this.g={},this.h=0}ur.prototype.add=function(c,f,g,w,L){var $=c.toString();c=this.g[$],c||(c=this.g[$]=[],this.h++);var Z=fr(c,f,w,L);return-1<Z?(f=c[Z],g||(f.fa=!1)):(f=new je(f,this.src,$,!!w,L),f.fa=g,c.push(f)),f};function hr(c,f){var g=f.type;if(g in c.g){var w=c.g[g],L=Array.prototype.indexOf.call(w,f,void 0),$;($=0<=L)&&Array.prototype.splice.call(w,L,1),$&&(tt(f),c.g[g].length==0&&(delete c.g[g],c.h--))}}function fr(c,f,g,w){for(var L=0;L<c.length;++L){var $=c[L];if(!$.da&&$.listener==f&&$.capture==!!g&&$.ha==w)return L}return-1}var dr="closure_lm_"+(1e6*Math.random()|0),pr={};function Gt(c,f,g,w,L){if(Array.isArray(f)){for(var $=0;$<f.length;$++)Gt(c,f[$],g,w,L);return null}return g=Ic(g),c&&c[Ne]?c.K(f,g,u(w)?!!w.capture:!!w,L):gr(c,f,g,!1,w,L)}function gr(c,f,g,w,L,$){if(!f)throw Error("Invalid event type");var Z=u(L)?!!L.capture:!!L,be=va(c);if(be||(c[dr]=be=new ur(c)),g=be.add(f,g,w,Z,$),g.proxy)return g;if(w=bc(),g.proxy=w,w.src=c,w.listener=g,c.addEventListener)Jt||(L=Z),L===void 0&&(L=!1),c.addEventListener(f.toString(),w,L);else if(c.attachEvent)c.attachEvent(Ut(f.toString()),w);else if(c.addListener&&c.removeListener)c.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return g}function bc(){function c(g){return f.call(c.src,c.listener,g)}const f=ld;return c}function Ta(c,f,g,w,L){if(Array.isArray(f))for(var $=0;$<f.length;$++)Ta(c,f[$],g,w,L);else w=u(w)?!!w.capture:!!w,g=Ic(g),c&&c[Ne]?(c=c.i,f=String(f).toString(),f in c.g&&($=c.g[f],g=fr($,g,w,L),-1<g&&(tt($[g]),Array.prototype.splice.call($,g,1),$.length==0&&(delete c.g[f],c.h--)))):c&&(c=va(c))&&(f=c.g[f.toString()],c=-1,f&&(c=fr(f,g,w,L)),(g=-1<c?f[c]:null)&&zr(g))}function zr(c){if(typeof c!="number"&&c&&!c.da){var f=c.src;if(f&&f[Ne])hr(f.i,c);else{var g=c.type,w=c.proxy;f.removeEventListener?f.removeEventListener(g,w,c.capture):f.detachEvent?f.detachEvent(Ut(g),w):f.addListener&&f.removeListener&&f.removeListener(w),(g=va(f))?(hr(g,c),g.h==0&&(g.src=null,f[dr]=null)):tt(c)}}}function Ut(c){return c in pr?pr[c]:pr[c]="on"+c}function ld(c,f){if(c.da)c=!0;else{f=new Rn(f,this);var g=c.listener,w=c.ha||c.src;c.fa&&zr(c),c=g.call(w,f)}return c}function va(c){return c=c[dr],c instanceof ur?c:null}var Ea="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ic(c){return typeof c=="function"?c:(c[Ea]||(c[Ea]=function(f){return c.handleEvent(f)}),c[Ea])}function ut(){_e.call(this),this.i=new ur(this),this.M=this,this.F=null}A(ut,_e),ut.prototype[Ne]=!0,ut.prototype.removeEventListener=function(c,f,g,w){Ta(this,c,f,g,w)};function ht(c,f){var g,w=c.F;if(w)for(g=[];w;w=w.F)g.push(w);if(c=c.M,w=f.type||f,typeof f=="string")f=new Ue(f,c);else if(f instanceof Ue)f.target=f.target||c;else{var L=f;f=new Ue(w,c),x(f,L)}if(L=!0,g)for(var $=g.length-1;0<=$;$--){var Z=f.g=g[$];L=Li(Z,w,!0,f)&&L}if(Z=f.g=c,L=Li(Z,w,!0,f)&&L,L=Li(Z,w,!1,f)&&L,g)for($=0;$<g.length;$++)Z=f.g=g[$],L=Li(Z,w,!1,f)&&L}ut.prototype.N=function(){if(ut.aa.N.call(this),this.i){var c=this.i,f;for(f in c.g){for(var g=c.g[f],w=0;w<g.length;w++)tt(g[w]);delete c.g[f],c.h--}}this.F=null},ut.prototype.K=function(c,f,g,w){return this.i.add(String(c),f,!1,g,w)},ut.prototype.L=function(c,f,g,w){return this.i.add(String(c),f,!0,g,w)};function Li(c,f,g,w){if(f=c.i.g[String(f)],!f)return!0;f=f.concat();for(var L=!0,$=0;$<f.length;++$){var Z=f[$];if(Z&&!Z.da&&Z.capture==g){var be=Z.listener,Tt=Z.ha||Z.src;Z.fa&&hr(c.i,Z),L=be.call(Tt,w)!==!1&&L}}return L&&!w.defaultPrevented}function wa(c,f,g){if(typeof c=="function")g&&(c=p(c,g));else if(c&&typeof c.handleEvent=="function")c=p(c.handleEvent,c);else throw Error("Invalid listener argument");return 2147483647<Number(f)?-1:a.setTimeout(c,f||0)}function Aa(c){c.g=wa(()=>{c.g=null,c.i&&(c.i=!1,Aa(c))},c.l);const f=c.h;c.h=null,c.m.apply(null,f)}class Vs extends _e{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Aa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _r(c){_e.call(this),this.h=c,this.g={}}A(_r,_e);var Cc=[];function Pc(c){j(c.g,function(f,g){this.g.hasOwnProperty(g)&&zr(f)},c),c.g={}}_r.prototype.N=function(){_r.aa.N.call(this),Pc(this)},_r.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Sa=a.JSON.stringify,cd=a.JSON.parse,ud=class{stringify(c){return a.JSON.stringify(c,void 0)}parse(c){return a.JSON.parse(c,void 0)}};function jr(){}jr.prototype.h=null;function xc(c){return c.h||(c.h=c.i())}function Nc(){}var Wr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ls(){Ue.call(this,"d")}A(Ls,Ue);function zi(){Ue.call(this,"c")}A(zi,Ue);var mr={},kc=null;function zs(){return kc=kc||new ut}mr.La="serverreachability";function Ra(c){Ue.call(this,mr.La,c)}A(Ra,Ue);function ji(c){const f=zs();ht(f,new Ra(f))}mr.STAT_EVENT="statevent";function Mc(c,f){Ue.call(this,mr.STAT_EVENT,c),this.stat=f}A(Mc,Ue);function mt(c){const f=zs();ht(f,new Mc(f,c))}mr.Ma="timingevent";function Wi(c,f){Ue.call(this,mr.Ma,c),this.size=f}A(Wi,Ue);function $i(c,f){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){c()},f)}function Hi(){this.g=!0}Hi.prototype.xa=function(){this.g=!1};function Oc(c,f,g,w,L,$){c.info(function(){if(c.g)if($)for(var Z="",be=$.split("&"),Tt=0;Tt<be.length;Tt++){var ye=be[Tt].split("=");if(1<ye.length){var bt=ye[0];ye=ye[1];var It=bt.split("_");Z=2<=It.length&&It[1]=="type"?Z+(bt+"="+ye+"&"):Z+(bt+"=redacted&")}}else Z=null;else Z=$;return"XMLHTTP REQ ("+w+") [attempt "+L+"]: "+f+`
`+g+`
`+Z})}function ba(c,f,g,w,L,$,Z){c.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+L+"]: "+f+`
`+g+`
`+$+" "+Z})}function $r(c,f,g,w){c.info(function(){return"XMLHTTP TEXT ("+f+"): "+hd(c,g)+(w?" "+w:"")})}function Dc(c,f){c.info(function(){return"TIMEOUT: "+f})}Hi.prototype.info=function(){};function hd(c,f){if(!c.g)return f;if(!f)return null;try{var g=JSON.parse(f);if(g){for(c=0;c<g.length;c++)if(Array.isArray(g[c])){var w=g[c];if(!(2>w.length)){var L=w[1];if(Array.isArray(L)&&!(1>L.length)){var $=L[0];if($!="noop"&&$!="stop"&&$!="close")for(var Z=1;Z<L.length;Z++)L[Z]=""}}}}return Sa(g)}catch{return f}}var Xi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ia={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},js;function qi(){}A(qi,jr),qi.prototype.g=function(){return new XMLHttpRequest},qi.prototype.i=function(){return{}},js=new qi;function hn(c,f,g,w){this.j=c,this.i=f,this.l=g,this.R=w||1,this.U=new _r(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vn}function Vn(){this.i=null,this.g="",this.h=!1}var Hr={},yr={};function Xr(c,f,g){c.L=1,c.v=y(pn(f)),c.m=g,c.P=!0,Ws(c,null)}function Ws(c,f){c.F=Date.now(),Tr(c),c.A=pn(c.v);var g=c.A,w=c.R;Array.isArray(w)||(w=[String(w)]),wy(g.i,"t",w),c.C=0,g=c.j.J,c.h=new Vn,c.g=Ly(c.j,g?f:null,!c.m),0<c.O&&(c.M=new Vs(p(c.Y,c,c.g),c.O)),f=c.U,g=c.g,w=c.ca;var L="readystatechange";Array.isArray(L)||(L&&(Cc[0]=L.toString()),L=Cc);for(var $=0;$<L.length;$++){var Z=Gt(g,L[$],w||f.handleEvent,!1,f.h||f);if(!Z)break;f.g[Z.key]=Z}f=c.H?E(c.H):{},c.m?(c.u||(c.u="POST"),f["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.A,c.u,c.m,f)):(c.u="GET",c.g.ea(c.A,c.u,null,f)),ji(),Oc(c.i,c.u,c.A,c.l,c.R,c.m)}hn.prototype.ca=function(c){c=c.target;const f=this.M;f&&wr(c)==3?f.j():this.Y(c)},hn.prototype.Y=function(c){try{if(c==this.g)e:{const It=wr(this.g);var f=this.g.Ba();const Ks=this.g.Z();if(!(3>It)&&(It!=3||this.g&&(this.h.h||this.g.oa()||Py(this.g)))){this.J||It!=4||f==7||(f==8||0>=Ks?ji(3):ji(2)),Ln(this);var g=this.g.Z();this.X=g;t:if(Fc(this)){var w=Py(this.g);c="";var L=w.length,$=wr(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){yt(this),Ht(this);var Z="";break t}this.h.i=new a.TextDecoder}for(f=0;f<L;f++)this.h.h=!0,c+=this.h.i.decode(w[f],{stream:!($&&f==L-1)});w.length=0,this.h.g+=c,this.C=0,Z=this.h.g}else Z=this.g.oa();if(this.o=g==200,ba(this.i,this.u,this.A,this.l,this.R,It,g),this.o){if(this.T&&!this.K){t:{if(this.g){var be,Tt=this.g;if((be=Tt.g?Tt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(be)){var ye=be;break t}}ye=null}if(g=ye)$r(this.i,this.l,g,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vr(this,g);else{this.o=!1,this.s=3,mt(12),yt(this),Ht(this);break e}}if(this.P){g=!0;let In;for(;!this.J&&this.C<Z.length;)if(In=fd(this,Z),In==yr){It==4&&(this.s=4,mt(14),g=!1),$r(this.i,this.l,null,"[Incomplete Response]");break}else if(In==Hr){this.s=4,mt(15),$r(this.i,this.l,Z,"[Invalid Chunk]"),g=!1;break}else $r(this.i,this.l,In,null),vr(this,In);if(Fc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),It!=4||Z.length!=0||this.h.h||(this.s=1,mt(16),g=!1),this.o=this.o&&g,!g)$r(this.i,this.l,Z,"[Invalid Chunked Response]"),yt(this),Ht(this);else if(0<Z.length&&!this.W){this.W=!0;var bt=this.j;bt.g==this&&bt.ba&&!bt.M&&(bt.j.info("Great, no buffering proxy detected. Bytes received: "+Z.length),_d(bt),bt.M=!0,mt(11))}}else $r(this.i,this.l,Z,null),vr(this,Z);It==4&&yt(this),this.o&&!this.J&&(It==4?Fy(this.j,this):(this.o=!1,Tr(this)))}else Xb(this.g),g==400&&0<Z.indexOf("Unknown SID")?(this.s=3,mt(12)):(this.s=0,mt(13)),yt(this),Ht(this)}}}catch{}finally{}};function Fc(c){return c.g?c.u=="GET"&&c.L!=2&&c.j.Ca:!1}function fd(c,f){var g=c.C,w=f.indexOf(`
`,g);return w==-1?yr:(g=Number(f.substring(g,w)),isNaN(g)?Hr:(w+=1,w+g>f.length?yr:(f=f.slice(w,w+g),c.C=w+g,f)))}hn.prototype.cancel=function(){this.J=!0,yt(this)};function Tr(c){c.S=Date.now()+c.I,Bt(c,c.I)}function Bt(c,f){if(c.B!=null)throw Error("WatchDog timer not null");c.B=$i(p(c.ba,c),f)}function Ln(c){c.B&&(a.clearTimeout(c.B),c.B=null)}hn.prototype.ba=function(){this.B=null;const c=Date.now();0<=c-this.S?(Dc(this.i,this.A),this.L!=2&&(ji(),mt(17)),yt(this),this.s=2,Ht(this)):Bt(this,this.S-c)};function Ht(c){c.j.G==0||c.J||Fy(c.j,c)}function yt(c){Ln(c);var f=c.M;f&&typeof f.ma=="function"&&f.ma(),c.M=null,Pc(c.U),c.g&&(f=c.g,c.g=null,f.abort(),f.ma())}function vr(c,f){try{var g=c.j;if(g.G!=0&&(g.g==c||qr(g.h,c))){if(!c.K&&qr(g.h,c)&&g.G==3){try{var w=g.Da.g.parse(f)}catch{w=null}if(Array.isArray(w)&&w.length==3){var L=w;if(L[0]==0){e:if(!g.u){if(g.g)if(g.g.F+3e3<c.F)Wc(g),zc(g);else break e;gd(g),mt(18)}}else g.za=L[1],0<g.za-g.T&&37500>L[2]&&g.F&&g.v==0&&!g.C&&(g.C=$i(p(g.Za,g),6e3));if(1>=Pa(g.h)&&g.ca){try{g.ca()}catch{}g.ca=void 0}}else Zi(g,11)}else if((c.K||g.g==c)&&Wc(g),!m(f))for(L=g.Da.g.parse(f),f=0;f<L.length;f++){let ye=L[f];if(g.T=ye[0],ye=ye[1],g.G==2)if(ye[0]=="c"){g.K=ye[1],g.ia=ye[2];const bt=ye[3];bt!=null&&(g.la=bt,g.j.info("VER="+g.la));const It=ye[4];It!=null&&(g.Aa=It,g.j.info("SVER="+g.Aa));const Ks=ye[5];Ks!=null&&typeof Ks=="number"&&0<Ks&&(w=1.5*Ks,g.L=w,g.j.info("backChannelRequestTimeoutMs_="+w)),w=g;const In=c.g;if(In){const Hc=In.g?In.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Hc){var $=w.h;$.g||Hc.indexOf("spdy")==-1&&Hc.indexOf("quic")==-1&&Hc.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(Vt($,$.h),$.h=null))}if(w.D){const md=In.g?In.g.getResponseHeader("X-HTTP-Session-Id"):null;md&&(w.ya=md,Re(w.I,w.D,md))}}g.G=3,g.l&&g.l.ua(),g.ba&&(g.R=Date.now()-c.F,g.j.info("Handshake RTT: "+g.R+"ms")),w=g;var Z=c;if(w.qa=Vy(w,w.J?w.ia:null,w.W),Z.K){Ki(w.h,Z);var be=Z,Tt=w.L;Tt&&(be.I=Tt),be.B&&(Ln(be),Tr(be)),w.g=Z}else Oy(w);0<g.i.length&&jc(g)}else ye[0]!="stop"&&ye[0]!="close"||Zi(g,7);else g.G==3&&(ye[0]=="stop"||ye[0]=="close"?ye[0]=="stop"?Zi(g,7):pd(g):ye[0]!="noop"&&g.l&&g.l.ta(ye),g.v=0)}}ji(4)}catch{}}var fn=class{constructor(c,f){this.g=c,this.map=f}};function dn(c){this.l=c||10,a.PerformanceNavigationTiming?(c=a.performance.getEntriesByType("navigation"),c=0<c.length&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ca(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function Pa(c){return c.h?1:c.g?c.g.size:0}function qr(c,f){return c.h?c.h==f:c.g?c.g.has(f):!1}function Vt(c,f){c.g?c.g.add(f):c.h=f}function Ki(c,f){c.h&&c.h==f?c.h=null:c.g&&c.g.has(f)&&c.g.delete(f)}dn.prototype.cancel=function(){if(this.i=$s(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function $s(c){if(c.h!=null)return c.i.concat(c.h.D);if(c.g!=null&&c.g.size!==0){let f=c.i;for(const g of c.g.values())f=f.concat(g.D);return f}return S(c.i)}function xa(c){if(c.V&&typeof c.V=="function")return c.V();if(typeof Map<"u"&&c instanceof Map||typeof Set<"u"&&c instanceof Set)return Array.from(c.values());if(typeof c=="string")return c.split("");if(l(c)){for(var f=[],g=c.length,w=0;w<g;w++)f.push(c[w]);return f}f=[],g=0;for(w in c)f[g++]=c[w];return f}function Na(c){if(c.na&&typeof c.na=="function")return c.na();if(!c.V||typeof c.V!="function"){if(typeof Map<"u"&&c instanceof Map)return Array.from(c.keys());if(!(typeof Set<"u"&&c instanceof Set)){if(l(c)||typeof c=="string"){var f=[];c=c.length;for(var g=0;g<c;g++)f.push(g);return f}f=[],g=0;for(const w in c)f[g++]=w;return f}}}function Hs(c,f){if(c.forEach&&typeof c.forEach=="function")c.forEach(f,void 0);else if(l(c)||typeof c=="string")Array.prototype.forEach.call(c,f,void 0);else for(var g=Na(c),w=xa(c),L=w.length,$=0;$<L;$++)f.call(void 0,w[$],g&&g[$],c)}var Yi=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zn(c,f){if(c){c=c.split("&");for(var g=0;g<c.length;g++){var w=c[g].indexOf("="),L=null;if(0<=w){var $=c[g].substring(0,w);L=c[g].substring(w+1)}else $=c[g];f($,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function Er(c){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,c instanceof Er){this.h=c.h,Kr(this,c.j),this.o=c.o,this.g=c.g,Qi(this,c.s),this.l=c.l;var f=c.i,g=new Xe;g.i=f.i,f.g&&(g.g=new Map(f.g),g.h=f.h),Uc(this,g),this.m=c.m}else c&&(f=String(c).match(Yi))?(this.h=!1,Kr(this,f[1]||"",!0),this.o=R(f[2]||""),this.g=R(f[3]||"",!0),Qi(this,f[4]),this.l=R(f[5]||"",!0),Uc(this,f[6]||"",!0),this.m=R(f[7]||"")):(this.h=!1,this.i=new Xe(null,this.h))}Er.prototype.toString=function(){var c=[],f=this.j;f&&c.push(M(f,X,!0),":");var g=this.g;return(g||f=="file")&&(c.push("//"),(f=this.o)&&c.push(M(f,X,!0),"@"),c.push(encodeURIComponent(String(g)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.s,g!=null&&c.push(":",String(g))),(g=this.l)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(M(g,g.charAt(0)=="/"?ue:G,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",M(g,nt)),c.join("")};function pn(c){return new Er(c)}function Kr(c,f,g){c.j=g?R(f,!0):f,c.j&&(c.j=c.j.replace(/:$/,""))}function Qi(c,f){if(f){if(f=Number(f),isNaN(f)||0>f)throw Error("Bad port number "+f);c.s=f}else c.s=null}function Uc(c,f,g){f instanceof Xe?(c.i=f,Vb(c.i,c.h)):(g||(f=M(f,Qe)),c.i=new Xe(f,c.h))}function Re(c,f,g){c.i.set(f,g)}function y(c){return Re(c,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),c}function R(c,f){return c?f?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function M(c,f,g){return typeof c=="string"?(c=encodeURI(c).replace(f,W),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function W(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var X=/[#\/\?@]/g,G=/[#\?:]/g,ue=/[#\?]/g,Qe=/[#\?@]/g,nt=/#/g;function Xe(c,f){this.h=this.g=null,this.i=c||null,this.j=!!f}function rt(c){c.g||(c.g=new Map,c.h=0,c.i&&zn(c.i,function(f,g){c.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}t=Xe.prototype,t.add=function(c,f){rt(this),this.i=null,c=Xs(this,c);var g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(f),this.h+=1,this};function vy(c,f){rt(c),f=Xs(c,f),c.g.has(f)&&(c.i=null,c.h-=c.g.get(f).length,c.g.delete(f))}function Ey(c,f){return rt(c),f=Xs(c,f),c.g.has(f)}t.forEach=function(c,f){rt(this),this.g.forEach(function(g,w){g.forEach(function(L){c.call(f,L,w,this)},this)},this)},t.na=function(){rt(this);const c=Array.from(this.g.values()),f=Array.from(this.g.keys()),g=[];for(let w=0;w<f.length;w++){const L=c[w];for(let $=0;$<L.length;$++)g.push(f[w])}return g},t.V=function(c){rt(this);let f=[];if(typeof c=="string")Ey(this,c)&&(f=f.concat(this.g.get(Xs(this,c))));else{c=Array.from(this.g.values());for(let g=0;g<c.length;g++)f=f.concat(c[g])}return f},t.set=function(c,f){return rt(this),this.i=null,c=Xs(this,c),Ey(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[f]),this.h+=1,this},t.get=function(c,f){return c?(c=this.V(c),0<c.length?String(c[0]):f):f};function wy(c,f,g){vy(c,f),0<g.length&&(c.i=null,c.g.set(Xs(c,f),S(g)),c.h+=g.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],f=Array.from(this.g.keys());for(var g=0;g<f.length;g++){var w=f[g];const $=encodeURIComponent(String(w)),Z=this.V(w);for(w=0;w<Z.length;w++){var L=$;Z[w]!==""&&(L+="="+encodeURIComponent(String(Z[w]))),c.push(L)}}return this.i=c.join("&")};function Xs(c,f){return f=String(f),c.j&&(f=f.toLowerCase()),f}function Vb(c,f){f&&!c.j&&(rt(c),c.i=null,c.g.forEach(function(g,w){var L=w.toLowerCase();w!=L&&(vy(this,w),wy(this,L,g))},c)),c.j=f}function Lb(c,f){const g=new Hi;if(a.Image){const w=new Image;w.onload=_(Yr,g,"TestLoadImage: loaded",!0,f,w),w.onerror=_(Yr,g,"TestLoadImage: error",!1,f,w),w.onabort=_(Yr,g,"TestLoadImage: abort",!1,f,w),w.ontimeout=_(Yr,g,"TestLoadImage: timeout",!1,f,w),a.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=c}else f(!1)}function zb(c,f){const g=new Hi,w=new AbortController,L=setTimeout(()=>{w.abort(),Yr(g,"TestPingServer: timeout",!1,f)},1e4);fetch(c,{signal:w.signal}).then($=>{clearTimeout(L),$.ok?Yr(g,"TestPingServer: ok",!0,f):Yr(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(L),Yr(g,"TestPingServer: error",!1,f)})}function Yr(c,f,g,w,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),w(g)}catch{}}function jb(){this.g=new ud}function Wb(c,f,g){const w=g||"";try{Hs(c,function(L,$){let Z=L;u(L)&&(Z=Sa(L)),f.push(w+$+"="+encodeURIComponent(Z))})}catch(L){throw f.push(w+"type="+encodeURIComponent("_badmap")),L}}function Bc(c){this.l=c.Ub||null,this.j=c.eb||!1}A(Bc,jr),Bc.prototype.g=function(){return new Vc(this.l,this.j)},Bc.prototype.i=function(c){return function(){return c}}({});function Vc(c,f){ut.call(this),this.D=c,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}A(Vc,ut),t=Vc.prototype,t.open=function(c,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=c,this.A=f,this.readyState=1,Ma(this)},t.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const f={headers:this.u,method:this.B,credentials:this.m,cache:void 0};c&&(f.body=c),(this.D||a).fetch(new Request(this.A,f)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ka(this)),this.readyState=0},t.Sa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,Ma(this)),this.g&&(this.readyState=3,Ma(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ay(this)}else c.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ay(c){c.j.read().then(c.Pa.bind(c)).catch(c.ga.bind(c))}t.Pa=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var f=c.value?c.value:new Uint8Array(0);(f=this.v.decode(f,{stream:!c.done}))&&(this.response=this.responseText+=f)}c.done?ka(this):Ma(this),this.readyState==3&&Ay(this)}},t.Ra=function(c){this.g&&(this.response=this.responseText=c,ka(this))},t.Qa=function(c){this.g&&(this.response=c,ka(this))},t.ga=function(){this.g&&ka(this)};function ka(c){c.readyState=4,c.l=null,c.j=null,c.v=null,Ma(c)}t.setRequestHeader=function(c,f){this.u.append(c,f)},t.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=f.next();return c.join(`\r
`)};function Ma(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(Vc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Sy(c){let f="";return j(c,function(g,w){f+=w,f+=":",f+=g,f+=`\r
`}),f}function dd(c,f,g){e:{for(w in g){var w=!1;break e}w=!0}w||(g=Sy(g),typeof c=="string"?g!=null&&encodeURIComponent(String(g)):Re(c,f,g))}function We(c){ut.call(this),this.headers=new Map,this.o=c||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}A(We,ut);var $b=/^https?$/i,Hb=["POST","PUT"];t=We.prototype,t.Ha=function(c){this.J=c},t.ea=function(c,f,g,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);f=f?f.toUpperCase():"GET",this.D=c,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():js.g(),this.v=this.o?xc(this.o):xc(js),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(f,String(c),!0),this.B=!1}catch($){Ry(this,$);return}if(c=g||"",g=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var L in w)g.set(L,w[L]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const $ of w.keys())g.set($,w.get($));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(g.keys()).find($=>$.toLowerCase()=="content-type"),L=a.FormData&&c instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Hb,f,void 0))||w||L||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,Z]of g)this.g.setRequestHeader($,Z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Cy(this),this.u=!0,this.g.send(c),this.u=!1}catch($){Ry(this,$)}};function Ry(c,f){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=f,c.m=5,by(c),Lc(c)}function by(c){c.A||(c.A=!0,ht(c,"complete"),ht(c,"error"))}t.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=c||7,ht(this,"complete"),ht(this,"abort"),Lc(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Lc(this,!0)),We.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Iy(this):this.bb())},t.bb=function(){Iy(this)};function Iy(c){if(c.h&&typeof o<"u"&&(!c.v[1]||wr(c)!=4||c.Z()!=2)){if(c.u&&wr(c)==4)wa(c.Ea,0,c);else if(ht(c,"readystatechange"),wr(c)==4){c.h=!1;try{const Z=c.Z();e:switch(Z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break e;default:f=!1}var g;if(!(g=f)){var w;if(w=Z===0){var L=String(c.D).match(Yi)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),w=!$b.test(L?L.toLowerCase():"")}g=w}if(g)ht(c,"complete"),ht(c,"success");else{c.m=6;try{var $=2<wr(c)?c.g.statusText:""}catch{$=""}c.l=$+" ["+c.Z()+"]",by(c)}}finally{Lc(c)}}}}function Lc(c,f){if(c.g){Cy(c);const g=c.g,w=c.v[0]?()=>{}:null;c.g=null,c.v=null,f||ht(c,"ready");try{g.onreadystatechange=w}catch{}}}function Cy(c){c.I&&(a.clearTimeout(c.I),c.I=null)}t.isActive=function(){return!!this.g};function wr(c){return c.g?c.g.readyState:0}t.Z=function(){try{return 2<wr(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(c){if(this.g){var f=this.g.responseText;return c&&f.indexOf(c)==0&&(f=f.substring(c.length)),cd(f)}};function Py(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.H){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Xb(c){const f={};c=(c.g&&2<=wr(c)&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<c.length;w++){if(m(c[w]))continue;var g=O(c[w]);const L=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const $=f[L]||[];f[L]=$,$.push(g)}P(f,function(w){return w.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Oa(c,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||f}function xy(c){this.Aa=0,this.i=[],this.j=new Hi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Oa("failFast",!1,c),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Oa("baseRetryDelayMs",5e3,c),this.cb=Oa("retryDelaySeedMs",1e4,c),this.Wa=Oa("forwardChannelMaxRetries",2,c),this.wa=Oa("forwardChannelRequestTimeoutMs",2e4,c),this.pa=c&&c.xmlHttpFactory||void 0,this.Xa=c&&c.Tb||void 0,this.Ca=c&&c.useFetchStreams||!1,this.L=void 0,this.J=c&&c.supportsCrossDomainXhr||!1,this.K="",this.h=new dn(c&&c.concurrentRequestLimit),this.Da=new jb,this.P=c&&c.fastHandshake||!1,this.O=c&&c.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=c&&c.Rb||!1,c&&c.xa&&this.j.xa(),c&&c.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&c&&c.detectBufferingProxy||!1,this.ja=void 0,c&&c.longPollingTimeout&&0<c.longPollingTimeout&&(this.ja=c.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=xy.prototype,t.la=8,t.G=1,t.connect=function(c,f,g,w){mt(0),this.W=c,this.H=f||{},g&&w!==void 0&&(this.H.OSID=g,this.H.OAID=w),this.F=this.X,this.I=Vy(this,null,this.W),jc(this)};function pd(c){if(Ny(c),c.G==3){var f=c.U++,g=pn(c.I);if(Re(g,"SID",c.K),Re(g,"RID",f),Re(g,"TYPE","terminate"),Da(c,g),f=new hn(c,c.j,f),f.L=2,f.v=y(pn(g)),g=!1,a.navigator&&a.navigator.sendBeacon)try{g=a.navigator.sendBeacon(f.v.toString(),"")}catch{}!g&&a.Image&&(new Image().src=f.v,g=!0),g||(f.g=Ly(f.j,null),f.g.ea(f.v)),f.F=Date.now(),Tr(f)}By(c)}function zc(c){c.g&&(_d(c),c.g.cancel(),c.g=null)}function Ny(c){zc(c),c.u&&(a.clearTimeout(c.u),c.u=null),Wc(c),c.h.cancel(),c.s&&(typeof c.s=="number"&&a.clearTimeout(c.s),c.s=null)}function jc(c){if(!Ca(c.h)&&!c.s){c.s=!0;var f=c.Ga;un||ce(),J||(un(),J=!0),ie.add(f,c),c.B=0}}function qb(c,f){return Pa(c.h)>=c.h.j-(c.s?1:0)?!1:c.s?(c.i=f.D.concat(c.i),!0):c.G==1||c.G==2||c.B>=(c.Va?0:c.Wa)?!1:(c.s=$i(p(c.Ga,c,f),Uy(c,c.B)),c.B++,!0)}t.Ga=function(c){if(this.s)if(this.s=null,this.G==1){if(!c){this.U=Math.floor(1e5*Math.random()),c=this.U++;const L=new hn(this,this.j,c);let $=this.o;if(this.S&&($?($=E($),x($,this.S)):$=this.S),this.m!==null||this.O||(L.H=$,$=null),this.P)e:{for(var f=0,g=0;g<this.i.length;g++){t:{var w=this.i[g];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(f+=w,4096<f){f=g;break e}if(f===4096||g===this.i.length-1){f=g+1;break e}}f=1e3}else f=1e3;f=My(this,L,f),g=pn(this.I),Re(g,"RID",c),Re(g,"CVER",22),this.D&&Re(g,"X-HTTP-Session-Id",this.D),Da(this,g),$&&(this.O?f="headers="+encodeURIComponent(String(Sy($)))+"&"+f:this.m&&dd(g,this.m,$)),Vt(this.h,L),this.Ua&&Re(g,"TYPE","init"),this.P?(Re(g,"$req",f),Re(g,"SID","null"),L.T=!0,Xr(L,g,null)):Xr(L,g,f),this.G=2}}else this.G==3&&(c?ky(this,c):this.i.length==0||Ca(this.h)||ky(this))};function ky(c,f){var g;f?g=f.l:g=c.U++;const w=pn(c.I);Re(w,"SID",c.K),Re(w,"RID",g),Re(w,"AID",c.T),Da(c,w),c.m&&c.o&&dd(w,c.m,c.o),g=new hn(c,c.j,g,c.B+1),c.m===null&&(g.H=c.o),f&&(c.i=f.D.concat(c.i)),f=My(c,g,1e3),g.I=Math.round(.5*c.wa)+Math.round(.5*c.wa*Math.random()),Vt(c.h,g),Xr(g,w,f)}function Da(c,f){c.H&&j(c.H,function(g,w){Re(f,w,g)}),c.l&&Hs({},function(g,w){Re(f,w,g)})}function My(c,f,g){g=Math.min(c.i.length,g);var w=c.l?p(c.l.Na,c.l,c):null;e:{var L=c.i;let $=-1;for(;;){const Z=["count="+g];$==-1?0<g?($=L[0].g,Z.push("ofs="+$)):$=0:Z.push("ofs="+$);let be=!0;for(let Tt=0;Tt<g;Tt++){let ye=L[Tt].g;const bt=L[Tt].map;if(ye-=$,0>ye)$=Math.max(0,L[Tt].g-100),be=!1;else try{Wb(bt,Z,"req"+ye+"_")}catch{w&&w(bt)}}if(be){w=Z.join("&");break e}}}return c=c.i.splice(0,g),f.D=c,w}function Oy(c){if(!c.g&&!c.u){c.Y=1;var f=c.Fa;un||ce(),J||(un(),J=!0),ie.add(f,c),c.v=0}}function gd(c){return c.g||c.u||3<=c.v?!1:(c.Y++,c.u=$i(p(c.Fa,c),Uy(c,c.v)),c.v++,!0)}t.Fa=function(){if(this.u=null,Dy(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var c=2*this.R;this.j.info("BP detection timer enabled: "+c),this.A=$i(p(this.ab,this),c)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,mt(10),zc(this),Dy(this))};function _d(c){c.A!=null&&(a.clearTimeout(c.A),c.A=null)}function Dy(c){c.g=new hn(c,c.j,"rpc",c.Y),c.m===null&&(c.g.H=c.o),c.g.O=0;var f=pn(c.qa);Re(f,"RID","rpc"),Re(f,"SID",c.K),Re(f,"AID",c.T),Re(f,"CI",c.F?"0":"1"),!c.F&&c.ja&&Re(f,"TO",c.ja),Re(f,"TYPE","xmlhttp"),Da(c,f),c.m&&c.o&&dd(f,c.m,c.o),c.L&&(c.g.I=c.L);var g=c.g;c=c.ia,g.L=1,g.v=y(pn(f)),g.m=null,g.P=!0,Ws(g,c)}t.Za=function(){this.C!=null&&(this.C=null,zc(this),gd(this),mt(19))};function Wc(c){c.C!=null&&(a.clearTimeout(c.C),c.C=null)}function Fy(c,f){var g=null;if(c.g==f){Wc(c),_d(c),c.g=null;var w=2}else if(qr(c.h,f))g=f.D,Ki(c.h,f),w=1;else return;if(c.G!=0){if(f.o)if(w==1){g=f.m?f.m.length:0,f=Date.now()-f.F;var L=c.B;w=zs(),ht(w,new Wi(w,g)),jc(c)}else Oy(c);else if(L=f.s,L==3||L==0&&0<f.X||!(w==1&&qb(c,f)||w==2&&gd(c)))switch(g&&0<g.length&&(f=c.h,f.i=f.i.concat(g)),L){case 1:Zi(c,5);break;case 4:Zi(c,10);break;case 3:Zi(c,6);break;default:Zi(c,2)}}}function Uy(c,f){let g=c.Ta+Math.floor(Math.random()*c.cb);return c.isActive()||(g*=2),g*f}function Zi(c,f){if(c.j.info("Error code "+f),f==2){var g=p(c.fb,c),w=c.Xa;const L=!w;w=new Er(w||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Kr(w,"https"),y(w),L?Lb(w.toString(),g):zb(w.toString(),g)}else mt(2);c.G=0,c.l&&c.l.sa(f),By(c),Ny(c)}t.fb=function(c){c?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))};function By(c){if(c.G=0,c.ka=[],c.l){const f=$s(c.h);(f.length!=0||c.i.length!=0)&&(k(c.ka,f),k(c.ka,c.i),c.h.i.length=0,S(c.i),c.i.length=0),c.l.ra()}}function Vy(c,f,g){var w=g instanceof Er?pn(g):new Er(g);if(w.g!="")f&&(w.g=f+"."+w.g),Qi(w,w.s);else{var L=a.location;w=L.protocol,f=f?f+"."+L.hostname:L.hostname,L=+L.port;var $=new Er(null);w&&Kr($,w),f&&($.g=f),L&&Qi($,L),g&&($.l=g),w=$}return g=c.D,f=c.ya,g&&f&&Re(w,g,f),Re(w,"VER",c.la),Da(c,w),w}function Ly(c,f,g){if(f&&!c.J)throw Error("Can't create secondary domain capable XhrIo object.");return f=c.Ca&&!c.pa?new We(new Bc({eb:g})):new We(c.pa),f.Ha(c.J),f}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function zy(){}t=zy.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function $c(){}$c.prototype.g=function(c,f){return new en(c,f)};function en(c,f){ut.call(this),this.g=new xy(f),this.l=c,this.h=f&&f.messageUrlParams||null,c=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(c?c["X-WebChannel-Content-Type"]=f.messageContentType:c={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.va&&(c?c["X-WebChannel-Client-Profile"]=f.va:c={"X-WebChannel-Client-Profile":f.va}),this.g.S=c,(c=f&&f.Sb)&&!m(c)&&(this.g.m=c),this.v=f&&f.supportsCrossDomainXhr||!1,this.u=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!m(f)&&(this.g.D=f,c=this.h,c!==null&&f in c&&(c=this.h,f in c&&delete c[f])),this.j=new qs(this)}A(en,ut),en.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},en.prototype.close=function(){pd(this.g)},en.prototype.o=function(c){var f=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.u&&(g={},g.__data__=Sa(c),c=g);f.i.push(new fn(f.Ya++,c)),f.G==3&&jc(f)},en.prototype.N=function(){this.g.l=null,delete this.j,pd(this.g),delete this.g,en.aa.N.call(this)};function jy(c){Ls.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var f=c.__sm__;if(f){e:{for(const g in f){c=g;break e}c=void 0}(this.i=c)&&(c=this.i,f=f!==null&&c in f?f[c]:void 0),this.data=f}else this.data=c}A(jy,Ls);function Wy(){zi.call(this),this.status=1}A(Wy,zi);function qs(c){this.g=c}A(qs,zy),qs.prototype.ua=function(){ht(this.g,"a")},qs.prototype.ta=function(c){ht(this.g,new jy(c))},qs.prototype.sa=function(c){ht(this.g,new Wy)},qs.prototype.ra=function(){ht(this.g,"b")},$c.prototype.createWebChannel=$c.prototype.g,en.prototype.send=en.prototype.o,en.prototype.open=en.prototype.m,en.prototype.close=en.prototype.close,AR=function(){return new $c},wR=function(){return zs()},ER=mr,d_={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xi.NO_ERROR=0,Xi.TIMEOUT=8,Xi.HTTP_ERROR=6,$u=Xi,Ia.COMPLETE="complete",vR=Ia,Nc.EventType=Wr,Wr.OPEN="a",Wr.CLOSE="b",Wr.ERROR="c",Wr.MESSAGE="d",ut.prototype.listen=ut.prototype.K,sl=Nc,We.prototype.listenOnce=We.prototype.L,We.prototype.getLastError=We.prototype.Ka,We.prototype.getLastErrorCode=We.prototype.Ba,We.prototype.getStatus=We.prototype.Z,We.prototype.getResponseJson=We.prototype.Oa,We.prototype.getResponseText=We.prototype.oa,We.prototype.send=We.prototype.ea,We.prototype.setWithCredentials=We.prototype.Ha,TR=We}).apply(typeof Au<"u"?Au:typeof self<"u"?self:typeof window<"u"?window:{});const pE="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}kt.UNAUTHENTICATED=new kt(null),kt.GOOGLE_CREDENTIALS=new kt("google-credentials-uid"),kt.FIRST_PARTY=new kt("first-party-uid"),kt.MOCK_USER=new kt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ga="11.0.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Is=new fR("@firebase/firestore");function io(){return Is.logLevel}function ee(t,...e){if(Is.logLevel<=ge.DEBUG){const n=e.map(qm);Is.debug(`Firestore (${ga}): ${t}`,...n)}}function Ur(t,...e){if(Is.logLevel<=ge.ERROR){const n=e.map(qm);Is.error(`Firestore (${ga}): ${t}`,...n)}}function ra(t,...e){if(Is.logLevel<=ge.WARN){const n=e.map(qm);Is.warn(`Firestore (${ga}): ${t}`,...n)}}function qm(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(t="Unexpected state"){const e=`FIRESTORE (${ga}) INTERNAL ASSERTION FAILED: `+t;throw Ur(e),new Error(e)}function Te(t,e){t||se()}function le(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ne extends pa{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class jV{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(kt.UNAUTHENTICATED))}shutdown(){}}class WV{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class $V{constructor(e){this.t=e,this.currentUser=kt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Te(this.o===void 0);let r=this.i;const i=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let s=new Si;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Si,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await i(this.currentUser)})},a=l=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Si)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Te(typeof r.accessToken=="string"),new SR(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Te(e===null||typeof e=="string"),new kt(e)}}class HV{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=kt.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class XV{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new HV(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(kt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qV{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KV{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){Te(this.o===void 0);const r=s=>{s.error!=null&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,ee("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Te(typeof n.token=="string"),this.R=n.token,new qV(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YV(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=YV(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function de(t,e){return t<e?-1:t>e?1:0}function ia(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{static now(){return at.fromMillis(Date.now())}static fromDate(e){return at.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new at(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ne(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ne(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new ne(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ne(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?de(this.nanoseconds,e.nanoseconds):de(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{static fromTimestamp(e){return new ae(e)}static min(){return new ae(new at(0,0))}static max(){return new ae(new at(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(e,n,r){n===void 0?n=0:n>e.length&&se(),r===void 0?r=e.length-n:r>e.length-n&&se(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return nc.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof nc?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),o=n.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class De extends nc{construct(e,n,r){return new De(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ne(q.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new De(n)}static emptyPath(){return new De([])}}const QV=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wt extends nc{construct(e,n,r){return new wt(e,n,r)}static isValidIdentifier(e){return QV.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new wt(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new ne(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new ne(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ne(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new ne(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wt(n)}static emptyPath(){return new wt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(De.fromString(e))}static fromName(e){return new re(De.fromString(e).popFirst(5))}static empty(){return new re(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&De.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return De.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new De(e.slice()))}}function ZV(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=ae.fromTimestamp(r===1e9?new at(n+1,0):new at(n,r));return new xi(i,re.empty(),e)}function JV(t){return new xi(t.readTime,t.key,-1)}class xi{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new xi(ae.min(),re.empty(),-1)}static max(){return new xi(ae.max(),re.empty(),-1)}}function GV(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=re.comparator(t.documentKey,e.documentKey),n!==0?n:de(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tL{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _a(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==eL)throw t;ee("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&se(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new H((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof H?n:H.resolve(n)}catch(n){return H.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):H.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):H.reject(n)}static resolve(e){return new H((n,r)=>{n(e)})}static reject(e){return new H((n,r)=>{r(e)})}static waitFor(e){return new H((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},l=>r(l))}),o=!0,s===i&&n()})}static or(e){let n=H.resolve(!1);for(const r of e)n=n.next(i=>i?H.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new H((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const u=l;n(e[u]).next(h=>{o[u]=h,++a,a===s&&r(o)},h=>i(h))}})}static doWhile(e,n){return new H((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function nL(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function ma(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}qf.oe=-1;function Kf(t){return t==null}function qh(t){return t===0&&1/t==-1/0}function rL(t){return typeof t=="number"&&Number.isInteger(t)&&!qh(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iL(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=gE(e)),e=sL(t.get(n),e);return gE(e)}function sL(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function gE(t){return t+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _E(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ds(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function bR(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e,n){this.comparator=e,this.root=n||Et.EMPTY}insert(e,n){return new ze(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Et.BLACK,null,null))}remove(e){return new ze(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Et.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Su(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Su(this.root,e,this.comparator,!1)}getReverseIterator(){return new Su(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Su(this.root,e,this.comparator,!0)}}class Su{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Et{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Et.RED,this.left=i??Et.EMPTY,this.right=s??Et.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new Et(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Et.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Et.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Et.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw se();const e=this.left.check();if(e!==this.right.check())throw se();return e+(this.isRed()?0:1)}}Et.EMPTY=null,Et.RED=!0,Et.BLACK=!1;Et.EMPTY=new class{constructor(){this.size=0}get key(){throw se()}get value(){throw se()}get color(){throw se()}get left(){throw se()}get right(){throw se()}copy(e,n,r,i,s){return this}insert(e,n,r){return new Et(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lt{constructor(e){this.comparator=e,this.data=new ze(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new mE(this.data.getIterator())}getIteratorFrom(e){return new mE(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof lt)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new lt(this.comparator);return n.data=e,n}}class mE{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(e){this.fields=e,e.sort(wt.comparator)}static empty(){return new On([])}unionWith(e){let n=new lt(wt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new On(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return ia(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new IR("Invalid base64 string: "+s):s}}(e);return new Rt(n)}static fromUint8Array(e){const n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Rt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return de(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Rt.EMPTY_BYTE_STRING=new Rt("");const oL=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ni(t){if(Te(!!t),typeof t=="string"){let e=0;const n=oL.exec(t);if(Te(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:qe(t.seconds),nanos:qe(t.nanos)}}function qe(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ki(t){return typeof t=="string"?Rt.fromBase64String(t):Rt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Km(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Yf(t){const e=t.mapValue.fields.__previous_value__;return Km(e)?Yf(e):e}function rc(t){const e=Ni(t.mapValue.fields.__local_write_time__.timestampValue);return new at(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aL{constructor(e,n,r,i,s,o,a,l,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u}}class ic{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new ic("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ic&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Mi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Km(t)?4:cL(t)?9007199254740991:lL(t)?10:11:se()}function or(t,e){if(t===e)return!0;const n=Mi(t);if(n!==Mi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return rc(t).isEqual(rc(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Ni(i.timestampValue),a=Ni(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return ki(i.bytesValue).isEqual(ki(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return qe(i.geoPointValue.latitude)===qe(s.geoPointValue.latitude)&&qe(i.geoPointValue.longitude)===qe(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return qe(i.integerValue)===qe(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=qe(i.doubleValue),a=qe(s.doubleValue);return o===a?qh(o)===qh(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return ia(t.arrayValue.values||[],e.arrayValue.values||[],or);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(_E(o)!==_E(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!or(o[l],a[l])))return!1;return!0}(t,e);default:return se()}}function sc(t,e){return(t.values||[]).find(n=>or(n,e))!==void 0}function sa(t,e){if(t===e)return 0;const n=Mi(t),r=Mi(e);if(n!==r)return de(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return de(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=qe(s.integerValue||s.doubleValue),l=qe(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return yE(t.timestampValue,e.timestampValue);case 4:return yE(rc(t),rc(e));case 5:return de(t.stringValue,e.stringValue);case 6:return function(s,o){const a=ki(s),l=ki(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=de(a[u],l[u]);if(h!==0)return h}return de(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=de(qe(s.latitude),qe(o.latitude));return a!==0?a:de(qe(s.longitude),qe(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return TE(t.arrayValue,e.arrayValue);case 10:return function(s,o){var a,l,u,h;const d=s.fields||{},p=o.fields||{},_=(a=d.value)===null||a===void 0?void 0:a.arrayValue,A=(l=p.value)===null||l===void 0?void 0:l.arrayValue,S=de(((u=_==null?void 0:_.values)===null||u===void 0?void 0:u.length)||0,((h=A==null?void 0:A.values)===null||h===void 0?void 0:h.length)||0);return S!==0?S:TE(_,A)}(t.mapValue,e.mapValue);case 11:return function(s,o){if(s===Ru.mapValue&&o===Ru.mapValue)return 0;if(s===Ru.mapValue)return 1;if(o===Ru.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const p=de(l[d],h[d]);if(p!==0)return p;const _=sa(a[l[d]],u[h[d]]);if(_!==0)return _}return de(l.length,h.length)}(t.mapValue,e.mapValue);default:throw se()}}function yE(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return de(t,e);const n=Ni(t),r=Ni(e),i=de(n.seconds,r.seconds);return i!==0?i:de(n.nanos,r.nanos)}function TE(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=sa(n[i],r[i]);if(s)return s}return de(n.length,r.length)}function oa(t){return p_(t)}function p_(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Ni(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return ki(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return re.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=p_(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${p_(n.fields[o])}`;return i+"}"}(t.mapValue):se()}function Hu(t){switch(Mi(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Yf(t);return e?16+Hu(e):16;case 5:return 2*t.stringValue.length;case 6:return ki(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+Hu(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Ds(r.fields,(s,o)=>{i+=s.length+Hu(o)}),i}(t.mapValue);default:throw se()}}function g_(t){return!!t&&"integerValue"in t}function Ym(t){return!!t&&"arrayValue"in t}function vE(t){return!!t&&"nullValue"in t}function EE(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Xu(t){return!!t&&"mapValue"in t}function lL(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function wl(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ds(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=wl(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=wl(t.arrayValue.values[n]);return e}return Object.assign({},t)}function cL(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(e){this.value=e}static empty(){return new mn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Xu(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=wl(n)}setAll(e){let n=wt.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=wl(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());Xu(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return or(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];Xu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Ds(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new mn(wl(this.value))}}function CR(t){const e=[];return Ds(t.fields,(n,r)=>{const i=new wt([n]);if(Xu(r)){const s=CR(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new On(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Dt(e,0,ae.min(),ae.min(),ae.min(),mn.empty(),0)}static newFoundDocument(e,n,r,i){return new Dt(e,1,n,ae.min(),r,i,0)}static newNoDocument(e,n){return new Dt(e,2,n,ae.min(),ae.min(),mn.empty(),0)}static newUnknownDocument(e,n){return new Dt(e,3,n,ae.min(),ae.min(),mn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ae.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=mn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=mn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ae.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Dt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Dt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kh{constructor(e,n){this.position=e,this.inclusive=n}}function wE(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=re.comparator(re.fromName(o.referenceValue),n.key):r=sa(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function AE(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!or(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e,n="asc"){this.field=e,this.dir=n}}function uL(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{}class st extends PR{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new fL(e,n,r):n==="array-contains"?new gL(e,r):n==="in"?new _L(e,r):n==="not-in"?new mL(e,r):n==="array-contains-any"?new yL(e,r):new st(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new dL(e,r):new pL(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(sa(n,this.value)):n!==null&&Mi(this.value)===Mi(n)&&this.matchesComparison(sa(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return se()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ar extends PR{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new ar(e,n)}matches(e){return xR(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function xR(t){return t.op==="and"}function NR(t){return hL(t)&&xR(t)}function hL(t){for(const e of t.filters)if(e instanceof ar)return!1;return!0}function __(t){if(t instanceof st)return t.field.canonicalString()+t.op.toString()+oa(t.value);if(NR(t))return t.filters.map(e=>__(e)).join(",");{const e=t.filters.map(n=>__(n)).join(",");return`${t.op}(${e})`}}function kR(t,e){return t instanceof st?function(r,i){return i instanceof st&&r.op===i.op&&r.field.isEqual(i.field)&&or(r.value,i.value)}(t,e):t instanceof ar?function(r,i){return i instanceof ar&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&kR(o,i.filters[a]),!0):!1}(t,e):void se()}function MR(t){return t instanceof st?function(n){return`${n.field.canonicalString()} ${n.op} ${oa(n.value)}`}(t):t instanceof ar?function(n){return n.op.toString()+" {"+n.getFilters().map(MR).join(" ,")+"}"}(t):"Filter"}class fL extends st{constructor(e,n,r){super(e,n,r),this.key=re.fromName(r.referenceValue)}matches(e){const n=re.comparator(e.key,this.key);return this.matchesComparison(n)}}class dL extends st{constructor(e,n){super(e,"in",n),this.keys=OR("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class pL extends st{constructor(e,n){super(e,"not-in",n),this.keys=OR("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function OR(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>re.fromName(r.referenceValue))}class gL extends st{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Ym(n)&&sc(n.arrayValue,this.value)}}class _L extends st{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&sc(this.value.arrayValue,n)}}class mL extends st{constructor(e,n){super(e,"not-in",n)}matches(e){if(sc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!sc(this.value.arrayValue,n)}}class yL extends st{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Ym(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>sc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TL{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ue=null}}function SE(t,e=null,n=[],r=[],i=null,s=null,o=null){return new TL(t,e,n,r,i,s,o)}function Qm(t){const e=le(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>__(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Kf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>oa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>oa(r)).join(",")),e.ue=n}return e.ue}function Zm(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!uL(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!kR(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!AE(t.startAt,e.startAt)&&AE(t.endAt,e.endAt)}function m_(t){return re.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qf{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function vL(t,e,n,r,i,s,o,a){return new Qf(t,e,n,r,i,s,o,a)}function DR(t){return new Qf(t)}function RE(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function EL(t){return t.collectionGroup!==null}function Al(t){const e=le(t);if(e.ce===null){e.ce=[];const n=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new lt(wt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Yh(s,r))}),n.has(wt.keyField().canonicalString())||e.ce.push(new Yh(wt.keyField(),r))}return e.ce}function tr(t){const e=le(t);return e.le||(e.le=wL(e,Al(t))),e.le}function wL(t,e){if(t.limitType==="F")return SE(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Yh(i.field,s)});const n=t.endAt?new Kh(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Kh(t.startAt.position,t.startAt.inclusive):null;return SE(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function y_(t,e,n){return new Qf(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Zf(t,e){return Zm(tr(t),tr(e))&&t.limitType===e.limitType}function FR(t){return`${Qm(tr(t))}|lt:${t.limitType}`}function so(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>MR(i)).join(", ")}]`),Kf(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>oa(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>oa(i)).join(",")),`Target(${r})`}(tr(t))}; limitType=${t.limitType})`}function Jf(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):re.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of Al(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,l){const u=wE(o,a,l);return o.inclusive?u<=0:u<0}(r.startAt,Al(r),i)||r.endAt&&!function(o,a,l){const u=wE(o,a,l);return o.inclusive?u>=0:u>0}(r.endAt,Al(r),i))}(t,e)}function AL(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function UR(t){return(e,n)=>{let r=!1;for(const i of Al(t)){const s=SL(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function SL(t,e,n){const r=t.field.isKeyField()?re.comparator(e.key,n.key):function(s,o,a){const l=o.data.field(s),u=a.data.field(s);return l!==null&&u!==null?sa(l,u):se()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return se()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ds(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return bR(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RL=new ze(re.comparator);function Br(){return RL}const BR=new ze(re.comparator);function ol(...t){let e=BR;for(const n of t)e=e.insert(n.key,n);return e}function VR(t){let e=BR;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function fs(){return Sl()}function LR(){return Sl()}function Sl(){return new Fs(t=>t.toString(),(t,e)=>t.isEqual(e))}const bL=new ze(re.comparator),IL=new lt(re.comparator);function fe(...t){let e=IL;for(const n of t)e=e.add(n);return e}const CL=new lt(de);function PL(){return CL}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jm(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qh(e)?"-0":e}}function zR(t){return{integerValue:""+t}}function xL(t,e){return rL(e)?zR(e):Jm(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gf{constructor(){this._=void 0}}function NL(t,e,n){return t instanceof Qh?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Km(s)&&(s=Yf(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(n,e):t instanceof oc?WR(t,e):t instanceof ac?$R(t,e):function(i,s){const o=jR(i,s),a=bE(o)+bE(i.Pe);return g_(o)&&g_(i.Pe)?zR(a):Jm(i.serializer,a)}(t,e)}function kL(t,e,n){return t instanceof oc?WR(t,e):t instanceof ac?$R(t,e):n}function jR(t,e){return t instanceof Zh?function(r){return g_(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class Qh extends Gf{}class oc extends Gf{constructor(e){super(),this.elements=e}}function WR(t,e){const n=HR(e);for(const r of t.elements)n.some(i=>or(i,r))||n.push(r);return{arrayValue:{values:n}}}class ac extends Gf{constructor(e){super(),this.elements=e}}function $R(t,e){let n=HR(e);for(const r of t.elements)n=n.filter(i=>!or(i,r));return{arrayValue:{values:n}}}class Zh extends Gf{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function bE(t){return qe(t.integerValue||t.doubleValue)}function HR(t){return Ym(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function ML(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof oc&&i instanceof oc||r instanceof ac&&i instanceof ac?ia(r.elements,i.elements,or):r instanceof Zh&&i instanceof Zh?or(r.Pe,i.Pe):r instanceof Qh&&i instanceof Qh}(t.transform,e.transform)}class OL{constructor(e,n){this.version=e,this.transformResults=n}}class nr{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new nr}static exists(e){return new nr(void 0,e)}static updateTime(e){return new nr(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function qu(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ed{}function XR(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Gm(t.key,nr.none()):new wc(t.key,t.data,nr.none());{const n=t.data,r=mn.empty();let i=new lt(wt.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Us(t.key,r,new On(i.toArray()),nr.none())}}function DL(t,e,n){t instanceof wc?function(i,s,o){const a=i.value.clone(),l=CE(i.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof Us?function(i,s,o){if(!qu(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=CE(i.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(qR(i)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Rl(t,e,n,r){return t instanceof wc?function(s,o,a,l){if(!qu(s.precondition,o))return a;const u=s.value.clone(),h=PE(s.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof Us?function(s,o,a,l){if(!qu(s.precondition,o))return a;const u=PE(s.fieldTransforms,l,o),h=o.data;return h.setAll(qR(s)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,r):function(s,o,a){return qu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function FL(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=jR(r.transform,i||null);s!=null&&(n===null&&(n=mn.empty()),n.set(r.field,s))}return n||null}function IE(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ia(r,i,(s,o)=>ML(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class wc extends ed{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Us extends ed{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function qR(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function CE(t,e,n){const r=new Map;Te(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,kL(o,a,n[i]))}return r}function PE(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,NL(s,o,e))}return r}class Gm extends ed{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class UL extends ed{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BL{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&DL(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Rl(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Rl(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=LR();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const l=XR(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(ae.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),fe())}isEqual(e){return this.batchId===e.batchId&&ia(this.mutations,e.mutations,(n,r)=>IE(n,r))&&ia(this.baseMutations,e.baseMutations,(n,r)=>IE(n,r))}}class ey{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){Te(e.mutations.length===r.length);let i=function(){return bL}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new ey(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VL{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LL{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Je,pe;function zL(t){switch(t){default:return se();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function KR(t){if(t===void 0)return Ur("GRPC error has no .code"),q.UNKNOWN;switch(t){case Je.OK:return q.OK;case Je.CANCELLED:return q.CANCELLED;case Je.UNKNOWN:return q.UNKNOWN;case Je.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Je.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Je.INTERNAL:return q.INTERNAL;case Je.UNAVAILABLE:return q.UNAVAILABLE;case Je.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Je.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Je.NOT_FOUND:return q.NOT_FOUND;case Je.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Je.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Je.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Je.ABORTED:return q.ABORTED;case Je.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Je.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Je.DATA_LOSS:return q.DATA_LOSS;default:return se()}}(pe=Je||(Je={}))[pe.OK=0]="OK",pe[pe.CANCELLED=1]="CANCELLED",pe[pe.UNKNOWN=2]="UNKNOWN",pe[pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",pe[pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",pe[pe.NOT_FOUND=5]="NOT_FOUND",pe[pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",pe[pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",pe[pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",pe[pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",pe[pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",pe[pe.ABORTED=10]="ABORTED",pe[pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",pe[pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",pe[pe.INTERNAL=13]="INTERNAL",pe[pe.UNAVAILABLE=14]="UNAVAILABLE",pe[pe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WL=new Ts([4294967295,4294967295],0);function xE(t){const e=jL().encode(t),n=new yR;return n.update(e),new Uint8Array(n.digest())}function NE(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ts([n,r],0),new Ts([i,s],0)]}class ty{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new al(`Invalid padding: ${n}`);if(r<0)throw new al(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new al(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new al(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*e.length-n,this.Ie=Ts.fromNumber(this.Te)}Ee(e,n,r){let i=e.add(n.multiply(Ts.fromNumber(r)));return i.compare(WL)===1&&(i=new Ts([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ie).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const n=xE(e),[r,i]=NE(n);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);if(!this.de(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new ty(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const n=xE(e),[r,i]=NE(n);for(let s=0;s<this.hashCount;s++){const o=this.Ee(r,i,s);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class al extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Ac.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new td(ae.min(),i,new ze(de),Br(),fe())}}class Ac{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Ac(r,n,fe(),fe(),fe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku{constructor(e,n,r,i){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=i}}class YR{constructor(e,n){this.targetId=e,this.me=n}}class QR{constructor(e,n,r=Rt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class kE{constructor(){this.fe=0,this.ge=ME(),this.pe=Rt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=fe(),n=fe(),r=fe();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:se()}}),new Ac(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=ME()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Te(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class $L{constructor(e){this.Le=e,this.Be=new Map,this.ke=Br(),this.qe=bu(),this.Qe=bu(),this.Ke=new ze(de)}$e(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.Ue(n,e.Ve):this.We(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.We(n,e.key,e.Ve)}Ge(e){this.forEachTarget(e,n=>{const r=this.ze(n);switch(e.state){case 0:this.je(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.je(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.De(e.resumeToken));break;default:se()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,i)=>{this.je(i)&&n(i)})}Je(e){const n=e.targetId,r=e.me.count,i=this.Ye(n);if(i){const s=i.target;if(m_(s))if(r===0){const o=new re(s.path);this.We(n,o,Dt.newNoDocument(o,ae.min()))}else Te(r===1);else{const o=this.Ze(n);if(o!==r){const a=this.Xe(e),l=a?this.et(a,e,o):1;if(l!==0){this.He(n);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}}}}}Xe(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let o,a;try{o=ki(r).toUint8Array()}catch(l){if(l instanceof IR)return ra("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new ty(o,i,s)}catch(l){return ra(l instanceof al?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.Te===0?null:a}et(e,n,r){return n.me.count===r-this.rt(e,n.targetId)?0:2}rt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(n,s,null),i++)}),i}it(e){const n=new Map;this.Be.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&m_(a.target)){const l=new re(a.target.path);this.st(l).has(o)||this.ot(o,l)||this.We(o,l,Dt.newNoDocument(l,e))}s.be&&(n.set(o,s.ve()),s.Ce())}});let r=fe();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const u=this.Ye(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ke.forEach((s,o)=>o.setReadTime(e));const i=new td(e,n,this.Ke,this.ke,r);return this.ke=Br(),this.qe=bu(),this.Qe=bu(),this.Ke=new ze(de),i}Ue(e,n){if(!this.je(e))return;const r=this.ot(e,n.key)?2:0;this.ze(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e)),this.Qe=this.Qe.insert(n.key,this._t(n.key).add(e))}We(e,n,r){if(!this.je(e))return;const i=this.ze(e);this.ot(e,n)?i.Fe(n,1):i.Me(n),this.Qe=this.Qe.insert(n,this._t(n).delete(e)),this.Qe=this.Qe.insert(n,this._t(n).add(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ze(e){const n=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.ze(e).xe()}ze(e){let n=this.Be.get(e);return n||(n=new kE,this.Be.set(e,n)),n}_t(e){let n=this.Qe.get(e);return n||(n=new lt(de),this.Qe=this.Qe.insert(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new lt(de),this.qe=this.qe.insert(e,n)),n}je(e){const n=this.Ye(e)!==null;return n||ee("WatchChangeAggregator","Detected inactive target",e),n}Ye(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ut(e)}He(e){this.Be.set(e,new kE),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.We(e,n,null)})}ot(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function bu(){return new ze(re.comparator)}function ME(){return new ze(re.comparator)}const HL={asc:"ASCENDING",desc:"DESCENDING"},XL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qL={and:"AND",or:"OR"};class KL{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function T_(t,e){return t.useProto3Json||Kf(e)?e:{value:e}}function Jh(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ZR(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function YL(t,e){return Jh(t,e.toTimestamp())}function rr(t){return Te(!!t),ae.fromTimestamp(function(n){const r=Ni(n);return new at(r.seconds,r.nanos)}(t))}function ny(t,e){return v_(t,e).canonicalString()}function v_(t,e){const n=function(i){return new De(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function JR(t){const e=De.fromString(t);return Te(rb(e)),e}function E_(t,e){return ny(t.databaseId,e.path)}function Sp(t,e){const n=JR(e);if(n.get(1)!==t.databaseId.projectId)throw new ne(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ne(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new re(eb(n))}function GR(t,e){return ny(t.databaseId,e)}function QL(t){const e=JR(t);return e.length===4?De.emptyPath():eb(e)}function w_(t){return new De(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function eb(t){return Te(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function OE(t,e,n){return{name:E_(t,e),fields:n.value.mapValue.fields}}function ZL(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:se()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,h){return u.useProto3Json?(Te(h===void 0||typeof h=="string"),Rt.fromBase64String(h||"")):(Te(h===void 0||h instanceof Buffer||h instanceof Uint8Array),Rt.fromUint8Array(h||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const h=u.code===void 0?q.UNKNOWN:KR(u.code);return new ne(h,u.message||"")}(o);n=new QR(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Sp(t,r.document.name),s=rr(r.document.updateTime),o=r.document.createTime?rr(r.document.createTime):ae.min(),a=new mn({mapValue:{fields:r.document.fields}}),l=Dt.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new Ku(u,h,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Sp(t,r.document),s=r.readTime?rr(r.readTime):ae.min(),o=Dt.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Ku([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Sp(t,r.document),s=r.removedTargetIds||[];n=new Ku([],s,i,null)}else{if(!("filter"in e))return se();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new LL(i,s),a=r.targetId;n=new YR(a,o)}}return n}function JL(t,e){let n;if(e instanceof wc)n={update:OE(t,e.key,e.value)};else if(e instanceof Gm)n={delete:E_(t,e.key)};else if(e instanceof Us)n={update:OE(t,e.key,e.data),updateMask:a5(e.fieldMask)};else{if(!(e instanceof UL))return se();n={verify:E_(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof Qh)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof oc)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ac)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Zh)return{fieldPath:o.field.canonicalString(),increment:a.Pe};throw se()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:YL(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:se()}(t,e.precondition)),n}function GL(t,e){return t&&t.length>0?(Te(e!==void 0),t.map(n=>function(i,s){let o=i.updateTime?rr(i.updateTime):rr(s);return o.isEqual(ae.min())&&(o=rr(s)),new OL(o,i.transformResults||[])}(n,e))):[]}function e5(t,e){return{documents:[GR(t,e.path)]}}function t5(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=GR(t,i);const s=function(u){if(u.length!==0)return nb(ar.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(u){if(u.length!==0)return u.map(h=>function(p){return{field:oo(p.field),direction:i5(p.dir)}}(h))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=T_(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ct:n,parent:i}}function n5(t){let e=QL(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Te(r===1);const h=n.from[0];h.allDescendants?i=h.collectionId:e=e.child(h.collectionId)}let s=[];n.where&&(s=function(d){const p=tb(d);return p instanceof ar&&NR(p)?p.getFilters():[p]}(n.where));let o=[];n.orderBy&&(o=function(d){return d.map(p=>function(A){return new Yh(ao(A.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(A.direction))}(p))}(n.orderBy));let a=null;n.limit&&(a=function(d){let p;return p=typeof d=="object"?d.value:d,Kf(p)?null:p}(n.limit));let l=null;n.startAt&&(l=function(d){const p=!!d.before,_=d.values||[];return new Kh(_,p)}(n.startAt));let u=null;return n.endAt&&(u=function(d){const p=!d.before,_=d.values||[];return new Kh(_,p)}(n.endAt)),vL(e,i,o,s,a,"F",l,u)}function r5(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return se()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function tb(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=ao(n.unaryFilter.field);return st.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=ao(n.unaryFilter.field);return st.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ao(n.unaryFilter.field);return st.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=ao(n.unaryFilter.field);return st.create(o,"!=",{nullValue:"NULL_VALUE"});default:return se()}}(t):t.fieldFilter!==void 0?function(n){return st.create(ao(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return se()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return ar.create(n.compositeFilter.filters.map(r=>tb(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return se()}}(n.compositeFilter.op))}(t):se()}function i5(t){return HL[t]}function s5(t){return XL[t]}function o5(t){return qL[t]}function oo(t){return{fieldPath:t.canonicalString()}}function ao(t){return wt.fromServerFormat(t.fieldPath)}function nb(t){return t instanceof st?function(n){if(n.op==="=="){if(EE(n.value))return{unaryFilter:{field:oo(n.field),op:"IS_NAN"}};if(vE(n.value))return{unaryFilter:{field:oo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(EE(n.value))return{unaryFilter:{field:oo(n.field),op:"IS_NOT_NAN"}};if(vE(n.value))return{unaryFilter:{field:oo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oo(n.field),op:s5(n.op),value:n.value}}}(t):t instanceof ar?function(n){const r=n.getFilters().map(i=>nb(i));return r.length===1?r[0]:{compositeFilter:{op:o5(n.op),filters:r}}}(t):se()}function a5(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function rb(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,n,r,i,s=ae.min(),o=ae.min(),a=Rt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new fi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(e){this.ht=e}}function c5(t){const e=n5({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?y_(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5{constructor(){this.ln=new h5}addToCollectionParentIndex(e,n){return this.ln.add(n),H.resolve()}getCollectionParents(e,n){return H.resolve(this.ln.getEntries(n))}addFieldIndex(e,n){return H.resolve()}deleteFieldIndex(e,n){return H.resolve()}deleteAllFieldIndexes(e){return H.resolve()}createTargetIndexes(e,n){return H.resolve()}getDocumentsMatchingTarget(e,n){return H.resolve(null)}getIndexType(e,n){return H.resolve(0)}getFieldIndexes(e,n){return H.resolve([])}getNextCollectionGroupToUpdate(e){return H.resolve(null)}getMinOffset(e,n){return H.resolve(xi.min())}getMinOffsetFromCollectionGroup(e,n){return H.resolve(xi.min())}updateCollectionGroup(e,n,r){return H.resolve()}updateIndexEntries(e,n){return H.resolve()}}class h5{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new lt(De.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new lt(De.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Xt{static withCacheSize(e){return new Xt(e,Xt.DEFAULT_COLLECTION_PERCENTILE,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xt.DEFAULT_COLLECTION_PERCENTILE=10,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xt.DEFAULT=new Xt(41943040,Xt.DEFAULT_COLLECTION_PERCENTILE,Xt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xt.DISABLED=new Xt(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.kn=e}next(){return this.kn+=2,this.kn}static qn(){return new aa(0)}static Qn(){return new aa(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FE([t,e],[n,r]){const i=de(t,n);return i===0?de(e,r):i}class f5{constructor(e){this.Gn=e,this.buffer=new lt(FE),this.zn=0}jn(){return++this.zn}Hn(e){const n=[e,this.jn()];if(this.buffer.size<this.Gn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();FE(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class d5{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Yn(6e4)}stop(){this.Jn&&(this.Jn.cancel(),this.Jn=null)}get started(){return this.Jn!==null}Yn(e){ee("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ma(n)?ee("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await _a(n)}await this.Yn(3e5)})}}class p5{constructor(e,n){this.Zn=e,this.params=n}calculateTargetCount(e,n){return this.Zn.Xn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return H.resolve(qf.oe);const r=new f5(n);return this.Zn.forEachTarget(e,i=>r.Hn(i.sequenceNumber)).next(()=>this.Zn.er(e,i=>r.Hn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Zn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Zn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(ee("LruGarbageCollector","Garbage collection skipped; disabled"),H.resolve(DE)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),DE):this.tr(e,n))}getCacheSize(e){return this.Zn.getCacheSize(e)}tr(e,n){let r,i,s,o,a,l,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(ee("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,n))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(u=Date.now(),io()<=ge.DEBUG&&ee("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),H.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})))}}function g5(t,e){return new p5(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5{constructor(){this.changes=new Fs(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Dt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?H.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Rl(r.mutation,i,On.empty(),at.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,fe()).next(()=>r))}getLocalViewOfDocuments(e,n,r=fe()){const i=fs();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=ol();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=fs();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,fe()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Br();const o=Sl(),a=function(){return Sl()}();return n.forEach((l,u)=>{const h=r.get(u.key);i.has(u.key)&&(h===void 0||h.mutation instanceof Us)?s=s.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Rl(h.mutation,u,h.mutation.getFieldMask(),at.now())):o.set(u.key,On.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((u,h)=>o.set(u,h)),n.forEach((u,h)=>{var d;return a.set(u,new m5(h,(d=o.get(u))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,n){const r=Sl();let i=new ze((o,a)=>o-a),s=fe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const u=n.get(l);if(u===null)return;let h=r.get(l)||On.empty();h=a.applyToLocalView(u,h),r.set(l,h);const d=(i.get(a.batchId)||fe()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=LR();h.forEach(p=>{if(!s.has(p)){const _=XR(n.get(p),r.get(p));_!==null&&d.set(p,_),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,d))}return H.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):EL(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):H.resolve(fs());let a=-1,l=s;return o.next(u=>H.forEach(u,(h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(h)?H.resolve():this.remoteDocumentCache.getEntry(e,h).next(p=>{l=l.insert(h,p)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,l,u,fe())).next(h=>({batchId:a,changes:VR(h)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new re(n)).next(r=>{let i=ol();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let o=ol();return this.indexManager.getCollectionParents(e,s).next(a=>H.forEach(a,l=>{const u=function(d,p){return new Qf(p,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(h=>{h.forEach((d,p)=>{o=o.insert(d,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,Dt.newInvalidDocument(h)))});let a=ol();return o.forEach((l,u)=>{const h=s.get(l);h!==void 0&&Rl(h.mutation,u,On.empty(),at.now()),Jf(n,u)&&(a=a.insert(l,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5{constructor(e){this.serializer=e,this.Tr=new Map,this.Ir=new Map}getBundleMetadata(e,n){return H.resolve(this.Tr.get(n))}saveBundleMetadata(e,n){return this.Tr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:rr(i.createTime)}}(n)),H.resolve()}getNamedQuery(e,n){return H.resolve(this.Ir.get(n))}saveNamedQuery(e,n){return this.Ir.set(n.name,function(i){return{name:i.name,query:c5(i.bundledQuery),readTime:rr(i.readTime)}}(n)),H.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(){this.overlays=new ze(re.comparator),this.Er=new Map}getOverlay(e,n){return H.resolve(this.overlays.get(n))}getOverlays(e,n){const r=fs();return H.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.Tt(e,n,s)}),H.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Er.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Er.delete(r)),H.resolve()}getOverlaysForCollection(e,n,r){const i=fs(),s=n.length+1,o=new re(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&l.largestBatchId>r&&i.set(l.getKey(),l)}return H.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new ze((u,h)=>u-h);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=fs(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=fs(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((u,h)=>a.set(u,h)),!(a.size()>=i)););return H.resolve(a)}Tt(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Er.get(i.largestBatchId).delete(r.key);this.Er.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new VL(n,r));let s=this.Er.get(n);s===void 0&&(s=fe(),this.Er.set(n,s)),this.Er.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E5{constructor(){this.sessionToken=Rt.EMPTY_BYTE_STRING}getSessionToken(e){return H.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,H.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(){this.dr=new lt(pt.Ar),this.Rr=new lt(pt.Vr)}isEmpty(){return this.dr.isEmpty()}addReference(e,n){const r=new pt(e,n);this.dr=this.dr.add(r),this.Rr=this.Rr.add(r)}mr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.gr(new pt(e,n))}pr(e,n){e.forEach(r=>this.removeReference(r,n))}yr(e){const n=new re(new De([])),r=new pt(n,e),i=new pt(n,e+1),s=[];return this.Rr.forEachInRange([r,i],o=>{this.gr(o),s.push(o.key)}),s}wr(){this.dr.forEach(e=>this.gr(e))}gr(e){this.dr=this.dr.delete(e),this.Rr=this.Rr.delete(e)}Sr(e){const n=new re(new De([])),r=new pt(n,e),i=new pt(n,e+1);let s=fe();return this.Rr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new pt(e,0),r=this.dr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class pt{constructor(e,n){this.key=e,this.br=n}static Ar(e,n){return re.comparator(e.key,n.key)||de(e.br,n.br)}static Vr(e,n){return de(e.br,n.br)||re.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Dr=1,this.vr=new lt(pt.Ar)}checkEmpty(e){return H.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.Dr;this.Dr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new BL(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.vr=this.vr.add(new pt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return H.resolve(o)}lookupMutationBatch(e,n){return H.resolve(this.Cr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Fr(r),s=i<0?0:i;return H.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return H.resolve(this.mutationQueue.length===0?-1:this.Dr-1)}getAllMutationBatches(e){return H.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new pt(n,0),i=new pt(n,Number.POSITIVE_INFINITY),s=[];return this.vr.forEachInRange([r,i],o=>{const a=this.Cr(o.br);s.push(a)}),H.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new lt(de);return n.forEach(i=>{const s=new pt(i,0),o=new pt(i,Number.POSITIVE_INFINITY);this.vr.forEachInRange([s,o],a=>{r=r.add(a.br)})}),H.resolve(this.Mr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;re.isDocumentKey(s)||(s=s.child(""));const o=new pt(new re(s),0);let a=new lt(de);return this.vr.forEachWhile(l=>{const u=l.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(l.br)),!0)},o),H.resolve(this.Mr(a))}Mr(e){const n=[];return e.forEach(r=>{const i=this.Cr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){Te(this.Or(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.vr;return H.forEach(n.mutations,i=>{const s=new pt(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.vr=r})}Ln(e){}containsKey(e,n){const r=new pt(n,0),i=this.vr.firstAfterOrEqual(r);return H.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,H.resolve()}Or(e,n){return this.Fr(e)}Fr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Cr(e){const n=this.Fr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(e){this.Nr=e,this.docs=function(){return new ze(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.Nr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return H.resolve(r?r.document.mutableCopy():Dt.newInvalidDocument(n))}getEntries(e,n){let r=Br();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Dt.newInvalidDocument(i))}),H.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Br();const o=n.path,a=new re(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||GV(JV(h),r)<=0||(i.has(h.key)||Jf(n,h))&&(s=s.insert(h.key,h.mutableCopy()))}return H.resolve(s)}getAllFromCollectionGroup(e,n,r,i){se()}Lr(e,n){return H.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new S5(this)}getSize(e){return H.resolve(this.size)}}class S5 extends _5{constructor(e){super(),this.hr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.hr.addEntry(e,i)):this.hr.removeEntry(r)}),H.waitFor(n)}getFromCache(e,n){return this.hr.getEntry(e,n)}getAllFromCache(e,n){return this.hr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e){this.persistence=e,this.Br=new Fs(n=>Qm(n),Zm),this.lastRemoteSnapshotVersion=ae.min(),this.highestTargetId=0,this.kr=0,this.qr=new ry,this.targetCount=0,this.Qr=aa.qn()}forEachTarget(e,n){return this.Br.forEach((r,i)=>n(i)),H.resolve()}getLastRemoteSnapshotVersion(e){return H.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return H.resolve(this.kr)}allocateTargetId(e){return this.highestTargetId=this.Qr.next(),H.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.kr&&(this.kr=n),H.resolve()}Un(e){this.Br.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Qr=new aa(n),this.highestTargetId=n),e.sequenceNumber>this.kr&&(this.kr=e.sequenceNumber)}addTargetData(e,n){return this.Un(n),this.targetCount+=1,H.resolve()}updateTargetData(e,n){return this.Un(n),H.resolve()}removeTargetData(e,n){return this.Br.delete(n.target),this.qr.yr(n.targetId),this.targetCount-=1,H.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Br.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Br.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),H.waitFor(s).next(()=>i)}getTargetCount(e){return H.resolve(this.targetCount)}getTargetData(e,n){const r=this.Br.get(n)||null;return H.resolve(r)}addMatchingKeys(e,n,r){return this.qr.mr(n,r),H.resolve()}removeMatchingKeys(e,n,r){this.qr.pr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),H.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.qr.yr(n),H.resolve()}getMatchingKeysForTargetId(e,n){const r=this.qr.Sr(n);return H.resolve(r)}containsKey(e,n){return H.resolve(this.qr.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(e,n){this.Kr={},this.overlays={},this.$r=new qf(0),this.Ur=!1,this.Ur=!0,this.Wr=new E5,this.referenceDelegate=e(this),this.Gr=new R5(this),this.indexManager=new u5,this.remoteDocumentCache=function(i){return new A5(i)}(r=>this.referenceDelegate.zr(r)),this.serializer=new l5(n),this.jr=new T5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Ur=!1,Promise.resolve()}get started(){return this.Ur}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new v5,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Kr[e.toKey()];return r||(r=new w5(n,this.referenceDelegate),this.Kr[e.toKey()]=r),r}getGlobalsCache(){return this.Wr}getTargetCache(){return this.Gr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.jr}runTransaction(e,n,r){ee("MemoryPersistence","Starting transaction:",e);const i=new b5(this.$r.next());return this.referenceDelegate.Hr(),r(i).next(s=>this.referenceDelegate.Jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Yr(e,n){return H.or(Object.values(this.Kr).map(r=>()=>r.containsKey(e,n)))}}class b5 extends tL{constructor(e){super(),this.currentSequenceNumber=e}}class iy{constructor(e){this.persistence=e,this.Zr=new ry,this.Xr=null}static ei(e){return new iy(e)}get ti(){if(this.Xr)return this.Xr;throw se()}addReference(e,n,r){return this.Zr.addReference(r,n),this.ti.delete(r.toString()),H.resolve()}removeReference(e,n,r){return this.Zr.removeReference(r,n),this.ti.add(r.toString()),H.resolve()}markPotentiallyOrphaned(e,n){return this.ti.add(n.toString()),H.resolve()}removeTarget(e,n){this.Zr.yr(n.targetId).forEach(i=>this.ti.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.ti.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Hr(){this.Xr=new Set}Jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return H.forEach(this.ti,r=>{const i=re.fromPath(r);return this.ni(e,i).next(s=>{s||n.removeEntry(i,ae.min())})}).next(()=>(this.Xr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ni(e,n).next(r=>{r?this.ti.delete(n.toString()):this.ti.add(n.toString())})}zr(e){return 0}ni(e,n){return H.or([()=>H.resolve(this.Zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Yr(e,n)])}}class Gh{constructor(e,n){this.persistence=e,this.ri=new Fs(r=>iL(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=g5(this,n)}static ei(e,n){return new Gh(e,n)}Hr(){}Jr(e){return H.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}Xn(e){const n=this.nr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}nr(e){let n=0;return this.er(e,r=>{n++}).next(()=>n)}er(e,n){return H.forEach(this.ri,(r,i)=>this.ir(e,r,i).next(s=>s?H.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Lr(e,o=>this.ir(e,o,n).next(a=>{a||(r++,s.removeEntry(o,ae.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.ri.set(n,e.currentSequenceNumber),H.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.ri.set(r,e.currentSequenceNumber),H.resolve()}removeReference(e,n,r){return this.ri.set(r,e.currentSequenceNumber),H.resolve()}updateLimboDocument(e,n){return this.ri.set(n,e.currentSequenceNumber),H.resolve()}zr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Hu(e.data.value)),n}ir(e,n,r){return H.or([()=>this.persistence.Yr(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.ri.get(n);return H.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Wi=r,this.Gi=i}static zi(e,n){let r=fe(),i=fe();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new sy(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(){this.ji=!1,this.Hi=!1,this.Ji=100,this.Yi=function(){return b6()?8:nL(S6())>0?6:4}()}initialize(e,n){this.Zi=e,this.indexManager=n,this.ji=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.Xi(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.es(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new I5;return this.ts(e,n,o).next(a=>{if(s.result=a,this.Hi)return this.ns(e,n,o,a.size)})}).next(()=>s.result)}ns(e,n,r,i){return r.documentReadCount<this.Ji?(io()<=ge.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",so(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Ji,"documents"),H.resolve()):(io()<=ge.DEBUG&&ee("QueryEngine","Query:",so(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Yi*i?(io()<=ge.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",so(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,tr(n))):H.resolve())}Xi(e,n){if(RE(n))return H.resolve(null);let r=tr(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=y_(n,null,"F"),r=tr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=fe(...s);return this.Zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const u=this.rs(n,a);return this.ss(n,u,o,l.readTime)?this.Xi(e,y_(n,null,"F")):this.os(e,u,n,l)}))})))}es(e,n,r,i){return RE(n)||i.isEqual(ae.min())?H.resolve(null):this.Zi.getDocuments(e,r).next(s=>{const o=this.rs(n,s);return this.ss(n,o,r,i)?H.resolve(null):(io()<=ge.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),so(n)),this.os(e,o,n,ZV(i,-1)).next(a=>a))})}rs(e,n){let r=new lt(UR(e));return n.forEach((i,s)=>{Jf(e,s)&&(r=r.add(s))}),r}ss(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ts(e,n,r){return io()<=ge.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",so(n)),this.Zi.getDocumentsMatchingQuery(e,n,xi.min(),r)}os(e,n,r,i){return this.Zi.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5{constructor(e,n,r,i){this.persistence=e,this._s=n,this.serializer=i,this.us=new ze(de),this.cs=new Fs(s=>Qm(s),Zm),this.ls=new Map,this.hs=e.getRemoteDocumentCache(),this.Gr=e.getTargetCache(),this.jr=e.getBundleCache(),this.Ps(r)}Ps(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new y5(this.hs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.hs.setIndexManager(this.indexManager),this._s.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.us))}}function x5(t,e,n,r){return new P5(t,e,n,r)}async function sb(t,e){const n=le(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Ps(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let l=fe();for(const u of i){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of s){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return n.localDocuments.getDocuments(r,l).next(u=>({Ts:u,removedBatchIds:o,addedBatchIds:a}))})})}function N5(t,e){const n=le(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.hs.newChangeBuffer({trackRemovals:!0});return function(a,l,u,h){const d=u.batch,p=d.keys();let _=H.resolve();return p.forEach(A=>{_=_.next(()=>h.getEntry(l,A)).next(S=>{const k=u.docVersions.get(A);Te(k!==null),S.version.compareTo(k)<0&&(d.applyToRemoteDocument(S,u),S.isValidDocument()&&(S.setReadTime(u.commitVersion),h.addEntry(S)))})}),_.next(()=>a.mutationQueue.removeMutationBatch(l,d))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=fe();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function ob(t){const e=le(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Gr.getLastRemoteSnapshotVersion(n))}function k5(t,e){const n=le(t),r=e.snapshotVersion;let i=n.us;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.hs.newChangeBuffer({trackRemovals:!0});i=n.us;const a=[];e.targetChanges.forEach((h,d)=>{const p=i.get(d);if(!p)return;a.push(n.Gr.removeMatchingKeys(s,h.removedDocuments,d).next(()=>n.Gr.addMatchingKeys(s,h.addedDocuments,d)));let _=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?_=_.withResumeToken(Rt.EMPTY_BYTE_STRING,ae.min()).withLastLimboFreeSnapshotVersion(ae.min()):h.resumeToken.approximateByteSize()>0&&(_=_.withResumeToken(h.resumeToken,r)),i=i.insert(d,_),function(S,k,v){return S.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(p,_,h)&&a.push(n.Gr.updateTargetData(s,_))});let l=Br(),u=fe();if(e.documentUpdates.forEach(h=>{e.resolvedLimboDocuments.has(h)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,h))}),a.push(M5(s,o,e.documentUpdates).next(h=>{l=h.Is,u=h.Es})),!r.isEqual(ae.min())){const h=n.Gr.getLastRemoteSnapshotVersion(s).next(d=>n.Gr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(h)}return H.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,u)).next(()=>l)}).then(s=>(n.us=i,s))}function M5(t,e,n){let r=fe(),i=fe();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Br();return n.forEach((a,l)=>{const u=s.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(ae.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ee("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)}),{Is:o,Es:i}})}function O5(t,e){const n=le(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function D5(t,e){const n=le(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Gr.getTargetData(r,e).next(s=>s?(i=s,H.resolve(i)):n.Gr.allocateTargetId(r).next(o=>(i=new fi(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Gr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.us.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.us=n.us.insert(r.targetId,r),n.cs.set(e,r.targetId)),r})}async function A_(t,e,n){const r=le(t),i=r.us.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ma(o))throw o;ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.us=r.us.remove(e),r.cs.delete(i.target)}function UE(t,e,n){const r=le(t);let i=ae.min(),s=fe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,u,h){const d=le(l),p=d.cs.get(h);return p!==void 0?H.resolve(d.us.get(p)):d.Gr.getTargetData(u,h)}(r,o,tr(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Gr.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r._s.getDocumentsMatchingQuery(o,e,n?i:ae.min(),n?s:fe())).next(a=>(F5(r,AL(e),a),{documents:a,ds:s})))}function F5(t,e,n){let r=t.ls.get(e)||ae.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.ls.set(e,r)}class BE{constructor(){this.activeTargetIds=PL()}ps(e){this.activeTargetIds=this.activeTargetIds.add(e)}ys(e){this.activeTargetIds=this.activeTargetIds.delete(e)}gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class U5{constructor(){this._o=new BE,this.ao={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this._o.ps(e),this.ao[e]||"not-current"}updateQueryState(e,n,r){this.ao[e]=n}removeLocalQueryTarget(e){this._o.ys(e)}isLocalQueryTarget(e){return this._o.activeTargetIds.has(e)}clearQueryState(e){delete this.ao[e]}getAllActiveQueryTargets(){return this._o.activeTargetIds}isActiveQueryTarget(e){return this._o.activeTargetIds.has(e)}start(){return this._o=new BE,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{uo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(){this.co=()=>this.lo(),this.ho=()=>this.Po(),this.To=[],this.Io()}uo(e){this.To.push(e)}shutdown(){window.removeEventListener("online",this.co),window.removeEventListener("offline",this.ho)}Io(){window.addEventListener("online",this.co),window.addEventListener("offline",this.ho)}lo(){ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.To)e(0)}Po(){ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.To)e(1)}static p(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Iu=null;function Rp(){return Iu===null?Iu=function(){return 268435456+Math.round(2147483648*Math.random())}():Iu++,"0x"+Iu.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.Eo=e.Eo,this.Ao=e.Ao}Ro(e){this.Vo=e}mo(e){this.fo=e}po(e){this.yo=e}onMessage(e){this.wo=e}close(){this.Ao()}send(e){this.Eo(e)}So(){this.Vo()}bo(){this.fo()}Do(e){this.yo(e)}vo(e){this.wo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="WebChannelConnection";class z5 extends class{get Co(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Fo=r+"://"+n.host,this.Mo=`projects/${i}/databases/${s}`,this.xo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Oo(n,r,i,s,o){const a=Rp(),l=this.No(n,r.toUriEncodedString());ee("RestConnection",`Sending RPC '${n}' ${a}:`,l,i);const u={"google-cloud-resource-prefix":this.Mo,"x-goog-request-params":this.xo};return this.Lo(u,s,o),this.Bo(n,l,u,i).then(h=>(ee("RestConnection",`Received RPC '${n}' ${a}: `,h),h),h=>{throw ra("RestConnection",`RPC '${n}' ${a} failed with error: `,h,"url: ",l,"request:",i),h})}ko(n,r,i,s,o,a){return this.Oo(n,r,i,s,o)}Lo(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ga}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>n[o]=s),i&&i.headers.forEach((s,o)=>n[o]=s)}No(n,r){const i=V5[n];return`${this.Fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Bo(e,n,r,i){const s=Rp();return new Promise((o,a)=>{const l=new TR;l.setWithCredentials(!0),l.listenOnce(vR.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case $u.NO_ERROR:const h=l.getResponseJson();ee(Nt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(h)),o(h);break;case $u.TIMEOUT:ee(Nt,`RPC '${e}' ${s} timed out`),a(new ne(q.DEADLINE_EXCEEDED,"Request time out"));break;case $u.HTTP_ERROR:const d=l.getStatus();if(ee(Nt,`RPC '${e}' ${s} failed with status:`,d,"response text:",l.getResponseText()),d>0){let p=l.getResponseJson();Array.isArray(p)&&(p=p[0]);const _=p==null?void 0:p.error;if(_&&_.status&&_.message){const A=function(k){const v=k.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(v)>=0?v:q.UNKNOWN}(_.status);a(new ne(A,_.message))}else a(new ne(q.UNKNOWN,"Server responded with status "+l.getStatus()))}else a(new ne(q.UNAVAILABLE,"Connection failed."));break;default:se()}}finally{ee(Nt,`RPC '${e}' ${s} completed.`)}});const u=JSON.stringify(i);ee(Nt,`RPC '${e}' ${s} sending request:`,i),l.send(n,"POST",u,r,15)})}qo(e,n,r){const i=Rp(),s=[this.Fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=AR(),a=wR(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Lo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const h=s.join("");ee(Nt,`Creating RPC '${e}' stream ${i}: ${h}`,l);const d=o.createWebChannel(h,l);let p=!1,_=!1;const A=new L5({Eo:k=>{_?ee(Nt,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(p||(ee(Nt,`Opening RPC '${e}' stream ${i} transport.`),d.open(),p=!0),ee(Nt,`RPC '${e}' stream ${i} sending:`,k),d.send(k))},Ao:()=>d.close()}),S=(k,v,m)=>{k.listen(v,b=>{try{m(b)}catch(D){setTimeout(()=>{throw D},0)}})};return S(d,sl.EventType.OPEN,()=>{_||(ee(Nt,`RPC '${e}' stream ${i} transport opened.`),A.So())}),S(d,sl.EventType.CLOSE,()=>{_||(_=!0,ee(Nt,`RPC '${e}' stream ${i} transport closed`),A.Do())}),S(d,sl.EventType.ERROR,k=>{_||(_=!0,ra(Nt,`RPC '${e}' stream ${i} transport errored:`,k),A.Do(new ne(q.UNAVAILABLE,"The operation could not be completed")))}),S(d,sl.EventType.MESSAGE,k=>{var v;if(!_){const m=k.data[0];Te(!!m);const b=m,D=(b==null?void 0:b.error)||((v=b[0])===null||v===void 0?void 0:v.error);if(D){ee(Nt,`RPC '${e}' stream ${i} received error:`,D);const V=D.status;let j=function(C){const x=Je[C];if(x!==void 0)return KR(x)}(V),P=D.message;j===void 0&&(j=q.INTERNAL,P="Unknown error status: "+V+" with message "+D.message),_=!0,A.Do(new ne(j,P)),d.close()}else ee(Nt,`RPC '${e}' stream ${i} received:`,m),A.vo(m)}}),S(a,ER.STAT_EVENT,k=>{k.stat===d_.PROXY?ee(Nt,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===d_.NOPROXY&&ee(Nt,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{A.bo()},0),A}}function bp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nd(t){return new KL(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e,n,r=1e3,i=1.5,s=6e4){this.li=e,this.timerId=n,this.Qo=r,this.Ko=i,this.$o=s,this.Uo=0,this.Wo=null,this.Go=Date.now(),this.reset()}reset(){this.Uo=0}zo(){this.Uo=this.$o}jo(e){this.cancel();const n=Math.floor(this.Uo+this.Ho()),r=Math.max(0,Date.now()-this.Go),i=Math.max(0,n-r);i>0&&ee("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Uo} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Wo=this.li.enqueueAfterDelay(this.timerId,i,()=>(this.Go=Date.now(),e())),this.Uo*=this.Ko,this.Uo<this.Qo&&(this.Uo=this.Qo),this.Uo>this.$o&&(this.Uo=this.$o)}Jo(){this.Wo!==null&&(this.Wo.skipDelay(),this.Wo=null)}cancel(){this.Wo!==null&&(this.Wo.cancel(),this.Wo=null)}Ho(){return(Math.random()-.5)*this.Uo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e,n,r,i,s,o,a,l){this.li=e,this.Yo=r,this.Zo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.Xo=0,this.e_=null,this.t_=null,this.stream=null,this.n_=0,this.r_=new ab(e,n)}i_(){return this.state===1||this.state===5||this.s_()}s_(){return this.state===2||this.state===3}start(){this.n_=0,this.state!==4?this.auth():this.o_()}async stop(){this.i_()&&await this.close(0)}__(){this.state=0,this.r_.reset()}a_(){this.s_()&&this.e_===null&&(this.e_=this.li.enqueueAfterDelay(this.Yo,6e4,()=>this.u_()))}c_(e){this.l_(),this.stream.send(e)}async u_(){if(this.s_())return this.close(0)}l_(){this.e_&&(this.e_.cancel(),this.e_=null)}h_(){this.t_&&(this.t_.cancel(),this.t_=null)}async close(e,n){this.l_(),this.h_(),this.r_.cancel(),this.Xo++,e!==4?this.r_.reset():n&&n.code===q.RESOURCE_EXHAUSTED?(Ur(n.toString()),Ur("Using maximum backoff delay to prevent overloading the backend."),this.r_.zo()):n&&n.code===q.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.P_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.po(n)}P_(){}auth(){this.state=1;const e=this.T_(this.Xo),n=this.Xo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Xo===n&&this.I_(r,i)},r=>{e(()=>{const i=new ne(q.UNKNOWN,"Fetching auth token failed: "+r.message);return this.E_(i)})})}I_(e,n){const r=this.T_(this.Xo);this.stream=this.d_(e,n),this.stream.Ro(()=>{r(()=>this.listener.Ro())}),this.stream.mo(()=>{r(()=>(this.state=2,this.t_=this.li.enqueueAfterDelay(this.Zo,1e4,()=>(this.s_()&&(this.state=3),Promise.resolve())),this.listener.mo()))}),this.stream.po(i=>{r(()=>this.E_(i))}),this.stream.onMessage(i=>{r(()=>++this.n_==1?this.A_(i):this.onNext(i))})}o_(){this.state=5,this.r_.jo(async()=>{this.state=0,this.start()})}E_(e){return ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}T_(e){return n=>{this.li.enqueueAndForget(()=>this.Xo===e?n():(ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class j5 extends lb{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}d_(e,n){return this.connection.qo("Listen",e,n)}A_(e){return this.onNext(e)}onNext(e){this.r_.reset();const n=ZL(this.serializer,e),r=function(s){if(!("targetChange"in s))return ae.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?ae.min():o.readTime?rr(o.readTime):ae.min()}(e);return this.listener.R_(n,r)}V_(e){const n={};n.database=w_(this.serializer),n.addTarget=function(s,o){let a;const l=o.target;if(a=m_(l)?{documents:e5(s,l)}:{query:t5(s,l).ct},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=ZR(s,o.resumeToken);const u=T_(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(ae.min())>0){a.readTime=Jh(s,o.snapshotVersion.toTimestamp());const u=T_(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=r5(this.serializer,e);r&&(n.labels=r),this.c_(n)}m_(e){const n={};n.database=w_(this.serializer),n.removeTarget=e,this.c_(n)}}class W5 extends lb{constructor(e,n,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}get f_(){return this.n_>0}start(){this.lastStreamToken=void 0,super.start()}P_(){this.f_&&this.g_([])}d_(e,n){return this.connection.qo("Write",e,n)}A_(e){return Te(!!e.streamToken),this.lastStreamToken=e.streamToken,Te(!e.writeResults||e.writeResults.length===0),this.listener.p_()}onNext(e){Te(!!e.streamToken),this.lastStreamToken=e.streamToken,this.r_.reset();const n=GL(e.writeResults,e.commitTime),r=rr(e.commitTime);return this.listener.y_(r,n)}w_(){const e={};e.database=w_(this.serializer),this.c_(e)}g_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>JL(this.serializer,r))};this.c_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5 extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.S_=!1}b_(){if(this.S_)throw new ne(q.FAILED_PRECONDITION,"The client has already been terminated.")}Oo(e,n,r,i){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Oo(e,v_(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ne(q.UNKNOWN,s.toString())})}ko(e,n,r,i,s){return this.b_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.ko(e,v_(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ne(q.UNKNOWN,o.toString())})}terminate(){this.S_=!0,this.connection.terminate()}}class H5{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.D_=0,this.v_=null,this.C_=!0}F_(){this.D_===0&&(this.M_("Unknown"),this.v_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.v_=null,this.x_("Backend didn't respond within 10 seconds."),this.M_("Offline"),Promise.resolve())))}O_(e){this.state==="Online"?this.M_("Unknown"):(this.D_++,this.D_>=1&&(this.N_(),this.x_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.M_("Offline")))}set(e){this.N_(),this.D_=0,e==="Online"&&(this.C_=!1),this.M_(e)}M_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}x_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.C_?(Ur(n),this.C_=!1):ee("OnlineStateTracker",n)}N_(){this.v_!==null&&(this.v_.cancel(),this.v_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X5{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.L_=[],this.B_=new Map,this.k_=new Set,this.q_=[],this.Q_=s,this.Q_.uo(o=>{r.enqueueAndForget(async()=>{Bs(this)&&(ee("RemoteStore","Restarting streams for network reachability change."),await async function(l){const u=le(l);u.k_.add(4),await Sc(u),u.K_.set("Unknown"),u.k_.delete(4),await rd(u)}(this))})}),this.K_=new H5(r,i)}}async function rd(t){if(Bs(t))for(const e of t.q_)await e(!0)}async function Sc(t){for(const e of t.q_)await e(!1)}function cb(t,e){const n=le(t);n.B_.has(e.targetId)||(n.B_.set(e.targetId,e),cy(n)?ly(n):ya(n).s_()&&ay(n,e))}function oy(t,e){const n=le(t),r=ya(n);n.B_.delete(e),r.s_()&&ub(n,e),n.B_.size===0&&(r.s_()?r.a_():Bs(n)&&n.K_.set("Unknown"))}function ay(t,e){if(t.U_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ae.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}ya(t).V_(e)}function ub(t,e){t.U_.xe(e),ya(t).m_(e)}function ly(t){t.U_=new $L({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.B_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),ya(t).start(),t.K_.F_()}function cy(t){return Bs(t)&&!ya(t).i_()&&t.B_.size>0}function Bs(t){return le(t).k_.size===0}function hb(t){t.U_=void 0}async function q5(t){t.K_.set("Online")}async function K5(t){t.B_.forEach((e,n)=>{ay(t,e)})}async function Y5(t,e){hb(t),cy(t)?(t.K_.O_(e),ly(t)):t.K_.set("Unknown")}async function Q5(t,e,n){if(t.K_.set("Online"),e instanceof QR&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.B_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.B_.delete(a),i.U_.removeTarget(a))}(t,e)}catch(r){ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await ef(t,r)}else if(e instanceof Ku?t.U_.$e(e):e instanceof YR?t.U_.Je(e):t.U_.Ge(e),!n.isEqual(ae.min()))try{const r=await ob(t.localStore);n.compareTo(r)>=0&&await function(s,o){const a=s.U_.it(o);return a.targetChanges.forEach((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=s.B_.get(u);h&&s.B_.set(u,h.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,u)=>{const h=s.B_.get(l);if(!h)return;s.B_.set(l,h.withResumeToken(Rt.EMPTY_BYTE_STRING,h.snapshotVersion)),ub(s,l);const d=new fi(h.target,l,u,h.sequenceNumber);ay(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){ee("RemoteStore","Failed to raise snapshot:",r),await ef(t,r)}}async function ef(t,e,n){if(!ma(e))throw e;t.k_.add(1),await Sc(t),t.K_.set("Offline"),n||(n=()=>ob(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ee("RemoteStore","Retrying IndexedDB access"),await n(),t.k_.delete(1),await rd(t)})}function fb(t,e){return e().catch(n=>ef(t,n,e))}async function id(t){const e=le(t),n=Oi(e);let r=e.L_.length>0?e.L_[e.L_.length-1].batchId:-1;for(;Z5(e);)try{const i=await O5(e.localStore,r);if(i===null){e.L_.length===0&&n.a_();break}r=i.batchId,J5(e,i)}catch(i){await ef(e,i)}db(e)&&pb(e)}function Z5(t){return Bs(t)&&t.L_.length<10}function J5(t,e){t.L_.push(e);const n=Oi(t);n.s_()&&n.f_&&n.g_(e.mutations)}function db(t){return Bs(t)&&!Oi(t).i_()&&t.L_.length>0}function pb(t){Oi(t).start()}async function G5(t){Oi(t).w_()}async function e8(t){const e=Oi(t);for(const n of t.L_)e.g_(n.mutations)}async function t8(t,e,n){const r=t.L_.shift(),i=ey.from(r,e,n);await fb(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await id(t)}async function n8(t,e){e&&Oi(t).f_&&await async function(r,i){if(function(o){return zL(o)&&o!==q.ABORTED}(i.code)){const s=r.L_.shift();Oi(r).__(),await fb(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await id(r)}}(t,e),db(t)&&pb(t)}async function LE(t,e){const n=le(t);n.asyncQueue.verifyOperationInProgress(),ee("RemoteStore","RemoteStore received new credentials");const r=Bs(n);n.k_.add(3),await Sc(n),r&&n.K_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.k_.delete(3),await rd(n)}async function r8(t,e){const n=le(t);e?(n.k_.delete(2),await rd(n)):e||(n.k_.add(2),await Sc(n),n.K_.set("Unknown"))}function ya(t){return t.W_||(t.W_=function(n,r,i){const s=le(n);return s.b_(),new j5(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Ro:q5.bind(null,t),mo:K5.bind(null,t),po:Y5.bind(null,t),R_:Q5.bind(null,t)}),t.q_.push(async e=>{e?(t.W_.__(),cy(t)?ly(t):t.K_.set("Unknown")):(await t.W_.stop(),hb(t))})),t.W_}function Oi(t){return t.G_||(t.G_=function(n,r,i){const s=le(n);return s.b_(),new W5(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Ro:()=>Promise.resolve(),mo:G5.bind(null,t),po:n8.bind(null,t),p_:e8.bind(null,t),y_:t8.bind(null,t)}),t.q_.push(async e=>{e?(t.G_.__(),await id(t)):(await t.G_.stop(),t.L_.length>0&&(ee("RemoteStore",`Stopping write stream with ${t.L_.length} pending writes`),t.L_=[]))})),t.G_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Si,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new uy(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ne(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hy(t,e){if(Ur("AsyncQueue",`${e}: ${t}`),ma(t))return new ne(q.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{static emptySet(e){return new Vo(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||re.comparator(n.key,r.key):(n,r)=>re.comparator(n.key,r.key),this.keyedMap=ol(),this.sortedSet=new ze(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof Vo)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new Vo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zE{constructor(){this.z_=new ze(re.comparator)}track(e){const n=e.doc.key,r=this.z_.get(n);r?e.type!==0&&r.type===3?this.z_=this.z_.insert(n,e):e.type===3&&r.type!==1?this.z_=this.z_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.z_=this.z_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.z_=this.z_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.z_=this.z_.remove(n):e.type===1&&r.type===2?this.z_=this.z_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.z_=this.z_.insert(n,{type:2,doc:e.doc}):se():this.z_=this.z_.insert(n,e)}j_(){const e=[];return this.z_.inorderTraversal((n,r)=>{e.push(r)}),e}}class la{constructor(e,n,r,i,s,o,a,l,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new la(e,n,Vo.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Zf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i8{constructor(){this.H_=void 0,this.J_=[]}Y_(){return this.J_.some(e=>e.Z_())}}class s8{constructor(){this.queries=jE(),this.onlineState="Unknown",this.X_=new Set}terminate(){(function(n,r){const i=le(n),s=i.queries;i.queries=jE(),s.forEach((o,a)=>{for(const l of a.J_)l.onError(r)})})(this,new ne(q.ABORTED,"Firestore shutting down"))}}function jE(){return new Fs(t=>FR(t),Zf)}async function o8(t,e){const n=le(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.Y_()&&e.Z_()&&(r=2):(s=new i8,r=e.Z_()?0:1);try{switch(r){case 0:s.H_=await n.onListen(i,!0);break;case 1:s.H_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=hy(o,`Initialization of query '${so(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.J_.push(e),e.ea(n.onlineState),s.H_&&e.ta(s.H_)&&fy(n)}async function a8(t,e){const n=le(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const o=s.J_.indexOf(e);o>=0&&(s.J_.splice(o,1),s.J_.length===0?i=e.Z_()?0:1:!s.Y_()&&e.Z_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function l8(t,e){const n=le(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.J_)a.ta(i)&&(r=!0);o.H_=i}}r&&fy(n)}function c8(t,e,n){const r=le(t),i=r.queries.get(e);if(i)for(const s of i.J_)s.onError(n);r.queries.delete(e)}function fy(t){t.X_.forEach(e=>{e.next()})}var S_,WE;(WE=S_||(S_={})).na="default",WE.Cache="cache";class u8{constructor(e,n,r){this.query=e,this.ra=n,this.ia=!1,this.sa=null,this.onlineState="Unknown",this.options=r||{}}ta(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new la(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ia?this.oa(e)&&(this.ra.next(e),n=!0):this._a(e,this.onlineState)&&(this.aa(e),n=!0),this.sa=e,n}onError(e){this.ra.error(e)}ea(e){this.onlineState=e;let n=!1;return this.sa&&!this.ia&&this._a(this.sa,e)&&(this.aa(this.sa),n=!0),n}_a(e,n){if(!e.fromCache||!this.Z_())return!0;const r=n!=="Offline";return(!this.options.ua||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}oa(e){if(e.docChanges.length>0)return!0;const n=this.sa&&this.sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}aa(e){e=la.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ia=!0,this.ra.next(e)}Z_(){return this.options.source!==S_.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e){this.key=e}}class _b{constructor(e){this.key=e}}class h8{constructor(e,n){this.query=e,this.da=n,this.Aa=null,this.hasCachedResults=!1,this.current=!1,this.Ra=fe(),this.mutatedKeys=fe(),this.Va=UR(e),this.ma=new Vo(this.Va)}get fa(){return this.da}ga(e,n){const r=n?n.pa:new zE,i=n?n.ma:this.ma;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((h,d)=>{const p=i.get(h),_=Jf(this.query,d)?d:null,A=!!p&&this.mutatedKeys.has(p.key),S=!!_&&(_.hasLocalMutations||this.mutatedKeys.has(_.key)&&_.hasCommittedMutations);let k=!1;p&&_?p.data.isEqual(_.data)?A!==S&&(r.track({type:3,doc:_}),k=!0):this.ya(p,_)||(r.track({type:2,doc:_}),k=!0,(l&&this.Va(_,l)>0||u&&this.Va(_,u)<0)&&(a=!0)):!p&&_?(r.track({type:0,doc:_}),k=!0):p&&!_&&(r.track({type:1,doc:p}),k=!0,(l||u)&&(a=!0)),k&&(_?(o=o.add(_),s=S?s.add(h):s.delete(h)):(o=o.delete(h),s=s.delete(h)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),s=s.delete(h.key),r.track({type:1,doc:h})}return{ma:o,pa:r,ss:a,mutatedKeys:s}}ya(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.ma;this.ma=e.ma,this.mutatedKeys=e.mutatedKeys;const o=e.pa.j_();o.sort((h,d)=>function(_,A){const S=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return se()}};return S(_)-S(A)}(h.type,d.type)||this.Va(h.doc,d.doc)),this.wa(r),i=i!=null&&i;const a=n&&!i?this.Sa():[],l=this.Ra.size===0&&this.current&&!i?1:0,u=l!==this.Aa;return this.Aa=l,o.length!==0||u?{snapshot:new la(this.query,e.ma,s,o,e.mutatedKeys,l===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),ba:a}:{ba:a}}ea(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ma:this.ma,pa:new zE,mutatedKeys:this.mutatedKeys,ss:!1},!1)):{ba:[]}}Da(e){return!this.da.has(e)&&!!this.ma.has(e)&&!this.ma.get(e).hasLocalMutations}wa(e){e&&(e.addedDocuments.forEach(n=>this.da=this.da.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.da=this.da.delete(n)),this.current=e.current)}Sa(){if(!this.current)return[];const e=this.Ra;this.Ra=fe(),this.ma.forEach(r=>{this.Da(r.key)&&(this.Ra=this.Ra.add(r.key))});const n=[];return e.forEach(r=>{this.Ra.has(r)||n.push(new _b(r))}),this.Ra.forEach(r=>{e.has(r)||n.push(new gb(r))}),n}va(e){this.da=e.ds,this.Ra=fe();const n=this.ga(e.documents);return this.applyChanges(n,!0)}Ca(){return la.fromInitialDocuments(this.query,this.ma,this.mutatedKeys,this.Aa===0,this.hasCachedResults)}}class f8{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class d8{constructor(e){this.key=e,this.Fa=!1}}class p8{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ma={},this.xa=new Fs(a=>FR(a),Zf),this.Oa=new Map,this.Na=new Set,this.La=new ze(re.comparator),this.Ba=new Map,this.ka=new ry,this.qa={},this.Qa=new Map,this.Ka=aa.Qn(),this.onlineState="Unknown",this.$a=void 0}get isPrimaryClient(){return this.$a===!0}}async function g8(t,e,n=!0){const r=wb(t);let i;const s=r.xa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Ca()):i=await mb(r,e,n,!0),i}async function _8(t,e){const n=wb(t);await mb(n,e,!0,!1)}async function mb(t,e,n,r){const i=await D5(t.localStore,tr(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await m8(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&cb(t.remoteStore,i),a}async function m8(t,e,n,r,i){t.Ua=(d,p,_)=>async function(S,k,v,m){let b=k.view.ga(v);b.ss&&(b=await UE(S.localStore,k.query,!1).then(({documents:P})=>k.view.ga(P,b)));const D=m&&m.targetChanges.get(k.targetId),V=m&&m.targetMismatches.get(k.targetId)!=null,j=k.view.applyChanges(b,S.isPrimaryClient,D,V);return HE(S,k.targetId,j.ba),j.snapshot}(t,d,p,_);const s=await UE(t.localStore,e,!0),o=new h8(e,s.ds),a=o.ga(s.documents),l=Ac.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,l);HE(t,n,u.ba);const h=new f8(e,n,o);return t.xa.set(e,h),t.Oa.has(n)?t.Oa.get(n).push(e):t.Oa.set(n,[e]),u.snapshot}async function y8(t,e,n){const r=le(t),i=r.xa.get(e),s=r.Oa.get(i.targetId);if(s.length>1)return r.Oa.set(i.targetId,s.filter(o=>!Zf(o,e))),void r.xa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await A_(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&oy(r.remoteStore,i.targetId),R_(r,i.targetId)}).catch(_a)):(R_(r,i.targetId),await A_(r.localStore,i.targetId,!0))}async function T8(t,e){const n=le(t),r=n.xa.get(e),i=n.Oa.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),oy(n.remoteStore,r.targetId))}async function v8(t,e,n){const r=I8(t);try{const i=await function(o,a){const l=le(o),u=at.now(),h=a.reduce((_,A)=>_.add(A.key),fe());let d,p;return l.persistence.runTransaction("Locally write mutations","readwrite",_=>{let A=Br(),S=fe();return l.hs.getEntries(_,h).next(k=>{A=k,A.forEach((v,m)=>{m.isValidDocument()||(S=S.add(v))})}).next(()=>l.localDocuments.getOverlayedDocuments(_,A)).next(k=>{d=k;const v=[];for(const m of a){const b=FL(m,d.get(m.key).overlayedDocument);b!=null&&v.push(new Us(m.key,b,CR(b.value.mapValue),nr.exists(!0)))}return l.mutationQueue.addMutationBatch(_,u,v,a)}).next(k=>{p=k;const v=k.applyToLocalDocumentSet(d,S);return l.documentOverlayCache.saveOverlays(_,k.batchId,v)})}).then(()=>({batchId:p.batchId,changes:VR(d)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,l){let u=o.qa[o.currentUser.toKey()];u||(u=new ze(de)),u=u.insert(a,l),o.qa[o.currentUser.toKey()]=u}(r,i.batchId,n),await Rc(r,i.changes),await id(r.remoteStore)}catch(i){const s=hy(i,"Failed to persist write");n.reject(s)}}async function yb(t,e){const n=le(t);try{const r=await k5(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.Ba.get(s);o&&(Te(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Fa=!0:i.modifiedDocuments.size>0?Te(o.Fa):i.removedDocuments.size>0&&(Te(o.Fa),o.Fa=!1))}),await Rc(n,r,e)}catch(r){await _a(r)}}function $E(t,e,n){const r=le(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.xa.forEach((s,o)=>{const a=o.view.ea(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const l=le(o);l.onlineState=a;let u=!1;l.queries.forEach((h,d)=>{for(const p of d.J_)p.ea(a)&&(u=!0)}),u&&fy(l)}(r.eventManager,e),i.length&&r.Ma.R_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function E8(t,e,n){const r=le(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Ba.get(e),s=i&&i.key;if(s){let o=new ze(re.comparator);o=o.insert(s,Dt.newNoDocument(s,ae.min()));const a=fe().add(s),l=new td(ae.min(),new Map,new ze(de),o,a);await yb(r,l),r.La=r.La.remove(s),r.Ba.delete(e),dy(r)}else await A_(r.localStore,e,!1).then(()=>R_(r,e,n)).catch(_a)}async function w8(t,e){const n=le(t),r=e.batch.batchId;try{const i=await N5(n.localStore,e);vb(n,r,null),Tb(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Rc(n,i)}catch(i){await _a(i)}}async function A8(t,e,n){const r=le(t);try{const i=await function(o,a){const l=le(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next(d=>(Te(d!==null),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d))).next(()=>l.mutationQueue.performConsistencyCheck(u)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h)).next(()=>l.localDocuments.getDocuments(u,h))})}(r.localStore,e);vb(r,e,n),Tb(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Rc(r,i)}catch(i){await _a(i)}}function Tb(t,e){(t.Qa.get(e)||[]).forEach(n=>{n.resolve()}),t.Qa.delete(e)}function vb(t,e,n){const r=le(t);let i=r.qa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.qa[r.currentUser.toKey()]=i}}function R_(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Oa.get(e))t.xa.delete(r),n&&t.Ma.Wa(r,n);t.Oa.delete(e),t.isPrimaryClient&&t.ka.yr(e).forEach(r=>{t.ka.containsKey(r)||Eb(t,r)})}function Eb(t,e){t.Na.delete(e.path.canonicalString());const n=t.La.get(e);n!==null&&(oy(t.remoteStore,n),t.La=t.La.remove(e),t.Ba.delete(n),dy(t))}function HE(t,e,n){for(const r of n)r instanceof gb?(t.ka.addReference(r.key,e),S8(t,r)):r instanceof _b?(ee("SyncEngine","Document no longer in limbo: "+r.key),t.ka.removeReference(r.key,e),t.ka.containsKey(r.key)||Eb(t,r.key)):se()}function S8(t,e){const n=e.key,r=n.path.canonicalString();t.La.get(n)||t.Na.has(r)||(ee("SyncEngine","New document in limbo: "+n),t.Na.add(r),dy(t))}function dy(t){for(;t.Na.size>0&&t.La.size<t.maxConcurrentLimboResolutions;){const e=t.Na.values().next().value;t.Na.delete(e);const n=new re(De.fromString(e)),r=t.Ka.next();t.Ba.set(r,new d8(n)),t.La=t.La.insert(n,r),cb(t.remoteStore,new fi(tr(DR(n.path)),r,"TargetPurposeLimboResolution",qf.oe))}}async function Rc(t,e,n){const r=le(t),i=[],s=[],o=[];r.xa.isEmpty()||(r.xa.forEach((a,l)=>{o.push(r.Ua(l,e,n).then(u=>{var h;if((u||n)&&r.isPrimaryClient){const d=u?!u.fromCache:(h=n==null?void 0:n.targetChanges.get(l.targetId))===null||h===void 0?void 0:h.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(u){i.push(u);const d=sy.zi(l.targetId,u);s.push(d)}}))}),await Promise.all(o),r.Ma.R_(i),await async function(l,u){const h=le(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>H.forEach(u,p=>H.forEach(p.Wi,_=>h.persistence.referenceDelegate.addReference(d,p.targetId,_)).next(()=>H.forEach(p.Gi,_=>h.persistence.referenceDelegate.removeReference(d,p.targetId,_)))))}catch(d){if(!ma(d))throw d;ee("LocalStore","Failed to update sequence numbers: "+d)}for(const d of u){const p=d.targetId;if(!d.fromCache){const _=h.us.get(p),A=_.snapshotVersion,S=_.withLastLimboFreeSnapshotVersion(A);h.us=h.us.insert(p,S)}}}(r.localStore,s))}async function R8(t,e){const n=le(t);if(!n.currentUser.isEqual(e)){ee("SyncEngine","User change. New user:",e.toKey());const r=await sb(n.localStore,e);n.currentUser=e,function(s,o){s.Qa.forEach(a=>{a.forEach(l=>{l.reject(new ne(q.CANCELLED,o))})}),s.Qa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Rc(n,r.Ts)}}function b8(t,e){const n=le(t),r=n.Ba.get(e);if(r&&r.Fa)return fe().add(r.key);{let i=fe();const s=n.Oa.get(e);if(!s)return i;for(const o of s){const a=n.xa.get(o);i=i.unionWith(a.view.fa)}return i}}function wb(t){const e=le(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=yb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=b8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=E8.bind(null,e),e.Ma.R_=l8.bind(null,e.eventManager),e.Ma.Wa=c8.bind(null,e.eventManager),e}function I8(t){const e=le(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=w8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=A8.bind(null,e),e}class tf{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=nd(e.databaseInfo.databaseId),this.sharedClientState=this.za(e),this.persistence=this.ja(e),await this.persistence.start(),this.localStore=this.Ha(e),this.gcScheduler=this.Ja(e,this.localStore),this.indexBackfillerScheduler=this.Ya(e,this.localStore)}Ja(e,n){return null}Ya(e,n){return null}Ha(e){return x5(this.persistence,new C5,e.initialUser,this.serializer)}ja(e){return new ib(iy.ei,this.serializer)}za(e){return new U5}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}tf.provider={build:()=>new tf};class C8 extends tf{constructor(e){super(),this.cacheSizeBytes=e}Ja(e,n){Te(this.persistence.referenceDelegate instanceof Gh);const r=this.persistence.referenceDelegate.garbageCollector;return new d5(r,e.asyncQueue,n)}ja(e){const n=this.cacheSizeBytes!==void 0?Xt.withCacheSize(this.cacheSizeBytes):Xt.DEFAULT;return new ib(r=>Gh.ei(r,n),this.serializer)}}class b_{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$E(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=R8.bind(null,this.syncEngine),await r8(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new s8}()}createDatastore(e){const n=nd(e.databaseInfo.databaseId),r=function(s){return new z5(s)}(e.databaseInfo);return function(s,o,a,l){return new $5(s,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new X5(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>$E(this.syncEngine,n,0),function(){return VE.p()?new VE:new B5}())}createSyncEngine(e,n){return function(i,s,o,a,l,u,h){const d=new p8(i,s,o,a,l,u);return h&&(d.$a=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=le(i);ee("RemoteStore","RemoteStore shutting down."),s.k_.add(5),await Sc(s),s.Q_.shutdown(),s.K_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}b_.provider={build:()=>new b_};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P8{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Xa(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Xa(this.observer.error,e):Ur("Uncaught Error in snapshot listener:",e.toString()))}eu(){this.muted=!0}Xa(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x8{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=kt.UNAUTHENTICATED,this.clientId=RR.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{ee("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ee("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Si;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=hy(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ip(t,e){t.asyncQueue.verifyOperationInProgress(),ee("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await sb(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function XE(t,e){t.asyncQueue.verifyOperationInProgress();const n=await N8(t);ee("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>LE(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>LE(e.remoteStore,i)),t._onlineComponents=e}async function N8(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ee("FirestoreClient","Using user provided OfflineComponentProvider");try{await Ip(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===q.FAILED_PRECONDITION||i.code===q.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;ra("Error using user provided cache. Falling back to memory cache: "+n),await Ip(t,new tf)}}else ee("FirestoreClient","Using default OfflineComponentProvider"),await Ip(t,new C8(void 0));return t._offlineComponents}async function Ab(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ee("FirestoreClient","Using user provided OnlineComponentProvider"),await XE(t,t._uninitializedComponentsProvider._online)):(ee("FirestoreClient","Using default OnlineComponentProvider"),await XE(t,new b_))),t._onlineComponents}function k8(t){return Ab(t).then(e=>e.syncEngine)}async function M8(t){const e=await Ab(t),n=e.eventManager;return n.onListen=g8.bind(null,e.syncEngine),n.onUnlisten=y8.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=_8.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=T8.bind(null,e.syncEngine),n}function O8(t,e,n={}){const r=new Si;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,u){const h=new P8({next:p=>{h.eu(),o.enqueueAndForget(()=>a8(s,d)),p.fromCache&&l.source==="server"?u.reject(new ne(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(p)},error:p=>u.reject(p)}),d=new u8(a,h,{includeMetadataChanges:!0,ua:!0});return o8(s,d)}(await M8(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sb(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qE=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(t,e,n){if(!n)throw new ne(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function D8(t,e,n,r){if(e===!0&&r===!0)throw new ne(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function KE(t){if(!re.isDocumentKey(t))throw new ne(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function YE(t){if(re.isDocumentKey(t))throw new ne(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function py(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":se()}function lc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ne(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=py(t);throw new ne(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QE{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ne(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ne(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}D8("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sb((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new ne(q.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class sd{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new QE({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ne(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ne(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new QE(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new jV;switch(r.type){case"firstParty":return new XV(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ne(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=qE.get(n);r&&(ee("ComponentProvider","Removing Datastore"),qE.delete(n),r.terminate())}(this),Promise.resolve()}}function F8(t,e,n,r={}){var i;const s=(t=lc(t,sd))._getSettings(),o=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&ra("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=kt.MOCK_USER;else{a=A6(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new ne(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new kt(u)}t._authCredentials=new WV(new SR(a,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new od(this.firestore,e,this._query)}}class Un{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ri(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Un(this.firestore,e,this._key)}}class Ri extends od{constructor(e,n,r){super(e,n,DR(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Un(this.firestore,null,new re(e))}withConverter(e){return new Ri(this.firestore,e,this._path)}}function bb(t,e,...n){if(t=Gl(t),Rb("collection","path",e),t instanceof sd){const r=De.fromString(e,...n);return YE(r),new Ri(t,null,r)}{if(!(t instanceof Un||t instanceof Ri))throw new ne(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return YE(r),new Ri(t.firestore,null,r)}}function Ib(t,e,...n){if(t=Gl(t),arguments.length===1&&(e=RR.newId()),Rb("doc","path",e),t instanceof sd){const r=De.fromString(e,...n);return KE(r),new Un(t,null,new re(r))}{if(!(t instanceof Un||t instanceof Ri))throw new ne(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return KE(r),new Un(t.firestore,t instanceof Ri?t.converter:null,new re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZE{constructor(e=Promise.resolve()){this.Iu=[],this.Eu=!1,this.du=[],this.Au=null,this.Ru=!1,this.Vu=!1,this.mu=[],this.r_=new ab(this,"async_queue_retry"),this.fu=()=>{const r=bp();r&&ee("AsyncQueue","Visibility state changed to "+r.visibilityState),this.r_.Jo()},this.gu=e;const n=bp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.fu)}get isShuttingDown(){return this.Eu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.yu(e)}enterRestrictedMode(e){if(!this.Eu){this.Eu=!0,this.Vu=e||!1;const n=bp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.fu)}}enqueue(e){if(this.pu(),this.Eu)return new Promise(()=>{});const n=new Si;return this.yu(()=>this.Eu&&this.Vu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Iu.push(e),this.wu()))}async wu(){if(this.Iu.length!==0){try{await this.Iu[0](),this.Iu.shift(),this.r_.reset()}catch(e){if(!ma(e))throw e;ee("AsyncQueue","Operation failed with retryable error: "+e)}this.Iu.length>0&&this.r_.jo(()=>this.wu())}}yu(e){const n=this.gu.then(()=>(this.Ru=!0,e().catch(r=>{this.Au=r,this.Ru=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Ur("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.Ru=!1,r))));return this.gu=n,n}enqueueAfterDelay(e,n,r){this.pu(),this.mu.indexOf(e)>-1&&(n=0);const i=uy.createAndSchedule(this,e,n,r,s=>this.Su(s));return this.du.push(i),i}pu(){this.Au&&se()}verifyOperationInProgress(){}async bu(){let e;do e=this.gu,await e;while(e!==this.gu)}Du(e){for(const n of this.du)if(n.timerId===e)return!0;return!1}vu(e){return this.bu().then(()=>{this.du.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.du)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.bu()})}Cu(e){this.mu.push(e)}Su(e){const n=this.du.indexOf(e);this.du.splice(n,1)}}class ad extends sd{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new ZE,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ZE(e),this._firestoreClient=void 0,await e}}}function U8(t,e){const n=typeof t=="object"?t:kV(),r=typeof t=="string"?t:"(default)",i=CV(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=E6("firestore");s&&F8(i,...s)}return i}function Cb(t){if(t._terminated)throw new ne(q.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||B8(t),t._firestoreClient}function B8(t){var e,n,r;const i=t._freezeSettings(),s=function(a,l,u,h){return new aL(a,l,u,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,Sb(h.experimentalLongPollingOptions),h.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new x8(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ca(Rt.fromBase64String(e))}catch(n){throw new ne(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new ca(Rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gy{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ne(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pb{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ne(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ne(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return de(this._lat,e._lat)||de(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V8=/^__.*__$/;class L8{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Us(e,this.data,this.fieldMask,n,this.fieldTransforms):new wc(e,this.data,n,this.fieldTransforms)}}function xb(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw se()}}class yy{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Fu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Mu(){return this.settings.Mu}xu(e){return new yy(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ou(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.xu({path:r,Nu:!1});return i.Lu(e),i}Bu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.xu({path:r,Nu:!1});return i.Fu(),i}ku(e){return this.xu({path:void 0,Nu:!0})}qu(e){return nf(e,this.settings.methodName,this.settings.Qu||!1,this.path,this.settings.Ku)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Fu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lu(this.path.get(e))}Lu(e){if(e.length===0)throw this.qu("Document fields must not be empty");if(xb(this.Mu)&&V8.test(e))throw this.qu('Document fields cannot begin and end with "__"')}}class z8{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||nd(e)}$u(e,n,r,i=!1){return new yy({Mu:e,methodName:n,Ku:r,path:wt.emptyPath(),Nu:!1,Qu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function j8(t){const e=t._freezeSettings(),n=nd(t._databaseId);return new z8(t._databaseId,!!e.ignoreUndefinedProperties,n)}function W8(t,e,n,r,i,s={}){const o=t.$u(s.merge||s.mergeFields?2:0,e,n,i);Ob("Data must be an object, but it was:",o,r);const a=kb(r,o);let l,u;if(s.merge)l=new On(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const h=[];for(const d of s.mergeFields){const p=$8(e,d,n);if(!o.contains(p))throw new ne(q.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);X8(h,p)||h.push(p)}l=new On(h),u=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,u=o.fieldTransforms;return new L8(new mn(a),l,u)}function Nb(t,e){if(Mb(t=Gl(t)))return Ob("Unsupported field value:",e,t),kb(t,e);if(t instanceof Pb)return function(r,i){if(!xb(i.Mu))throw i.qu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.qu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Nu&&e.Mu!==4)throw e.qu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let l=Nb(a,i.ku(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Gl(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return xL(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=at.fromDate(r);return{timestampValue:Jh(i.serializer,s)}}if(r instanceof at){const s=new at(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Jh(i.serializer,s)}}if(r instanceof _y)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ca)return{bytesValue:ZR(i.serializer,r._byteString)};if(r instanceof Un){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.qu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ny(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof my)return function(o,a){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.qu("VectorValues must only contain numeric values.");return Jm(a.serializer,l)})}}}}}}(r,i);throw i.qu(`Unsupported field value: ${py(r)}`)}(t,e)}function kb(t,e){const n={};return bR(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ds(t,(r,i)=>{const s=Nb(i,e.Ou(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Mb(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof at||t instanceof _y||t instanceof ca||t instanceof Un||t instanceof Pb||t instanceof my)}function Ob(t,e,n){if(!Mb(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=py(n);throw r==="an object"?e.qu(t+" a custom object"):e.qu(t+" "+r)}}function $8(t,e,n){if((e=Gl(e))instanceof gy)return e._internalPath;if(typeof e=="string")return Db(t,e);throw nf("Field path arguments must be of type string or ",t,!1,void 0,n)}const H8=new RegExp("[~\\*/\\[\\]]");function Db(t,e,n){if(e.search(H8)>=0)throw nf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new gy(...e.split("."))._internalPath}catch{throw nf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function nf(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new ne(q.INVALID_ARGUMENT,a+t+l)}function X8(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new q8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Ub("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class q8 extends Fb{data(){return super.data()}}function Ub(t,e){return typeof e=="string"?Db(t,e):e instanceof gy?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K8(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ne(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Y8{convertValue(e,n="none"){switch(Mi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return qe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ki(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw se()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Ds(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var n,r,i;const s=(i=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>qe(o.doubleValue));return new my(s)}convertGeoPoint(e){return new _y(qe(e.latitude),qe(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Yf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(rc(e));default:return null}}convertTimestamp(e){const n=Ni(e);return new at(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=De.fromString(e);Te(rb(r));const i=new ic(r.get(1),r.get(3)),s=new re(r.popFirst(5));return i.isEqual(n)||Ur(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q8(t,e,n){let r;return r=t?t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Z8 extends Fb{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Yu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Ub("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class Yu extends Z8{data(e={}){return super.data(e)}}class J8{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new Cu(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Yu(this._firestore,this._userDataWriter,r.key,r,new Cu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ne(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const l=new Yu(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Cu(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const l=new Yu(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Cu(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:G8(a.type),doc:l,oldIndex:u,newIndex:h}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function G8(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return se()}}class e9 extends Y8{constructor(e){super(),this.firestore=e}convertBytes(e){return new ca(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Un(this.firestore,null,n)}}function t9(t){t=lc(t,od);const e=lc(t.firestore,ad),n=Cb(e),r=new e9(e);return K8(t._query),O8(n,t._query).then(i=>new J8(e,r,t,i))}function n9(t){return Bb(lc(t.firestore,ad),[new Gm(t._key,nr.none())])}function r9(t,e){const n=lc(t.firestore,ad),r=Ib(t),i=Q8(t.converter,e);return Bb(n,[W8(j8(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,nr.exists(!1))]).then(()=>r)}function Bb(t,e){return function(r,i){const s=new Si;return r.asyncQueue.enqueueAndForget(async()=>v8(await k8(r),i,s)),s.promise}(Cb(t),e)}(function(e,n=!0){(function(i){ga=i})(NV),Xh(new ec("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new ad(new $V(r.getProvider("auth-internal")),new KV(r.getProvider("app-check-internal")),function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new ne(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ic(u.options.projectId,h)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Bo(pE,"4.7.5",e),Bo(pE,"4.7.5","esm2017")})();const i9={apiKey:"AIzaSyA3jSqDANzu8yCScJ5lAYIyuxgg6P33G3o",authDomain:"ar-navigation-533e7.firebaseapp.com",projectId:"ar-navigation-533e7",storageBucket:"ar-navigation-533e7.firebasestorage.app",messagingSenderId:"555192352525",appId:"1:555192352525:web:a75c996384b26911d9ba44"};var s9="firebase",o9="11.0.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bo(s9,o9,"app");const a9=gR(i9),Ty=U8(a9),l9=async(t,e)=>{const n=bb(Ty,"stick-location");try{return(await r9(n,{lat:t,lng:e})).id}catch(r){return console.error("Error adding document: ",r),!1}},c9=async()=>{const t=bb(Ty,"stick-location");return(await t9(t)).docs.map(n=>({id:n.id,...n.data()}))},u9=async t=>{const e=Ib(Ty,"stick-location",t);try{return await n9(e),!0}catch(n){return console.error("Error deleting document: ",n),!1}};function h9(t,e){return f9(t,e,window.localStorage)}function f9(t,e,n){const[r,i]=Q.useState(()=>{const o=n.getItem(t);return o!=null?JSON.parse(o):e});Q.useEffect(()=>{if(r===void 0)return n.removeItem(t);n.setItem(t,JSON.stringify(r))},[t,r,n]);const s=Q.useCallback(()=>{i(void 0)},[]);return[r,i,s]}const d9=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,p9=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,JE=[0,0,0,255],g9={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:JE},getLineColor:{type:"accessor",value:JE},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class bl extends $f{getShaders(){return super.getShaders({vs:d9,fs:p9,modules:[CM,QM]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:u,lineWidthUnits:h,lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:_}=this.props,A=this.state.model;A.setUniforms(e),A.setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:u,radiusUnits:Fh[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Fh[h],lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:_}),A.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ql(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new UO({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}bl.defaultProps=g9;bl.layerName="ScatterplotLayer";const _9={longitude:-71.978,latitude:-13.516,zoom:13},m9=["mapbox://styles/mapbox/streets-v12","mapbox://styles/mapbox/satellite-v9","mapbox://styles/mapbox/satellite-streets-v12","mapbox://styles/mapbox/navigation-night-v1"];function y9(){const[t,e]=Q.useState([]),[n,r]=Q.useState({}),[i,s]=Q.useState({}),[o,a]=Q.useState(!1),[l,u]=h9("style",0),h=()=>{u(S=>S>=3?0:S+1)},d=async()=>{const{lng:S,lat:k}=i;a(!0);const v=await l9(k,S);v&&(e(m=>[...m,{id:v,lat:k,lng:S}]),s({})),a(!1)},p=S=>{r({});const[k,v]=S.coordinate;s({lng:k,lat:v})},_=async()=>{a(!0),await u9(n.id)&&(e(k=>k.filter(v=>v.id!==n.id)),r({})),a(!1)},A=async()=>{a(!0);const S=await c9();e(S),console.log(S),a(!1)};return Q.useEffect(()=>{A()},[]),dt.jsxs(dt.Fragment,{children:[dt.jsxs(FB,{controller:{dragPan:!0},initialViewState:_9,onClick:p,children:[dt.jsx(bl,{id:"route-points",data:t,getPosition:S=>[S.lng,S.lat],getRadius:1,getFillColor:[255,140,0],getLineColor:[255,255,255],getLineWidth:.5,stroked:!0,radiusMinPixels:10,autoHighlight:!0,highlightColor:[255,0,0,100],pickable:!0,onClick:S=>{console.log(S.object),setTimeout(()=>{r(S.object),s({})},50)}}),dt.jsx(bl,{id:"target-points",data:[n],getPosition:S=>[S.lng,S.lat],getRadius:1,getFillColor:[10,140,0],getLineColor:[10,100,25],getLineWidth:.5,stroked:!0,radiusMinPixels:10,autoHighlight:!0}),dt.jsx(bl,{id:"new-point",data:[i],getPosition:S=>[S.lng,S.lat],getRadius:1,getFillColor:[100,140,0],getLineColor:[100,100,255],getLineWidth:.5,stroked:!0,radiusMinPixels:10,autoHighlight:!0}),dt.jsx(u6,{mapStyle:m9[l],mapboxAccessToken:"pk.eyJ1Ijoia20xMTVmcmFuY28iLCJhIjoiY2x4cGE5emJvMG1vMDJrbzZpdXQwaXp6NCJ9.OMUGXuwdfhrcCwcwwKIZ5A",children:dt.jsx(h6,{})})]}),dt.jsxs("div",{style:{position:"absolute",z:1,top:0,left:0,background:"rgb(0,0,0)",opacity:.5,maxHeight:"100vh",margin:"0.5em",borderRadius:"0.5em"},children:[dt.jsxs("button",{className:"m-1",onClick:h,children:["Map ",l+1,"/4"]}),dt.jsxs("p",{className:"m-1",children:["Piles: ",t.length]}),"id"in n?dt.jsxs("div",{children:[dt.jsx("p",{className:"m-1",children:"Pile Selected"}),dt.jsx("button",{onClick:_,children:"Delete"})]}):dt.jsx("p",{className:"m-1",children:"No pile selected"}),"lng"in i&&dt.jsx("button",{className:"m-1",onClick:d,children:"Add point"})]})]})}fS(document.getElementById("root")).render(dt.jsx(Q.StrictMode,{children:dt.jsx(y9,{})}));export{v9 as c,Zb as g};
